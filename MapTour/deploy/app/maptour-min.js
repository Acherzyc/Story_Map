$(function(){$("input[type=file]").each(function(a,b){if("undefined"==typeof $(this).attr("data-bfi-disabled")){var d="Browse";"undefined"!=typeof $(this).attr("title")&&(d=$(this).attr("title"));var f=$("<div>").append($(b).eq(0).clone()).html(),e=$(this).attr("class");$(b).replaceWith('<a class="file-input-wrapper btn '+e+'">'+d+f+"</a>")}}).promise().done(function(){$(".file-input-wrapper").mousemove(function(a){var b,d,f,e,g,j;d=$(this);b=d.find("input");f=d.offset().left;d=d.offset().top;e=b.width();
g=b.height();j=a.pageX;a=a.pageY;moveInputX=j-f-e+20;moveInputY=a-d-g/2;b.css({left:moveInputX,top:moveInputY})});$(".file-input-wrapper input[type=file]").change(function(){$(this).parent().next().has("file-input-name").remove();$(this).parent().after('<span class="file-input-name">'+$(this).val()+"</span>")})});$("link[rel=stylesheet]").eq(0).before("<style>.file-input-wrapper { overflow: hidden; position: relative; cursor: pointer; z-index: 1; }.file-input-wrapper input[type=file], .file-input-wrapper input[type=file]:focus, .file-input-wrapper input[type=file]:hover { position: absolute; top: 0; left: 0; cursor: pointer; opacity: 0; filter: alpha(opacity=0); z-index: 99; outline: 0; }.file-input-name { margin-left: 8px; }</style>")});(function(a,b){function d(a){if(""===g)return a;a=a.charAt(0).toUpperCase()+a.substr(1);return g+a}var f=Math,e=b.createElement("div").style,g;a:{for(var j=["t","webkitT","MozT","msT","OT"],k,l=0,p=j.length;l<p;l++)if(k=j[l]+"ransform",k in e){g=j[l].substr(0,j[l].length-1);break a}g=!1}var m=g?"-"+g.toLowerCase()+"-":"",s=d("transform"),o=d("transitionProperty"),n=d("transitionDuration"),r=d("transformOrigin"),t=d("transitionTimingFunction"),q=d("transitionDelay"),y=/android/gi.test(navigator.appVersion),
x=/iphone|ipad/gi.test(navigator.appVersion),j=/hp-tablet/gi.test(navigator.appVersion),v=d("perspective")in e,u="ontouchstart"in a&&!j,H=!1!==g,C=d("transition")in e,K="onorientationchange"in a?"orientationchange":"resize",h=u?"touchstart":"mousedown",z=u?"touchmove":"mousemove",w=u?"touchend":"mouseup",E=u?"touchcancel":"mouseup",F;F=!1===g?!1:{"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"otransitionend",ms:"MSTransitionEnd"}[g];var L=a.requestAnimationFrame||a.webkitRequestAnimationFrame||
a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(a){return setTimeout(a,1)},G=a.cancelRequestAnimationFrame||a.webkitCancelAnimationFrame||a.webkitCancelRequestAnimationFrame||a.mozCancelRequestAnimationFrame||a.oCancelRequestAnimationFrame||a.msCancelRequestAnimationFrame||clearTimeout,D=v?" translateZ(0)":"",j=function(d,f){var e=this,g;e.wrapper="object"==typeof d?d:b.getElementById(d);e.wrapper.style.overflow="hidden";e.scroller=e.wrapper.children[0];e.options=
{hScroll:!0,vScroll:!0,x:0,y:0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,topOffset:0,checkDOMChanges:!1,handleClick:!0,hScrollbar:!0,vScrollbar:!0,fixedScrollbar:y,hideScrollbar:x,fadeScrollbar:x&&v,scrollbarClass:"",zoom:!1,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",snap:!1,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(a){a.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,
onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(g in f)e.options[g]=f[g];e.x=e.options.x;e.y=e.options.y;e.options.useTransform=H&&e.options.useTransform;e.options.hScrollbar=e.options.hScroll&&e.options.hScrollbar;e.options.vScrollbar=e.options.vScroll&&e.options.vScrollbar;e.options.zoom=e.options.useTransform&&e.options.zoom;e.options.useTransition=C&&e.options.useTransition;e.options.zoom&&y&&(D="");e.scroller.style[o]=e.options.useTransform?m+
"transform":"top left";e.scroller.style[n]="0";e.scroller.style[r]="0 0";e.options.useTransition&&(e.scroller.style[t]="cubic-bezier(0.33,0.66,0.66,1)");e.options.useTransform?e.scroller.style[s]="translate("+e.x+"px,"+e.y+"px)"+D:e.scroller.style.cssText+=";position:absolute;top:"+e.y+"px;left:"+e.x+"px";e.options.useTransition&&(e.options.fixedScrollbar=!0);e.refresh();e._bind(K,a);e._bind(h);!u&&"none"!=e.options.wheelAction&&(e._bind("DOMMouseScroll"),e._bind("mousewheel"));e.options.checkDOMChanges&&
(e.checkDOMTime=setInterval(function(){e._checkDOMChanges()},500))};j.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(a){switch(a.type){case h:if(!u&&0!==a.button)break;this._start(a);break;case z:this._move(a);break;case w:case E:this._end(a);break;case K:this._resize();break;case "DOMMouseScroll":case "mousewheel":this._wheel(a);break;case F:this._transitionEnd(a)}},_checkDOMChanges:function(){!this.moved&&
(!this.zoomed&&!(this.animating||this.scrollerW==this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale))&&this.refresh()},_scrollbar:function(a){var d;this[a+"Scrollbar"]?(this[a+"ScrollbarWrapper"]||(d=b.createElement("div"),this.options.scrollbarClass?d.className=this.options.scrollbarClass+a.toUpperCase():d.style.cssText="position:absolute;z-index:100;"+("h"==a?"height:7px;bottom:1px;left:2px;right:"+(this.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(this.hScrollbar?
"7":"2")+"px;top:2px;right:1px"),d.style.cssText+=";pointer-events:none;"+m+"transition-property:opacity;"+m+"transition-duration:"+(this.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(this.options.hideScrollbar?"0":"1"),this.wrapper.appendChild(d),this[a+"ScrollbarWrapper"]=d,d=b.createElement("div"),this.options.scrollbarClass||(d.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);"+m+"background-clip:padding-box;"+m+"box-sizing:border-box;"+
("h"==a?"height:100%":"width:100%")+";"+m+"border-radius:3px;border-radius:3px"),d.style.cssText+=";pointer-events:none;"+m+"transition-property:"+m+"transform;"+m+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);"+m+"transition-duration:0;"+m+"transform: translate(0,0)"+D,this.options.useTransition&&(d.style.cssText+=";"+m+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)"),this[a+"ScrollbarWrapper"].appendChild(d),this[a+"ScrollbarIndicator"]=d),"h"==a?(this.hScrollbarSize=this.hScrollbarWrapper.clientWidth,
this.hScrollbarIndicatorSize=f.max(f.round(this.hScrollbarSize*this.hScrollbarSize/this.scrollerW),8),this.hScrollbarIndicator.style.width=this.hScrollbarIndicatorSize+"px",this.hScrollbarMaxScroll=this.hScrollbarSize-this.hScrollbarIndicatorSize,this.hScrollbarProp=this.hScrollbarMaxScroll/this.maxScrollX):(this.vScrollbarSize=this.vScrollbarWrapper.clientHeight,this.vScrollbarIndicatorSize=f.max(f.round(this.vScrollbarSize*this.vScrollbarSize/this.scrollerH),8),this.vScrollbarIndicator.style.height=
this.vScrollbarIndicatorSize+"px",this.vScrollbarMaxScroll=this.vScrollbarSize-this.vScrollbarIndicatorSize,this.vScrollbarProp=this.vScrollbarMaxScroll/this.maxScrollY),this._scrollbarPos(a,!0)):this[a+"ScrollbarWrapper"]&&(H&&(this[a+"ScrollbarIndicator"].style[s]=""),this[a+"ScrollbarWrapper"].parentNode.removeChild(this[a+"ScrollbarWrapper"]),this[a+"ScrollbarWrapper"]=null,this[a+"ScrollbarIndicator"]=null)},_resize:function(){var a=this;setTimeout(function(){a.refresh()},y?200:0)},_pos:function(a,
b){this.zoomed||(a=this.hScroll?a:0,b=this.vScroll?b:0,this.options.useTransform?this.scroller.style[s]="translate("+a+"px,"+b+"px) scale("+this.scale+")"+D:(a=f.round(a),b=f.round(b),this.scroller.style.left=a+"px",this.scroller.style.top=b+"px"),this.x=a,this.y=b,this._scrollbarPos("h"),this._scrollbarPos("v"))},_scrollbarPos:function(a,b){var d="h"==a?this.x:this.y;this[a+"Scrollbar"]&&(d*=this[a+"ScrollbarProp"],0>d?(this.options.fixedScrollbar||(d=this[a+"ScrollbarIndicatorSize"]+f.round(3*d),
8>d&&(d=8),this[a+"ScrollbarIndicator"].style["h"==a?"width":"height"]=d+"px"),d=0):d>this[a+"ScrollbarMaxScroll"]&&(this.options.fixedScrollbar?d=this[a+"ScrollbarMaxScroll"]:(d=this[a+"ScrollbarIndicatorSize"]-f.round(3*(d-this[a+"ScrollbarMaxScroll"])),8>d&&(d=8),this[a+"ScrollbarIndicator"].style["h"==a?"width":"height"]=d+"px",d=this[a+"ScrollbarMaxScroll"]+(this[a+"ScrollbarIndicatorSize"]-d))),this[a+"ScrollbarWrapper"].style[q]="0",this[a+"ScrollbarWrapper"].style.opacity=b&&this.options.hideScrollbar?
"0":"1",this[a+"ScrollbarIndicator"].style[s]="translate("+("h"==a?d+"px,0)":"0,"+d+"px)")+D)},_start:function(b){var d=u?b.touches[0]:b,e,g;if(this.enabled){this.options.onBeforeScrollStart&&this.options.onBeforeScrollStart.call(this,b);(this.options.useTransition||this.options.zoom)&&this._transitionTime(0);this.zoomed=this.animating=this.moved=!1;this.dirY=this.dirX=this.absDistY=this.absDistX=this.distY=this.distX=0;this.options.zoom&&(u&&1<b.touches.length)&&(g=f.abs(b.touches[0].pageX-b.touches[1].pageX),
e=f.abs(b.touches[0].pageY-b.touches[1].pageY),this.touchesDistStart=f.sqrt(g*g+e*e),this.originX=f.abs(b.touches[0].pageX+b.touches[1].pageX-2*this.wrapperOffsetLeft)/2-this.x,this.originY=f.abs(b.touches[0].pageY+b.touches[1].pageY-2*this.wrapperOffsetTop)/2-this.y,this.options.onZoomStart&&this.options.onZoomStart.call(this,b));if(this.options.momentum&&(this.options.useTransform?(e=getComputedStyle(this.scroller,null)[s].replace(/[^0-9\-.,]/g,"").split(","),g=+(e[12]||e[4]),e=+(e[13]||e[5])):
(g=+getComputedStyle(this.scroller,null).left.replace(/[^0-9-]/g,""),e=+getComputedStyle(this.scroller,null).top.replace(/[^0-9-]/g,"")),g!=this.x||e!=this.y))this.options.useTransition?this._unbind(F):G(this.aniTime),this.steps=[],this._pos(g,e),this.options.onScrollEnd&&this.options.onScrollEnd.call(this);this.absStartX=this.x;this.absStartY=this.y;this.startX=this.x;this.startY=this.y;this.pointX=d.pageX;this.pointY=d.pageY;this.startTime=b.timeStamp||(new Date).getTime();this.options.onScrollStart&&
this.options.onScrollStart.call(this,b);this._bind(z,a);this._bind(w,a);this._bind(E,a)}},_move:function(a){var b=u?a.touches[0]:a,d=b.pageX-this.pointX,e=b.pageY-this.pointY,g=this.x+d,l=this.y+e,k=a.timeStamp||(new Date).getTime();this.options.onBeforeScrollMove&&this.options.onBeforeScrollMove.call(this,a);if(this.options.zoom&&u&&1<a.touches.length)g=f.abs(a.touches[0].pageX-a.touches[1].pageX),l=f.abs(a.touches[0].pageY-a.touches[1].pageY),this.touchesDist=f.sqrt(g*g+l*l),this.zoomed=!0,b=1/
this.touchesDistStart*this.touchesDist*this.scale,b<this.options.zoomMin?b=0.5*this.options.zoomMin*Math.pow(2,b/this.options.zoomMin):b>this.options.zoomMax&&(b=2*this.options.zoomMax*Math.pow(0.5,this.options.zoomMax/b)),this.lastScale=b/this.scale,g=this.originX-this.originX*this.lastScale+this.x,l=this.originY-this.originY*this.lastScale+this.y,this.scroller.style[s]="translate("+g+"px,"+l+"px) scale("+b+")"+D,this.options.onZoom&&this.options.onZoom.call(this,a);else{this.pointX=b.pageX;this.pointY=
b.pageY;if(0<g||g<this.maxScrollX)g=this.options.bounce?this.x+d/2:0<=g||0<=this.maxScrollX?0:this.maxScrollX;if(l>this.minScrollY||l<this.maxScrollY)l=this.options.bounce?this.y+e/2:l>=this.minScrollY||0<=this.maxScrollY?this.minScrollY:this.maxScrollY;this.distX+=d;this.distY+=e;this.absDistX=f.abs(this.distX);this.absDistY=f.abs(this.distY);6>this.absDistX&&6>this.absDistY||(this.options.lockDirection&&(this.absDistX>this.absDistY+5?(l=this.y,e=0):this.absDistY>this.absDistX+5&&(g=this.x,d=0)),
this.moved=!0,this._pos(g,l),this.dirX=0<d?-1:0>d?1:0,this.dirY=0<e?-1:0>e?1:0,300<k-this.startTime&&(this.startTime=k,this.startX=this.x,this.startY=this.y),this.options.onScrollMove&&this.options.onScrollMove.call(this,a))}},_end:function(d){if(!(u&&0!==d.touches.length)){var e=this,g=u?d.changedTouches[0]:d,l,k,h={dist:0,time:0},j={dist:0,time:0},m=(d.timeStamp||(new Date).getTime())-e.startTime,p=e.x,r=e.y;e._unbind(z,a);e._unbind(w,a);e._unbind(E,a);e.options.onBeforeScrollEnd&&e.options.onBeforeScrollEnd.call(e,
d);if(e.zoomed)p=e.scale*e.lastScale,p=Math.max(e.options.zoomMin,p),p=Math.min(e.options.zoomMax,p),e.lastScale=p/e.scale,e.scale=p,e.x=e.originX-e.originX*e.lastScale+e.x,e.y=e.originY-e.originY*e.lastScale+e.y,e.scroller.style[n]="200ms",e.scroller.style[s]="translate("+e.x+"px,"+e.y+"px) scale("+e.scale+")"+D,e.zoomed=!1,e.refresh(),e.options.onZoomEnd&&e.options.onZoomEnd.call(e,d);else{if(e.moved){if(300>m&&e.options.momentum){h=p?e._momentum(p-e.startX,m,-e.x,e.scrollerW-e.wrapperW+e.x,e.options.bounce?
e.wrapperW:0):h;j=r?e._momentum(r-e.startY,m,-e.y,0>e.maxScrollY?e.scrollerH-e.wrapperH+e.y-e.minScrollY:0,e.options.bounce?e.wrapperH:0):j;p=e.x+h.dist;r=e.y+j.dist;if(0<e.x&&0<p||e.x<e.maxScrollX&&p<e.maxScrollX)h={dist:0,time:0};if(e.y>e.minScrollY&&r>e.minScrollY||e.y<e.maxScrollY&&r<e.maxScrollY)j={dist:0,time:0}}h.dist||j.dist?(h=f.max(f.max(h.time,j.time),10),e.options.snap&&(j=p-e.absStartX,m=r-e.absStartY,f.abs(j)<e.options.snapThreshold&&f.abs(m)<e.options.snapThreshold?e.scrollTo(e.absStartX,
e.absStartY,200):(j=e._snap(p,r),p=j.x,r=j.y,h=f.max(j.time,h))),e.scrollTo(f.round(p),f.round(r),h)):e.options.snap?(j=p-e.absStartX,m=r-e.absStartY,f.abs(j)<e.options.snapThreshold&&f.abs(m)<e.options.snapThreshold?e.scrollTo(e.absStartX,e.absStartY,200):(j=e._snap(e.x,e.y),(j.x!=e.x||j.y!=e.y)&&e.scrollTo(j.x,j.y,j.time))):e._resetPos(200)}else u&&(e.doubleTapTimer&&e.options.zoom?(clearTimeout(e.doubleTapTimer),e.doubleTapTimer=null,e.options.onZoomStart&&e.options.onZoomStart.call(e,d),e.zoom(e.pointX,
e.pointY,1==e.scale?e.options.doubleTapZoom:1),e.options.onZoomEnd&&setTimeout(function(){e.options.onZoomEnd.call(e,d)},200)):this.options.handleClick&&(e.doubleTapTimer=setTimeout(function(){e.doubleTapTimer=null;for(l=g.target;1!=l.nodeType;)l=l.parentNode;"SELECT"!=l.tagName&&("INPUT"!=l.tagName&&"TEXTAREA"!=l.tagName)&&(k=b.createEvent("MouseEvents"),k.initMouseEvent("click",!0,!0,d.view,1,g.screenX,g.screenY,g.clientX,g.clientY,d.ctrlKey,d.altKey,d.shiftKey,d.metaKey,0,null),k._fake=!0,l.dispatchEvent(k))},
e.options.zoom?250:0))),e._resetPos(400);e.options.onTouchEnd&&e.options.onTouchEnd.call(e,d)}}},_resetPos:function(a){var b=0<=this.x?0:this.x<this.maxScrollX?this.maxScrollX:this.x,d=this.y>=this.minScrollY||0<this.maxScrollY?this.minScrollY:this.y<this.maxScrollY?this.maxScrollY:this.y;if(b==this.x&&d==this.y){if(this.moved&&(this.moved=!1,this.options.onScrollEnd&&this.options.onScrollEnd.call(this)),this.hScrollbar&&this.options.hideScrollbar&&("webkit"==g&&(this.hScrollbarWrapper.style[q]="300ms"),
this.hScrollbarWrapper.style.opacity="0"),this.vScrollbar&&this.options.hideScrollbar)"webkit"==g&&(this.vScrollbarWrapper.style[q]="300ms"),this.vScrollbarWrapper.style.opacity="0"}else this.scrollTo(b,d,a||0)},_wheel:function(a){var b=this,d;if("wheelDeltaX"in a)d=a.wheelDeltaY/12;else if("wheelDelta"in a)d=a.wheelDelta/12;else if("detail"in a)d=3*-a.detail;else return;if("zoom"==b.options.wheelAction){if(d=b.scale*Math.pow(2,1/3*(d?d/Math.abs(d):0)),d<b.options.zoomMin&&(d=b.options.zoomMin),d>
b.options.zoomMax&&(d=b.options.zoomMax),d!=b.scale)!b.wheelZoomCount&&b.options.onZoomStart&&b.options.onZoomStart.call(b,a),b.wheelZoomCount++,b.zoom(a.pageX,a.pageY,d,400),setTimeout(function(){b.wheelZoomCount--;!b.wheelZoomCount&&b.options.onZoomEnd&&b.options.onZoomEnd.call(b,a)},400)}else d=b.x+45*d,b.scrollTo(d,b.y,350)},_transitionEnd:function(a){a.target==this.scroller&&(this._unbind(F),this._startAni())},_startAni:function(){var a=this,b=a.x,d=a.y,e=(new Date).getTime(),g,l,k;a.animating||
(a.steps.length?(g=a.steps.shift(),g.x==b&&g.y==d&&(g.time=0),a.animating=!0,a.moved=!0,a.options.useTransition)?(a._transitionTime(g.time),a._pos(g.x,g.y),a.animating=!1,g.time?a._bind(F):a._resetPos(0)):(k=function(){var h=(new Date).getTime(),j;if(h>=e+g.time){a._pos(g.x,g.y);a.animating=false;a.options.onAnimationEnd&&a.options.onAnimationEnd.call(a);a._startAni()}else{h=(h-e)/g.time-1;l=f.sqrt(1-h*h);h=(g.x-b)*l+b;j=(g.y-d)*l+d;a._pos(h,j);if(a.animating)a.aniTime=L(k)}},k()):a._resetPos(400))},
_transitionTime:function(a){a+="ms";this.scroller.style[n]=a;this.hScrollbar&&(this.hScrollbarIndicator.style[n]=a);this.vScrollbar&&(this.vScrollbarIndicator.style[n]=a)},_momentum:function(a,b,d,e,g){var b=f.abs(a)/b,l=b*b/0.0012;0<a&&l>d?(d+=g/(6/(6E-4*(l/b))),b=b*d/l,l=d):0>a&&l>e&&(e+=g/(6/(6E-4*(l/b))),b=b*e/l,l=e);return{dist:l*(0>a?-1:1),time:f.round(b/6E-4)}},_offset:function(a){for(var b=-a.offsetLeft,d=-a.offsetTop;a=a.offsetParent;)b-=a.offsetLeft,d-=a.offsetTop;a!=this.wrapper&&(b*=this.scale,
d*=this.scale);return{left:b,top:d}},_snap:function(a,b){var d,e,g;g=this.pagesX.length-1;d=0;for(e=this.pagesX.length;d<e;d++)if(a>=this.pagesX[d]){g=d;break}g==this.currPageX&&(0<g&&0>this.dirX)&&g--;a=this.pagesX[g];e=(e=f.abs(a-this.pagesX[this.currPageX]))?500*(f.abs(this.x-a)/e):0;this.currPageX=g;g=this.pagesY.length-1;for(d=0;d<g;d++)if(b>=this.pagesY[d]){g=d;break}g==this.currPageY&&(0<g&&0>this.dirY)&&g--;b=this.pagesY[g];d=(d=f.abs(b-this.pagesY[this.currPageY]))?500*(f.abs(this.y-b)/d):
0;this.currPageY=g;g=f.round(f.max(e,d))||200;return{x:a,y:b,time:g}},_bind:function(a,b,d){if(void 0==dojo.isIE||8<dojo.isIE)(b||this.scroller).addEventListener(a,this,!!d)},_unbind:function(a,b,d){if(void 0==dojo.isIE||8<dojo.isIE)(b||this.scroller).removeEventListener(a,this,!!d)},destroy:function(){this.scroller.style[s]="";this.vScrollbar=this.hScrollbar=!1;this._scrollbar("h");this._scrollbar("v");this._unbind(K,a);this._unbind(h);this._unbind(z,a);this._unbind(w,a);this._unbind(E,a);this.options.hasTouch||
(this._unbind("DOMMouseScroll"),this._unbind("mousewheel"));this.options.useTransition&&this._unbind(F);this.options.checkDOMChanges&&clearInterval(this.checkDOMTime);this.options.onDestroy&&this.options.onDestroy.call(this)},refresh:function(){var a,b,d,e=0;b=0;this.scale<this.options.zoomMin&&(this.scale=this.options.zoomMin);this.wrapperW=this.wrapper.clientWidth||1;this.wrapperH=this.wrapper.clientHeight||1;this.minScrollY=-this.options.topOffset||0;this.scrollerW=f.round(this.scroller.offsetWidth*
this.scale);this.scrollerH=f.round((this.scroller.offsetHeight+this.minScrollY)*this.scale);this.maxScrollX=this.wrapperW-this.scrollerW;this.maxScrollY=this.wrapperH-this.scrollerH+this.minScrollY;this.dirY=this.dirX=0;this.options.onRefresh&&this.options.onRefresh.call(this);this.hScroll=this.options.hScroll&&0>this.maxScrollX;this.vScroll=this.options.vScroll&&(!this.options.bounceLock&&!this.hScroll||this.scrollerH>this.wrapperH);this.hScrollbar=this.hScroll&&this.options.hScrollbar;this.vScrollbar=
this.vScroll&&this.options.vScrollbar&&this.scrollerH>this.wrapperH;a=this._offset(this.wrapper);this.wrapperOffsetLeft=-a.left;this.wrapperOffsetTop=-a.top;if("string"==typeof this.options.snap){this.pagesX=[];this.pagesY=[];d=this.scroller.querySelectorAll(this.options.snap);a=0;for(b=d.length;a<b;a++)e=this._offset(d[a]),e.left+=this.wrapperOffsetLeft,e.top+=this.wrapperOffsetTop,this.pagesX[a]=e.left<this.maxScrollX?this.maxScrollX:e.left*this.scale,this.pagesY[a]=e.top<this.maxScrollY?this.maxScrollY:
e.top*this.scale}else if(this.options.snap){for(this.pagesX=[];e>=this.maxScrollX;)this.pagesX[b]=e,e-=this.wrapperW,b++;this.maxScrollX%this.wrapperW&&(this.pagesX[this.pagesX.length]=this.maxScrollX-this.pagesX[this.pagesX.length-1]+this.pagesX[this.pagesX.length-1]);b=e=0;for(this.pagesY=[];e>=this.maxScrollY;)this.pagesY[b]=e,e-=this.wrapperH,b++;this.maxScrollY%this.wrapperH&&(this.pagesY[this.pagesY.length]=this.maxScrollY-this.pagesY[this.pagesY.length-1]+this.pagesY[this.pagesY.length-1])}this._scrollbar("h");
this._scrollbar("v");this.zoomed||(this.scroller.style[n]="0",this._resetPos(400))},scrollTo:function(a,b,d,f){var e=a;this.stop();e.length||(e=[{x:a,y:b,time:d,relative:f}]);a=0;for(b=e.length;a<b;a++)e[a].relative&&(e[a].x=this.x-e[a].x,e[a].y=this.y-e[a].y),this.steps.push({x:e[a].x,y:e[a].y,time:e[a].time||0});this._startAni()},scrollToElement:function(a,b){var d;if(a=a.nodeType?a:this.scroller.querySelector(a))d=this._offset(a),d.left+=this.wrapperOffsetLeft,d.top+=this.wrapperOffsetTop,d.left=
0<d.left?0:d.left<this.maxScrollX?this.maxScrollX:d.left,d.top=d.top>this.minScrollY?this.minScrollY:d.top<this.maxScrollY?this.maxScrollY:d.top,b=void 0===b?f.max(2*f.abs(d.left),2*f.abs(d.top)):b,this.scrollTo(d.left,d.top,b)},scrollToPage:function(a,b,d){d=void 0===d?400:d;this.options.onScrollStart&&this.options.onScrollStart.call(this);if(this.options.snap)a="next"==a?this.currPageX+1:"prev"==a?this.currPageX-1:a,b="next"==b?this.currPageY+1:"prev"==b?this.currPageY-1:b,a=0>a?0:a>this.pagesX.length-
1?this.pagesX.length-1:a,b=0>b?0:b>this.pagesY.length-1?this.pagesY.length-1:b,this.currPageX=a,this.currPageY=b,a=this.pagesX[a],b=this.pagesY[b];else if(a*=-this.wrapperW,b*=-this.wrapperH,a<this.maxScrollX&&(a=this.maxScrollX),b<this.maxScrollY)b=this.maxScrollY;this.scrollTo(a,b,d)},disable:function(){this.stop();this._resetPos(0);this.enabled=!1;this._unbind(z,a);this._unbind(w,a);this._unbind(E,a)},enable:function(){this.enabled=!0},stop:function(){this.options.useTransition?this._unbind(F):
G(this.aniTime);this.steps=[];this.animating=this.moved=!1},zoom:function(a,b,d,f){var e=d/this.scale;this.options.useTransform&&(this.zoomed=!0,f=void 0===f?200:f,a=a-this.wrapperOffsetLeft-this.x,b=b-this.wrapperOffsetTop-this.y,this.x=a-a*e+this.x,this.y=b-b*e+this.y,this.scale=d,this.refresh(),this.x=0<this.x?0:this.x<this.maxScrollX?this.maxScrollX:this.x,this.y=this.y>this.minScrollY?this.minScrollY:this.y<this.maxScrollY?this.maxScrollY:this.y,this.scroller.style[n]=f+"ms",this.scroller.style[s]=
"translate("+this.x+"px,"+this.y+"px) scale("+d+")"+D,this.zoomed=!1)},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}};e=null;"undefined"!==typeof exports?exports.iScroll=j:a.iScroll=j})(window,document);var SwipeView=function(a,b){function d(a){if(""===e)return a;a=a.charAt(0).toUpperCase()+a.substr(1);return e+a}var f=b.createElement("div").style,e;a:{for(var g=["t","webkitT","MozT","msT","OT"],j,k=0,l=g.length;k<l;k++)if(j=g[k]+"ransform",j in f){e=g[k].substr(0,g[k].length-1);break a}e=!1}var p=e?"-"+e.toLowerCase()+"-":"",m=d("transform"),s=d("transitionDuration"),f=d("perspective")in f,o="ontouchstart"in a;d("transition");var n=f?" translateZ(0)":"",r="onorientationchange"in a?"orientationchange":
"resize",t=o?"touchstart":"mousedown",q=o?"touchmove":"mousemove",y=o?"touchend":"mouseup",x=o?"touchcancel":"mouseup",v;v=!1===e?!1:{"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"oTransitionEnd",ms:"MSTransitionEnd"}[e];f=function(d,f){var g,l,k;this.wrapper="string"==typeof d?b.querySelector(d):d;this.options={text:null,numberOfPages:3,snapThreshold:null,hastyPageFlip:!1,loop:!0};for(g in f)this.options[g]=f[g];this.wrapper.style.overflow="hidden";this.wrapper.style.position=
"relative";this.masterPages=[];l=b.createElement("div");l.id="swipeview-slider";l.style.cssText="position:relative;top:0;height:100%;width:100%;"+p+"transition-duration:0;"+p+"transform:translateZ(0);"+p+"transition-timing-function:ease-out";this.wrapper.appendChild(l);this.slider=l;this.refreshSize();for(g=-1;2>g;g++)l=b.createElement("div"),l.id="swipeview-masterpage-"+(g+1),l.style.cssText=p+"transform:translateZ(0);position:absolute;top:0;height:100%;width:100%;left:"+100*g+"%",l.dataset||(l.dataset=
{}),k=-1==g?this.options.numberOfPages-1:g,l.dataset.pageIndex=k,l.dataset.upcomingPageIndex=k,!this.options.loop&&-1==g&&(l.style.visibility="hidden"),this.slider.appendChild(l),this.masterPages.push(l);g=this.masterPages[1].className;this.masterPages[1].className=!g?"swipeview-active":g+" swipeview-active";a.addEventListener(r,this,!1);this.wrapper.addEventListener(t,this,!1);this.wrapper.addEventListener(q,this,!1);this.wrapper.addEventListener(y,this,!1);this.slider.addEventListener(v,this,!1);
"O"==e&&this.slider.addEventListener(v.toLowerCase(),this,!1)};f.prototype={currentMasterPage:1,x:0,page:0,pageIndex:0,customEvents:[],onFlip:function(a){this.wrapper.addEventListener("swipeview-flip",a,!1);this.customEvents.push(["flip",a])},onMoveOut:function(a){this.wrapper.addEventListener("swipeview-moveout",a,!1);this.customEvents.push(["moveout",a])},onMoveIn:function(a){this.wrapper.addEventListener("swipeview-movein",a,!1);this.customEvents.push(["movein",a])},onTouchStart:function(a){this.wrapper.addEventListener("swipeview-touchstart",
a,!1);this.customEvents.push(["touchstart",a])},destroy:function(){for(;this.customEvents.length;)this.wrapper.removeEventListener("swipeview-"+this.customEvents[0][0],this.customEvents[0][1],!1),this.customEvents.shift();a.removeEventListener(r,this,!1);this.wrapper.removeEventListener(t,this,!1);this.wrapper.removeEventListener(q,this,!1);this.wrapper.removeEventListener(y,this,!1);this.slider.removeEventListener(v,this,!1)},refreshSize:function(){this.wrapperWidth=this.wrapper.clientWidth;this.wrapperHeight=
this.wrapper.clientHeight;this.pageWidth=this.wrapperWidth;this.maxX=-this.options.numberOfPages*this.pageWidth+this.wrapperWidth;this.snapThreshold=null===this.options.snapThreshold?Math.round(0.15*this.pageWidth):/%/.test(this.options.snapThreshold)?Math.round(this.pageWidth*this.options.snapThreshold.replace("%","")/100):this.options.snapThreshold},updatePageCount:function(a){this.options.numberOfPages=a;this.maxX=-this.options.numberOfPages*this.pageWidth+this.wrapperWidth},goToPage:function(a){var b;
this.masterPages[this.currentMasterPage].className=this.masterPages[this.currentMasterPage].className.replace(/(^|\s)swipeview-active(\s|$)/,"");for(b=0;3>b;b++)className=this.masterPages[b].className,/(^|\s)swipeview-loading(\s|$)/.test(className)||(this.masterPages[b].className=!className?"swipeview-loading":className+" swipeview-loading");this.pageIndex=this.page=a=0>a?0:a>this.options.numberOfPages-1?this.options.numberOfPages-1:a;this.slider.style[s]="0s";this.__pos(-a*this.pageWidth);this.currentMasterPage=
this.page+1-3*Math.floor((this.page+1)/3);this.masterPages[this.currentMasterPage].className+=" swipeview-active";0===this.currentMasterPage?(this.masterPages[2].style.left=100*this.page-100+"%",this.masterPages[0].style.left=100*this.page+"%",this.masterPages[1].style.left=100*this.page+100+"%",this.masterPages[2].dataset.upcomingPageIndex=0===this.page?this.options.numberOfPages-1:this.page-1,this.masterPages[0].dataset.upcomingPageIndex=this.page,this.masterPages[1].dataset.upcomingPageIndex=this.page==
this.options.numberOfPages-1?0:this.page+1):1==this.currentMasterPage?(this.masterPages[0].style.left=100*this.page-100+"%",this.masterPages[1].style.left=100*this.page+"%",this.masterPages[2].style.left=100*this.page+100+"%",this.masterPages[0].dataset.upcomingPageIndex=0===this.page?this.options.numberOfPages-1:this.page-1,this.masterPages[1].dataset.upcomingPageIndex=this.page,this.masterPages[2].dataset.upcomingPageIndex=this.page==this.options.numberOfPages-1?0:this.page+1):(this.masterPages[1].style.left=
100*this.page-100+"%",this.masterPages[2].style.left=100*this.page+"%",this.masterPages[0].style.left=100*this.page+100+"%",this.masterPages[1].dataset.upcomingPageIndex=0===this.page?this.options.numberOfPages-1:this.page-1,this.masterPages[2].dataset.upcomingPageIndex=this.page,this.masterPages[0].dataset.upcomingPageIndex=this.page==this.options.numberOfPages-1?0:this.page+1);this.__flip()},next:function(){if(this.options.loop||this.x!=this.maxX)this.directionX=-1,this.x-=1,this.__checkPosition()},
prev:function(){if(this.options.loop||0!==this.x)this.directionX=1,this.x+=1,this.__checkPosition()},handleEvent:function(a){switch(a.type){case t:this.__start(a);break;case q:this.__move(a);break;case x:case y:this.__end(a);break;case r:this.__resize();break;case v:case "otransitionend":a.target==this.slider&&!this.options.hastyPageFlip&&this.__flip()}},__pos:function(a){this.x=a;this.slider.style[m]="translate("+a+"px,0)"+n},__resize:function(){this.refreshSize();this.slider.style[s]="0s";this.__pos(-this.page*
this.pageWidth)},__start:function(a){this.initiated||(a=o?a.touches[0]:a,this.initiated=!0,this.thresholdExceeded=this.moved=!1,this.startX=a.pageX,this.startY=a.pageY,this.pointX=a.pageX,this.pointY=a.pageY,this.directionX=this.stepsY=this.stepsX=0,this.directionLocked=!1,this.slider.style[s]="0s",this.__event("touchstart"))},__move:function(a){if(this.initiated){var b=o?a.touches[0]:a,d=b.pageX-this.pointX,f=b.pageY-this.pointY,e=this.x+d,g=Math.abs(b.pageX-this.startX);this.moved=!0;this.pointX=
b.pageX;this.pointY=b.pageY;this.directionX=0<d?1:0>d?-1:0;this.stepsX+=Math.abs(d);this.stepsY+=Math.abs(f);if(!(10>this.stepsX&&10>this.stepsY))if(!this.directionLocked&&this.stepsY>this.stepsX)this.initiated=!1;else{a.preventDefault();this.directionLocked=!0;if(!this.options.loop&&(0<e||e<this.maxX))e=this.x+d/2;!this.thresholdExceeded&&g>=this.snapThreshold?(this.thresholdExceeded=!0,this.__event("moveout")):this.thresholdExceeded&&g<this.snapThreshold&&(this.thresholdExceeded=!1,this.__event("movein"));
this.__pos(e)}}},__end:function(a){if(this.initiated&&(a=Math.abs((o?a.changedTouches[0]:a).pageX-this.startX),this.initiated=!1,this.moved)){if(!this.options.loop&&(0<this.x||this.x<this.maxX))a=0,this.__event("movein");a<this.snapThreshold?(this.slider.style[s]=Math.floor(300*a/this.snapThreshold)+"ms",this.__pos(-this.page*this.pageWidth)):this.__checkPosition()}},__checkPosition:function(){var a,b,d;this.masterPages[this.currentMasterPage].className=this.masterPages[this.currentMasterPage].className.replace(/(^|\s)swipeview-active(\s|$)/,
"");0<this.directionX?(this.page=-Math.ceil(this.x/this.pageWidth),this.currentMasterPage=this.page+1-3*Math.floor((this.page+1)/3),this.pageIndex=0===this.pageIndex?this.options.numberOfPages-1:this.pageIndex-1,a=this.currentMasterPage-1,a=0>a?2:a,this.masterPages[a].style.left=100*this.page-100+"%",b=this.page-1):(this.page=-Math.floor(this.x/this.pageWidth),this.currentMasterPage=this.page+1-3*Math.floor((this.page+1)/3),this.pageIndex=this.pageIndex==this.options.numberOfPages-1?0:this.pageIndex+
1,a=this.currentMasterPage+1,a=2<a?0:a,this.masterPages[a].style.left=100*this.page+100+"%",b=this.page+1);d=this.masterPages[this.currentMasterPage].className;/(^|\s)swipeview-active(\s|$)/.test(d)||(this.masterPages[this.currentMasterPage].className=!d?"swipeview-active":d+" swipeview-active");d=this.masterPages[a].className;/(^|\s)swipeview-loading(\s|$)/.test(d)||(this.masterPages[a].className=!d?"swipeview-loading":d+" swipeview-loading");b-=Math.floor(b/this.options.numberOfPages)*this.options.numberOfPages;
this.masterPages[a].dataset.upcomingPageIndex=b;newX=-this.page*this.pageWidth;this.slider.style[s]=Math.floor(500*Math.abs(this.x-newX)/this.pageWidth)+"ms";this.options.loop||(this.masterPages[a].style.visibility=0===newX||newX==this.maxX?"hidden":"");this.x==newX?this.__flip():(this.__pos(newX),this.options.hastyPageFlip&&this.__flip())},__flip:function(){this.__event("flip");for(var a=0;3>a;a++)this.masterPages[a].className=this.masterPages[a].className.replace(/(^|\s)swipeview-loading(\s|$)/,
""),this.masterPages[a].dataset.pageIndex=this.masterPages[a].dataset.upcomingPageIndex},__event:function(a){var d=b.createEvent("Event");d.initEvent("swipeview-"+a,!0,!0);this.wrapper.dispatchEvent(d)}};return f}(window,document);(function(a,b){function d(b,d){var e,g,j,o=b.nodeName.toLowerCase();return"area"===o?(e=b.parentNode,g=e.name,!b.href||!g||"map"!==e.nodeName.toLowerCase()?!1:(j=a("img[usemap=#"+g+"]")[0],!!j&&f(j))):(/input|select|textarea|button|object/.test(o)?!b.disabled:"a"===o?b.href||d:d)&&f(b)}function f(b){return a.expr.filters.visible(b)&&!a(b).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}var e=0,g=/^ui-id-\d+$/;a.ui=a.ui||{};if(!a.ui.version){a.extend(a.ui,{version:"1.10.0",
keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}});a.fn.extend({_focus:a.fn.focus,focus:function(b,d){return"number"==typeof b?this.each(function(){var f=this;setTimeout(function(){a(f).focus();d&&d.call(f)},b)}):this._focus.apply(this,arguments)},scrollParent:function(){var b;return a.ui.ie&&
/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?b=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.css(this,"position"))&&/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0):b=this.parents().filter(function(){return/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!b.length?a(document):b},zIndex:function(d){if(d!==
b)return this.css("zIndex",d);if(this.length)for(var d=a(this[0]),f;d.length&&d[0]!==document;){f=d.css("position");if("absolute"===f||"relative"===f||"fixed"===f)if(f=parseInt(d.css("zIndex"),10),!isNaN(f)&&0!==f)return f;d=d.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})},removeUniqueId:function(){return this.each(function(){g.test(this.id)&&a(this).removeAttr("id")})}});a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(b){return function(d){return!!a.data(d,
b)}}):function(b,d,f){return!!a.data(b,f[3])},focusable:function(b){return d(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var f=a.attr(b,"tabindex"),e=isNaN(f);return(e||0<=f)&&d(b,!e)}});a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(d,f){function e(b,d,f,l){return a.each(g,function(){d-=parseFloat(a.css(b,"padding"+this))||0;f&&(d-=parseFloat(a.css(b,"border"+this+"Width"))||0);l&&(d-=parseFloat(a.css(b,"margin"+this))||0)}),d}var g="Width"===f?["Left","Right"]:["Top",
"Bottom"],j=f.toLowerCase(),o={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+f]=function(d){return d===b?o["inner"+f].call(this):this.each(function(){a(this).css(j,e(this,d)+"px")})};a.fn["outer"+f]=function(b,d){return"number"!=typeof b?o["outer"+f].call(this,b):this.each(function(){a(this).css(j,e(this,b,!0,d)+"px")})}});a.fn.addBack||(a.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))});
if(a("<a>").data("a-b","a").removeData("a-b").data("a-b")){var j=a.fn.removeData;a.fn.removeData=function(b){return arguments.length?j.call(this,a.camelCase(b)):j.call(this)}}a.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());a.support.selectstart="onselectstart"in document.createElement("div");a.fn.extend({disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}});
a.extend(a.ui,{plugin:{add:function(b,d,f){var e,b=a.ui[b].prototype;for(e in f)b.plugins[e]=b.plugins[e]||[],b.plugins[e].push([d,f[e]])},call:function(a,b,d){var f=a.plugins[b];if(f&&a.element[0].parentNode&&11!==a.element[0].parentNode.nodeType)for(b=0;b<f.length;b++)a.options[f[b][0]]&&f[b][1].apply(a.element,d)}},hasScroll:function(b,d){if("hidden"===a(b).css("overflow"))return!1;var f=d&&"left"===d?"scrollLeft":"scrollTop";return 0<b[f]?!0:(b[f]=1,b[f]=0,!1)}})}})(jQuery);
(function(a,b){var d=0,f=Array.prototype.slice,e=a.cleanData;a.cleanData=function(b){for(var d=0,f;null!=(f=b[d]);d++)try{a(f).triggerHandler("remove")}catch(l){}e(b)};a.widget=function(b,d,f){var e,p,m,s,o={},n=b.split(".")[0],b=b.split(".")[1];e=n+"-"+b;f||(f=d,d=a.Widget);a.expr[":"][e.toLowerCase()]=function(b){return!!a.data(b,e)};a[n]=a[n]||{};p=a[n][b];m=a[n][b]=function(a,b){if(!this._createWidget)return new m(a,b);arguments.length&&this._createWidget(a,b)};a.extend(m,p,{version:f.version,
_proto:a.extend({},f),_childConstructors:[]});s=new d;s.options=a.widget.extend({},s.options);a.each(f,function(b,f){if(a.isFunction(f)){var e=function(){return d.prototype[b].apply(this,arguments)},g=function(a){return d.prototype[b].apply(this,a)};o[b]=function(){var a=this._super,b=this._superApply,d;return this._super=e,this._superApply=g,d=f.apply(this,arguments),this._super=a,this._superApply=b,d}}else o[b]=f});m.prototype=a.widget.extend(s,{widgetEventPrefix:p?s.widgetEventPrefix:b},o,{constructor:m,
namespace:n,widgetName:b,widgetFullName:e});p?(a.each(p._childConstructors,function(b,d){var f=d.prototype;a.widget(f.namespace+"."+f.widgetName,m,d._proto)}),delete p._childConstructors):d._childConstructors.push(m);a.widget.bridge(b,m)};a.widget.extend=function(d){for(var e=f.call(arguments,1),k=0,l=e.length,p,m;k<l;k++)for(p in e[k])m=e[k][p],e[k].hasOwnProperty(p)&&m!==b&&(a.isPlainObject(m)?d[p]=a.isPlainObject(d[p])?a.widget.extend({},d[p],m):a.widget.extend({},m):d[p]=m);return d};a.widget.bridge=
function(d,e){var k=e.prototype.widgetFullName||d;a.fn[d]=function(l){var p="string"==typeof l,m=f.call(arguments,1),s=this;return l=!p&&m.length?a.widget.extend.apply(null,[l].concat(m)):l,p?this.each(function(){var f,e=a.data(this,k);if(!e)return a.error("cannot call methods on "+d+" prior to initialization; attempted to call method '"+l+"'");if(!a.isFunction(e[l])||"_"===l.charAt(0))return a.error("no such method '"+l+"' for "+d+" widget instance");f=e[l].apply(e,m);if(f!==e&&f!==b)return s=f&&
f.jquery?s.pushStack(f.get()):f,!1}):this.each(function(){var b=a.data(this,k);b?b.option(l||{})._init():a.data(this,k,new e(l,this))}),s}};a.Widget=function(){};a.Widget._childConstructors=[];a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(b,f){f=a(f||this.defaultElement||this)[0];this.element=a(f);this.uuid=d++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=a.widget.extend({},this.options,
this._getCreateOptions(),b);this.bindings=a();this.hoverable=a();this.focusable=a();f!==this&&(a.data(f,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===f&&this.destroy()}}),this.document=a(f.style?f.ownerDocument:f.document||f),this.window=a(this.document[0].defaultView||this.document[0].parentWindow));this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:a.noop,_getCreateEventData:a.noop,_create:a.noop,_init:a.noop,
destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(a.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},_destroy:a.noop,widget:function(){return this.element},
option:function(d,f){var e=d,l,p,m;if(0===arguments.length)return a.widget.extend({},this.options);if("string"==typeof d)if(e={},l=d.split("."),d=l.shift(),l.length){p=e[d]=a.widget.extend({},this.options[d]);for(m=0;m<l.length-1;m++)p[l[m]]=p[l[m]]||{},p=p[l[m]];d=l.pop();if(f===b)return p[d]===b?null:p[d];p[d]=f}else{if(f===b)return this.options[d]===b?null:this.options[d];e[d]=f}return this._setOptions(e),this},_setOptions:function(a){for(var b in a)this._setOption(b,a[b]);return this},_setOption:function(a,
b){return this.options[a]=b,"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!b).attr("aria-disabled",b),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(b,d,f){var e,p=this;"boolean"!=typeof b&&(f=d,d=b,b=!1);f?(d=e=a(d),this.bindings=this.bindings.add(d)):(f=d,d=this.element,e=
this.widget());a.each(f,function(f,k){function o(){if(b||!(!0===p.options.disabled||a(this).hasClass("ui-state-disabled")))return("string"==typeof k?p[k]:k).apply(p,arguments)}"string"!=typeof k&&(o.guid=k.guid=k.guid||o.guid||a.guid++);var n=f.match(/^(\w+)\s*(.*)$/),r=n[1]+p.eventNamespace;(n=n[2])?e.delegate(n,r,o):d.bind(r,o)})},_off:function(a,b){b=(b||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;a.unbind(b).undelegate(b)},_delay:function(a,b){var d=this;return setTimeout(function(){return("string"==
typeof a?d[a]:a).apply(d,arguments)},b||0)},_hoverable:function(b){this.hoverable=this.hoverable.add(b);this._on(b,{mouseenter:function(b){a(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){a(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(b){this.focusable=this.focusable.add(b);this._on(b,{focusin:function(b){a(b.currentTarget).addClass("ui-state-focus")},focusout:function(b){a(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(b,d,f){var e,
p=this.options[b],f=f||{},d=a.Event(d);d.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase();d.target=this.element[0];if(b=d.originalEvent)for(e in b)e in d||(d[e]=b[e]);return this.element.trigger(d,f),!(a.isFunction(p)&&!1===p.apply(this.element[0],[d].concat(f))||d.isDefaultPrevented())}};a.each({show:"fadeIn",hide:"fadeOut"},function(b,d){a.Widget.prototype["_"+b]=function(f,e,p){"string"==typeof e&&(e={effect:e});var m,s=e?!0===e||"number"==typeof e?d:e.effect||d:b,e=e||
{};"number"==typeof e&&(e={duration:e});m=!a.isEmptyObject(e);e.complete=p;e.delay&&f.delay(e.delay);m&&a.effects&&a.effects.effect[s]?f[b](e):s!==b&&f[s]?f[s](e.duration,e.easing,p):f.queue(function(d){a(this)[b]();p&&p.call(f[0]);d()})}})})(jQuery);
(function(a){var b=!1;a(document).mouseup(function(){b=!1});a.widget("ui.mouse",{version:"1.10.0",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(f){if(!0===a.data(f.target,b.widgetName+".preventClickEvent"))return a.removeData(f.target,b.widgetName+".preventClickEvent"),f.stopImmediatePropagation(),!1});this.started=
!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName);this._mouseMoveDelegate&&a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(d){if(!b){this._mouseStarted&&this._mouseUp(d);this._mouseDownEvent=d;var f=this,e=1===d.which,g="string"==typeof this.options.cancel&&d.target.nodeName?a(d.target).closest(this.options.cancel).length:!1;if(!e||g||!this._mouseCapture(d))return!0;(this.mouseDelayMet=
!this.options.delay)||(this._mouseDelayTimer=setTimeout(function(){f.mouseDelayMet=!0},this.options.delay));return this._mouseDistanceMet(d)&&this._mouseDelayMet(d)&&(this._mouseStarted=!1!==this._mouseStart(d),!this._mouseStarted)?(d.preventDefault(),!0):(!0===a.data(d.target,this.widgetName+".preventClickEvent")&&a.removeData(d.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return f._mouseMove(a)},this._mouseUpDelegate=function(a){return f._mouseUp(a)},a(document).bind("mousemove."+
this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),d.preventDefault(),b=!0,!0)}},_mouseMove:function(b){return a.ui.ie&&(!document.documentMode||9>document.documentMode)&&!b.button?this._mouseUp(b):this._mouseStarted?(this._mouseDrag(b),b.preventDefault()):(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,b),this._mouseStarted?this._mouseDrag(b):this._mouseUp(b)),!this._mouseStarted)},_mouseUp:function(b){return a(document).unbind("mousemove."+
this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target===this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b)),!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},
_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})})(jQuery);
(function(a){a.widget("ui.sortable",a.ui.mouse,{version:"1.10.0",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1E3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,
receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var a=this.options;this.containerCache={};this.element.addClass("ui-sortable");this.refresh();this.floating=this.items.length?"x"===a.axis||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1;this.offset=this.element.offset();this._mouseInit();this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled");this._mouseDestroy();
for(var a=this.items.length-1;0<=a;a--)this.items[a].item.removeData(this.widgetName+"-item");return this},_setOption:function(b,d){"disabled"===b?(this.options[b]=d,this.widget().toggleClass("ui-sortable-disabled",!!d)):a.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(b,d){var f=null,e=!1,g=this;if(this.reverting||this.options.disabled||"static"===this.options.type)return!1;this._refreshItems(b);a(b.target).parents().each(function(){if(a.data(this,g.widgetName+"-item")===
g)return f=a(this),!1});a.data(b.target,g.widgetName+"-item")===g&&(f=a(b.target));return!f||this.options.handle&&!d&&(a(this.options.handle,f).find("*").addBack().each(function(){this===b.target&&(e=!0)}),!e)?!1:(this.currentItem=f,this._removeCurrentsFromItems(),!0)},_mouseStart:function(b,d,f){d=this.options;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(b);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=
this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");this.originalPosition=this._generatePosition(b);this.originalPageX=b.pageX;this.originalPageY=b.pageY;d.cursorAt&&this._adjustOffsetFromHelper(d.cursorAt);
this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};this.helper[0]!==this.currentItem[0]&&this.currentItem.hide();this._createPlaceholder();d.containment&&this._setContainment();d.cursor&&(a("body").css("cursor")&&(this._storedCursor=a("body").css("cursor")),a("body").css("cursor",d.cursor));d.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",d.opacity));d.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=
this.helper.css("zIndex")),this.helper.css("zIndex",d.zIndex));this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset());this._trigger("start",b,this._uiHash());this._preserveHelperProportions||this._cacheHelperProportions();if(!f)for(f=this.containers.length-1;0<=f;f--)this.containers[f]._trigger("activate",b,this._uiHash(this));return a.ui.ddmanager&&(a.ui.ddmanager.current=this),a.ui.ddmanager&&!d.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,
b),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(b),!0},_mouseDrag:function(b){var d,f,e,g;d=this.options;f=!1;this.position=this._generatePosition(b);this.positionAbs=this._convertPositionTo("absolute");this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs);this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-b.pageY<d.scrollSensitivity?this.scrollParent[0].scrollTop=
f=this.scrollParent[0].scrollTop+d.scrollSpeed:b.pageY-this.overflowOffset.top<d.scrollSensitivity&&(this.scrollParent[0].scrollTop=f=this.scrollParent[0].scrollTop-d.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-b.pageX<d.scrollSensitivity?this.scrollParent[0].scrollLeft=f=this.scrollParent[0].scrollLeft+d.scrollSpeed:b.pageX-this.overflowOffset.left<d.scrollSensitivity&&(this.scrollParent[0].scrollLeft=f=this.scrollParent[0].scrollLeft-d.scrollSpeed)):(b.pageY-a(document).scrollTop()<
d.scrollSensitivity?f=a(document).scrollTop(a(document).scrollTop()-d.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<d.scrollSensitivity&&(f=a(document).scrollTop(a(document).scrollTop()+d.scrollSpeed)),b.pageX-a(document).scrollLeft()<d.scrollSensitivity?f=a(document).scrollLeft(a(document).scrollLeft()-d.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<d.scrollSensitivity&&(f=a(document).scrollLeft(a(document).scrollLeft()+d.scrollSpeed))),!1!==f&&a.ui.ddmanager&&
!d.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b));this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||"y"!==this.options.axis)this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||"x"!==this.options.axis)this.helper[0].style.top=this.position.top+"px";for(d=this.items.length-1;0<=d;d--)if(f=this.items[d],e=f.item[0],(g=this._intersectsWithPointer(f))&&f.instance===this.currentContainer&&e!==this.currentItem[0]&&this.placeholder[1===g?"next":"prev"]()[0]!==
e&&!a.contains(this.placeholder[0],e)&&("semi-dynamic"===this.options.type?!a.contains(this.element[0],e):1)){this.direction=1===g?"down":"up";if("pointer"!==this.options.tolerance&&!this._intersectsWithSides(f))break;this._rearrange(b,f);this._trigger("change",b,this._uiHash());break}return this._contactContainers(b),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),this._trigger("sort",b,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(b,d){if(b){a.ui.ddmanager&&!this.options.dropBehaviour&&
a.ui.ddmanager.drop(this,b);if(this.options.revert){var f=this,e=this.placeholder.offset();this.reverting=!0;a(this.helper).animate({left:e.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft),top:e.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){f._clear(b)})}else this._clear(b,d);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null});
"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var b=this.containers.length-1;0<=b;b--)this.containers[b]._trigger("deactivate",null,this._uiHash(this)),this.containers[b].containerCache.over&&(this.containers[b]._trigger("out",null,this._uiHash(this)),this.containers[b].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),
"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),a.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?a(this.domPosition.prev).after(this.currentItem):a(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(b){var d=this._getItemsAsjQuery(b&&b.connected),f=[];return b=b||{},a(d).each(function(){var d=(a(b.item||this).attr(b.attribute||"id")||"").match(b.expression||/(.+)[\-=_](.+)/);d&&f.push((b.key||
d[1]+"[]")+"="+(b.key&&b.expression?d[1]:d[2]))}),!f.length&&b.key&&f.push(b.key+"="),f.join("&")},toArray:function(b){var d=this._getItemsAsjQuery(b&&b.connected),f=[];return b=b||{},d.each(function(){f.push(a(b.item||this).attr(b.attribute||"id")||"")}),f},_intersectsWith:function(a){var d=this.positionAbs.left,f=d+this.helperProportions.width,e=this.positionAbs.top,g=e+this.helperProportions.height,j=a.left,k=j+a.width,l=a.top,p=l+a.height,m=this.offset.click.top,s=this.offset.click.left;return"pointer"===
this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>a[this.floating?"width":"height"]?e+m>l&&e+m<p&&d+s>j&&d+s<k:j<d+this.helperProportions.width/2&&f-this.helperProportions.width/2<k&&l<e+this.helperProportions.height/2&&g-this.helperProportions.height/2<p},_intersectsWithPointer:function(a){var d="y"===this.options.axis||this.positionAbs.left+this.offset.click.left>a.left&&this.positionAbs.left+
this.offset.click.left<a.left+a.width,a=("x"===this.options.axis||this.positionAbs.top+this.offset.click.top>a.top&&this.positionAbs.top+this.offset.click.top<a.top+a.height)&&d,d=this._getDragVerticalDirection(),f=this._getDragHorizontalDirection();return a?this.floating?f&&"right"===f||"down"===d?2:1:d&&("down"===d?2:1):!1},_intersectsWithSides:function(a){var d=this.positionAbs.top+this.offset.click.top>a.top+a.height/2&&this.positionAbs.top+this.offset.click.top<a.top+a.height/2+a.height,a=this.positionAbs.left+
this.offset.click.left>a.left+a.width/2&&this.positionAbs.left+this.offset.click.left<a.left+a.width/2+a.width,f=this._getDragVerticalDirection(),e=this._getDragHorizontalDirection();return this.floating&&e?"right"===e&&a||"left"===e&&!a:f&&("down"===f&&d||"up"===f&&!d)},_getDragVerticalDirection:function(){var a=this.positionAbs.top-this.lastPositionAbs.top;return 0!==a&&(0<a?"down":"up")},_getDragHorizontalDirection:function(){var a=this.positionAbs.left-this.lastPositionAbs.left;return 0!==a&&
(0<a?"right":"left")},refresh:function(a){return this._refreshItems(a),this.refreshPositions(),this},_connectWith:function(){var a=this.options;return a.connectWith.constructor===String?[a.connectWith]:a.connectWith},_getItemsAsjQuery:function(b){var d,f,e,g=[],j=[],k=this._connectWith();if(k&&b)for(b=k.length-1;0<=b;b--){f=a(k[b]);for(d=f.length-1;0<=d;d--)(e=a.data(f[d],this.widgetFullName))&&e!==this&&!e.options.disabled&&j.push([a.isFunction(e.options.items)?e.options.items.call(e.element):a(e.options.items,
e.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),e])}j.push([a.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):a(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(b=j.length-1;0<=b;b--)j[b][0].each(function(){g.push(this)});return a(g)},_removeCurrentsFromItems:function(){var b=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=a.grep(this.items,
function(a){for(var f=0;f<b.length;f++)if(b[f]===a.item[0])return!1;return!0})},_refreshItems:function(b){this.items=[];this.containers=[this];var d,f,e,g,j,k=this.items,l=[[a.isFunction(this.options.items)?this.options.items.call(this.element[0],b,{item:this.currentItem}):a(this.options.items,this.element),this]];if((j=this._connectWith())&&this.ready)for(d=j.length-1;0<=d;d--){e=a(j[d]);for(f=e.length-1;0<=f;f--)(g=a.data(e[f],this.widgetFullName))&&g!==this&&!g.options.disabled&&(l.push([a.isFunction(g.options.items)?
g.options.items.call(g.element[0],b,{item:this.currentItem}):a(g.options.items,g.element),g]),this.containers.push(g))}for(d=l.length-1;0<=d;d--){b=l[d][1];e=l[d][0];f=0;for(j=e.length;f<j;f++)g=a(e[f]),g.data(this.widgetName+"-item",b),k.push({item:g,instance:b,width:0,height:0,left:0,top:0})}},refreshPositions:function(b){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var d,f,e;for(d=this.items.length-1;0<=d;d--)f=this.items[d],f.instance!==this.currentContainer&&this.currentContainer&&
f.item[0]!==this.currentItem[0]||(e=this.options.toleranceElement?a(this.options.toleranceElement,f.item):f.item,b||(f.width=e.outerWidth(),f.height=e.outerHeight()),e=e.offset(),f.left=e.left,f.top=e.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(d=this.containers.length-1;0<=d;d--)e=this.containers[d].element.offset(),this.containers[d].containerCache.left=e.left,this.containers[d].containerCache.top=e.top,this.containers[d].containerCache.width=
this.containers[d].element.outerWidth(),this.containers[d].containerCache.height=this.containers[d].element.outerHeight();return this},_createPlaceholder:function(b){var b=b||this,d,f=b.options;if(!f.placeholder||f.placeholder.constructor===String)d=f.placeholder,f.placeholder={element:function(){var f=a(document.createElement(b.currentItem[0].nodeName)).addClass(d||b.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return d||(f.style.visibility="hidden"),
f},update:function(a,g){if(!d||f.forcePlaceholderSize)g.height()||g.height(b.currentItem.innerHeight()-parseInt(b.currentItem.css("paddingTop")||0,10)-parseInt(b.currentItem.css("paddingBottom")||0,10)),g.width()||g.width(b.currentItem.innerWidth()-parseInt(b.currentItem.css("paddingLeft")||0,10)-parseInt(b.currentItem.css("paddingRight")||0,10))}};b.placeholder=a(f.placeholder.element.call(b.element,b.currentItem));b.currentItem.after(b.placeholder);f.placeholder.update(b,b.placeholder)},_contactContainers:function(b){var d,
f,e,g,j,k,l,p,m=f=null;for(d=this.containers.length-1;0<=d;d--)if(!a.contains(this.currentItem[0],this.containers[d].element[0]))if(this._intersectsWith(this.containers[d].containerCache)){if(!f||!a.contains(this.containers[d].element[0],f.element[0]))f=this.containers[d],m=d}else this.containers[d].containerCache.over&&(this.containers[d]._trigger("out",b,this._uiHash(this)),this.containers[d].containerCache.over=0);if(f)if(1===this.containers.length)this.containers[m]._trigger("over",b,this._uiHash(this)),
this.containers[m].containerCache.over=1;else{f=1E4;e=null;g=this.containers[m].floating?"left":"top";j=this.containers[m].floating?"width":"height";k=this.positionAbs[g]+this.offset.click[g];for(d=this.items.length-1;0<=d;d--)a.contains(this.containers[m].element[0],this.items[d].item[0])&&this.items[d].item[0]!==this.currentItem[0]&&(l=this.items[d].item.offset()[g],p=!1,Math.abs(l-k)>Math.abs(l+this.items[d][j]-k)&&(p=!0,l+=this.items[d][j]),Math.abs(l-k)<f&&(f=Math.abs(l-k),e=this.items[d],this.direction=
p?"up":"down"));if(e||this.options.dropOnEmpty)this.currentContainer=this.containers[m],e?this._rearrange(b,e,null,!0):this._rearrange(b,null,this.containers[m].element,!0),this._trigger("change",b,this._uiHash()),this.containers[m]._trigger("change",b,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[m]._trigger("over",b,this._uiHash(this)),this.containers[m].containerCache.over=1}},_createHelper:function(b){var d=this.options,b=a.isFunction(d.helper)?
a(d.helper.apply(this.element[0],[b,this.currentItem])):"clone"===d.helper?this.currentItem.clone():this.currentItem;return b.parents("body").length||a("parent"!==d.appendTo?d.appendTo:this.currentItem[0].parentNode)[0].appendChild(b[0]),b[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!b[0].style.width||d.forceHelperSize)&&
b.width(this.currentItem.width()),(!b[0].style.height||d.forceHelperSize)&&b.height(this.currentItem.height()),b},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" "));a.isArray(b)&&(b={left:+b[0],top:+b[1]||0});"left"in b&&(this.offset.click.left=b.left+this.margins.left);"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left);"top"in b&&(this.offset.click.top=b.top+this.margins.top);"bottom"in b&&(this.offset.click.top=this.helperProportions.height-
b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&a.ui.ie)b={top:0,left:0};return{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),
10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var a=this.currentItem.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),
10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b,d,f,e=this.options;"parent"===e.containment&&(e.containment=this.helper[0].parentNode);if("document"===e.containment||"window"===e.containment)this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,a("document"===e.containment?document:window).width()-this.helperProportions.width-
this.margins.left,(a("document"===e.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];/^(document|window|parent)$/.test(e.containment)||(b=a(e.containment)[0],d=a(e.containment).offset(),f="hidden"!==a(b).css("overflow"),this.containment=[d.left+(parseInt(a(b).css("borderLeftWidth"),10)||0)+(parseInt(a(b).css("paddingLeft"),10)||0)-this.margins.left,d.top+(parseInt(a(b).css("borderTopWidth"),10)||0)+(parseInt(a(b).css("paddingTop"),
10)||0)-this.margins.top,d.left+(f?Math.max(b.scrollWidth,b.offsetWidth):b.offsetWidth)-(parseInt(a(b).css("borderLeftWidth"),10)||0)-(parseInt(a(b).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,d.top+(f?Math.max(b.scrollHeight,b.offsetHeight):b.offsetHeight)-(parseInt(a(b).css("borderTopWidth"),10)||0)-(parseInt(a(b).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(b,d){d||(d=this.position);var f="absolute"===
b?1:-1,e="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,g=/(html|body)/i.test(e[0].tagName);return{top:d.top+this.offset.relative.top*f+this.offset.parent.top*f-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():g?0:e.scrollTop())*f,left:d.left+this.offset.relative.left*f+this.offset.parent.left*f-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():g?0:e.scrollLeft())*f}},_generatePosition:function(b){var d,
f,e=this.options,g=b.pageX,j=b.pageY,k="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(k[0].tagName);return"relative"===this.cssPosition&&(this.scrollParent[0]===document||this.scrollParent[0]===this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(b.pageX-this.offset.click.left<this.containment[0]&&(g=this.containment[0]+
this.offset.click.left),b.pageY-this.offset.click.top<this.containment[1]&&(j=this.containment[1]+this.offset.click.top),b.pageX-this.offset.click.left>this.containment[2]&&(g=this.containment[2]+this.offset.click.left),b.pageY-this.offset.click.top>this.containment[3]&&(j=this.containment[3]+this.offset.click.top)),e.grid&&(d=this.originalPageY+Math.round((j-this.originalPageY)/e.grid[1])*e.grid[1],j=this.containment?d-this.offset.click.top>=this.containment[1]&&d-this.offset.click.top<=this.containment[3]?
d:d-this.offset.click.top>=this.containment[1]?d-e.grid[1]:d+e.grid[1]:d,f=this.originalPageX+Math.round((g-this.originalPageX)/e.grid[0])*e.grid[0],g=this.containment?f-this.offset.click.left>=this.containment[0]&&f-this.offset.click.left<=this.containment[2]?f:f-this.offset.click.left>=this.containment[0]?f-e.grid[0]:f+e.grid[0]:f)),{top:j-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:k.scrollTop()),left:g-this.offset.click.left-
this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:k.scrollLeft())}},_rearrange:function(a,d,f,e){f?f[0].appendChild(this.placeholder[0]):d.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?d.item[0]:d.item[0].nextSibling);var g=this.counter=this.counter?++this.counter:1;this._delay(function(){g===this.counter&&this.refreshPositions(!e)})},_clear:function(b,d){this.reverting=!1;var f,e=[];!this._noFinalSort&&
this.currentItem.parent().length&&this.placeholder.before(this.currentItem);this._noFinalSort=null;if(this.helper[0]===this.currentItem[0]){for(f in this._storedCSS)if("auto"===this._storedCSS[f]||"static"===this._storedCSS[f])this._storedCSS[f]="";this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!d&&e.push(function(a){this._trigger("receive",a,this._uiHash(this.fromOutside))});(this.fromOutside||this.domPosition.prev!==this.currentItem.prev().not(".ui-sortable-helper")[0]||
this.domPosition.parent!==this.currentItem.parent()[0])&&!d&&e.push(function(a){this._trigger("update",a,this._uiHash())});this!==this.currentContainer&&(d||(e.push(function(a){this._trigger("remove",a,this._uiHash())}),e.push(function(a){return function(b){a._trigger("receive",b,this._uiHash(this))}}.call(this,this.currentContainer)),e.push(function(a){return function(b){a._trigger("update",b,this._uiHash(this))}}.call(this,this.currentContainer))));for(f=this.containers.length-1;0<=f;f--)d||e.push(function(a){return function(b){a._trigger("deactivate",
b,this._uiHash(this))}}.call(this,this.containers[f])),this.containers[f].containerCache.over&&(e.push(function(a){return function(b){a._trigger("out",b,this._uiHash(this))}}.call(this,this.containers[f])),this.containers[f].containerCache.over=0);this._storedCursor&&a("body").css("cursor",this._storedCursor);this._storedOpacity&&this.helper.css("opacity",this._storedOpacity);this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex);this.dragging=!1;if(this.cancelHelperRemoval){if(!d){this._trigger("beforeStop",
b,this._uiHash());for(f=0;f<e.length;f++)e[f].call(this,b);this._trigger("stop",b,this._uiHash())}return this.fromOutside=!1,!1}d||this._trigger("beforeStop",b,this._uiHash());this.placeholder[0].parentNode.removeChild(this.placeholder[0]);this.helper[0]!==this.currentItem[0]&&this.helper.remove();this.helper=null;if(!d){for(f=0;f<e.length;f++)e[f].call(this,b);this._trigger("stop",b,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){!1===a.Widget.prototype._trigger.apply(this,arguments)&&
this.cancel()},_uiHash:function(b){var d=b||this;return{helper:d.helper,placeholder:d.placeholder||a([]),position:d.position,originalPosition:d.originalPosition,offset:d.positionAbs,item:d.currentItem,sender:b?b.element:null}}})})(jQuery);(function(){BinaryFile=function(a,b,d){var f=a,e=b||0,g=0;this.getRawData=function(){return f};"string"==typeof a?(g=d||f.length,this.getByteAt=function(a){return f.charCodeAt(a+e)&255}):"unknown"==typeof a&&(g=d||IEBinary_getLength(f),this.getByteAt=function(a){return IEBinary_getByteAt(f,a+e)});this.getLength=function(){return g};this.getSByteAt=function(a){a=this.getByteAt(a);return a>127?a-256:a};this.getShortAt=function(a,b){var d=b?(this.getByteAt(a)<<8)+this.getByteAt(a+1):(this.getByteAt(a+
1)<<8)+this.getByteAt(a);d<0&&(d=d+65536);return d};this.getSShortAt=function(a,b){var d=this.getShortAt(a,b);return d>32767?d-65536:d};this.getLongAt=function(a,b){var d=this.getByteAt(a),f=this.getByteAt(a+1),e=this.getByteAt(a+2),g=this.getByteAt(a+3),d=b?(((d<<8)+f<<8)+e<<8)+g:(((g<<8)+e<<8)+f<<8)+d;d<0&&(d=d+4294967296);return d};this.getSLongAt=function(a,b){var d=this.getLongAt(a,b);return d>2147483647?d-4294967296:d};this.getStringAt=function(a,b){for(var d=[],f=a,e=0;f<a+b;f++,e++)d[e]=String.fromCharCode(this.getByteAt(f));
return d.join("")};this.getCharAt=function(a){return String.fromCharCode(this.getByteAt(a))};this.toBase64=function(){return window.btoa(f)};this.fromBase64=function(a){f=window.atob(a)}};var a,b=function(){var a=null;window.XMLHttpRequest?a=new XMLHttpRequest:window.ActiveXObject&&(a=new ActiveXObject("Microsoft.XMLHTTP"));return a},d=function(a,d,f,e,g,k){var j=b();if(j){var t=0;e&&!g&&(t=e[0]);var q=0;e&&(q=e[1]-e[0]+1);d&&("undefined"!=typeof j.onload?j.onload=function(){"200"==j.status||"206"==
j.status||"0"==j.status?(this.binaryResponse=new BinaryFile(this.responseText,t,q),this.fileSize=k||this.getResponseHeader("Content-Length"),d(this)):f&&f();j=null}:j.onreadystatechange=function(){4==j.readyState&&("200"==j.status||"206"==j.status||"0"==j.status?(this.binaryResponse=new BinaryFile(j.responseBody,t,q),this.fileSize=k||this.getResponseHeader("Content-Length"),d(this)):f&&f(),j=null)});j.open("GET",a,!0);j.overrideMimeType&&j.overrideMimeType("text/plain; charset=x-user-defined");e&&
g&&j.setRequestHeader("Range","bytes="+e[0]+"-"+e[1]);j.send(null)}else f&&f()};a=function(a,f,e,g){if(g){var k=function(b){var j=parseInt(b.getResponseHeader("Content-Length"),10),b=b.getResponseHeader("Accept-Ranges"),k;k=g[0];0>g[0]&&(k+=j);d(a,f,e,[k,k+g[1]-1],"bytes"==b,j)},j=b();j&&(k&&("undefined"!=typeof j.onload?j.onload=function(){"200"==j.status&&k(this);j=null}:j.onreadystatechange=function(){4==j.readyState&&("200"==j.status&&k(this),j=null)}),j.open("HEAD",a,!0),j.send(null))}else d(a,
f,e)};document.write("<script type='text/vbscript'>\r\nFunction IEBinary_getByteAt(strBinary, iOffset)\r\n\tIEBinary_getByteAt = AscB(MidB(strBinary,iOffset+1,1))\r\nEnd Function\r\nFunction IEBinary_getLength(strBinary)\r\n\tIEBinary_getLength = LenB(strBinary)\r\nEnd Function\r\n<\/script>\r\n");EXIF={};var f=function(a){if(255!=a.getByteAt(0)||216!=a.getByteAt(1))return!1;for(var b=2,d=a.getLength();b<d;){if(255!=a.getByteAt(b))return k&&console.log("Not a valid marker at offset "+b+", found: "+
a.getByteAt(b)),!1;var f=a.getByteAt(b+1);if(22400==f||225==f)return k&&console.log("Found 0xFFE1 marker"),j(a,b+4,a.getShortAt(b+2,!0)-2);b+=2+a.getShortAt(b+2,!0)}},e=function(a,b,d,f,e){for(var j=a.getShortAt(d,e),r={},t=0;t<j;t++){var q=d+12*t+2,y=f[a.getShortAt(q,e)];!y&&k&&console.log("Unknown tag: "+a.getShortAt(q,e));r[y]=g(a,q,b,d,e)}return r},g=function(a,b,d,f,e){var g=a.getShortAt(b+2,e),f=a.getLongAt(b+4,e),d=a.getLongAt(b+8,e)+d;switch(g){case 1:case 7:if(1==f)return a.getByteAt(b+8,
e);d=4<f?d:b+8;b=[];for(g=0;g<f;g++)b[g]=a.getByteAt(d+g);return b;case 2:return a.getStringAt(4<f?d:b+8,f-1);case 3:if(1==f)return a.getShortAt(b+8,e);d=2<f?d:b+8;b=[];for(g=0;g<f;g++)b[g]=a.getShortAt(d+2*g,e);return b;case 4:if(1==f)return a.getLongAt(b+8,e);b=[];for(g=0;g<f;g++)b[g]=a.getLongAt(d+4*g,e);return b;case 5:if(1==f)return a.getLongAt(d,e)/a.getLongAt(d+4,e);b=[];for(g=0;g<f;g++)b[g]=a.getLongAt(d+8*g,e)/a.getLongAt(d+4+8*g,e);return b;case 9:if(1==f)return a.getSLongAt(b+8,e);b=[];
for(g=0;g<f;g++)b[g]=a.getSLongAt(d+4*g,e);return b;case 10:if(1==f)return a.getSLongAt(d,e)/a.getSLongAt(d+4,e);b=[];for(g=0;g<f;g++)b[g]=a.getSLongAt(d+8*g,e)/a.getSLongAt(d+4+8*g,e);return b}},j=function(a,b){if("Exif"!=a.getStringAt(b,4))return k&&console.log("Not valid EXIF data! "+a.getStringAt(b,4)),!1;var d,f=b+6;if(18761==a.getShortAt(f))d=!1;else if(19789==a.getShortAt(f))d=!0;else return k&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;if(42!=a.getShortAt(f+2,d))return k&&
console.log("Not valid TIFF data! (no 0x002A)"),!1;if(8!=a.getLongAt(f+4,d))return k&&console.log("Not valid TIFF data! (First offset not 8)",a.getShortAt(f+4,d)),!1;var g=e(a,f,f+8,EXIF.TiffTags,d);if(g.ExifIFDPointer){var j=e(a,f,f+g.ExifIFDPointer,EXIF.Tags,d),r;for(r in j){switch(r){case "LightSource":case "Flash":case "MeteringMode":case "ExposureProgram":case "SensingMethod":case "SceneCaptureType":case "SceneType":case "CustomRendered":case "WhiteBalance":case "GainControl":case "Contrast":case "Saturation":case "Sharpness":case "SubjectDistanceRange":case "FileSource":j[r]=
EXIF.StringValues[r][j[r]];break;case "ExifVersion":case "FlashpixVersion":j[r]=String.fromCharCode(j[r][0],j[r][1],j[r][2],j[r][3]);break;case "ComponentsConfiguration":j[r]=EXIF.StringValues.Components[j[r][0]]+EXIF.StringValues.Components[j[r][1]]+EXIF.StringValues.Components[j[r][2]]+EXIF.StringValues.Components[j[r][3]]}g[r]=j[r]}}if(g.GPSInfoIFDPointer)for(r in d=e(a,f,f+g.GPSInfoIFDPointer,EXIF.GPSTags,d),d){switch(r){case "GPSVersionID":d[r]=d[r][0]+"."+d[r][1]+"."+d[r][2]+"."+d[r][3]}g[r]=
d[r]}return g},k=!1;EXIF.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",
34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",
41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"};EXIF.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",
259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",
272:"Model",305:"Software",315:"Artist",33432:"Copyright"};EXIF.GPSTags={"0":"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",
24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"};EXIF.StringValues={ExposureProgram:{"0":"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{"0":"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{"0":"Unknown",
1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{"0":"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",
7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",
71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},
SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{"0":"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{"0":"Normal process",1:"Custom process"},WhiteBalance:{"0":"Auto white balance",1:"Manual white balance"},GainControl:{"0":"None",1:"Low gain up",2:"High gain up",
3:"Low gain down",4:"High gain down"},Contrast:{"0":"Normal",1:"Soft",2:"Hard"},Saturation:{"0":"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{"0":"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{"0":"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{"0":"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};EXIF.getData=function(b,d){if(!b.complete)return!1;b.exifdata?d&&d():a(b.src,function(a){a=f(a.binaryResponse);b.exifdata=a||{};d&&d(b.exifdata)});return!0};
EXIF.getTag=function(a,b){if(a.exifdata)return a.exifdata[b]};EXIF.getAllTags=function(a){if(!a.exifdata)return{};var a=a.exifdata,b={},d;for(d in a)a.hasOwnProperty(d)&&(b[d]=a[d]);return b};EXIF.pretty=function(a){if(!a.exifdata)return"";var a=a.exifdata,b="",d;for(d in a)a.hasOwnProperty(d)&&(b="object"==typeof a[d]?b+(d+" : ["+a[d].length+" values]\r\n"):b+(d+" : "+a[d]+"\r\n"));return b};EXIF.readFromBinaryFile=function(a){return f(a)};jQuery.fn.exifLoad=function(a){return this.each(function(){EXIF.getData(this,
a)})};jQuery.fn.exif=function(a){var b=[];this.each(function(){b.push(EXIF.getTag(this,a))});return b};jQuery.fn.exifAll=function(){var a=[];this.each(function(){a.push(EXIF.getAllTags(this))});return a};jQuery.fn.exifPretty=function(){var a=[];this.each(function(){a.push(EXIF.pretty(this))});return a}})();/*
 MIT
 @author Dave Hulbert (dave1010)
 @version 1.0.0 2013-01-17
*/
(function(a){a.fn.fastClick=function(b){return a(this).each(function(){a.FastButton(a(this)[0],b)})};a.FastButton=function(b,d){var f,e,g=function(){a(b).unbind("touchend");a("body").unbind("touchmove.fastClick")},j=function(b){b.stopPropagation();g();d.call(this,b);"touchend"===b.type&&a.clickbuster.preventGhostClick(f,e)},k=function(a){(10<Math.abs(a.originalEvent.touches[0].clientX-f)||10<Math.abs(a.originalEvent.touches[0].clientY-e))&&g()};a(b).bind({touchstart:function(d){d.stopPropagation();
a(b).bind("touchend",j);a("body").bind("touchmove.fastClick",k);f=d.originalEvent.touches[0].clientX;e=d.originalEvent.touches[0].clientY},click:j})};a.clickbuster={coordinates:[],preventGhostClick:function(b,d){a.clickbuster.coordinates.push(b,d);window.setTimeout(a.clickbuster.pop,2500)},pop:function(){a.clickbuster.coordinates.splice(0,2)},onClick:function(b){var d,f,e;for(e=0;e<a.clickbuster.coordinates.length;e+=2)d=a.clickbuster.coordinates[e],f=a.clickbuster.coordinates[e+1],25>Math.abs(b.clientX-
d)&&25>Math.abs(b.clientY-f)&&(b.stopPropagation(),b.preventDefault())}};a(function(){document.addEventListener?document.addEventListener("click",a.clickbuster.onClick,!0):document.attachEvent&&document.attachEvent("onclick",a.clickbuster.onClick)})})(jQuery);(function(a){function b(a,b){if(!(1<a.originalEvent.touches.length)){a.preventDefault();var d=a.originalEvent.changedTouches[0],f=document.createEvent("MouseEvents");f.initMouseEvent(b,!0,!0,window,1,d.screenX,d.screenY,d.clientX,d.clientY,!1,!1,!1,!1,0,null);a.target.dispatchEvent(f)}}a.support.touch="ontouchend"in document;if(a.support.touch){var d=a.ui.mouse.prototype,f=d._mouseInit,e;d._touchStart=function(a){!e&&this._mouseCapture(a.originalEvent.changedTouches[0])&&(e=!0,this._touchMoved=!1,
b(a,"mouseover"),b(a,"mousemove"),b(a,"mousedown"))};d._touchMove=function(a){e&&(this._touchMoved=!0,b(a,"mousemove"))};d._touchEnd=function(a){e&&(b(a,"mouseup"),b(a,"mouseout"),this._touchMoved||b(a,"click"),e=!1)};d._mouseInit=function(){this.element.bind("touchstart",a.proxy(this,"_touchStart")).bind("touchmove",a.proxy(this,"_touchMove")).bind("touchend",a.proxy(this,"_touchEnd"));f.call(this)}}})(jQuery);(function(){function a(a,b,e){var g=a.naturalWidth,j=a.naturalHeight,k=e.width,l=e.height,p=b.getContext("2d");p.save();e=e.orientation;switch(e){case 5:case 6:case 7:case 8:b.width=l;b.height=k;break;default:b.width=k,b.height=l}b=b.getContext("2d");switch(e){case 2:b.translate(k,0);b.scale(-1,1);break;case 3:b.translate(k,l);b.rotate(Math.PI);break;case 4:b.translate(0,l);b.scale(1,-1);break;case 5:b.rotate(0.5*Math.PI);b.scale(1,-1);break;case 6:b.rotate(0.5*Math.PI);b.translate(0,-l);break;case 7:b.rotate(0.5*
Math.PI);b.translate(k,-l);b.scale(-1,1);break;case 8:b.rotate(-0.5*Math.PI),b.translate(-k,0)}b=a.naturalWidth;1048576<b*a.naturalHeight?(e=document.createElement("canvas"),e.width=e.height=1,e=e.getContext("2d"),e.drawImage(a,-b+1,0),b=0===e.getImageData(0,0,1,1).data[3]):b=!1;b&&(g/=2,j/=2);b=document.createElement("canvas");b.width=b.height=1024;var e=b.getContext("2d"),m;m=j;var s=document.createElement("canvas");s.width=1;s.height=m;s=s.getContext("2d");s.drawImage(a,0,0);for(var s=s.getImageData(0,
0,1,m).data,o=0,n=m,r=m;r>o;)0===s[4*(r-1)+3]?n=r:o=r,r=n+o>>1;m=r/m;m=0===m?1:m;k=Math.ceil(1024*k/g);l=Math.ceil(1024*l/j/m);for(s=m=0;m<j;){for(n=o=0;o<g;)e.clearRect(0,0,1024,1024),e.drawImage(a,-o,-m),p.drawImage(b,0,0,1024,1024,n,s,k,l),o+=1024,n+=k;m+=1024;s+=l}p.restore()}function b(a){if(a instanceof Blob){var b=new Image,e=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!e)throw Error("No createObjectURL function found to create blob url");
b.src=e.createObjectURL(a);a=b}if(!a.naturalWidth&&!a.naturalHeight){var g=this;a.onload=function(){var a=g.imageLoadListeners;if(a){g.imageLoadListeners=null;for(var b=0,d=a.length;b<d;b++)a[b]()}};this.imageLoadListeners=[]}this.srcImage=a}b.prototype.render=function(b,f){if(this.imageLoadListeners){var e=this;this.imageLoadListeners.push(function(){e.render(b,f)})}else{var f=f||{},g=this.srcImage.naturalWidth,j=this.srcImage.naturalHeight,k=f.width,l=f.height,p=f.maxWidth,m=f.maxHeight;k&&!l?l=
j*k/g<<0:l&&!k?k=g*l/j<<0:(k=g,l=j);p&&k>p&&(k=p,l=j*k/g<<0);m&&l>m&&(l=m,k=g*l/j<<0);var g={width:k,height:l},s;for(s in f)g[s]=f[s];s=b.tagName.toLowerCase();"img"===s?(s=this.srcImage,j=document.createElement("canvas"),a(s,j,g),s=j.toDataURL("image/jpeg",g.quality||0.8),b.src=s):"canvas"===s&&a(this.srcImage,b,g);if("function"===typeof this.onrender)this.onrender(b)}};this.MegaPixImage=b})();if("undefined"==typeof stlib)var stlib={};stlib.functions||(stlib.functions=[],stlib.functionCount=0);stlib.global={};stlib.global.hash=document.location.href.split("#");stlib.global.hash.shift();stlib.global.hash=stlib.global.hash.join("#");stlib.dynamicOn=!0;stlib.debugOn=!1;
stlib.debug={count:0,messages:[],debug:function(a,b){b&&typeof console!="undefined"&&console.log(a);stlib.debug.messages.push(a)},show:function(a){for(message in stlib.debug.messages)typeof console!="undefined"&&(a?/ERROR/.test(stlib.debug.messages[message])?console.log(stlib.debug.messages[message]):null:console.log(stlib.debug.messages[message]))},showError:function(){stlib.debug.show(true)}};
var _$d=function(a){stlib.debug.debug(a,stlib.debugOn)},_$d0=function(){_$d(" ")},_$d_=function(){_$d("___________________________________________")},_$d1=function(a){_$d(_$dt()+"| "+a)},_$d2=function(a){_$d(_$dt()+"|  * "+a)},_$de=function(a){_$d(_$dt()+"ERROR: "+a)},_$dt=function(){var a=new Date,b=a.getHours(),d=a.getMinutes(),a=a.getSeconds();return b+":"+d+":"+a+" > "};
stlib.buttonInfo={buttonList:[],addButton:function(a){stlib.buttonInfo.buttonList.push(a)},getButton:function(a){if(isNaN(a))for(c=0;c<stlib.buttonInfo.buttonList.length;c++)stlib.buttonInfo.buttonList[c].service==a&&debug(stlib.buttonInfo.buttonList[c]);else return a>=stlib.buttonInfo.buttonList.length?false:stlib.buttonInfo.buttonList[a]},clickButton:function(a){if(isNaN(a))for(c=0;c<stlib.buttonInfo.buttonList.length;c++){if(stlib.buttonInfo.buttonList[c].service==a){if(stlib.buttonInfo.getButton(c).service==
"sharethis"||stlib.buttonInfo.getButton(c).service=="email"||stlib.buttonInfo.getButton(c).service=="wordpress"){stlib.buttonInfo.getButton(c).popup();return true}stlib.buttonInfo.getButton(c).element.childNodes[0].onclick()}}else{if(a>=stlib.buttonInfo.buttonList.length)return false;if(stlib.buttonInfo.getButton(a).service=="sharethis"||stlib.buttonInfo.getButton(a).service=="email"||stlib.buttonInfo.getButton(a).service=="wordpress")stlib.buttonInfo.getButton(a).popup();else stlib.buttonInfo.getButton(a).element.childNodes[0].onclick()}},
resetButton:function(){stlib.buttonInfo.buttonList=[]},listButton:function(){for(c=0;c<stlib.buttonInfo.buttonList.length;c++)debug(stlib.buttonInfo.buttonList[c])}};stlib.buttonInfo.resetButton();
stlib.messageQueue=function(){var a=this;this.pumpInstance=null;this.queue=[];this.dependencies=["data"];this.sending=true;this.setPumpInstance=function(a){this.pumpInstance=a};this.send=function(b,d){if(typeof b=="string"&&typeof d=="string"){_$d_();_$d1("Queueing message: "+d+": "+b)}typeof b=="string"&&typeof d=="string"?this.queue.push([d,b]):null;if(this.sending==false||stlib.browser.ieFallback)if(this.pumpInstance!=null)if(this.dependencies.length>0)for(messageSet in this.queue){if(this.queue[messageSet][0]==
this.dependencies[0]&&this.queue.length>0){_$d1("Current Queue Length: "+this.queue.length);var f=this.queue.shift();this.pumpInstance.broadcastSendMessage(f[1]);this.dependencies.shift();this.sending=true}}else{if(this.queue.length>0){_$d1("Current Queue Length: "+this.queue.length);f=this.queue.shift();this.pumpInstance.broadcastSendMessage(f[1]);this.sending=true}}else{_$d_();_$d1("Pump is null")}if(stlib.browser.ieFallback&&this.queue.length>0){f="process"+stlib.functionCount;stlib.functionCount++;
stlib.functions[f]=a.process;setTimeout("stlib.functions['"+f+"']()",500)}};this.process=function(){_$d1("Processing MessageQueue");a.sending=false;_$d(this.queue);a.send()}};
stlib.sharer={sharerUrl:("https:"==document.location.protocol?"https://ws.":"http://wd.")+"sharethis.com/api/sharer.php",regAuto:RegExp(/(.*?)_auto$/),constructParamString:function(){stlib.data.validate();stlib.hash.checkURL();var a=stlib.data.pageInfo,b="?",d;for(d in a){b=b+(d+"="+encodeURIComponent(a[d])+"&");_$d1("constructParamStringPageInfo: "+d+": "+a[d])}a=stlib.data.shareInfo;for(d in a){b=b+(d+"="+encodeURIComponent(a[d])+"&");_$d1("constructParamStringShareInfo: "+d+": "+a[d])}return b.substring(0,
b.length-1)},sharePinterest:function(){typeof stWidget!="undefined"&&typeof stWidget.closeWidget==="function"&&stWidget.closeWidget();typeof stcloseWidget==="function"&&stcloseWidget();typeof stToolbar!="undefined"&&typeof stToolbar.closeWidget==="function"&&stToolbar.closeWidget();var a=document.createElement("script");a.setAttribute("type","text/javascript");a.setAttribute("charset","UTF-8");a.setAttribute("src","//assets.pinterest.com/js/pinmarklet.js?r="+Math.random()*99999999);document.body.appendChild(a)},
share:function(a,b){var d=stlib.sharer.constructParamString();_$d_();_$d1("Initiating a Share with the following url:");_$d2(stlib.sharer.sharerUrl+d);if(stlib.data.get("destination","shareInfo")=="pinterest"&&stlib.data.get("source","shareInfo").match(/share4xmobile/)==null&&stlib.data.get("source","shareInfo").match(/share4xpage/)==null&&stlib.data.get("source","shareInfo").match(/5xpage/)==null&&(stlib.data.get("image","shareInfo")==false||stlib.data.get("image","shareInfo")==null)||stlib.data.get("destination",
"shareInfo")=="copy"||stlib.data.get("destination","shareInfo")=="plusone"||stlib.data.get("destination","shareInfo").match(stlib.sharer.regAuto)||typeof stlib.nativeButtons!="undefined"&&stlib.nativeButtons.checkNativeButtonSupport(stlib.data.get("destination","shareInfo"))){var f=new Image(1,1);f.src=stlib.sharer.sharerUrl+d;f.onload=function(){}}else typeof b!="undefined"&&b==true?window.open(stlib.sharer.sharerUrl+d,(new Date).valueOf(),"scrollbars=1, status=1, height=480, width=640, resizable=1"):
window.open(stlib.sharer.sharerUrl+d);a?a():null}};
stlib.browser={iemode:null,firefox:null,firefoxVersion:null,safari:null,chrome:null,windows:null,mac:null,ieFallback:/MSIE [6789]/.test(navigator.userAgent),init:function(){if(window.navigator.appName=="Microsoft Internet Explorer")if(document.documentMode)stlib.browser.iemode=document.documentMode;else{stlib.browser.iemode=5;if(document.compatMode&&document.compatMode=="CSS1Compat")stlib.browser.iemode=7}stlib.browser.firefox=navigator.userAgent.indexOf("Firefox")!=-1?true:false;stlib.browser.firefoxVersion=
navigator.userAgent.indexOf("Firefox/5.0")!=-1||navigator.userAgent.indexOf("Firefox/9.0")!=-1?false:true;stlib.browser.safari=navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1?true:false;stlib.browser.chrome=navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")!=-1?true:false;stlib.browser.windows=navigator.userAgent.indexOf("Windows")!=-1?true:false;stlib.browser.mac=navigator.userAgent.indexOf("Macintosh")!=-1?true:false},getIEVersion:function(){return stlib.browser.iemode},
isFirefox:function(){return stlib.browser.firefox},firefox8Version:function(){return stlib.browser.firefoxVersion},isSafari:function(){return stlib.browser.safari},isWindows:function(){return stlib.browser.windows},isMac:function(){return stlib.browser.mac}};stlib.browser.init();
stlib.browser.mobile={mobile:!1,uagent:null,android:null,iOs:null,silk:null,windows:null,kindle:null,init:function(){this.uagent=navigator.userAgent.toLowerCase();if(this.isAndroid())this.mobile=true;else if(this.isIOs())this.mobile=true;else if(this.isSilk())this.mobile=true;else if(this.isWindowsPhone())this.mobile=true;else if(this.isKindle())this.mobile=true},isMobile:function(){return this.mobile},isAndroid:function(){if(this.android===null)this.android=this.uagent.indexOf("android")>-1;return this.android},
isKindle:function(){if(this.kindle===null)this.kindle=this.uagent.indexOf("kindle")>-1;return this.kindle},isIOs:function(){if(this.iOs===null)this.iOs=this.uagent.indexOf("ipad")>-1||this.uagent.indexOf("ipod")>-1||this.uagent.indexOf("iphone")>-1;return this.iOs},isSilk:function(){if(this.silk===null)this.silk=this.uagent.indexOf("silk")>-1;return this.silk},isWindowsPhone:function(){if(this.windows===null)this.windows=this.uagent.indexOf("windows phone")>-1;return this.windows},handleForMobileFriendly:function(a,
b,d){if(!this.isMobile())return false;if(typeof stLight==="undefined"){stLight={};stLight.publisher=b.publisher;stLight.sessionID=b.sessionID;stLight.fpc=""}var f=typeof a.title!=="undefined"?a.title:encodeURIComponent(document.title),e=typeof a.url!=="undefined"?a.url:document.URL;if(b.service=="sharethis"){var f=typeof a.title!=="undefined"?a.title:encodeURIComponent(document.title),e=typeof a.url!=="undefined"?a.url:document.URL,g=document.createElement("form");g.setAttribute("method","GET");g.setAttribute("action",
"http://edge.sharethis.com/share4x/mobile.html");g.setAttribute("target","_blank");f={url:e,title:f,destination:b.service,publisher:stLight.publisher,fpc:stLight.fpc,sessionID:stLight.sessionID};if(typeof a.image!="undefined"&&a.image!=null)f.image=a.image;if(typeof a.summary!="undefined"&&a.summary!=null)f.desc=a.summary;if(typeof d!="undefined"&&typeof d.exclusive_services!="undefined"&&d.exclusive_services!=null)f.exclusive_services=d.exclusive_services;if(typeof b.exclusive_services!="undefined"&&
b.exclusive_services!=null)f.exclusive_services=b.exclusive_services;if(typeof d!="undefined"&&typeof d.services!="undefined"&&d.services!=null)f.services=d.services;if(typeof b.services!="undefined"&&b.services!=null)f.services=b.services;e=b;typeof d!="undefined"&&(e=d);if(typeof e.doNotHash!="undefined"&&e.doNotHash!=null)f.doNotHash=e.doNotHash;if(typeof a.via!="undefined"&&a.via!=null)f.via=a.via;f.service=b.service;f.type=b.type;if(stlib.data){a=stlib.json.encode(stlib.data.pageInfo);b=stlib.json.encode(stlib.data.shareInfo);
if(stlib.browser.isFirefox()&&!stlib.browser.firefox8Version()){a=encodeURIComponent(encodeURIComponent(a));b=encodeURIComponent(encodeURIComponent(b))}else{a=encodeURIComponent(a);b=encodeURIComponent(b)}f.pageInfo=a;f.shareInfo=b}for(var j in f){a=document.createElement("input");a.setAttribute("type","hidden");a.setAttribute("name",j);a.setAttribute("value",f[j]);g.appendChild(a)}document.body.appendChild(g);g.submit();return true}if(b.service=="email"){j="mailto:?Subject="+f+("&body="+(e+"%0A%0aSent using ShareThis"));
g=document.createElement("form");g.setAttribute("method","POST");g.setAttribute("action",j);document.body.appendChild(g);g.submit();return true}return false}};stlib.browser.mobile.init();
stlib.cookie={setCookie:function(a,b,d){var f=navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1,e=navigator.userAgent.indexOf("MSIE")!=-1;if(f||e){d=d?d*86400:0;f=document.createElement("div");f.setAttribute("id",a);f.setAttribute("type","hidden");document.body.appendChild(f);f=document.getElementById(a);e=document.createElement("form");try{var g=document.createElement('<iframe name="'+a+'" ></iframe>')}catch(j){g=document.createElement("iframe")}g.name=a;g.src=
"javascript:false";g.style.display="none";f.appendChild(g);e.action=("https:"==document.location.protocol?"https://sharethis.com/":"http://sharethis.com/")+"account/setCookie.php";e.method="POST";g=document.createElement("input");g.setAttribute("type","hidden");g.setAttribute("name","name");g.setAttribute("value",a);e.appendChild(g);g=document.createElement("input");g.setAttribute("type","hidden");g.setAttribute("name","value");g.setAttribute("value",b);e.appendChild(g);b=document.createElement("input");
b.setAttribute("type","hidden");b.setAttribute("name","time");b.setAttribute("value",d);e.appendChild(b);e.target=a;f.appendChild(e);e.submit()}else{if(d){g=new Date;g.setTime(g.getTime()+d*864E5);d="; expires="+g.toGMTString()}else d="";a=a+"="+escape(b)+d;a=a+("; domain="+escape(".sharethis.com")+";path=/");document.cookie=a}},getCookie:function(a){return(a=document.cookie.match("(^|;) ?"+a+"=([^;]*)(;|$)"))?unescape(a[2]):false},deleteCookie:function(a){var b=navigator.userAgent.indexOf("Safari")!=
-1&&navigator.userAgent.indexOf("Chrome")==-1,d=navigator.userAgent.indexOf("MSIE")!=-1;if(b||d){b=document.createElement("div");b.setAttribute("id",a);b.setAttribute("type","hidden");document.body.appendChild(b);b=document.getElementById(a);d=document.createElement("form");try{var f=document.createElement('<iframe name="'+a+'" ></iframe>')}catch(e){f=document.createElement("iframe")}f.name=a;f.src="javascript:false";f.style.display="none";b.appendChild(f);d.action=("https:"==document.location.protocol?
"https://sharethis.com/":"http://sharethis.com/")+"account/deleteCookie.php";d.method="POST";f=document.createElement("input");f.setAttribute("type","hidden");f.setAttribute("name","name");f.setAttribute("value",a);d.appendChild(f);d.target=a;b.appendChild(d);d.submit()}else document.cookie=a.replace(/^\s+|\s+$/g,"")+"=;path=/;domain=.sharethis.com;expires=Thu, 01-Jan-1970 00:00:01 GMT"},deleteAllSTCookie:function(){for(var a=document.cookie,a=a.split(";"),b=0;b<a.length;b++){var d=a[b],d=d.split("=");
if(!/st_optout/.test(d[0]))document.cookie=d[0]+"=;path=/;domain=.edge.sharethis.com;expires=Thu, 01-Jan-1970 00:00:01 GMT"}},setFpcCookie:function(a,b){var d=new Date,f=d.getFullYear(),e=d.getMonth()+9,g=d.getDate(),d=a+"="+escape(b);f&&(d=d+("; expires="+(new Date(f,e,g)).toGMTString()));f=stlib.cookie.getDomain();d=d+("; domain="+escape(f)+";path=/");document.cookie=d},getFpcCookie:function(a){return(a=document.cookie.match("(^|;) ?"+a+"=([^;]*)(;|$)"))?unescape(a[2]):false},getDomain:function(){var a=
document.domain.split(/\./),b="";a.length>1&&(b="."+a[a.length-2]+"."+a[a.length-1]);return b}};
stlib.fpc={cookieName:"__unam",cookieValue:"",createFpc:function(){if(!document.domain||document.domain.search(/\.gov/)>0)return false;var a=stlib.cookie.getFpcCookie(stlib.fpc.cookieName);if(a==false){var b=Math.round(Math.random()*2147483647),b=b.toString(16),a=(new Date).getTime(),a=a.toString(16),d=window.location.hostname.split(/\./)[1];if(!d)return false;var f="",a=f=stlib.fpc.determineHash(d)+"-"+a+"-"+b+"-1"}else{b=a.split(/\-/);if(b.length==4){a=Number(b[3]);a++;a=b[0]+"-"+b[1]+"-"+b[2]+
"-"+a}}stlib.cookie.setFpcCookie(stlib.fpc.cookieName,a);return stlib.fpc.cookieValue=a},determineHash:function(a){for(var b=0,d=0,f=a.length-1;f>=0;f--){d=parseInt(a.charCodeAt(f));b=(b<<8&268435455)+d+(d<<12);if((d=b&161119850)!=0)b=b^d>>20}return b.toString(16)}};
stlib.validate={regexes:{notEncoded:/(%[^0-7])|(%[0-7][^0-9a-f])|["{}\[\]\<\>\\\^`\|]/gi,tooEncoded:/%25([0-7][0-9a-f])/gi,publisher:/^(([a-z]{2}(-|\.))|)[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i,url:/^(http|https):\/\/([a-z0-9!'\(\)\*\.\-\+:]*(\.)[a-z0-9!'\(\)\*\.\-\+:]*)((\/[a-z0-9!'\(\)\*\.\-\+:]*)*)/i,fpc:/^[0-9a-f]{7}-[0-9a-f]{11}-[0-9a-f]{7,8}-[0-9]*$/i,sessionID:/^[0-9]*\.[0-9a-f]*$/i,title:/.*/,description:/.*/,buttonType:/^(chicklet|vcount|hcount|large|custom|button|)$/,
comment:/.*/,destination:/.*/,source:/.*/,image:/(^(http|https):\/\/([a-z0-9!'\(\)\*\.\-\+:]*(\.)[a-z0-9!'\(\)\*\.\-\+:]*)((\/[a-z0-9!'\(\)\*\.\-\+:]*)*))|^$/i,sourceURL:/^(http|https):\/\/([a-z0-9!'\(\)\*\.\-\+:]*(\.)[a-z0-9!'\(\)\*\.\-\+:]*)((\/[a-z0-9!'\(\)\*\.\-\+:]*)*)/i,sharURL:/(^(http|https):\/\/([a-z0-9!'\(\)\*\.\-\+:]*(\.)[a-z0-9!'\(\)\*\.\-\+:]*)((\/[a-z0-9!'\(\)\*\.\-\+:]*)*))|^$/i}};
"undefined"==typeof stlib.data&&(stlib.data={bInit:!1,publisherKeySet:!1,pageInfo:{},shareInfo:{},resetPageData:function(){stlib.data.pageInfo.fpc="ERROR";stlib.data.pageInfo.sessionID="ERROR";stlib.data.pageInfo.hostname="ERROR";stlib.data.pageInfo.location="ERROR"},resetShareData:function(){stlib.data.shareInfo={};stlib.data.shareInfo.url="ERROR";stlib.data.shareInfo.sharURL="";stlib.data.shareInfo.buttonType="ERROR";stlib.data.shareInfo.destination="ERROR";stlib.data.shareInfo.source="ERROR"},
resetData:function(){stlib.data.resetPageData();stlib.data.resetShareData()},validate:function(){function a(a,d){if(d!=encodeURIComponent(d)){b.notEncoded.test(d)?_$de(a+" not encoded"):null;b.tooEncoded.test(d)?_$de(a+" has too much encoding"):null}(b[a]?b[a].test(decodeURIComponent(d)):1)||_$de(a+" failed validation")}var b=stlib.validate.regexes,d=stlib.data.pageInfo,f;for(f in d)a(f,d[f]);d=stlib.data.shareInfo;for(f in d)a(f,d[f])},init:function(){if(!stlib.data.bInit){stlib.data.bInit=true;
stlib.data.resetData();stlib.data.set("url",document.location.href,"shareInfo");var a="";stlib.hash.init();stlib.data.set("shareHash",stlib.hash.shareHash,"pageInfo");stlib.data.set("incomingHash",stlib.hash.incomingHash,"pageInfo");stlib.hash.doNotHash||(a="#"+stlib.data.get("shareHash","pageInfo"));var b=stlib.hash.updateParams();stlib.data.set("url",b+a,"shareInfo");stlib.data.publisherKeySet!=true&&stlib.data.set("publisher","ur.00000000-0000-0000-0000-000000000000","pageInfo");stlib.fpc.createFpc();
stlib.data.set("fpc",stlib.fpc.cookieValue,"pageInfo");a=(new Date).getTime().toString();b=Number(Math.random().toPrecision(5).toString().substr(2)).toString();stlib.data.set("sessionID",a+"."+b,"pageInfo");stlib.data.set("hostname",document.location.hostname,"pageInfo");stlib.data.set("location",document.location.pathname,"pageInfo");b=document.referrer.replace("http://","").replace("https://","").split("/");a=b.shift();b=b.join("/");stlib.data.set("refDomain",a,"pageInfo");stlib.data.set("refQuery",
b,"pageInfo")}},setPublisher:function(a){stlib.data.set("publisher",a,"pageInfo");stlib.data.publisherKeySet=true},setSource:function(a,b){var d="",d=b?b.toolbar?"toolbar"+a:b.page&&b.page!="home"&&b.page!=""?"chicklet"+a:"button"+a:a;stlib.data.set("source",d,"shareInfo")},set:function(a,b,d){_$d_();_$d1("Setting: "+a+": "+b);if(typeof b=="number"||typeof b=="boolean")stlib.data[d][a]=b;else if(typeof b=="undefined"||b==null)_$d1("Value undefined or null");else{stlib.data[d][a]=encodeURIComponent(decodeURIComponent(unescape(b.replace(/<[^<>]*>/gi,
" ")).replace(/%/gi,"%25")));if(a=="url"||a=="location"||a=="image")try{stlib.data[d][a]=encodeURIComponent(decodeURIComponent(decodeURI(b.replace(/<[^<>]*>/gi," ")).replace(/%/gi,"%25")))}catch(f){stlib.data[d][a]=encodeURIComponent(decodeURIComponent(unescape(b.replace(/<[^<>]*>/gi," ")).replace(/%/gi,"%25")))}}},get:function(a,b){return stlib.data[b]&&stlib.data[b][a]?decodeURIComponent(stlib.data[b][a]):false},unset:function(a,b){stlib.data[b]&&typeof stlib.data[b][a]!="undefined"&&delete stlib.data[b][a]}},
stlib.data.resetData());
stlib.hash={doNotHash:!0,hashAddressBar:!1,doNotCopy:!0,prefix:"sthash",shareHash:"",incomingHash:"",validChars:"1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),servicePreferences:{linkedin:"param",stumbleupon:"param",bebo:"param"},hashDestination:function(a){if(a=="copy")return"dpuf";var a=a.substring(0,2)+a.substring(a.length-2,a.length),b=function(a,b){return a.charCodeAt(b)==122?"a":String.fromCharCode(a.charCodeAt(b)+1)};return b(a,0)+b(a,1)+b(a,2)+b(a,3)},getHash:function(){var a=
false,b="",d=document.location.href,d=d.split("#").shift(),d=d.split("?");if(d.length>1){d=d[1].split("&");for(arg in d)try{if(d[arg].substring(0,6)=="sthash"){a=true;b=d[arg]}}catch(f){}return a?b:document.location.hash.substring(1)}return document.location.hash.substring(1)},stripHash:function(a){a=a.split("#");return a.length>1?a[1]:""},clearHash:function(){if(stlib.hash.validateHash(document.location.hash))window.history&&history.replaceState?history.replaceState(null,"ShareThis","#"):/MSIE/.test(navigator.userAgent)?
window.location.replace("#"):document.location.hash=""},init:function(){var a="",b=stlib.hash.validChars.length;for(i=0;i<8;i++)a=a+stlib.hash.validChars[Math.random()*b|0];if(stlib.hash.getHash()=="")stlib.hash.shareHash=stlib.hash.prefix+"."+a;else{var b=stlib.hash.getHash().split("."),d=b.shift();if(d==stlib.hash.prefix||d==stlib.hash.prefix){stlib.hash.incomingHash=stlib.hash.getHash();stlib.hash.shareHash=stlib.hash.prefix+"."+b.shift()+"."+a}else stlib.hash.shareHash=stlib.hash.prefix+"."+a}if(!stlib.hash.doNotHash&&
stlib.hash.hashAddressBar){if(document.location.hash==""||stlib.hash.validateHash(document.location.hash))window.history&&history.replaceState?history.replaceState(null,"ShareThis","#"+stlib.hash.shareHash+".dpbs"):/MSIE/.test(navigator.userAgent)?window.location.replace("#"+stlib.hash.shareHash+".dpbs"):document.location.hash=stlib.hash.shareHash+".dpbs"}else stlib.hash.clearHash();!stlib.hash.doNotHash&&!stlib.hash.doNotCopy&&stlib.hash.copyPasteInit()},checkURL:function(){var a=stlib.data.get("destination",
"shareInfo"),b=stlib.hash.updateParams(a),d="."+stlib.hash.hashDestination(a);stlib.hash.updateDestination(d);if(!stlib.hash.doNotHash&&typeof stlib.data.pageInfo.shareHash!="undefined"){d=stlib.data.get("url","shareInfo");d=stlib.hash.stripHash(d);if(stlib.hash.validateHash(d)||d=="")if(typeof stlib.hash.servicePreferences[a]!="undefined")if(stlib.hash.servicePreferences[a]=="param"){_$d1("Don't use hash, use params");_$d2(b);if(b.split("?").length>1){var d=b.split("?")[1].split("&"),f=false;for(arg in d)d[arg].split(".")[0]==
"sthash"&&(f=true);f?stlib.data.set("url",b,"shareInfo"):stlib.data.set("url",b+"&"+stlib.data.pageInfo.shareHash,"shareInfo")}else stlib.data.set("url",b+"?"+stlib.data.pageInfo.shareHash,"shareInfo");a=="linkedin"&&stlib.data.get("sharURL","shareInfo")!=""&&stlib.data.set("sharURL",stlib.data.get("url","shareInfo"),"shareInfo")}else{_$d1("Using Hash");stlib.data.set("url",b+"#"+stlib.data.pageInfo.shareHash,"shareInfo")}else{_$d1("Not using custom destination hash type");stlib.data.set("url",b+
"#"+stlib.data.pageInfo.shareHash,"shareInfo")}}},updateParams:function(){var a=stlib.data.get("url","shareInfo").split("#").shift(),b=/(\?)sthash\.[a-zA-z0-9]{8}\.[a-zA-z0-9]{8}/,d=/(&)sthash\.[a-zA-z0-9]{8}\.[a-zA-z0-9]{8}/,f=/(\?)sthash\.[a-zA-z0-9]{8}/,e=/(&)sthash\.[a-zA-z0-9]{8}/;b.test(a)?a=a.replace(b,"?"+stlib.data.pageInfo.shareHash):d.test(a)?a=a.replace(d,"&"+stlib.data.pageInfo.shareHash):f.test(a)?a=a.replace(f,"?"+stlib.data.pageInfo.shareHash):e.test(a)&&(a=a.replace(e,"&"+stlib.data.pageInfo.shareHash));
return a},updateDestination:function(a){var b=/sthash\.[a-zA-z0-9]{8}\.[a-z]{4}/;_$d_();_$d1("Updating Destination");if(/sthash\.[a-zA-z0-9]{8}\.[a-zA-z0-9]{8}\.[a-z]{4}/.test(stlib.data.pageInfo.shareHash)){_$d2(stlib.data.pageInfo.shareHash.substring(0,24));stlib.data.pageInfo.shareHash=stlib.data.pageInfo.shareHash.substring(0,24)+a}else if(b.test(stlib.data.pageInfo.shareHash)){_$d2(stlib.data.pageInfo.shareHash.substring(0,15));stlib.data.pageInfo.shareHash=stlib.data.pageInfo.shareHash.substring(0,
15)+a}else stlib.data.pageInfo.shareHash=stlib.data.pageInfo.shareHash+a},validateHash:function(a){var b=/[\?#&]?sthash\.[a-zA-z0-9]{8}\.[a-zA-z0-9]{8}$/,d=/[\?#&]?sthash\.[a-zA-z0-9]{8}\.[a-zA-z0-9]{8}\.[a-z]{4}$/,f=/[\?#&]?sthash\.[a-zA-z0-9]{8}\.[a-z]{4}$/;return/[\?#&]?sthash\.[a-zA-z0-9]{8}$/.test(a)||f.test(a)||d.test(a)||b.test(a)},appendHash:function(a){var b=stlib.hash.stripHash(a);if(stlib.data.pageInfo.shareHash&&(stlib.hash.validateHash(b)||b==""))a=a.replace("#"+b,"")+"#"+stlib.data.pageInfo.shareHash;
return a},copyPasteInit:function(){var a=document.getElementsByTagName("body")[0],b=document.createElement("div");b.style.position="absolute";b.style.top="-1999px";b.style.left="-1988px";a.appendChild(b);b.innerHTML="ShareThis Copy and Paste";document.location.href.split("#").shift();if(document.attachEvent)a.oncopy=function(){var a=document.selection.createRange();b.innerHTML=a.htmlText;try{var f=a.text.trim().length}catch(e){f=a.text.replace(/^\s+|\s+$/g,"").length}if(f!=0)b.innerHTML=a.htmlText==
a.text?stlib.hash.selectionModify(a.text):b.innerHTML+stlib.hash.selectionModify(a.text,true);f=document.body.createTextRange();f.moveToElementText(b);f.select();setTimeout(function(){a.select()},1)};else if(document.addEventListener)a.oncopy=function(){var a=document.getSelection(),f=a.getRangeAt(0).cloneContents();b.innerHTML="";b.appendChild(f);if((a+"").trim().length!=0)b.innerHTML=b.innerHTML==a+""?stlib.hash.selectionModify(a):b.innerHTML+stlib.hash.selectionModify(a,true);f=document.createRange();
f.selectNodeContents(b);var e=a.getRangeAt(0);a.removeAllRanges();a.addRange(f);setTimeout(function(){a.removeAllRanges();a.addRange(e)},0)}},logCopy:function(a,b){stlib.data.resetShareData();stlib.data.set("url",a,"shareInfo");stlib.data.setSource("copy");stlib.data.set("destination","copy","shareInfo");stlib.data.set("buttonType","custom","shareInfo");b&&stlib.data.set("description",b,"shareInfo");stlib.sharer.share()},selectionModify:function(a,b){a=""+a;_$d_();_$d1("Copy Paste");var d=/^((http|https):\/\/([a-z0-9!'\(\)\*\.\-\+:]*(\.)[a-z0-9!'\(\)\*\.\-\+:]*)((\/[a-z0-9!'\(\)\*\.\-\+:]*)*))/i,
f=/^([a-z0-9!'\(\)\*\.\-\+:]*(\.)[a-z0-9!'\(\)\*\.\-\+:]*)((\/[a-z0-9!'\(\)\*\.\-\+:]*)*)/i,e=/^\+?1?[\.\-\\)_\s]?[\\(]?[0-9]{3}[\.\-\\)_\s]?[0-9]{3}[\.\-_\s]?[0-9]{4}$|^[0-9]{3}[\.\-_\s]?[0-9]{4}$/,g=/^[0-9]{3}[\.\-_\s]?[0-9]{8}$/,j=/^[0-9]{2}[\.\-_\s]?[0-9]{4}[\.\-_\s]?[0-9]{4}$/,k=/[\-_\.a-z0-9]+@[\-_\.a-z0-9]+\.[\-_\.a-z0-9]+/i,l=/[\s@]/,p=document.location.href.split("#").shift(),m="#"+stlib.hash.shareHash,s="",o="",n="";if(typeof b=="undefined"&&(d.test(a)||f.test(a))&&!l.test(a.trim())){_$d2("is Url");
n=o=a.match(/#/)==null||stlib.hash.validateHash(a)?a.split("#")[0]+m+".dpuf":a}else{_$d2("is Not Url");o=document.location.hash==""||stlib.hash.validateHash(document.location.hash)?p+m+".dpuf":document.location.href;n=a;if(a.length>50){s=" - See more at: "+o+"";!e.test(a)&&(!g.test(a)&&!j.test(a)&&!k.test(a))&&(n=n+s)}}a.length>140&&(a=a.substring(0,137)+"...");stlib.hash.logCopy(o,a);return b&&b==true?s:n}};
stlib.pump=function(a,b,d){this.isIframeSending=this.isIframeReady=false;this.getHash=function(a){a=a.split("#");a.shift();return a.join("#")};this.broadcastInit=function(a){this.destination=a;_$d_("---------------------");_$d1("Initiating broadcaster:");_$d(this.destination)};this.broadcastSendMessage=function(a){_$d_("---------------------");_$d1("Initiating Send:");if(this.destination===window)if(stlib.browser.ieFallback){window.location.replace(window.location.href.split("#")[0]+"#"+a);_$d2("child can't communicate with parent")}else{_$d2("Iframe to publisher: "+
a);parent.postMessage("#"+a,document.referrer)}else{_$d2("Publisher to Iframe: "+a);if(stlib.browser.ieFallback){if(this.destination.contentWindow){this.destination.contentWindow.location.replace(this.destination.src+"#"+a);this.isIframeSending=true}}else this.destination.contentWindow.postMessage("#"+a,this.destination.src)}};this.receiverInit=function(a,b){_$d_("---------------------");_$d1("Initiating Receiver:");_$d(a);if(stlib.browser.ieFallback){this.callback=b;this.source=a;if(a===window){window.location.replace(window.location.href.split("#")[0]+
"#");this.currentIframe=window.location.hash;var d="receiver"+stlib.functionCount;stlib.functions[d]=function(a){if(""!=window.location.hash&&"#"!=window.location.hash){a(window.location.hash);window.location.replace(window.location.href.split("#")[0]+"#")}};stlib.functionCount++;var j="callback"+stlib.functionCount;stlib.functions[j]=b;stlib.functionCount++;setInterval("stlib.functions['"+d+"'](stlib.functions['"+j+"'])",200)}d=window.addEventListener?"addEventListener":"attachEvent";window[d](d==
"attachEvent"?"onmessage":"message",function(b){a!=window&&b.origin.indexOf("sharethis.com")!=-1&&b.data.match(/#Pinterest Click/)&&stlib.sharer.sharePinterest()},false)}else{d=window.addEventListener?"addEventListener":"attachEvent";window[d](d=="attachEvent"?"onmessage":"message",function(d){if(a==window){_$d1("arrived in iframe from:");_$d(d.origin);(d.data.match(/#fragmentPump/)||d.data.match(/#Buttons Ready/)||d.data.match(/#Widget Ready/)||d.data.indexOf("#light")==0||d.data.indexOf("#widget")==
0||d.data.indexOf("#popup")==0||d.data.indexOf("#show")==0||d.data.indexOf("#init")==0||d.data.indexOf("#test")==0||d.data.indexOf("#data")==0)&&b(d.data)}else if(d.origin.indexOf("sharethis.com")!=-1){_$d1("arrived in parent from:");_$d(d.origin);d.data.match(/#fragmentPump/)||d.data.match(/#Buttons Ready/)||d.data.match(/#Widget Ready/)||d.data.indexOf("#light")==0||d.data.indexOf("#widget")==0||d.data.indexOf("#popup")==0||d.data.indexOf("#show")==0||d.data.indexOf("#init")==0||d.data.indexOf("#test")==
0||d.data.indexOf("#data")==0?b(d.data):d.data.match(/#Pinterest Click/)&&stlib.sharer.sharePinterest()}else{_$d1("discarded event from:");_$d(d.origin)}},false)}};this.broadcastInit(a);this.receiverInit(b,d)};
stlib.json={c:{"\b":"b","\t":"t","\n":"n","\f":"f","\r":"r",'"':'"',"\\":"\\","/":"/"},d:function(a){return a<10?"0".concat(a):a},e:function(a,b,d){d=eval;delete eval;typeof eval==="undefined"&&(eval=d);b=eval(""+a);eval=d;return b},i:function(a,b,d){return 1*a.substr(b,d)},p:["","000","00","0",""],rc:null,rd:/^[0-9]{4}\-[0-9]{2}\-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}$/,rs:/(\x5c|\x2F|\x22|[\x0c-\x0d]|[\x08-\x0a])/g,rt:/^([0-9]+|[0-9]+[,\.][0-9]{1,3})$/,ru:/([\x00-\x07]|\x0b|[\x0e-\x1f])/g,s:function(a,
b){return"\\".concat(stlib.json.c[b])},u:function(a,b){var d=b.charCodeAt(0).toString(16);return"\\u".concat(stlib.json.p[d.length],d)},v:function(a,b){return stlib.json.types[typeof result](result)!==Function&&(b.hasOwnProperty?b.hasOwnProperty(a):b.constructor.prototype[a]!==b[a])},types:{"boolean":function(){return Boolean},"function":function(){return Function},number:function(){return Number},object:function(a){return a instanceof a.constructor?a.constructor:null},string:function(){return String},
undefined:function(){return null}},$$:function(a){function b(b,f){f=b[a];delete b[a];try{stlib.json.e(b)}catch(e){b[a]=f;return 1}}return b(Array)&&b(Object)},encode:function(){var a=arguments.length?arguments[0]:this,b,d;if(a===null)b="null";else if(a!==void 0&&(d=stlib.json.types[typeof a](a)))switch(d){case Array:b=[];for(var f=0,e=0,g=a.length;e<g;e++)if(a[e]!==void 0&&(d=stlib.json.encode(a[e])))b[f++]=d;b="[".concat(b.join(","),"]");break;case Boolean:b=String(a);break;case Date:b='"'.concat(a.getFullYear(),
"-",stlib.json.d(a.getMonth()+1),"-",stlib.json.d(a.getDate()),"T",stlib.json.d(a.getHours()),":",stlib.json.d(a.getMinutes()),":",stlib.json.d(a.getSeconds()),'"');break;case Function:break;case Number:b=isFinite(a)?String(a):"null";break;case String:b='"'.concat(a.replace(stlib.json.rs,stlib.json.s).replace(stlib.json.ru,stlib.json.u),'"');break;default:f=0;b=[];for(e in a)if(a[e]!==void 0&&(d=stlib.json.encode(a[e])))b[f++]='"'.concat(e.replace(stlib.json.rs,stlib.json.s).replace(stlib.json.ru,
stlib.json.u),'":',d);b="{".concat(b.join(","),"}")}return b},decode:function(a){if(typeof a=="string"){var b=null;try{if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return b=window.JSON&&window.JSON.parse?window.JSON.parse(a):(new Function("return "+a))();return null}catch(d){}}}};
try{stlib.json.rc=/^("(\\.|[^"\\\n\r])*?"|[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t])+?$/}catch(z$$4){stlib.json.rc=/^(true|false|null|\[.*\]|\{.*\}|".*"|\d+|\d+\.\d+)$/}
stlib.logger={loggerUrl:("https:"==document.location.protocol?"https://":"http://")+"l.sharethis.com/",constructParamString:function(){var a=stlib.data.pageInfo,b="",d;for(d in a)b=b+(d+"="+a[d]+"&");a=stlib.data.shareInfo;for(d in a)b=b+(d+"="+a[d]+"&");return b.substring(0,b.length-1)},log:function(a,b){_$d_();_$d1("Log Event PageInfo:");_$d(stlib.data.pageInfo);_$d1("Log Event ShareInfo:");_$d(stlib.data.shareInfo);if(typeof a=="undefined")_$de("event does not exist \nFor help, contact support@sharethis.com");
else if(stlib.data.pageInfo==null||stlib.data.shareInfo==null)_$de("stlib.logger does not have enough info to log \nFor help, contact support@sharethis.com");else if(stlib.data.get("url","shareInfo"))if(stlib.data.get("sessionID","pageInfo"))if(!stlib.data.get("destination","shareInfo")&&a!="pview")_$de("shareThisInfo.destination do not exist \nFor help, contact support@sharethis.com");else if(!stlib.data.get("buttonType","shareInfo")&&a!="pview")_$de("shareThisInfo.type do not exist \nFor help, contact support@sharethis.com");
else if(stlib.data.get("source","shareInfo")){if(a=="pview"){stlib.data.unset("destination","shareInfo");stlib.data.unset("buttonType","shareInfo")}else{stlib.data.unset("refDomain","pageInfo");stlib.data.unset("refQuery","pageInfo")}if(typeof stlib.data.get("counter","shareInfo")!="undefined"){var d=0;stlib.data.get("counter","shareInfo")&&(d=stlib.data.get("counter","shareInfo"));stlib.data.set("ts"+(new Date).getTime()+"."+d,"","shareInfo");stlib.data.unset("counter","shareInfo")}else stlib.data.set("ts"+
(new Date).getTime(),"","shareInfo");d=stlib.logger.loggerUrl+(a=="pview"?"pview":"log")+"?event="+a+"&"+stlib.logger.constructParamString();_$d1("Final Log Url:");_$d2(d);var f=new Image(1,1);f.src=d;f.onload=function(){};b?b():null}else _$de("shareThisInfo.source do not exist \nFor help, contact support@sharethis.com");else _$de("sharePageInfo.sessionID do not exist \nFor help, contact support@sharethis.com");else _$de("shareThisInfo.url do not exist \nFor help, contact support@sharethis.com")}};
stlib.scriptLoader={loadJavascript:function(a,b){_$d_();_$d1("Loading JS: "+a);var d=stlib.scriptLoader;d.head=document.getElementsByTagName("head")[0];d.scriptSrc=a;d.script=document.createElement("script");d.script.setAttribute("type","text/javascript");d.script.setAttribute("src",d.scriptSrc);d.script.async=true;d.script.onload=b;d.script.onreadystatechange=function(){this.readyState=="loaded"&&b()};d.s=document.getElementsByTagName("script")[0];d.s.parentNode.insertBefore(d.script,d.s)},loadCSS:function(a,
b){_$d_();_$d1("Loading CSS: "+a);var d=stlib.scriptLoader,f;d.head=document.getElementsByTagName("head")[0];d.cssSrc=a;d.css=document.createElement("link");d.css.setAttribute("rel","stylesheet");d.css.setAttribute("type","text/css");d.css.setAttribute("href",a);d.css.setAttribute("id",a);setTimeout(function(){b();document.getElementById(a)||(f=setInterval(function(){if(document.getElementById(a)){clearInterval(f);b()}},100))},100);d.head.appendChild(d.css)}};
stlib.nativeButtons={supportedNativeButtons:{linkedinfollow:{log:!0,config:!0,dependencyLoaded:!1,dependencyLoading:!1,requiredFields:[["st_followId","Profile Id","Enter '207839' for profile id"]]},twitterfollow:{log:!1,config:!0,requiredFields:[["st_username","Username","Enter 'sharethis' for username"]]},pinterestfollow:{log:!0,config:!0,requiredFields:[["st_username","Username","Enter 'sharethis' for username"]]},youtube:{log:!0,config:!0,requiredFields:[["st_username","Username","Enter 'sharethis' for username"]]},
foursquaresave:{log:!1,config:!0,dependencyLoaded:!1,dependencyLoading:!1},foursquarefollow:{log:!1,config:!0,requiredFields:[["st_username","Username","Enter 'sharethis' for username"],["st_followId","Follow id","Enter '1234567' for follow id"]]},googleplusfollow:{log:!0,config:!0,requiredFields:[["st_followId","Page Id","Enter '110967630299632321627' for page id"]]},googleplusadd:{log:!0,config:!0,requiredFields:[["st_followId","Profile Id","Enter '113842823840690472625' for profile id"]]}},loadService:function(a){if(a==
"foursquaresave"||a=="foursquarefollow")if(stlib.nativeButtons.supportedNativeButtons.foursquaresave.dependencyLoaded==false){if(stlib.nativeButtons.supportedNativeButtons.foursquaresave.dependencyLoading==false){stlib.nativeButtons.supportedNativeButtons.foursquaresave.dependencyLoading=true;var a="http://platform.foursquare.com/js/widgets.js",b={uid:"606"};if("https:"==document.location.protocol){a="http://platform-s.foursquare.com/js/widgets.js";b.secure=true}window.___fourSq=b;b=document.createElement("script");
b.type="text/javascript";b.src=a;b.async=true;a=document.getElementsByTagName("script")[0];b.onload=function(){fourSq.widget.Factory.go();stlib.nativeButtons.supportedNativeButtons.foursquaresave.dependencyLoaded=true;stlib.nativeButtons.supportedNativeButtons.foursquaresave.dependencyLoading=false};b.onreadystatechange=function(){if(this.readyState=="complete"||this.readyState=="loaded"){fourSq.widget.Factory.go();stlib.nativeButtons.supportedNativeButtons.foursquaresave.dependencyLoaded=true;stlib.nativeButtons.supportedNativeButtons.foursquaresave.dependencyLoading=
false}};a.parentNode.insertBefore(b,a)}}else fourSq.widget.Factory.go();else if(a!="pinterestfollow"&&a!="twitterfollow"&&a!="youtube"&&a=="linkedinfollow")if(window.IN&&typeof window.IN.parse==="function")window.IN.parse();else if(stlib.nativeButtons.supportedNativeButtons.linkedinfollow.dependencyLoading==false){stlib.nativeButtons.supportedNativeButtons.linkedinfollow.dependencyLoading=true;a="//platform.linkedin.com/in.js";b=document.createElement("script");b.type="text/javascript";b.src=a;b.async=
true;a=document.getElementsByTagName("script")[0];b.onload=function(){stlib.nativeButtons.supportedNativeButtons.linkedinfollow.dependencyLoading=false};b.onreadystatechange=function(){if(this.readyState=="complete"||this.readyState=="loaded")stlib.nativeButtons.supportedNativeButtons.linkedinfollow.dependencyLoading=false};a.parentNode.insertBefore(b,a)}},logService:function(a,b){stlib.data.resetShareData();stlib.data.set("url",b,"shareInfo");stlib.data.set("destination",a,"shareInfo");stlib.data.setSource("chicklet");
stlib.data.set("buttonType","chicklet","shareInfo");stlib.sharer.share()},makeButton:function(a,b,d){if(a=="foursquaresave"){try{var f=document.createElement("<div></div>"),e=document.createElement("<a></a>")}catch(g){f=document.createElement("div");e=document.createElement("a")}f.className="stNativeButton stFourSquare";e.setAttribute("href","https://foursquare.com/intent/venue.html");e.setAttribute("class","fourSq-widget");e.setAttribute("data-on-open","foursquareCallback");f.appendChild(e);return f}if(a==
"foursquarefollow"){if(typeof d.username=="undefined"||d.username==""||typeof d.followId=="undefined"||d.followId=="")return false;try{f=document.createElement("<div></div>");e=document.createElement("<a></a>")}catch(j){f=document.createElement("div");e=document.createElement("a")}f.className="stNativeButton stFourSquare";e.setAttribute("href","https://foursquare.com/user/"+d.username);e.setAttribute("class","fourSq-widget");e.setAttribute("data-type","follow");e.setAttribute("data-fuid",d.followId);
e.setAttribute("data-on-open","foursquareCallback");f.appendChild(e);return f}if(a=="googleplusfollow"||a=="googleplusadd"){if(typeof d.followId=="undefined"||d.followId=="")return false;try{var k=document.createElement("<span></span>")}catch(l){k=document.createElement("span")}k.className="stNativeButton stGoogleNative";b=document.createElement("g:plus");b.setAttribute("href","https://plus.google.com/"+d.followId);b.setAttribute("width","300");b.setAttribute("height","69");k.appendChild(b);return k}if(a==
"pinterestfollow"){if(typeof d.username=="undefined"||d.username=="")return false;try{var p=document.createElement("<span></span>"),m=document.createElement("<a></a>"),s=document.createElement("<img></img>")}catch(o){p=document.createElement("span");m=document.createElement("a");s=document.createElement("img")}p.className="stNativeButton stPinterestfollow";b=d.username;m.setAttribute("target","_blank");m.setAttribute("href","//pinterest.com/"+b+"/");s.setAttribute("src","//passets-cdn.pinterest.com/images/follow-on-pinterest-button.png");
s.setAttribute("width","156");s.setAttribute("height","26");s.setAttribute("alt","Follow "+b+" on Pinterest");m.appendChild(s);p.appendChild(m);return p}if(a=="twitterfollow"){if(typeof d.username=="undefined"||d.username=="")return false;try{var n=document.createElement("<iframe></iframe>")}catch(r){n=document.createElement("iframe")}d="&screen_name="+d.username;k="&show_count=false";iedocmode=stlib.browser.getIEVersion();b=="vcount"?k="&show_count=true":b=="hcount"&&(k="&show_count=true");n.setAttribute("allowtransparency",
"true");n.setAttribute("frameborder","0");n.setAttribute("scrolling","no");n.className="stTwitterFollowFrame";n.setAttribute("src","//platform.twitter.com/widgets/follow_button.html?lang=en&show_screen_name=false"+d+k);b=document.createElement("span");b.className="stNativeButton stTwitterFollowFrame stTwitterFollow";b.appendChild(n);return b}if(a=="youtube"){if(typeof d.username=="undefined"||d.username=="")return false;try{var t=document.createElement("<span></span>"),q=document.createElement("<a></a>"),
y=document.createElement("<img></img>")}catch(x){t=document.createElement("span");q=document.createElement("a");y=document.createElement("img")}t.setAttribute("class","stNativeButton stYoutube");b=d.username;q.setAttribute("target","_blank");q.setAttribute("href","//youtube.com/subscription_center?add_user="+b);y.setAttribute("src","//s.ytimg.com/yt/img/creators_corner/Subscribe_to_my_videos/YT_Subscribe_130x36_red.png");y.setAttribute("alt","Follow "+b+" on youtube");q.appendChild(y);t.appendChild(q);
return t}if(a=="linkedinfollow"){if(typeof d.followId=="undefined"||d.followId=="")return false;n=document.createElement("span");n.setAttribute("class","stNativeButton stLinkedinfollow");k=document.createElement("script");k.type="text/javascript";k.setAttribute("type","IN/FollowCompany");k.setAttribute("data-id",d.followId);k.setAttribute("data-counter","none");b=="vcount"?k.setAttribute("data-counter","top"):b=="hcount"&&k.setAttribute("data-counter","right");n.appendChild(k);return n}},checkNativeButtonSupport:function(a){return stlib.nativeButtons.supportedNativeButtons[a]?
true:false},checkNativeButtonLogging:function(a){return stlib.nativeButtons.supportedNativeButtons[a]?stlib.nativeButtons.supportedNativeButtons[a].log:false},checkNativeButtonConfig:function(a){return stlib.nativeButtons.supportedNativeButtons[a]?stlib.nativeButtons.supportedNativeButtons[a].config:false}};
foursquareCallback=function(a){if(a){var b="foursquaresave",d="https://foursquare.com/intent/venue.html";if(a.config.type){b="foursquarefollow";d="https://foursquare.com/user/"+a.config.fuid}stlib.nativeButtons.logService(b,d)}};
stlib.nativeCounts={nativeCountServices:{linkedin:!0,facebook:!0,stumbleupon:!0},nativeFunc:[],addNativeFunc:function(a,b){stlib.nativeCounts.nativeFunc[a]=b},getNativeCounts:function(a,b,d){switch(a){case "facebook":stlib.scriptLoader.loadJavascript("http://api.facebook.com/method/fql.query?format=json&query=select url, like_count, total_count, comment_count, share_count, click_count from link_stat where url='"+encodeURIComponent(b)+"'&callback="+d,function(){});break;case "linkedin":stlib.scriptLoader.loadJavascript("//www.linkedin.com/countserv/count/share?format=jsonp&callback="+
d+"&url="+encodeURIComponent(b),function(){});break;case "stumbleupon":stlib.scriptLoader.loadJavascript("http://www.stumbleupon.com/services/1.1/badge.getinfo?url="+encodeURIComponent(b)+"&format=jsonp&callback="+d,function(){})}},checkNativeCountServicesQueue:function(a){return stlib.nativeCounts.nativeCountServices[a]?true:false}};
__stgetPubGA=function(){if(typeof _gaq!=="undefined"&&typeof __stPubGA=="undefined"){typeof _gat!=="undefined"&&(__stPubGA=_gat._getTrackerByName("~0")._getAccount());typeof __stPubGA!=="undefined"&&__stPubGA=="UA-XXXXX-X"&&_gaq.push(function(){__stPubGA=_gat._getTrackerByName()._getAccount()})}__stPubGA=="UA-XXXXX-X"&&delete __stPubGA};
if("undefined"==typeof stLight&&"undefined"==typeof SHARETHIS){var stRecentServices=!1;"undefined"==typeof switchTo5x&&(switchTo5x=!1);var esiLoaded=!1,stIsLoggedIn=!1,servicesLoggedIn={},stFastShareObj={shorten:!0};if("https:"==document.location.protocol)var useFastShare=!1;"undefined"==typeof useFastShare&&(useFastShare=!0);stLight=new function(){this.publisher=null;this.sessionID_time=(new Date).getTime().toString();this.sessionID_rand=Number(Math.random().toPrecision(5).toString().substr(2)).toString();
this.sessionID=this.sessionID_time+"."+this.sessionID_rand;this.fpc=null;this.counter=0;this.readyRun=false;this.meta={hostname:document.location.host,location:document.location.pathname};this.clickCallBack=this.loadedFromBar=false};stLight.onReady=function(){if(stLight.readyRun==true)return false;stlib.data.init();stLight.fpc=stlib.data.get("fpc","pageInfo");if(stButtons.messageQueueInstance==null)stButtons.messageQueueInstance=new stlib.messageQueue;stLight.processSTQ();stLight.readyRun=true;if(stLight.publisher==
null&&typeof window.console!=="undefined")try{console.debug("Please specify a ShareThis Publisher Key \nFor help, contact support@sharethis.com")}catch(a){}var b=stLight.getSource();stLight.log("pview",b);stWidget.options.sessionID=stLight.sessionID;stWidget.options.fpc=stLight.fpc;stLight.loadServicesLoggedIn(function(){stButtons.onReady()})};stLight.getSource=function(){var a="share4x";switchTo5x&&(a="share5x");stLight.hasButtonOnPage()?stLight.loadedFromBar&&(a=switchTo5x?"bar_share5x":"bar_share4x"):
stLight.loadedFromBar&&(a="bar");return a};stLight.getSource2=function(a){var b="share4x";if(switchTo5x){b="share5x";try{stLight.clickCallBack!=false&&stLight.clickCallBack(a.service)}catch(d){}}if(a.type=="stbar"||a.type=="stsmbar")b="bar";return b};stLight.log=function(a,b,d,f){stlib.data.resetShareData();stlib.data.set("url",document.location.href,"shareInfo");stlib.data.set("title",document.title,"shareInfo");stlib.data.set("counter",stLight.counter++,"shareInfo");stlib.data.setSource(b);typeof d!=
"undefined"&&stlib.data.set("destination",d,"shareInfo");typeof f!="undefined"&&stlib.data.set("buttonType",f,"shareInfo");stlib.logger.log(a);a=="pview"&&stLight.createSegmentFrame()};stLight._stFpc=function(){if(!document.domain||document.domain.search(/\.gov/)>0)return false;var a=stLight._stGetFpc("__unam");if(a==false){var b=Math.round(Math.random()*2147483647),b=b.toString(16),a=(new Date).getTime(),a=a.toString(16),d="",d=stLight._stGetD(),d=d.split(/\./)[1];if(!d)return false;a=d=stLight._stdHash(d)+
"-"+a+"-"+b+"-1";stLight._stSetFpc(a)}else{b=a.split(/\-/);if(b.length==4){a=Number(b[3]);a++;a=b=b[0]+"-"+b[1]+"-"+b[2]+"-"+a;stLight._stSetFpc(a)}}return a};stLight._stSetFpc=function(a){var b=new Date,d=b.getFullYear(),f=b.getMonth()+9,b=b.getDate(),a="__unam="+escape(a);d&&(a=a+("; expires="+(new Date(d,f,b)).toGMTString()));d=stLight._stGetD();a=a+("; domain="+escape(d)+";path=/");document.cookie=a};stLight._stGetD=function(){var a=document.domain.split(/\./),b="";a.length>1&&(b="."+a[a.length-
2]+"."+a[a.length-1]);return b};stLight._stGetFpc=function(a){return(a=document.cookie.match("(^|;) ?"+a+"=([^;]*)(;|$)"))?unescape(a[2]):false};stLight._stdHash=function(a){for(var b=0,d=0,f=a.length-1;f>=0;f--){d=parseInt(a.charCodeAt(f));b=(b<<8&268435455)+d+(d<<12);if((d=b&161119850)!=0)b=b^d>>20}return b.toString(16)};stLight._thisScript=null;stLight.getShareThisLightScript=function(){for(var a=document.getElementsByTagName("script"),b=null,d=0;d<a.length;d++)a[d].src.search(/.*sharethis.*\/button\/light.*/)>=
0&&(b=a[d]);return b};stLight.dbrInfo=function(){var a=document.referrer;if(a&&a.length>0){var b=a.match(/\/\/.*?\//);if(typeof b!=="undefined"&&typeof b[0]!=="undefined"&&RegExp(document.domain,"gi").test(b[0])==true)return false;var b="",d=a.replace(/(http:\/\/)(.*?)\/.*/i,"$2");if(d.length>0)b=b+("&refDomain="+d);else return false;a=a.replace(/(^.*\?)(.*)/ig,"$2");a.length>0&&(b=b+("&refQuery="+encodeURIComponent(a)));return b}return false};stLight.odjs=function(a,b){this.head=document.getElementsByTagName("head")[0];
this.scriptSrc=a;this.script=document.createElement("script");this.script.setAttribute("type","text/javascript");this.script.setAttribute("src",this.scriptSrc);this.script.onload=b;this.script.onreadystatechange=function(){(this.readyState=="complete"||a.indexOf("checkOAuth.esi")!=-1&&this.readyState=="loaded")&&b()};this.head.appendChild(this.script)};stLight.loadServicesLoggedIn=function(a){if(useFastShare&&esiLoaded==false)try{stLight.odjs("https:"==document.location.protocol?"https://wd-edge.sharethis.com/button/checkOAuth.esi":
"http://wd-edge.sharethis.com/button/checkOAuth.esi",function(){if(typeof userDetails!=="undefined"){stIsLoggedIn=true;userDetails!=="null"&&(servicesLoggedIn=userDetails)}esiLoaded=true;a!=null&&a()})}catch(b){}else a!=null&&a()};if("completed"==window.document.readyState)stLight.onReady();else"undefined"!=typeof window.addEventListener?window.addEventListener("load",stLight.onReady,!1):"undefined"!=typeof document.addEventListener?document.addEventListener("load",stLight.onReady,!1):"undefined"!=
typeof window.attachEvent&&window.attachEvent("onload",stLight.onReady);stLight.createSegmentFrame=function(){try{stLight.segmentframe=document.createElement('<iframe name="stframe" allowTransparency="true" style="body{background:transparent;}" ></iframe>')}catch(a){stLight.segmentframe=document.createElement("iframe")}stLight.segmentframe.id="stSegmentFrame";stLight.segmentframe.name="stSegmentFrame";var b=document.body,d=("https:"==document.location.protocol?"https://seg.":"http://seg.")+"sharethis.com/getSegment.php?purl="+
encodeURIComponent(document.location.href)+"&jsref="+encodeURIComponent(document.referrer)+"&rnd="+(new Date).getTime();stLight.segmentframe.src=d;stLight.segmentframe.frameBorder="0";stLight.segmentframe.scrolling="no";stLight.segmentframe.width="0px";stLight.segmentframe.height="0px";stLight.segmentframe.setAttribute("style","display:none;");b.appendChild(stLight.segmentframe)};stLight.options=function(a){if(a&&a.publisher){stlib.data.setPublisher(a.publisher);stLight.publisher=a.publisher}if(a&&
a.loadedFromBar)stLight.loadedFromBar=a.loadedFromBar;if(a&&a.clickCallBack&&typeof a.clickCallBack=="function")stLight.clickCallBack=a.clickCallBack;if(a&&typeof a.hashAddressBar!="undefined")stlib.hash.hashAddressBar=a.hashAddressBar;if(a&&typeof a.doNotHash!="undefined")stlib.hash.doNotHash=a.doNotHash;if(a&&typeof a.doNotCopy!="undefined")stlib.hash.doNotCopy=a.doNotCopy;for(var b in a){if(b=="shorten")stFastShareObj.shorten=a[b];stWidget.options.hasOwnProperty(b)&&a[b]!==null&&(stWidget.options[b]=
a[b])}};stLight.hasButtonOnPage=function(){for(var a=document.getElementsByTagName("*"),b=RegExp(/^st_(.*?)$/),d=a.length,f=0;f<d;f++)if(typeof a[f].className=="string"&&a[f].className!=""&&a[f].className.match(b)&&a[f].className.match(b).length>=2&&a[f].className.match(b)[1])return true;return false}}
var stButtons={smartifyButtons:function(a){if(typeof a!="undefined"&&a!="undefined"){stRecentServices=a;for(var b in stRecentServices)stRecentServices[b].processed=false}stButtons.completeInit()},makeButton:function(a){var b=a.service,d=a.text,f="";if(typeof stWidget.options.shorten!="undefined")f=stWidget.options.shorten;if(d==null&&(a.type=="vcount"||a.type=="hcount")){d="Share";b=="email"&&(d="Mail")}if(b=="fb_like")b="fblike";else if(b=="fblike_fbLong"){b="fblike";a.type="fbLong"}var e=stWidget.ogurl?
stWidget.ogurl:stWidget.twitterurl?stWidget.twitterurl:document.location.href,g=e=a.url?a.url:e;if(!stlib.hash.doNotHash)e=g=stlib.hash.appendHash(e);stlib.data.set("url",g,"shareInfo");var j=stWidget.ogtitle?stWidget.ogtitle:stWidget.twittertitle?stWidget.twittertitle:document.title,j=a.title?a.title:j,k=stWidget.ogimg?stWidget.ogimg:stWidget.twitterimg?stWidget.twitterimg:a.thumbnail?a.thumbnail:null,k=a.image?a.image:k,l=stWidget.desc?stWidget.desc:"",l=stWidget.ogdesc?stWidget.ogdesc:stWidget.twitterdesc?
stWidget.twitterdesc:stWidget.desc,l=a.summary&&a.summary!=null?a.summary:l,p=a.message&&a.message!=null?a.message:"";if(/(http|https):\/\//.test(e)==false){e=decodeURIComponent(e);j=decodeURIComponent(j)}var m=document.createElement("span");m.setAttribute("style","text-decoration:none;color:#000000;display:inline-block;cursor:pointer;");m.className="stButton";if(a.type=="custom"&&b!="email"&&b!="sharethis"&&b!="wordpress"){a.element.onclick=function(){_$d_();_$d1("Clicked on a custom button to share");
stLight.callSubscribers("click",b,e);stlib.data.resetShareData();stlib.data.set("url",e,"shareInfo");stlib.data.set("shorten",f,"shareInfo");stlib.data.set("title",j,"shareInfo");stlib.data.set("destination",b,"shareInfo");stlib.data.setSource("chicklet");stlib.data.set("buttonType",a.type,"shareInfo");typeof k!="undefined"&&k!=null&&stlib.data.set("image",k,"shareInfo");typeof l!="undefined"&&l!=null&&stlib.data.set("description",l,"shareInfo");p!=""&&stlib.data.set("message",p,"shareInfo");a.element.getAttribute("st_username")!=
null&&stlib.data.set("refUsername",a.element.getAttribute("st_username"),"shareInfo");b=="twitter"&&a.element.getAttribute("st_via")!=null&&stlib.data.set("via",a.element.getAttribute("st_via").replace(/^\s+|\s+$/g,""),"shareInfo");stlib.sharer.share(null,stWidget.options.servicePopup);b=="pinterest"&&(stlib.data.get("image","shareInfo")==false||stlib.data.get("image","shareInfo")==null)&&stlib.sharer.sharePinterest()};return false}if(!(b=="email"||(b=="sharethis"||b=="wordpress")||stIsLoggedIn&&
servicesLoggedIn&&typeof servicesLoggedIn[b]!="undefined"&&(useFastShare||!useFastShare&&switchTo5x)&&(b=="facebook"||b=="twitter"||b=="yahoo"||b=="linkedin")))m.onclick=function(){_$d_();_$d1("Clicked on a regular button to share");stLight.callSubscribers("click",b,e);for(var d=this.getElementsByTagName("*"),g=0;g<d.length;g++)if(d[g].className=="stBubble_hcount"||d[g].className=="stBubble_count")if((!stWidget.options.nativeCount||!stlib.nativeCounts.checkNativeCountServicesQueue(b))&&!isNaN(d[g].innerHTML))d[g].innerHTML=
Number(d[g].innerHTML)+1;stWidget.options.tracking&&shareLog(b);stlib.data.resetShareData();stlib.data.set("url",e,"shareInfo");stlib.data.set("shorten",f,"shareInfo");stlib.data.set("title",j,"shareInfo");stlib.data.set("destination",b,"shareInfo");stlib.data.setSource("chicklet");stlib.data.set("buttonType",a.type,"shareInfo");typeof k!="undefined"&&k!=null&&stlib.data.set("image",k,"shareInfo");typeof l!="undefined"&&l!=null&&stlib.data.set("description",l,"shareInfo");p!=""&&stlib.data.set("message",
p,"shareInfo");a.element.getAttribute("st_username")!=null&&stlib.data.set("refUsername",a.element.getAttribute("st_username"),"shareInfo");b=="twitter"&&a.element.getAttribute("st_via")!=null&&stlib.data.set("via",a.element.getAttribute("st_via").replace(/^\s+|\s+$/g,""),"shareInfo");stlib.sharer.share(null,stWidget.options.servicePopup);b=="pinterest"&&(stlib.data.get("image","shareInfo")==false||stlib.data.get("image","shareInfo")==null)&&stlib.sharer.sharePinterest()};if(b=="gbuzz")return m;if(b==
"fblike"||b=="fbsend"||b=="fbrec"||b=="fbLong"||b=="fbsub"){b=="fbsub"&&(e=a.element.getAttribute("st_username")!=null?"http://facebook.com/"+a.element.getAttribute("st_username"):"");return stButtons.makeFBButton(b,a.type,e)}if(stlib.nativeButtons.checkNativeButtonSupport(b)){g={};if(a.element.getAttribute("st_username")!=null)g.username=a.element.getAttribute("st_username");if(a.element.getAttribute("st_followId")!=null)g.followId=a.element.getAttribute("st_followId");if(retObj=stlib.nativeButtons.makeButton(b,
a.type,g)){if(stlib.nativeButtons.checkNativeButtonLogging(b))retObj.onclick=function(){stlib.nativeButtons.logService(b,e)};return retObj}if(typeof window.console!=="undefined")try{console.debug("Looks like "+b+" is missing some required parameters. Please recheck "+b+" HTML \nFor help, contact support@sharethis.com")}catch(s){}return m}if(b=="plusone"){stButtons.loadPlusone=true;g=document.createElement("div");g.innerHTML="&nbsp;";iedocmode=stlib.browser.getIEVersion();m=navigator.userAgent.indexOf("MSIE 7.0")!=
-1;navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome");var o=document.createElement("g:plusone");o.setAttribute("href",e);if(a.type=="vcount"){o.setAttribute("size","tall");g.setAttribute("style","display:inline-block;overflow:hidden;line-height:0px;vertical-align:bottom;width:55px; height:61px;");m&&g.style.setAttribute?g.style.setAttribute("cssText","display:inline-block;overflow:hidden;line-height:0px;vertical-align:bottom;width:55px; height:61px;",0):null;iedocmode&&
iedocmode==7&&g.style.setAttribute?g.style.setAttribute("cssText","overflow:hidden;zoom:1;display:inline;line-height:0px;position:relative;vertical-align:bottom;bottom:-8px;width:55px; height:80px;",0):null}else if(a.type=="hcount"){o.setAttribute("size","medium");o.setAttribute("count","true");g.setAttribute("style","display:inline-block;overflow:hidden;line-height:0px;position:relative;vertical-align:middle;bottom:0px;width:75px; height:21px;");m&&g.style.setAttribute?g.style.setAttribute("cssText",
"display:inline-block;overflow:hidden;line-height:0px;position:relative;vertical-align:middle;width:75px; height:21px;",0):null;iedocmode&&iedocmode==7&&g.style.setAttribute?g.style.setAttribute("cssText","overflow:hidden;zoom:1;display:inline;line-height:0px;position:relative;vertical-align:middle;bottom:2px;width:75px; height:21px;",0):null}else if(a.type=="button"){o.setAttribute("size","medium");o.setAttribute("count","false");g.setAttribute("style","display:inline-block;overflow:hidden;line-height:0px;position:relative;vertical-align:middle;bottom:0px;width:36px; height:21px;");
m&&g.style.setAttribute?g.style.setAttribute("cssText","display:inline-block;overflow:hidden;line-height:0px;position:relative;vertical-align:middle;width:36px; height:21px;",0):null;iedocmode&&iedocmode==7&&g.style.setAttribute?g.style.setAttribute("cssText","overflow:hidden;zoom:1;display:inline;line-height:0px;position:relative;vertical-align:middle;bottom:-8px;width:36px; height:39px;",0):null}else if(a.type=="large"){o.setAttribute("size","large");o.setAttribute("count","false");g.setAttribute("style",
"display:inline-block;overflow:hidden;line-height:0px;position:relative;vertical-align:middle;bottom:12px;width:38px; height:27px;");m&&g.style.setAttribute?g.style.setAttribute("cssText","display:inline-block;overflow:hidden;line-height:0px;position:relative;vertical-align:middle;bottom:0px;width:38px; height:30px;",0):null;iedocmode&&(iedocmode==8||iedocmode==9)&&g.style.setAttribute?g.style.setAttribute("cssText","overflow:hidden;zoom:1;display:inline;line-height:0px;position:relative;vertical-align:middle;bottom:7px;width:38px; height:39px;",
0):null;iedocmode&&iedocmode==7&&g.style.setAttribute?g.style.setAttribute("cssText","overflow:hidden;zoom:1;display:inline;line-height:0px;position:relative;vertical-align:middle;bottom:1px;width:38px; height:39px;",0):null}else{o.setAttribute("size","small");o.setAttribute("count","false");g.setAttribute("style","display:inline-block;overflow:hidden;line-height:0px;position:relative;vertical-align:middle;bottom:0px;width:36px; height:16px;");m&&g.style.setAttribute?g.style.setAttribute("cssText",
"display:inline-block;overflow:hidden;line-height:0px;position:relative;vertical-align:middle;width:36px; height:16px;",0):null;iedocmode&&iedocmode==7&&g.style.setAttribute?g.style.setAttribute("cssText","overflow:hidden;zoom:1;display:inline;line-height:0px;position:relative;vertical-align:middle;bottom:-12px;width:36px; height:36px;",0):null}g.appendChild(o);o.setAttribute("callback","plusoneCallback");return g}var n="https:"==document.location.protocol?"https://ws.sharethis.com/images/":"http://w.sharethis.com/images/",
g=document.createElement("img");g.src=n+"check-big.png";g.style.position="absolute";g.style.top="-7px";g.style.right="-7px";g.style.width="19px";g.style.height="19px";g.style.maxWidth="19px";g.style.maxHeight="19px";var r=b;if(!esiLoaded&&(b=="facebook"||b=="twitter"||b=="linkedin"||b=="yahoo")){var t=new Date,q=null,y=0;do{q=new Date;y++;if(y>500)break}while(q-t<500||!esiLoaded)}if(!useFastShare||!servicesLoggedIn||!(typeof servicesLoggedIn[b]!="undefined"&&(b=="facebook"||b=="twitter"||b=="linkedin"||
b=="yahoo")))g.style.display="none";if(a.type=="chicklet"){o=document.createElement("span");o.className="chicklets "+b;if(d==null){o.innerHTML="&nbsp;";m.style.paddingLeft="0px";m.style.paddingRight="0px";m.style.width="16px"}else{o.appendChild(document.createTextNode(d));g.style.right="auto";g.style.left="8px";g.style.top="-5px"}m.appendChild(o);g.src=n+"check-small.png";g.style.top="-6px";g.style.width="13px";g.style.height="13px";g.style.maxWidth="13px";g.style.maxHeight="13px";m.appendChild(g)}else if(a.type==
"large"){o=document.createElement("span");o.className="stLarge";m.appendChild(o);o.style.backgroundImage="url('"+n+r+"_32.png')";m.appendChild(g)}else if(a.type=="basic"||a.type=="circle"||a.type=="brushed"||a.type=="shiny"){o=document.createElement("span");o.className="stLarge";o.className=a.size=="16"?a.type=="brushed"||a.type=="shiny"?"stSmall2":"stSmall":o.className;o.className=a.size=="64"?"stHuge":o.className;m.appendChild(o);o.style.backgroundImage="url('"+n+a.type+"/"+a.size+"/"+r+(a.color?
"_"+a.color:"_"+a.type)+".png')";m.appendChild(g)}else{if(a.type=="pcount"||a.type=="stbar"||a.type=="stsmbar"){t=document.createElement("span");o=document.createElement("span");if(a.type=="stsmbar"){o.className="stSmBar";n="https:"==document.location.protocol?"https://ws.sharethis.com/images/":"http://w.sharethis.com/images/";o.style.backgroundImage="url('"+n+r+"_16.png')";g.src=n+"check-small.png"}else{o.className="stLarge";n="https:"==document.location.protocol?"https://ws.sharethis.com/images/":
"http://w.sharethis.com/images/";o.style.backgroundImage="url('"+n+r+"_32.png')"}o.appendChild(g);t.appendChild(o);d=document.createElement("span");n=document.createElement("div");n.className=a.type=="stsmbar"?"stBubbleSmHoriz":"stBubbleSm";n.setAttribute("id","stBubble_"+a.count);n.style.visibility="hidden";r=document.createElement("div");r.className="stBubble_count_sm";n.appendChild(r);d.appendChild(n);d.appendChild(t);m.appendChild(d);stButtons.getCount2(e,b,r);t.onmouseover=function(){document.getElementById("stBubble_"+
a.count).style.visibility="visible"};t.onmouseout=function(){document.getElementById("stBubble_"+a.count).style.visibility="hidden"};return m}if(a.type=="button"||a.type=="vcount"||a.type=="hcount"){t=document.createElement("span");t.className="stButton_gradient";q=document.createElement("span");q.className="chicklets "+b;d==null?q.innerHTML="&nbsp;":q.appendChild(document.createTextNode(d));t.appendChild(q);if(b=="facebook"||b=="twitter"||b=="linkedin"||b=="yahoo"||b=="pinterest"||b=="sharethis"||
b=="email"){q=document.createElement("span");q.className="stMainServices st-"+b+"-counter";q.innerHTML="&nbsp";t=q;q.style.backgroundImage="url('"+n+r+"_counter.png')";if(b=="sharethis"&&d!=null&&d.length<6){q.className="stMainServices st-"+b+"-counter2";q.style.backgroundImage="url('"+n+r+"_counter2.png')"}}t.appendChild(g);if(a.type=="vcount"){d=document.createElement("div");n=document.createElement("div");n.className="stBubble";r=document.createElement("div");r.className="stBubble_count";n.appendChild(r);
d.appendChild(n);d.appendChild(t);m.appendChild(d);stButtons.getCount2(e,b,r)}else if(a.type=="hcount"){d=document.createElement("span");n=document.createElement("span");n.className="stButton_gradient stHBubble";r=document.createElement("span");r.className="stButton_left";r.innerHTML="&nbsp;";r=document.createElement("span");r.className="stButton_right";r.innerHTML="&nbsp;";r=document.createElement("span");r.className="stBubble_hcount";n.appendChild(r);d.appendChild(t);t=document.createElement("span");
t.className="stArrow";t.appendChild(n);d.appendChild(t);m.appendChild(d);stButtons.getCount2(e,b,r)}else m.appendChild(t);if((a.type=="vcount"||a.type=="hcount")&&a.ctype=="native")if(b=="twitter"){m=document.createElement("span");m.className="stButton";d=55;n=20;q="";t="none";if(a.type=="vcount"){o=document.createElement("div");d=55;n=62;q="top:42px;";t="vertical";g.style.top="34px"}else if(a.type=="hcount"){o=document.createElement("span");d=110;n=20;t="horizontal";g.style.right="44px"}iedocmode=
stlib.browser.getIEVersion();r=document.createElement("span");r.setAttribute("style","vertical-align:bottom;line-height:0px;position:absolute;padding:0px !important;"+q+"width:55px;height:20px;");iedocmode&&iedocmode==7&&r.style.setAttribute?r.style.setAttribute("cssText","vertical-align:bottom;line-height:0px;position:absolute;padding:0px !important;"+q+"width:55px;height:20px;",0):null;try{var x=document.createElement('<iframe name="stframe" allowTransparency="true" scrolling="no" frameBorder="0"></iframe>')}catch(v){x=
document.createElement("iframe");x.setAttribute("allowTransparency","true");x.setAttribute("frameborder","0");x.setAttribute("scrolling","no")}q=encodeURIComponent(e);x.setAttribute("src","http://platform.twitter.com/widgets/tweet_button.html?count="+t+"&url="+q);x.setAttribute("style","width:"+d+"px;height:"+n+"px;");iedocmode&&iedocmode==7&&x.style.setAttribute?x.style.setAttribute("cssText","width:"+d+"px;height:"+n+"px;",0):null;useFastShare&&(servicesLoggedIn&&typeof servicesLoggedIn[b]!="undefined")&&
o.appendChild(r);o.appendChild(x);t=o;t.appendChild(g);m.appendChild(t);m.setAttribute("style","text-decoration:none;color:#000000;display:inline-block;cursor:pointer;vertical-align:bottom;margin-top:6px;width:"+d+"px;height:"+n+"px;");iedocmode&&iedocmode==7&&m.style.setAttribute?m.style.setAttribute("cssText","text-decoration:none;color:#000000;display:inline-block;cursor:pointer;vertical-align:bottom;width:"+d+"px;height:"+n+"px;",0):null}else if(b=="facebook"){stButtons.getXFBMLFromFB(a);return stButtons.makeFBButton("fblike",
a.type,e)}}else if(a.type=="css"){t=document.createElement("div");t.className="stCSSButton";if(a.cssType=="cssV"){x=document.createElement("div");x.className="stCSSVBubble";o=document.createElement("div");o.className="stCSSVBubble_count";x.appendChild(o);n=document.createElement("div");n.className="stCSSVArrow";r=document.createElement("div");r.className="stCSSVArrowBorder";r.appendChild(n);m.appendChild(x);m.appendChild(r);stButtons.getCount2(e,b,o)}x=document.createElement("div");x.className="stCSSSprite "+
b;x.innerHTML="&nbsp;";o=document.createElement("span");o.className="stCSSText";t.appendChild(x);if(!(d==null||d=="")){o.appendChild(document.createTextNode(d));t.appendChild(o)}t.appendChild(g);m.appendChild(t);if(a.cssType=="cssH"){g=document.createElement("div");g.className="stCSSHBubble";o=document.createElement("div");o.className="stCSSHBubble_count";g.appendChild(o);x=document.createElement("div");x.className="stCSSHArrow";t=document.createElement("div");t.className="stCSSHArrowBorder";t.appendChild(x);
m.appendChild(t);m.appendChild(g);stButtons.getCount2(e,b,o)}}}return m},makeFBButton:function(a,b,d){try{var f=document.createElement("<div></div>")}catch(e){f=document.createElement("div")}var g="button_count",j="fb-send",k="";iedocmode=stlib.browser.getIEVersion();var l="";b=="vcount"?g="box_count":b!="hcount"&&(b=="large"?l=iedocmode&&iedocmode==7?"vertical-align:bottom;bottom:3px;":"bottom:7px;margin-top:9px;":b!="button"&&(l="top:1px;margin-top:0px;"));if(a=="fbLong"){j="fb-like";g="standard";
f.setAttribute("data-layout",g);f.setAttribute("data-send","false");f.setAttribute("data-show-faces","false")}else if(a=="fbsend")j="fb-send";else if(a=="fblike"||a=="fbrec"){a=="fbrec"?k="recommend":null;j="fb-like";f.setAttribute("data-action",k);f.setAttribute("data-send","false");f.setAttribute("data-layout",g);f.setAttribute("data-show-faces","false")}else if(a=="fbsub"){j="fb-subscribe";f.setAttribute("data-layout",g);f.setAttribute("data-show-faces","false")}f.setAttribute("class",j);f.setAttribute("data-href",
d);iedocmode&&iedocmode==7&&(f=a!="fbsend"?document.createElement("<div class='"+j+"' data-action='"+k+"' data-send='false' data-layout='"+g+"' data-show-faces='false' data-href='"+d+"'></div>"):document.createElement("<div class='"+j+"' data-href='"+d+"'></div>"));a=document.createElement("span");a.setAttribute("style","text-decoration:none;color:#000000;display:inline-block;cursor:pointer;position:relative;margin:3px 3px 0;padding:0px;font-size:11px;line-height:16px;vertical-align:bottom;overflow:visible;"+
l);iedocmode&&iedocmode==7&&a.style.setAttribute?a.style.setAttribute("cssText","text-decoration:none;color:#000000;display:inline-block;cursor:pointer;position:relative;margin:3px 3px 0;font-size:11px;line-height:0px;"+l,0):null;a.appendChild(f);return a},getCount:function(a,b,d){if(d&&d!==null)for(;d.childNodes.length>=1;)try{d.removeChild(d.firstChild)}catch(f){}stButtons.cbQueue.push({url:a,service:b,element:d});stButtons.getCountsFromService(a,b,d)},getCount2:function(a,b,d){if(d&&d!==null)for(;d.childNodes.length>=
1;)try{d.removeChild(d.firstChild)}catch(f){}if(stWidget.options.nativeCount&&stlib.nativeCounts.checkNativeCountServicesQueue(b)){stButtons.cbNativeQueue.push({url:a,service:b,element:d});typeof stButtons.countsNativeResp[a]=="undefined"&&(stButtons.countsNativeResp[a]=[]);if(typeof stButtons.countsNativeResp[a][b]=="undefined"){stlib.nativeCounts.getNativeCounts(b,a,"stButtons."+b+"CB");stButtons.countsNativeResp[a][b]=null}else if(stButtons.countsNativeResp[a][b]!=null)switch(b){case "facebook":stButtons.facebookCB(stButtons.countsNativeResp[a][b]);
break;case "linkedin":stButtons.linkedinCB(stButtons.countsNativeResp[a][b]);break;case "stumbleupon":stButtons.stumbleuponCB(stButtons.countsNativeResp[a][b])}}else{stButtons.cbQueue.push({url:a,service:b,element:d});stButtons.getCountsFromService(a,b,d)}},processCB:function(a){typeof a!="undefined"&&typeof a.ourl!="undefined"&&(stButtons.countsResp[a.ourl]=a);stButtons.processCount(a)},stumbleuponCB:function(a){var b={ourl:"",stumbleupon:null};if(typeof a!="undefined"&&typeof a.result!="undefined"){typeof stButtons.countsNativeResp[a.result.url]!=
"undefined"&&(stButtons.countsNativeResp[a.result.url].stumbleupon=a);b.ourl=a.result.url;if(typeof a.result.views!="undefined")b.stumbleupon=a.result.views}stButtons.processNativeCount(b,"stumbleupon")},linkedinCB:function(a){var b={ourl:"",linkedin:null};if(typeof a!="undefined"){typeof stButtons.countsNativeResp[a.url]!="undefined"&&(stButtons.countsNativeResp[a.url].linkedin=a);b.ourl=a.url;if(typeof a.count!="undefined")b.linkedin=a.count}stButtons.processNativeCount(b,"linkedin")},facebookCB:function(a){var b=
{ourl:"",facebook:null};if(typeof a!="undefined"){typeof stButtons.countsNativeResp[a[0].url]!="undefined"&&(stButtons.countsNativeResp[a[0].url].facebook=a);b.ourl=a[0].url;if(typeof a[0].total_count!="undefined")b.facebook=a[0].total_count}stButtons.processNativeCount(b,"facebook")},processCount:function(a){if(a){stButtons.storedCountResponse=a;for(var b=0;b<stButtons.cbQueue.length;b++){var d=stButtons.cbQueue[b];if(a.ourl==d.url){var f="New";try{if(d.service=="sharethis"){if(stWidget.options.minShareCount==
null||a.total>=stWidget.options.minShareCount)f=stWidget.options.newOrZero=="zero"?a.total>0?stButtons.human(a.total):"0":a.total>0?stButtons.human(a.total):"New"}else if(d.service=="facebook"&&typeof a.facebook2!="undefined"){if(stWidget.options.minShareCount==null||a.facebook2>=stWidget.options.minShareCount)f=stButtons.human(a.facebook2)}else if(typeof a[d.service]!="undefined"){if(stWidget.options.minShareCount==null||a[d.service]>=stWidget.options.minShareCount)f=a[d.service]>0?stButtons.human(a[d.service]):
"0"}else if(stWidget.options.minShareCount==null||stWidget.options.minShareCount<=0)f="0";if(/stHBubble/.test(d.element.parentNode.className)==true)d.element.parentNode.style.display="inline-block";else if(/stBubble/.test(d.element.parentNode.className)==true)d.element.parentNode.style.display="block";d.element.innerHTML=f}catch(e){if(!d.element.hasChildNodes()){var g=document.createElement("div");g.innerHTML=f;d.element.appendChild(g)}}}}}},processNativeCount:function(a,b){if(a&&b)for(var d=0;d<
stButtons.cbNativeQueue.length;d++){var f=stButtons.cbNativeQueue[d];if(a.ourl==f.url||b=="stumbleupon"&&a.ourl.replace(/http:\/\/www\.|http:\/\/|www\./i,"")==f.url.replace(/http:\/\/www\.|http:\/\/|www\./i,"")){var e="New";try{if(f.service==b){if(a[b]!=null&&(stWidget.options.minShareCount==null||a[b]>=stWidget.options.minShareCount))e=stButtons.human(a[b]);if(/stHBubble/.test(f.element.parentNode.className)==true)f.element.parentNode.style.display="inline-block";else if(/stBubble/.test(f.element.parentNode.className)==
true)f.element.parentNode.style.display="block";f.element.innerHTML=e}}catch(g){if(!f.element.hasChildNodes()){var j=document.createElement("div");j.innerHTML=e;f.element.appendChild(j)}}}}},human:function(a){if(a>=1E5){a=Math.round(a/1E3);a=a+"K"}else if(a>=1E4){a=Math.round(a/100);a=a/10+"K"}return a},locateElements:function(){var a=document.getElementsByTagName("*"),b=[],d=RegExp(/st_(.*?)_custom/),f=RegExp(/st_(.*?)_vcount/),e=RegExp(/st_(.*?)_vcount_native/),g=RegExp(/st_(.*?)_hcount/),j=RegExp(/st_(.*?)_hcount_native/),
k=RegExp(/st_(.*?)_button/),l=RegExp(/st_(.*?)_large/),p=RegExp(/st_(.*?)_pcount/),m=RegExp(/st_(.*?)_stbar/),s=RegExp(/st_(.*?)_stsmbar/),o=RegExp(/st_(.*?)_css/),n=RegExp(/^st_(.*?)$/),r=RegExp(/st_(.*?)_circle/),t=RegExp(/(st_(.*?)_basic)|(st_(.*?)_circle)/),q=RegExp(/(st_(.*?)_brushed)|(st_(.*?)_shiny)/),y=RegExp(/(st_(.*?)_shiny)/),x=a.length,v=0,u,H,C=[],K=false;typeof stRecentServices!="undefined"&&(stRecentServices!="undefined"&&stRecentServices!="false"&&stRecentServices)&&(K=true);for(var h=
0;h<x;h++){u="";v=H=false;if(typeof a[h].className=="string"&&a[h].className!=""){if(a[h].className.match(d)&&a[h].className.match(d).length>=2&&a[h].className.match(d)[1]){if(stButtons.testElem(a[h])==false){v=true;u=a[h].className.match(d)[1];typeName="custom";if(u=="plusone"||u=="fblike"||u=="fbrec"||u=="fbsend"||u=="fbsub")typeName="chicklet";b.push({service:u,element:a[h],url:a[h].getAttribute("st_url"),title:a[h].getAttribute("st_title"),image:a[h].getAttribute("st_img")!=null?a[h].getAttribute("st_img"):
a[h].getAttribute("st_image"),message:a[h].getAttribute("st_msg")!=null?a[h].getAttribute("st_msg"):a[h].getAttribute("st_message"),summary:a[h].getAttribute("st_summary"),text:a[h].getAttribute("displayText"),type:typeName});a[h].setAttribute("st_processed","yes")}}else if(a[h].className.match(t)&&a[h].className.match(t).length>=2){if(stButtons.testElem(a[h])==false){v=true;u=a[h].className.split("_")[1];var z="basic";a[h].className.match(r)&&(z="circle");b.push({service:u,element:a[h],url:a[h].getAttribute("st_url"),
title:a[h].getAttribute("st_title"),image:a[h].getAttribute("st_img")!=null?a[h].getAttribute("st_img"):a[h].getAttribute("st_image"),message:a[h].getAttribute("st_msg")!=null?a[h].getAttribute("st_msg"):a[h].getAttribute("st_message"),summary:a[h].getAttribute("st_summary"),text:a[h].getAttribute("displayText"),type:z,size:a[h].className.split("$")[1],color:a[h].className.split("$")[2]});a[h].setAttribute("st_processed","yes")}}else if(a[h].className.match(q)&&a[h].className.match(q).length>=2){if(stButtons.testElem(a[h])==
false){v=true;u=a[h].className.split("_")[1];z="brushed";a[h].className.match(y)&&(z="shiny");b.push({service:u,element:a[h],url:a[h].getAttribute("st_url"),title:a[h].getAttribute("st_title"),image:a[h].getAttribute("st_img")!=null?a[h].getAttribute("st_img"):a[h].getAttribute("st_image"),message:a[h].getAttribute("st_msg")!=null?a[h].getAttribute("st_msg"):a[h].getAttribute("st_message"),summary:a[h].getAttribute("st_summary"),text:a[h].getAttribute("displayText"),type:z,size:a[h].className.split("$")[1]});
a[h].setAttribute("st_processed","yes")}}else if(a[h].className.match(f)&&a[h].className.match(f).length>=2&&a[h].className.match(f)[1]){if(stButtons.testElem(a[h])==false){v=true;u=a[h].className.match(f)[1];z="";a[h].className.match(e)&&(a[h].className.match(e).length>=2&&a[h].className.match(e)[1])&&(z="native");b.push({service:u,element:a[h],url:a[h].getAttribute("st_url"),title:a[h].getAttribute("st_title"),image:a[h].getAttribute("st_img")!=null?a[h].getAttribute("st_img"):a[h].getAttribute("st_image"),
message:a[h].getAttribute("st_msg")!=null?a[h].getAttribute("st_msg"):a[h].getAttribute("st_message"),summary:a[h].getAttribute("st_summary"),text:a[h].getAttribute("displayText"),type:"vcount",ctype:z});a[h].setAttribute("st_processed","yes")}}else if(a[h].className.match(g)&&a[h].className.match(g).length>=2&&a[h].className.match(g)[1]){if(stButtons.testElem(a[h])==false){v=true;u=a[h].className.match(g)[1];z="";a[h].className.match(j)&&(a[h].className.match(j).length>=2&&a[h].className.match(j)[1])&&
(z="native");b.push({service:u,element:a[h],url:a[h].getAttribute("st_url"),title:a[h].getAttribute("st_title"),image:a[h].getAttribute("st_img")!=null?a[h].getAttribute("st_img"):a[h].getAttribute("st_image"),message:a[h].getAttribute("st_msg")!=null?a[h].getAttribute("st_msg"):a[h].getAttribute("st_message"),summary:a[h].getAttribute("st_summary"),text:a[h].getAttribute("displayText"),type:"hcount",ctype:z});a[h].setAttribute("st_processed","yes")}}else if(a[h].className.match(k)&&a[h].className.match(k).length>=
2&&a[h].className.match(k)[1]){if(stButtons.testElem(a[h])==false){v=true;u=a[h].className.match(k)[1];b.push({service:u,element:a[h],url:a[h].getAttribute("st_url"),title:a[h].getAttribute("st_title"),image:a[h].getAttribute("st_img")!=null?a[h].getAttribute("st_img"):a[h].getAttribute("st_image"),message:a[h].getAttribute("st_msg")!=null?a[h].getAttribute("st_msg"):a[h].getAttribute("st_message"),summary:a[h].getAttribute("st_summary"),text:a[h].getAttribute("displayText"),type:"button"});a[h].setAttribute("st_processed",
"yes")}}else if(a[h].className.match(l)&&a[h].className.match(l).length>=2&&a[h].className.match(l)[1]){if(stButtons.testElem(a[h])==false){v=true;u=a[h].className.match(l)[1];b.push({service:u,element:a[h],url:a[h].getAttribute("st_url"),title:a[h].getAttribute("st_title"),image:a[h].getAttribute("st_img")!=null?a[h].getAttribute("st_img"):a[h].getAttribute("st_image"),message:a[h].getAttribute("st_msg")!=null?a[h].getAttribute("st_msg"):a[h].getAttribute("st_message"),summary:a[h].getAttribute("st_summary"),
text:a[h].getAttribute("displayText"),type:"large"});a[h].setAttribute("st_processed","yes")}}else if(a[h].className.match(p)&&a[h].className.match(p).length>=2&&a[h].className.match(p)[1]){if(stButtons.testElem(a[h])==false){v=true;u=a[h].className.match(p)[1];b.push({service:u,element:a[h],url:a[h].getAttribute("st_url"),title:a[h].getAttribute("st_title"),image:a[h].getAttribute("st_img")!=null?a[h].getAttribute("st_img"):a[h].getAttribute("st_image"),message:a[h].getAttribute("st_msg")!=null?
a[h].getAttribute("st_msg"):a[h].getAttribute("st_message"),summary:a[h].getAttribute("st_summary"),text:a[h].getAttribute("displayText"),type:"pcount",count:h});a[h].setAttribute("st_processed","yes")}}else if(a[h].className.match(m)&&a[h].className.match(m).length>=2&&a[h].className.match(m)[1]){if(stButtons.testElem(a[h])==false){v=true;u=a[h].className.match(m)[1];b.push({service:u,element:a[h],url:a[h].getAttribute("st_url"),title:a[h].getAttribute("st_title"),image:a[h].getAttribute("st_img")!=
null?a[h].getAttribute("st_img"):a[h].getAttribute("st_image"),message:a[h].getAttribute("st_msg")!=null?a[h].getAttribute("st_msg"):a[h].getAttribute("st_message"),summary:a[h].getAttribute("st_summary"),text:a[h].getAttribute("displayText"),type:"stbar",count:h});a[h].setAttribute("st_processed","yes")}}else if(a[h].className.match(s)&&a[h].className.match(s).length>=2&&a[h].className.match(s)[1]){if(stButtons.testElem(a[h])==false){v=true;u=a[h].className.match(s)[1];b.push({service:u,element:a[h],
url:a[h].getAttribute("st_url"),title:a[h].getAttribute("st_title"),image:a[h].getAttribute("st_img")!=null?a[h].getAttribute("st_img"):a[h].getAttribute("st_image"),message:a[h].getAttribute("st_msg")!=null?a[h].getAttribute("st_msg"):a[h].getAttribute("st_message"),summary:a[h].getAttribute("st_summary"),text:a[h].getAttribute("displayText"),type:"stsmbar",count:h});a[h].setAttribute("st_processed","yes")}}else if(a[h].className.match(o)&&a[h].className.match(o).length>=2&&a[h].className.match(o)[1]){if(stButtons.testElem(a[h])==
false){v=true;u=a[h].className.match(o)[1];z=a[h].className.split("_");b.push({service:u,element:a[h],url:a[h].getAttribute("st_url"),title:a[h].getAttribute("st_title"),image:a[h].getAttribute("st_img")!=null?a[h].getAttribute("st_img"):a[h].getAttribute("st_image"),message:a[h].getAttribute("st_msg")!=null?a[h].getAttribute("st_msg"):a[h].getAttribute("st_message"),summary:a[h].getAttribute("st_summary"),text:a[h].getAttribute("displayText"),type:"css",cssType:z[z.length-1]});a[h].setAttribute("st_processed",
"yes")}}else if(a[h].className.match(n)&&(a[h].className.match(n).length>=2&&a[h].className.match(n)[1])&&stButtons.testElem(a[h])==false){v=true;u=a[h].className.match(n)[1];b.push({service:u,element:a[h],url:a[h].getAttribute("st_url"),title:a[h].getAttribute("st_title"),image:a[h].getAttribute("st_img")!=null?a[h].getAttribute("st_img"):a[h].getAttribute("st_image"),message:a[h].getAttribute("st_msg")!=null?a[h].getAttribute("st_msg"):a[h].getAttribute("st_message"),summary:a[h].getAttribute("st_summary"),
text:a[h].getAttribute("displayText"),type:"chicklet"});a[h].setAttribute("st_processed","yes")}if(K&&v){for(v=0;v<C.length;v++)if(C[v].service==u){C[v].count++;H=true}H||C.push({service:u,count:1,doNotReplace:false,processed:false})}}}if(K){a=[];for(d=C.length-1;d>=0;d--)if(C[d].service=="sharethis"||C[d].doNotReplace)C[d].processed=true;else for(var w in stRecentServices){f=false;if(!stRecentServices[w].processed){for(e=0;e<C.length;e++)if(w==C[e].service&&!C[e].processed){f=true;C[e].doNotReplace=
true;stRecentServices[w].processed=true;break}if(f)C[d].processed=true;else{a.push({oldService:C[d].service,newService:w});for(f=0;f<b.length;f++)if(b[f].service==C[d].service){b[f].service=w;b[f].text=stRecentServices[w].title;b[f].element.setAttribute("displayText",stRecentServices[w].title);b[f].element.className=b[f].element.className.replace(C[d].service,w)}stRecentServices[w].processed=true;C[d].processed=true;break}}}}for(h=0;h<b.length;h++)stWidget.addEntry(b[h])},odcss:function(a,b){this.head=
document.getElementsByTagName("head")[0];this.scriptSrc=a;this.css=document.createElement("link");this.css.setAttribute("rel","stylesheet");this.css.setAttribute("type","text/css");this.css.setAttribute("href",this.scriptSrc);setTimeout(function(){b()},500);this.head.appendChild(this.css)},makeButtons:function(){if(typeof stButtons.button_css_called=="undefined"){stButtons.odcss("https:"==document.location.protocol?"https://ws.sharethis.com/button/css/buttons-secure.css":"http://w.sharethis.com/button/css/buttons.20a85a6a67053717023e8d12a9dba430.css",
function(){});stButtons.button_css_called=true}stButtons.locateElements()},getPlusOneFromGoogle:function(a){if(stButtons.plusOneLoaded==false){if(stButtons.plusOneLoading==false){var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("src","https://apis.google.com/js/plusone.js");b.async=stWidget.options.asyncPlusone;b.onload=function(){stButtons.renderPlusOneFromGoogle(a);stButtons.plusOneLoaded=true;stButtons.plusOneLoading=false};b.onreadystatechange=function(){if(this.readyState==
"complete"){stButtons.renderPlusOneFromGoogle(a);stButtons.plusOneLoaded=true;stButtons.plusOneLoading=false}};stButtons.plusOneLoading=true;document.getElementsByTagName("head")[0].appendChild(b)}}else stButtons.renderPlusOneFromGoogle(a)},renderPlusOneFromGoogle:function(a){a=="plusone"?gapi.plusone.go():(a=="googleplusfollow"||a=="googleplusadd")&&gapi.plus.go()},getXFBMLFromFB:function(a){if(!(typeof stWidget.options.fbLoad!="undefined"&&stWidget.options.fbLoad!=true))if(stButtons.xfbmlLoaded==
false){if(stButtons.xfbmlLoading==false){stButtons.xfbmlLoading=true;var b=document.createElement("div");b.setAttribute("id","fb-root");document.body.appendChild(b);b="en_US";if(typeof stWidget.options.fbLang!="undefined"&&stWidget.options.fbLang!="")b=stWidget.options.fbLang;var d=document.getElementsByTagName("script")[0];if(document.getElementById("facebook-jssdk")){if(typeof FB!="undefined"&&typeof FB.XFBML!="undefined"&&typeof FB.XFBML.parse=="function"){/iframe/.test(a.innerHTML)||FB.XFBML.parse(a);
stButtons.trackFB();stButtons.xfbmlLoaded=true;stButtons.xfbmlLoading=false}}else{a=document.createElement("script");a.id="facebook-jssdk";a.src="//connect.facebook.net/"+b+"/all.js";a.async=stWidget.options.async;a.onload=function(){FB.init({appId:"",xfbml:true});stButtons.trackFB();stButtons.xfbmlLoaded=true;stButtons.xfbmlLoading=false};a.onreadystatechange=function(){if(this.readyState=="complete"||this.readyState=="loaded"){FB.init({appId:"",xfbml:true});stButtons.trackFB();stButtons.xfbmlLoaded=
true;stButtons.xfbmlLoading=false}};d.parentNode.insertBefore(a,d)}}}else{/iframe/.test(a.innerHTML)||FB.XFBML.parse(a);stButtons.trackFB()}},addCount:function(a){stButtons.counts.push(a)},getCountsFromService:function(a){if(stButtons.checkQueue(a)==false){var b=b+"-"+stButtons.cbVal,b="stButtons.processCB";stButtons.cbVal++;var d=document.referrer.replace("http://","").replace("https://","").split("/"),f=d.shift(),d=d.join("/"),f=encodeURIComponent(f),d=encodeURIComponent(d),e=stLight.publisher,
b="https:"==document.location.protocol?"https://ws.sharethis.com/api/getCount2.php?cb="+b+"&refDomain="+f+"&refQuery="+d+"&pgurl="+encodeURIComponent(document.location.href)+"&pubKey="+e+"&url=":"http://wd.sharethis.com/api/getCount2.php?cb="+b+"&refDomain="+f+"&refQuery="+d+"&pgurl="+encodeURIComponent(document.location.href)+"&pubKey="+e+"&url=";stLight.odjs(b+encodeURIComponent(a),function(){});stButtons.queue.push(a)}stButtons.countsResp[a]&&stButtons.processCount(stButtons.countsResp[a])},checkQueue:function(a){for(var b=
0;b<stButtons.queue.length;b++)if(stButtons.queue[b]==a)return true;return false},testElem:function(a){return a.getAttribute("st_processed")!=null?true:false}};
function Shareable(a){this.idx=-1;this.message=this.service=this.element=this.image=this.title=this.url=null;this.screen="home";this.frag=this.buttonText=this.content=this.summary=null;this.onhover=true;this.type=null;var b=this;this.attachButton=function(d){this.element=d;if((this.onhover==true||this.onhover=="true")&&!stlib.browser.mobile.isMobile()&&(!switchTo5x||switchTo5x&&(a.service=="sharethis"||a.service=="email"||a.service=="wordpress"))){d.onmouseover=this.mouseOn;d.onmouseout=this.mouseOut}d.onclick=
function(){b.decideFastShare()}};this.init=function(){stWidget.merge(this,a);stWidget.shareables.push(this);a.element!==null&&this.attachButton(a.element)};return this}
var stWidget=new function(){this.shareables=[];this.entries=0;this.widgetOpen=false;this.mouseOutTimer=this.mouseTimer=this.mouseOnTimer=null;this.buttonClicked=this.stopClosing=this.frameReady=false;this.frameUrl5x="https:"==document.location.protocol?"https://ws.sharethis.com/secure5x/index.html":"http://edge.sharethis.com/share5x/index.56e59b830553aae40aa0f7c58f0a0a45.html";this.frameUrl4x="https:"==document.location.protocol?"https://ws.sharethis.com/secure/index.html":"http://edge.sharethis.com/share4x/index.7697f96df7f0083a45899fb1d1d16981.html";
this.frameUrlChoice=switchTo5x?this.frameUrl5x:this.frameUrl4x;this.secure=false;try{this.mainstframe=document.createElement('<iframe name="stLframe" allowTransparency="true" style="body{background:transparent;}" ></iframe>');this.mainstframe.onreadystatechange=function(){if(stWidget.mainstframe.readyState==="complete"){stWidget.frameReady=true;stButtons.pumpInstance=new stlib.pump(stWidget.mainstframe,stWidget.mainstframe,function(){stButtons.messageQueueInstance.process()});stButtons.messageQueueInstance.setPumpInstance(stButtons.pumpInstance);
try{stButtons.pumpInstance.broadcastSendMessage("Buttons Ready")}catch(a){}}}}catch(a){this.mainstframe=document.createElement("iframe");this.mainstframe.allowTransparency="true";this.mainstframe.setAttribute("allowTransparency","true");this.mainstframe.onload=function(){stWidget.frameReady=true;stButtons.pumpInstance=new stlib.pump(stWidget.mainstframe,stWidget.mainstframe,function(){stButtons.messageQueueInstance.process()});stButtons.messageQueueInstance.setPumpInstance(stButtons.pumpInstance);
try{stButtons.pumpInstance.broadcastSendMessage("Buttons Ready")}catch(a){}}}this.mainstframe.id="stLframe";this.mainstframe.className="stLframe";this.mainstframe.name="stLframe";this.mainstframe.frameBorder="0";this.mainstframe.scrolling="no";this.mainstframe.width="353px";this.mainstframe.height="350px";this.mainstframe.style.top="0px";this.mainstframe.style.left="0px";this.mainstframe.src=this.frameUrlChoice;this.wrapper=document.createElement("div");this.wrapper.id="stwrapper";this.wrapper.className=
"stwrapper";this.wrapper.style.visibility="hidden";this.wrapper.style.top="-999px";this.wrapper.style.left="-999px";this.closewrapper=document.createElement("div");this.closewrapper.className="stclose";if(switchTo5x){this.mainstframe.width="500px";this.mainstframe.height="430px";this.wrapper.style.top="-999px";this.wrapper.style.left="-999px";this.wrapper.style.width="500px";this.wrapper.style.zIndex=89999999;this.overlay=document.createElement("div");this.overlay.style.height="100%";this.overlay.style.width=
"100%";this.overlay.style.backgroundColor="#000";this.overlay.style.opacity="0.6";this.overlay.style.filter="Alpha(Opacity=60)";this.overlay.style.position="fixed";if(document.all&&navigator.appVersion.indexOf("MSIE 6.")!=-1)this.overlay.style.position="absolute";this.overlay.style.display="none";this.overlay.style.left="0";this.overlay.style.top="0";this.overlay.style.zIndex=89999990;this.overlay.setAttribute("id","stOverlay");this.closewrapper.className="stCloseNew2"}this.closewrapper.onclick=function(){stWidget.closeWidget()};
this.wrapper.appendChild(this.closewrapper);this.wrapper.appendChild(this.mainstframe);this.desc=this.twittercard=this.twitterimg=this.twitterurl=this.twitterdesc=this.twittertitle=this.ogtype=this.ogimg=this.ogurl=this.ogdesc=this.ogtitle=null;this.initFire=false;this.merge=function(a,d){for(var f in d)a.hasOwnProperty(f)&&d[f]!==null&&(a[f]=d[f])};this.oldScroll=0;this.init=function(){if(stWidget.initFire==false){stWidget.initFire=true;if(stButtons.messageQueueInstance==null)stButtons.messageQueueInstance=
new stlib.messageQueue;stlib.browser.ieFallback?setTimeout("stButtons.messageQueueInstance.send(stWidget.createFrag(stlib.data,'data'), 'data');",1E3):stButtons.messageQueueInstance.send(stWidget.createFrag(stlib.data,"data"),"data");if(stlib.browser.ieFallback){setTimeout("stButtons.messageQueueInstance.send(stWidget.createFrag(null,'init'), 'init');",2E3);setTimeout("stWidget.initIE=true;",2500)}else stButtons.messageQueueInstance.send(stWidget.createFrag(null,"init"),"init")}}};
stWidget.options=new function(){this.fpc=stLight.fpc;this.publisher=this.sessionID=null;this.tracking=true;this.offsetTop=this.offsetLeft=this.headerbg=this.headerfg=this.headerTitle=this.exclusive_services=this.send_services=null;this.onhover=true;this.asyncPlusone=this.async=false;this.autoPosition=this.autoclose=true;this.embeds=false;this.minorServices=this.doneScreen=true;this.excludeServices=null;this.theme=1;this.textBoxFontColor=this.mainWidgetColor=this.helpTextColor=this.headerTextColor=
this.footerColor=this.shareButtonColor=this.serviceBarColor=null;this.textRightToLeft=false;this.shorten=true;this.popup=false;this.newOrZero="new";this.publisherGA=this.minShareCount=null;this.services="";this.relatedDomain=null;this.hashAddressBar=false;this.doNotCopy=this.doNotHash=true;this.nativeCount=false;this.fbLang=this.lang="";this.fbLoad=true;this.servicePopup=false;this.linkcause=this.textcause=null};
stWidget.addEntry=function(a){if(!a.element)return false;openWidget=a&&a.service&&(a.service=="email"||(a.service=="sharethis"||a.service=="wordpress")||stIsLoggedIn&&servicesLoggedIn&&typeof servicesLoggedIn[a.service]!="undefined"&&(useFastShare||!useFastShare&&switchTo5x)&&(a.service=="facebook"||a.service=="twitter"||a.service=="yahoo"||a.service=="linkedin"))?true:false;if(!openWidget){if(a.type!=="custom"){a.element.appendChild(stButtons.makeButton(a));(a.service=="plusone"||a.service=="googleplusfollow"||
a.service=="googleplusadd")&&stButtons.getPlusOneFromGoogle(a.service);(a.service=="fblike"||a.service=="fbsend"||a.service=="fbrec"||a.service=="fbLong"||a.service=="fbsub")&&stButtons.getXFBMLFromFB(a.element);stlib.nativeButtons.checkNativeButtonSupport(a.service)&&stlib.nativeButtons.loadService(a.service)}else stButtons.makeButton(a);stlib.buttonInfo.addButton(a);return true}if(a.type!="custom"){a.element.appendChild(stButtons.makeButton(a));(a.service=="plusone"||a.service=="googleplusfollow"||
a.service=="googleplusadd")&&stButtons.getPlusOneFromGoogle(a.service);(a.service=="fblike"||a.service=="fbsend"||a.service=="fbrec"||a.service=="fbLong"||a.service=="fbsub")&&stButtons.getXFBMLFromFB(a.element);stlib.nativeButtons.checkNativeButtonSupport(a.service)&&stlib.nativeButtons.loadService(a.service)}else stButtons.makeButton(a);var b=new Shareable(a);b.idx=stWidget.entries;stWidget.entries++;b.publisher=stLight.publisher;b.sessionID=stLight.sessionID;b.fpc=stLight.fpc;if(a.element.getAttribute("st_via")!=
null)b.via=a.element.getAttribute("st_via").replace(/^\s+|\s+$/g,"");b.url=stWidget.ogurl?stWidget.ogurl:stWidget.twitterurl?stWidget.twitterurl:document.location.href;b.url=a.url?a.url:b.url;if(!stlib.hash.doNotHash){b.url=stlib.hash.appendHash(b.url);a.url=b.url}stlib.data.set("url",b.url,"shareInfo");b.title=stWidget.ogtitle?stWidget.ogtitle:stWidget.twittertitle?stWidget.twittertitle:document.title;b.title=a.title?a.title:b.title;var d=stWidget.ogimg?stWidget.ogimg:stWidget.twitterimg?stWidget.twitterimg:
a.element.thumbnail?a.element.thumbnail:null;b.image=a.element.image?a.element.image:d;b.summary=stWidget.ogdesc?stWidget.ogdesc:stWidget.twitterdesc?stWidget.twitterdesc:stWidget.desc;b.summary=a.element.summary?a.element.summary:b.summary;stWidget.merge(b,stWidget.options);if(typeof stWidget.options.textRightToLeft!="undefined"&&stWidget.options.textRightToLeft!="null"&&stWidget.options.textRightToLeft==true){document.getElementById("stwrapper").style.top="auto";document.getElementById("stwrapper").style.left=
"auto"}b.mouseOn=function(){stWidget.mouseOnTimer=setTimeout(b.decideFastShare,500)};b.mouseOut=function(){clearInterval(stWidget.mouseOnTimer)};b.decideFastShare=function(){if(!stlib.browser.ieFallback||!(typeof stWidget.initIE=="undefined"||stWidget.initIE!=true))if(!useFastShare||!stIsLoggedIn||a.service=="email"||a.service=="sharethis"||a.service=="wordpress"||typeof servicesLoggedIn[a.service]=="undefined"&&(a.service=="facebook"||a.service=="twitter"||a.service=="linkedin"||a.service=="yahoo"))stlib.browser.mobile.handleForMobileFriendly(b,
a,stWidget.options)?stLight.log("widget","mobile",a.service,a.type):b.popup();else{stLight.log("widget","fastShare",a.service,a.type);stFastShareObj.url=b.url;stFastShareObj.title=b.title;stFastShareObj.image=b.image;if(typeof b.summary!="undefined"&&b.summary!=null)stFastShareObj.summary=b.summary;stFastShareObj.via=null;if(a.service=="twitter"&&b.element.getAttribute("st_via")!=null)stFastShareObj.via=b.element.getAttribute("st_via").replace(/^\s+|\s+$/g,"");stFastShareObj.message=b.message;stFastShareObj.element=
a.element;stFastShareObj.service=a.service;stFastShareObj.type=a.type;stFastShareObj.publisher=stlib.data.get("publisher","pageInfo");stFastShareObj.fpc=stlib.data.get("fpc","pageInfo");stFastShareObj.sessionID=stlib.data.get("sessionID","pageInfo");stFastShareObj.hostname=stlib.data.get("hostname","pageInfo");stFastShareObj.username=servicesLoggedIn[a.service];typeof fastShare=="undefined"?stLight.odjs("https:"==document.location.protocol?"https://ws.sharethis.com/button/fastShare.js":"http://w.sharethis.com/button/fastShare.js",
function(){fastShare.showWidget()}):fastShare.showWidget()}};b.popup=function(){if(stWidget.widgetOpen==false){switchTo5x||stWidget.stCancelClose();var d=stLight.getSource2(a);stLight.log("widget",d,a.service,a.type);if(stWidget.options.popup&&!switchTo5x){d=stWidget.createFrag(b);_$d_();_$d1("4x Popup Called");_$d1(d);_$d_();window.open(stWidget.frameUrl4x+"#"+d,"newstframe","status=1,toolbar=0,width=345,height=375")}else if(stWidget.options.popup&&switchTo5x){d="http://sharethis.com/share?url="+
b.url;b.title!=null&&(d=d+("&title="+b.title));b.image!=null&&(d=d+("&img="+b.image));b.summary!=null&&(d=d+("&summary="+b.summary));a.type!=null&&(d=d+("&type="+a.type));b.via!=null&&(d=d+("&via="+b.via));var e="";if(stlib.data){var e=stlib.json.encode(stlib.data.pageInfo),g=stlib.json.encode(stlib.data.shareInfo);if(stlib.browser.isFirefox()&&!stlib.browser.firefox8Version()){e=encodeURIComponent(encodeURIComponent(e));g=encodeURIComponent(encodeURIComponent(g))}else{e=encodeURIComponent(e);g=encodeURIComponent(g)}e=
"&pageInfo="+e+"&shareInfo="+g}window.open(d+e,"newstframe","status=1,toolbar=0,width=820,height=950")}else{stButtons.messageQueueInstance.send(stWidget.createFrag(b),"light");stWidget.positionWidget(b);stWidget.options.embeds==false&&stWidget.hideEmbeds();setTimeout(function(){st_showing=stWidget.widgetOpen=true},200)}}return false};b.init();stlib.buttonInfo.addButton(b);return b};
stWidget.createFrag=function(a,b){var d;d=stWidget.options.popup?"popup":"light";__stgetPubGA();if(b=="data"){d="data";for(var f in a)if(a.hasOwnProperty(f)==true&&a[f]!==null&&typeof a[f]!="function"){var e=typeof a[f]=="object"?stlib.json.encode(a[f]):a[f];d=stlib.browser.isFirefox()&&!stlib.browser.firefox8Version()?d+"/"+f+"="+encodeURIComponent(encodeURIComponent(e)):d+"/"+f+"="+encodeURIComponent(e)}}else if(b=="init"){d="init";if(stWidget.options.tracking&&stWidget.options.publisherGA==null)if(typeof pageTracker!=
"undefined"&&pageTracker!==null)stWidget.options.publisherGA=pageTracker._getAccount();else if(stWidget.options.publisherGA==null&&typeof __stPubGA!=="undefined")stWidget.options.publisherGA=__stPubGA;for(f in stWidget.options)if(stWidget.options.hasOwnProperty(f)==true&&stWidget.options[f]!==null&&typeof stWidget.options[f]!="function"&&typeof stWidget.options[f]!="object"){e=stWidget.options[f];try{e=decodeURIComponent(e);e=decodeURIComponent(e)}catch(g){}d=d+"/"+f+"="+encodeURIComponent(e)}d=d+
"/pUrl="+encodeURIComponent(encodeURIComponent(document.location.href))+(document.title!=""?"/title="+encodeURIComponent(encodeURIComponent(document.title)):"")+"/stLight=true"}else{for(f in a)a.hasOwnProperty(f)==true&&(a[f]!==null&&typeof a[f]!="function"&&typeof a[f]!="object"&&f!=="idx")&&(d=d+"/"+f+"-=-"+encodeURIComponent(encodeURIComponent(a[f])));a.service=="email"&&(d=d+"/page-=-send");switchTo5x&&(a.service=="facebook"?d=d+"/page-=-fbhome":a.service=="twitter"?d=d+"/page-=-twhome":a.service==
"yahoo"?d=d+"/page-=-ybhome":a.service=="linkedin"?d=d+"/page-=-lihome":a.service=="wordpress"&&(d=d+"/page-=-wphome"));if(stlib.data){f=stlib.json.encode(stlib.data.pageInfo);e=stlib.json.encode(stlib.data.shareInfo);if(stlib.browser.isFirefox()&&!stlib.browser.firefox8Version()){f=encodeURIComponent(encodeURIComponent(f));e=encodeURIComponent(encodeURIComponent(e))}else{f=encodeURIComponent(f);e=encodeURIComponent(e)}d=d+("/pageInfo-=-"+f)+("/shareInfo-=-"+e)}}return d};
stWidget.positionWidget=function(a){function b(a){for(var b=0,d=0,f=true;a!=null;){d=d+a.offsetLeft;f&&(b=b+a.offsetTop);if(window.getComputedStyle){if(document.defaultView.getComputedStyle(a,null).getPropertyValue("position")=="fixed"){b=b+(document.documentElement.scrollTop||document.body.scrollTop);f=false}}else if(a.currentStyle&&a.currentStyle.position=="fixed"){b=b+(document.documentElement.scrollTop||document.body.scrollTop);f=false}a=a.offsetParent}return{height:b,width:d}}if(!a)return false;
if(switchTo5x){document.getElementById("stOverlay").style.display="block";if(stWidget.options.autoPosition==true){stWidget.wrapper.style.left=document.all&&navigator.appVersion.indexOf("MSIE 7.")!=-1?"500px":"10%";stWidget.wrapper.style.right="10%";e=(document.documentElement.clientHeight-parseFloat(stWidget.wrapper.offsetHeight)/2)/2;e>20?e=20:e<5&&(e=5);stWidget.wrapper.style.top=e+"px";stWidget.wrapper.style.marginLeft="auto";stWidget.wrapper.style.marginRight="auto";stWidget.wrapper.style.textAlign=
"left";stWidget.wrapper.style.position="fixed";if(document.all&&navigator.appVersion.indexOf("MSIE 6.")!=-1){stWidget.wrapper.style.left="300px";stWidget.wrapper.style.position="absolute"}}if(stWidget.options.autoPosition=="center"){stWidget.wrapper.style.left=document.all&&navigator.appVersion.indexOf("MSIE 7.")!=-1?"500px":"10%";stWidget.wrapper.style.right="10%";stWidget.wrapper.style.marginLeft="auto";stWidget.wrapper.style.marginRight="auto";stWidget.wrapper.style.position="fixed";e=(document.documentElement.clientHeight-
parseFloat(stWidget.wrapper.offsetHeight)/2)/2;e>20?e=20:e<5&&(e=5);stWidget.wrapper.style.top=e+"px";if(document.all&&navigator.appVersion.indexOf("MSIE 6.")!=-1)stWidget.wrapper.style.position="absolute"}}else{shareel=a.element;var d=curtop=0,f=b(shareel),d=f.width;curtop=f.height;shareel=a.element;var e=f=a=0,g=0,f=a=0,a=curtop+shareel.offsetHeight+5,f=d+5,e=a+(stWidget.options.offsetTop?stWidget.options.offsetTop:0),a=e=eval(e),e=e+"px",g=f+(stWidget.options.offsetLeft?stWidget.options.offsetLeft:
0),f=g=eval(g);stWidget.wrapper.style.top=e;stWidget.wrapper.style.left=g+"px";if(stWidget.options.autoPosition==true){stWidget.oldScroll=document.body.scrollTop;e=stWidget.pageSize();d=330+a-(e.height+e.scrY);e=330+f-(e.width+e.scrX);a=a-d;f=f-e;g=b(shareel);if(d>0){g.height-330>0&&(a=g.height-330);stWidget.wrapper.style.top=a+"px"}if(e>0){g.width-330>0&&(f=g.width-330);stWidget.wrapper.style.left=f+"px"}}if(stWidget.options.autoPosition=="center"){stWidget.wrapper.style.top="15%";stWidget.wrapper.style.left=
"35%";stWidget.wrapper.style.position="fixed"}}stWidget.wrapper.style.visibility="visible";stWidget.mainstframe.style.visibility="visible"};stWidget.hideWidget=function(){if(stWidget.wrapper.style.visibility!=="hidden")stWidget.wrapper.style.visibility="hidden";if(stWidget.mainstframe.style.visibility!=="hidden")stWidget.mainstframe.style.visibility="hidden";if(switchTo5x)document.getElementById("stOverlay").style.display="none"};
stWidget.pageSize=function(){var a=[0,0,0,0],b=a=0,d=0,f=0;if(typeof window.pageYOffset=="number"){a=window.pageXOffset;b=window.pageYOffset}else if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){a=document.body.scrollLeft;b=document.body.scrollTop}else if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){a=document.documentElement.scrollLeft;b=document.documentElement.scrollTop}if(window.innerWidth){d=window.innerWidth;f=window.innerHeight}else if(document.documentElement.offsetWidth){d=
document.documentElement.offsetWidth;f=document.documentElement.offsetHeight}return a={scrX:a,scrY:b,width:d,height:f}};stWidget.closetimeout=null;stWidget.stClose=function(a){a||(a=1E3);if(!switchTo5x&&stWidget.options.autoclose!=null&&(stWidget.options.autoclose==true||stWidget.options.autoclose=="true"))stWidget.openDuration<0.5&&stWidget.stopClosing==false?stWidget.closetimeout=setTimeout("stWidget.closeWidget()",a):stWidget.stopClosing=true};
stWidget.stCancelClose=function(){clearTimeout(stWidget.closetimeout);stWidget.buttonClicked=true;setTimeout(function(){stWidget.buttonClicked=false},100)};
stWidget.closeWidget=function(){if(st_showing==false)return false;st_showing=false;stWidget.widgetOpen=false;stWidget.wrapper.style.visibility="hidden";stWidget.mainstframe.style.visibility="hidden";stWidget.showEmbeds();stWidget.sendEvent("screen","home");if(switchTo5x)document.getElementById("stOverlay").style.display="none";else{stWidget.wrapper.style.top="-999px";stWidget.wrapper.style.left="-999px"}};
stWidget.hideEmbeds=function(){for(var a=document.getElementsByTagName("embed"),b=0;b<a.length;b++)a[b].style.visibility="hidden"};stWidget.showEmbeds=function(){if(stWidget.options.embeds==true)return true;for(var a=document.getElementsByTagName("embed"),b=0;b<a.length;b++)a[b].style.visibility="visible"};stWidget.sendEvent=function(a,b){stButtons.messageQueueInstance.send("widget/"+a+"="+b,"widget")};stWidget.getMetaTags=function(){stWidget.getOGTags();stWidget.getTwitterTags()};
stWidget.getOGTags=function(){for(var a=document.getElementsByTagName("meta"),b=0;b<a.length;b++){var d=a[b].getAttribute("property");d==null&&(d=a[b].getAttribute("name"));if(d=="og:title")stWidget.ogtitle=a[b].getAttribute("content");else if(d=="og:type")stWidget.ogtype=a[b].getAttribute("content");else if(d=="og:url")stWidget.ogurl=a[b].getAttribute("content");else if(d=="og:image")stWidget.ogimg=a[b].getAttribute("content");else if(d=="og:description")stWidget.ogdesc=a[b].getAttribute("content");
else if(d=="description"||d=="Description")stWidget.desc=a[b].getAttribute("content")}};
stWidget.getTwitterTags=function(){for(var a=document.getElementsByTagName("meta"),b=0;b<a.length;b++){var d=a[b].getAttribute("name");d==null&&(d=a[b].getAttribute("property"));if(d=="twitter:card")stWidget.twittercard=a[b].getAttribute("content");else if(d=="twitter:url")stWidget.twitterurl=a[b].getAttribute("content");else if(d=="twitter:title")stWidget.twittertitle=a[b].getAttribute("content");else if(d=="twitter:description")stWidget.twitterdesc=a[b].getAttribute("content");else if(d=="twitter:image")stWidget.twitterimg=
a[b].getAttribute("content");else if(d=="description"||d=="Description")stWidget.desc=a[b].getAttribute("content")}};
function shareLog(a){if(typeof pageTracker!="undefined"&&pageTracker!==null)pageTracker._trackEvent("ShareThis",a);else if(typeof _gaq!="undefined"&&_gaq!==null)_gaq.push(["_trackEvent","ShareThis",a]);else if(stButtons.publisherTracker!==null)stButtons.publisherTracker._trackEvent("ShareThis",a);else if(typeof _gat!="undefined"&&_gat!==null&&typeof stWidget.options.publisherGA!="undefined"&&stWidget.options.publisherGA!=null){stButtons.publisherTracker=_gat._getTracker(stWidget.options.publisherGA);
stButtons.publisherTracker._trackEvent("ShareThis",a)}}
stButtons.completeInit=function(){if(!stButtons.goToInit){stButtons.goToInit=true;stWidget.getMetaTags();document.body.appendChild(stWidget.wrapper);switchTo5x&&document.body.appendChild(stWidget.overlay);if(!switchTo5x)try{var a=document.getElementById("stLframe");a.onmouseover=function(){stWidget.stCancelClose();stWidget.inTime=(new Date).getTime()};a.onmouseout=function(){stWidget.outTime=(new Date).getTime();stWidget.openDuration=(stWidget.outTime-stWidget.inTime)/1E3;stWidget.stClose()};try{document.body.attachEvent?
document.body.attachEvent("onclick",function(){if(stWidget.buttonClicked==false){stWidget.stopClosing=false;stWidget.openDuration=0;stWidget.stClose(100)}}):document.body.setAttribute("onclick","if(stWidget.buttonClicked==false){stWidget.stopClosing=false;stWidget.openDuration=0;stWidget.stClose(100);}")}catch(b){document.body.onclick=function(){if(stWidget.buttonClicked==false){stWidget.stopClosing=false;stWidget.openDuration=0;stWidget.stClose(100)}}}}catch(d){}stButtons.makeButtons();stWidget.init()}};
plusoneCallback=function(a){if(a.state=="on"){stlib.data.resetShareData();stlib.data.set("url",a.href,"shareInfo");stlib.data.set("destination","plusone","shareInfo");stlib.data.setSource("chicklet");stlib.data.set("buttonType","chicklet","shareInfo");stlib.sharer.share()}};
stButtons.trackFB=function(){try{if(!stButtons.fbTracked&&typeof FB!="undefined"&&typeof FB.Event!="undefined"&&typeof FB.Event.subscribe!="undefined"){stButtons.fbTracked=true;FB.Event.subscribe("edge.create",function(a){stButtons.trackShare("fblike_auto",a);stLight.callSubscribers("click","fblike",a)});FB.Event.subscribe("edge.remove",function(a){stButtons.trackShare("fbunlike_auto",a);stLight.callSubscribers("click","fbunlike",a)});FB.Event.subscribe("message.send",function(a){stButtons.trackShare("fbsend_auto",
a);stLight.callSubscribers("click","fbsend",a)})}}catch(a){}};
stButtons.trackTwitter=function(){if(!stButtons.twitterTracked&&typeof twttr!="undefined"&&typeof twttr.events!="undefined"&&typeof twttr.events.bind!="undefined"){stButtons.twitterTracked=true;twttr.events.bind("click",function(){stButtons.trackTwitterEvent("click");stLight.callSubscribers("click","twitter")});twttr.events.bind("tweet",function(){stButtons.trackTwitterEvent("tweet")});twttr.events.bind("retweet",function(){stButtons.trackTwitterEvent("retweet");stLight.callSubscribers("click","retweet")});
twttr.events.bind("favorite",function(){stButtons.trackTwitterEvent("favorite");stLight.callSubscribers("click","favorite")});twttr.events.bind("follow",function(){stButtons.trackTwitterEvent("follow");stLight.callSubscribers("click","follow")})}};stButtons.trackTwitterEvent=function(a){stButtons.trackShare("twitter_"+a+"_auto")};
stButtons.trackShare=function(a,b){var d=typeof b!=="undefined"&&b!==null?b:document.location.href;stlib.data.resetShareData();stlib.data.set("url",d,"shareInfo");stlib.data.set("destination",a,"shareInfo");stlib.data.set("buttonType","chicklet","shareInfo");stlib.data.setSource("chicklet");stlib.sharer.share()};stLight.processSTQ=function(){if(typeof _stq!="undefined")for(var a=0;a<_stq.length;a++)stLight.options(_stq[a]);else return false};
stLight.onDomContentLoaded=function(){stLight.onReady();stButtons.trackTwitter()};stLight.onDomContentLoadedLazy=function(){stLight.loadServicesLoggedIn(function(){stlib.data.init();stButtons.locateElements();stButtons.makeButtons()})};stLight.messageReceiver=function(a){if(a&&(a.origin=="http://edge.sharethis.com"||a.origin=="https://ws.sharethis.com")){a=a.data;a=a.split("|");a[0]=="ShareThis"&&a.length>2&&stLight.callSubscribers(a[1],a[2],typeof a[3]=="undefined"?document.location.href:a[3])}};
stLight.subscribe=function(a,b){a=="click"?stLight.clickSubscribers.push(b):stLight.nonClickSubscribers.push(b)};stLight.callSubscribers=function(a,b,d){if(a=="click")for(a=0;a<stLight.clickSubscribers.length;a++)stLight.clickSubscribers[a]("click",b,d)};
stLight.gaTS=function(a,b,d){var f=a="";if(b=="fblike"){a="ShareThis_facebook";f="Like"}else if(b=="fbunlike"){a="ShareThis_facebook";f="UnLike"}else if(b=="fbsend"){a="ShareThis_facebook";f="Send"}else if(b=="twitter"){a="ShareThis_twitter";f="Share"}else if(b=="retweet"){a="ShareThis_twitter";f="ReTweet"}else if(b=="favorite"){a="ShareThis_twitter";f="Favorite"}else if(b=="follow"){a="ShareThis_twitter";f="Follow"}else{a="ShareThis_"+b;f="Share"}typeof _gaq!="undefined"&&_gaq.push(["_trackSocial",
a,f,d])};
stButtons.onReady=function(){for(var a=document.getElementsByTagName("*"),b=RegExp(/sharethis_smartbuttons/),d=false,f=0;f<a.length;f++)if(typeof a[f].className=="string"&&a[f].className!=""&&a[f].className.match(b)){d=true;break}if(d){a=document.getElementsByTagName("head")[0];b=["return=json","cb=stButtons.smartifyButtons"];b=b.join("&");b=("https:"==document.location.protocol?"https://ws.":"http://wd.")+"sharethis.com/api/getRecentServices.php?"+b;d=document.createElement("script");d.setAttribute("type","text/javascript");
d.setAttribute("src",b);a.appendChild(d);setTimeout("stButtons.completeInit()",2E3)}else stButtons.completeInit();stLight.subscribe("click",stLight.gaTS)};stLight.domReady=function(){stLight.onReady();stButtons.trackTwitter();__stgetPubGA();typeof __stPubGA!=="undefined"&&(stLight.readyRun==true&&stWidget.frameReady==true)&&stWidget.sendEvent("publisherGA",__stPubGA)};stButtons.goToInit=!1;stButtons.widget=!1;stButtons.widgetArray=[];stButtons.queue=[];stButtons.cbQueue=[];
stButtons.cbNativeQueue=[];stButtons.cbVal=0;stButtons.queuePos=0;stButtons.counts=[];st_showing=!1;stButtons.urlElements=[];stButtons.publisherTracker=null;stButtons.plusOneLoaded=!1;stButtons.plusOneLoading=!1;stButtons.xfbmlLoaded=!1;stButtons.xfbmlLoading=!1;stButtons.fbTracked=!1;stButtons.twitterTracked=!1;stButtons.pumpInstance=null;stButtons.messageQueueInstance=null;stButtons.countsResp=[];stButtons.countsNativeResp=[];stWidget.getMetaTags();stLight.clickSubscribers=[];
stLight.nonClickSubscribers=[];var __stPubGA;"completed"==window.document.readyState?stLight.domReady():"undefined"!=typeof window.addEventListener?window.addEventListener("load",stLight.domReady,!1):"undefined"!=typeof document.addEventListener?document.addEventListener("load",stLight.domReady,!1):"undefined"!=typeof window.attachEvent&&window.attachEvent("onload",stLight.domReady);
"undefined"!=typeof window.addEventListener?window.addEventListener("click",function(){stWidget.closeWidget()},!1):"undefined"!=typeof document.addEventListener?document.addEventListener("click",function(){stWidget.closeWidget()},!1):"undefined"!=typeof window.attachEvent&&window.attachEvent("onclick",function(){stWidget.closeWidget()});
"undefined"==typeof __st_loadLate?"undefined"!=typeof window.addEventListener?window.addEventListener("DOMContentLoaded",stLight.onDomContentLoaded,!1):"undefined"!=typeof document.addEventListener&&document.addEventListener("DOMContentLoaded",stLight.onDomContentLoaded,!1):"undefined"!=typeof window.addEventListener?window.addEventListener("DOMContentLoaded",stLight.onDomContentLoadedLazy,!1):"undefined"!=typeof document.addEventListener&&document.addEventListener("DOMContentLoaded",stLight.onDomContentLoadedLazy,
!1);"undefined"!=typeof window.addEventListener?window.addEventListener("message",stLight.messageReceiver,!1):"undefined"!=typeof document.addEventListener?document.addEventListener("message",stLight.messageReceiver,!1):"undefined"!=typeof window.attachEvent&&window.attachEvent("onmessage",stLight.messageReceiver);"complete"==document.readyState&&!1==stLight.readyRun&&stLight.domReady();(function(a,b,d){function f(a,d){var f=b.createElement(a||"div"),e;for(e in d)f[e]=d[e];return f}function e(a){for(var b=1,d=arguments.length;b<d;b++)a.appendChild(arguments[b]);return a}function g(a,b){var f=a.style,e,g;if(f[b]!==d)return b;b=b.charAt(0).toUpperCase()+b.slice(1);for(g=0;g<p.length;g++)if(e=p[g]+b,f[e]!==d)return e}function j(a,b){for(var d in b)a.style[g(a,d)||d]=b[d];return a}function k(a){for(var b=1;b<arguments.length;b++){var f=arguments[b],e;for(e in f)a[e]===d&&(a[e]=f[e])}return a}
function l(a){for(var b={x:a.offsetLeft,y:a.offsetTop};a=a.offsetParent;)b.x+=a.offsetLeft,b.y+=a.offsetTop;return b}var p=["webkit","Moz","ms","O"],m={},s,o,n=f("style");o=(e(b.getElementsByTagName("head")[0],n),n.sheet||n.styleSheet);var r={lines:12,length:7,width:5,radius:10,rotate:0,color:"#000",speed:1,trail:100,opacity:0.25,fps:20,zIndex:2E9,className:"spinner",top:"auto",left:"auto"},n=function x(a){if(!this.spin)return new x(a);this.opts=k(a||{},x.defaults,r)};n.defaults={};k(n.prototype,
{spin:function(a){this.stop();var b=this,d=b.opts,e=b.el=j(f(0,{className:d.className}),{position:"relative",zIndex:d.zIndex}),g=d.radius+d.length+d.width,k,h;a&&(a.insertBefore(e,a.firstChild||null),h=l(a),k=l(e),j(e,{left:("auto"==d.left?h.x-k.x+(a.offsetWidth>>1):d.left+g)+"px",top:("auto"==d.top?h.y-k.y+(a.offsetHeight>>1):d.top+g)+"px"}));e.setAttribute("aria-role","progressbar");b.lines(e,b.opts);if(!s){var m=0,p=d.fps,o=p/d.speed,n=(1-d.opacity)/(o*d.trail/100),q=o/d.lines;!function D(){m++;
for(var a=d.lines;a;a--){var f=Math.max(1-(m+a*q)%o*n,d.opacity);b.opacity(e,d.lines-a,f,d)}b.timeout=b.el&&setTimeout(D,~~(1E3/p))}()}return b},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=d),this},lines:function(a,b){function d(a,e){return j(f(),{position:"absolute",width:b.length+b.width+"px",height:b.width+"px",background:a,boxShadow:e,transformOrigin:"left",transform:"rotate("+~~(360/b.lines*g+b.rotate)+"deg) translate("+
b.radius+"px,0)",borderRadius:(b.width>>1)+"px"})}for(var g=0,k;g<b.lines;g++){k=f();var l=1+~(b.width/2)+"px",h=b.hwaccel?"translate3d(0,0,0)":"",p=b.opacity,n;if(n=s){n=b.opacity;var q=b.trail,r=g,t=b.lines,G=["opacity",q,~~(100*n),r,t].join("-"),r=0.01+100*(r/t),t=Math.max(1-(1-n)/q*(100-r),n),D=s.substring(0,s.indexOf("Animation")).toLowerCase(),D=D&&"-"+D+"-"||"";n=(m[G]||(o.insertRule("@"+D+"keyframes "+G+"{0%{opacity:"+t+"}"+r+"%{opacity:"+n+"}"+(r+0.01)+"%{opacity:1}"+(r+q)%100+"%{opacity:"+
n+"}100%{opacity:"+t+"}}",0),m[G]=1),G)+" "+1/b.speed+"s linear infinite"}k=j(k,{position:"absolute",top:l,transform:h,opacity:p,animation:n});b.shadow&&e(k,j(d("#000","0 0 4px #000"),{top:"2px"}));e(a,e(k,d(b.color,"0 0 1px rgba(0,0,0,.1)")))}return a},opacity:function(a,b,d){b<a.childNodes.length&&(a.childNodes[b].style.opacity=d)}});var t=function(a,b){return f("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',b)},q=j(f("group"),{behavior:"url(#default#VML)"});!g(q,"transform")&&
q.adj?(o.addRule(".spin-vml","behavior:url(#default#VML)"),n.prototype.lines=function(a,b){function d(){return j(t("group",{coordsize:k+" "+k,coordorigin:-g+" "+-g}),{width:k,height:k})}function f(a,h,k){e(l,e(j(d(),{rotation:360/b.lines*a+"deg",left:~~h}),e(j(t("roundrect",{arcsize:1}),{width:g,height:b.width,left:b.radius,top:-b.width>>1,filter:k}),t("fill",{color:b.color,opacity:b.opacity}),t("stroke",{opacity:0}))))}var g=b.length+b.width,k=2*g,h=2*-(b.width+b.length)+"px",l=j(d(),{position:"absolute",
top:h,left:h});if(b.shadow)for(h=1;h<=b.lines;h++)f(h,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(h=1;h<=b.lines;h++)f(h);return e(a,l)},n.prototype.opacity=function(a,b,d,f){a=a.firstChild;f=f.shadow&&f.lines||0;a&&b+f<a.childNodes.length&&(a=a.childNodes[b+f],a=a&&a.firstChild,a=a&&a.firstChild,a&&(a.opacity=d))}):s=g(q,"animation");!0;a.Spinner=n})(window,document);!function(a){a(function(){var b=a.support,d;a:{d=document.createElement("bootstrap");var f={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},e;for(e in f)if(void 0!==d.style[e]){d=f[e];break a}d=void 0}b.transition=d&&{end:d}})}(window.jQuery);
!function(a){var b=function(b,d){this.options=d;this.$element=a(b).delegate('[data-dismiss="modal"]',"click.dismiss.modal",a.proxy(this.hide,this));this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};b.prototype={constructor:b,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var b=this,d=a.Event("show");this.$element.trigger(d);!this.isShown&&!d.isDefaultPrevented()&&(this.isShown=!0,this.escape(),this.backdrop(function(){var d=a.support.transition&&
b.$element.hasClass("fade");b.$element.parent().length||b.$element.appendTo(document.body);b.$element.show();d&&b.$element[0].offsetWidth;b.$element.addClass("in").attr("aria-hidden",!1);b.enforceFocus();d?b.$element.one(a.support.transition.end,function(){b.$element.focus().trigger("shown")}):b.$element.focus().trigger("shown")}))},hide:function(b){b&&b.preventDefault();b=a.Event("hide");this.$element.trigger(b);this.isShown&&!b.isDefaultPrevented()&&(this.isShown=!1,this.escape(),a(document).off("focusin.modal"),
this.$element.removeClass("in").attr("aria-hidden",!0),a.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal())},enforceFocus:function(){var b=this;a(document).on("focusin.modal",function(a){b.$element[0]!==a.target&&!b.$element.has(a.target).length&&b.$element.focus()})},escape:function(){var a=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(b){27==b.which&&a.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},
hideWithTransition:function(){var b=this,d=setTimeout(function(){b.$element.off(a.support.transition.end);b.hideModal()},500);this.$element.one(a.support.transition.end,function(){clearTimeout(d);b.hideModal()})},hideModal:function(){var a=this;this.$element.hide();this.backdrop(function(){a.removeBackdrop();a.$element.trigger("hidden")})},removeBackdrop:function(){this.$backdrop.remove();this.$backdrop=null},backdrop:function(b){var d=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var g=
a.support.transition&&d;this.$backdrop=a('<div class="modal-backdrop '+d+'" />').appendTo(document.body);this.$backdrop.click("static"==this.options.backdrop?a.proxy(this.$element[0].focus,this.$element[0]):a.proxy(this.hide,this));g&&this.$backdrop[0].offsetWidth;this.$backdrop.addClass("in");b&&(g?this.$backdrop.one(a.support.transition.end,b):b())}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(a.support.transition.end,
b):b()):b&&b()}};var d=a.fn.modal;a.fn.modal=function(d){return this.each(function(){var e=a(this),g=e.data("modal"),j=a.extend({},a.fn.modal.defaults,e.data(),"object"==typeof d&&d);g||e.data("modal",g=new b(this,j));"string"==typeof d?g[d]():j.show&&g.show()})};a.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0};a.fn.modal.Constructor=b;a.fn.modal.noConflict=function(){return a.fn.modal=d,this};a(document).on("click.modal.data-api",'[data-toggle="modal"]',function(b){var d=a(this),g=d.attr("href"),
j=a(d.attr("data-target")||g&&g.replace(/.*(?=#[^\s]+$)/,"")),g=j.data("modal")?"toggle":a.extend({remote:!/#/.test(g)&&g},j.data(),d.data());b.preventDefault();j.modal(g).one("hide",function(){d.focus()})})}(window.jQuery);
!function(a){var b=function(a,b){this.init("tooltip",a,b)};b.prototype={constructor:b,init:function(b,d,g){var j,k;this.type=b;this.$element=a(d);this.options=this.getOptions(g);this.enabled=!0;b=this.options.trigger.split(" ");for(g=b.length;g--;)d=b[g],"click"==d?this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this)):"manual"!=d&&(j="hover"==d?"mouseenter":"focus",k="hover"==d?"mouseleave":"blur",this.$element.on(j+"."+this.type,this.options.selector,a.proxy(this.enter,
this)),this.$element.on(k+"."+this.type,this.options.selector,a.proxy(this.leave,this)));this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(b){return b=a.extend({},a.fn[this.type].defaults,this.$element.data(),b),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},enter:function(b){var d=a(b.currentTarget)[this.type](this._options).data(this.type);if(!d.options.delay||!d.options.delay.show)return d.show();
clearTimeout(this.timeout);d.hoverState="in";this.timeout=setTimeout(function(){"in"==d.hoverState&&d.show()},d.options.delay.show)},leave:function(b){var d=a(b.currentTarget)[this.type](this._options).data(this.type);this.timeout&&clearTimeout(this.timeout);if(!d.options.delay||!d.options.delay.hide)return d.hide();d.hoverState="out";this.timeout=setTimeout(function(){"out"==d.hoverState&&d.hide()},d.options.delay.hide)},show:function(){var b,d,g,j,k;d=a.Event("show");if(this.hasContent()&&this.enabled&&
(this.$element.trigger(d),!d.isDefaultPrevented())){b=this.tip();this.setContent();this.options.animation&&b.addClass("fade");j="function"==typeof this.options.placement?this.options.placement.call(this,b[0],this.$element[0]):this.options.placement;b.detach().css({top:0,left:0,display:"block"});this.options.container?b.appendTo(this.options.container):b.insertAfter(this.$element);d=this.getPosition();g=b[0].offsetWidth;b=b[0].offsetHeight;switch(j){case "bottom":k={top:d.top+d.height,left:d.left+
d.width/2-g/2};break;case "top":k={top:d.top-b,left:d.left+d.width/2-g/2};break;case "left":k={top:d.top+d.height/2-b/2,left:d.left-g};break;case "right":k={top:d.top+d.height/2-b/2,left:d.left+d.width}}this.applyPlacement(k,j);this.$element.trigger("shown")}},applyPlacement:function(a,b){var d=this.tip(),j=d[0].offsetWidth,k=d[0].offsetHeight,l,p,m,s;d.offset(a).addClass(b).addClass("in");l=d[0].offsetWidth;p=d[0].offsetHeight;"top"==b&&p!=k&&(a.top=a.top+k-p,s=!0);"bottom"==b||"top"==b?(m=0,0>a.left&&
(m=-2*a.left,a.left=0,d.offset(a),l=d[0].offsetWidth),this.replaceArrow(m-j+l,l,"left")):this.replaceArrow(p-k,p,"top");s&&d.offset(a)},replaceArrow:function(a,b,d){this.arrow().css(d,a?50*(1-a/b)+"%":"")},setContent:function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b);a.removeClass("fade in top bottom left right")},hide:function(){var b=this.tip(),d=a.Event("hide");this.$element.trigger(d);if(!d.isDefaultPrevented()){b.removeClass("in");if(a.support.transition&&
this.$tip.hasClass("fade")){var g=setTimeout(function(){b.off(a.support.transition.end).detach()},500);b.one(a.support.transition.end,function(){clearTimeout(g);b.detach()})}else b.detach();return this.$element.trigger("hidden"),this}},fixTitle:function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},hasContent:function(){return this.getTitle()},getPosition:function(){var b=this.$element[0];
return a.extend({},"function"==typeof b.getBoundingClientRect?b.getBoundingClientRect():{width:b.offsetWidth,height:b.offsetHeight},this.$element.offset())},getTitle:function(){var a,b=this.$element,d=this.options;return a=b.attr("data-original-title")||("function"==typeof d.title?d.title.call(b[0]):d.title),a},tip:function(){return this.$tip=this.$tip||a(this.options.template)},arrow:function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},validate:function(){this.$element[0].parentNode||
(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(b){b=b?a(b.currentTarget)[this.type](this._options).data(this.type):this;b.tip().hasClass("in")?b.hide():b.show()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};var d=a.fn.tooltip;a.fn.tooltip=function(d){return this.each(function(){var e=a(this),g=e.data("tooltip"),j="object"==
typeof d&&d;g||e.data("tooltip",g=new b(this,j));"string"==typeof d&&g[d]()})};a.fn.tooltip.Constructor=b;a.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1};a.fn.tooltip.noConflict=function(){return a.fn.tooltip=d,this}}(window.jQuery);
!function(a){var b=function(a,b){this.init("popover",a,b)};b.prototype=a.extend({},a.fn.tooltip.Constructor.prototype,{constructor:b,setContent:function(){var a=this.tip(),b=this.getTitle(),d=this.getContent();a.find(".popover-title")[this.options.html?"html":"text"](b);a.find(".popover-content")[this.options.html?"html":"text"](d);a.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var a,b=this.$element,d=this.options;
return a=("function"==typeof d.content?d.content.call(b[0]):d.content)||b.attr("data-content"),a},tip:function(){return this.$tip||(this.$tip=a(this.options.template)),this.$tip},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}});var d=a.fn.popover;a.fn.popover=function(d){return this.each(function(){var e=a(this),g=e.data("popover"),j="object"==typeof d&&d;g||e.data("popover",g=new b(this,j));"string"==typeof d&&g[d]()})};a.fn.popover.Constructor=b;a.fn.popover.defaults=
a.extend({},a.fn.tooltip.defaults,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'});a.fn.popover.noConflict=function(){return a.fn.popover=d,this}}(window.jQuery);
!function(a){var b=function(b,d){this.$element=a(b);this.options=a.extend({},a.fn.button.defaults,d)};b.prototype.setState=function(a){var b=this.$element,d=b.data(),j=b.is("input")?"val":"html",a=a+"Text";d.resetText||b.data("resetText",b[j]());b[j](d[a]||this.options[a]);setTimeout(function(){"loadingText"==a?b.addClass("disabled").attr("disabled","disabled"):b.removeClass("disabled").removeAttr("disabled")},0)};b.prototype.toggle=function(){var a=this.$element.closest('[data-toggle="buttons-radio"]');
a&&a.find(".active").removeClass("active");this.$element.toggleClass("active")};var d=a.fn.button;a.fn.button=function(d){return this.each(function(){var e=a(this),g=e.data("button"),j="object"==typeof d&&d;g||e.data("button",g=new b(this,j));"toggle"==d?g.toggle():d&&g.setState(d)})};a.fn.button.defaults={loadingText:"loading..."};a.fn.button.Constructor=b;a.fn.button.noConflict=function(){return a.fn.button=d,this};a(document).on("click.button.data-api","[data-toggle^=button]",function(b){b=a(b.target);
b.hasClass("btn")||(b=b.closest(".btn"));b.button("toggle")})}(window.jQuery);(function(a,b,d){function f(a,b,d){for(var e=[],f=0;f<a.length;f++){var g=tinycolor(a[f]),h=0.5>g.toHsl().l?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light",h=h+(tinycolor.equals(b,a[f])?" sp-thumb-active":""),j=o?"background-color:"+g.toRgbString():"filter:"+g.toFilter();e.push('<span title="'+g.toRgbString()+'" data-color="'+g.toRgbString()+'" class="'+h+'"><span class="sp-thumb-inner" style="'+j+';" /></span>')}return"<div class='sp-cf "+d+"'>"+e.join("")+"</div>"}function e(a,d){var e=
a.outerWidth(),f=a.outerHeight(),g=d.outerHeight(),h=a[0].ownerDocument,j=h.documentElement,k=j.clientWidth+b(h).scrollLeft(),h=j.clientHeight+b(h).scrollTop(),j=d.offset();j.top+=g;j.left-=Math.min(j.left,j.left+e>k&&k>e?Math.abs(j.left+e-k):0);j.top-=Math.min(j.top,j.top+f>h&&h>f?Math.abs(f+g-0):0);return j}function g(){}function j(a){a.stopPropagation()}function k(a,b){var d=Array.prototype.slice,e=d.call(arguments,2);return function(){return a.apply(b,e.concat(d.call(arguments)))}}function l(d,
e,f,g){function h(a){a.stopPropagation&&a.stopPropagation();a.preventDefault&&a.preventDefault();a.returnValue=!1}function j(a){if(m){if(s&&9>document.documentMode&&!a.button)return k();var b=a.originalEvent.touches,f=b?b[0].pageY:a.pageY,b=Math.max(0,Math.min((b?b[0].pageX:a.pageX)-n.left,o)),f=Math.max(0,Math.min(f-n.top,p));q&&h(a);e.apply(d,[b,f,a])}}function k(){m&&(b(l).unbind(r),b(l.body).removeClass("sp-dragging"),g.apply(d,arguments));m=!1}var e=e||function(){},f=f||function(){},g=g||function(){},
l=d.ownerDocument||document,m=!1,n={},p=0,o=0,q="ontouchstart"in a,r={};r.selectstart=h;r.dragstart=h;r[q?"touchmove":"mousemove"]=j;r[q?"touchend":"mouseup"]=k;b(d).bind(q?"touchstart":"mousedown",function(a){if(!(a.which?3==a.which:2==a.button)&&!m&&!1!==f.apply(d,arguments))m=!0,p=b(d).height(),o=b(d).width(),n=b(d).offset(),b(l).bind(r),b(l.body).addClass("sp-dragging"),q||j(a),h(a)})}var p={beforeShow:g,move:g,change:g,show:g,hide:g,color:!1,flat:!1,showInput:!1,showButtons:!0,clickoutFiresChange:!1,
showInitial:!1,showPalette:!1,showPaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",preferredFormat:!1,className:"",showAlpha:!1,theme:"sp-light",palette:["fff","000"],selectionPalette:[],disabled:!1},m=[],s=!!/msie/i.exec(a.navigator.userAgent),o,n=document.createElement("div").style;n.cssText="background-color:rgba(0,0,0,.5)";o=!!~(""+n.backgroundColor).indexOf("rgba")||!!~(""+n.backgroundColor).indexOf("hsla");var r,n="";if(s)for(var t=
1;6>=t;t++)n+="<div class='sp-"+t+"'></div>";r=["<div class='sp-container'><div class='sp-palette-container'><div class='sp-palette sp-thumb sp-cf'></div></div><div class='sp-picker-container'><div class='sp-top sp-cf'><div class='sp-fill'></div><div class='sp-top-inner'><div class='sp-color'><div class='sp-sat'><div class='sp-val'><div class='sp-dragger'></div></div></div></div><div class='sp-hue'><div class='sp-slider'></div>",n,"</div></div><div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div></div><div class='sp-input-container sp-cf'><input class='sp-input' type='text' spellcheck='false'  /></div><div class='sp-initial sp-thumb sp-cf'></div><div class='sp-button-container sp-cf'><a class='sp-cancel' href='#'></a><button class='sp-choose'></button></div></div></div>"].join("");
b.fn.spectrum=function(g,h){if("string"==typeof g){var O=this,n=Array.prototype.slice.call(arguments,1);this.each(function(){var a=m[b(this).data("spectrum.id")];if(a){var d=a[g];if(!d)throw Error("Spectrum: no such method: '"+g+"'");"get"==g?O=a.get():"container"==g?O=a.container:"option"==g?O=a.option.apply(a,n):"destroy"==g?(a.destroy(),b(this).removeData("spectrum.id")):d.apply(a,n)}});return O}return this.spectrum("destroy").each(function(){var h,n=function(){A.toggleClass("sp-flat",H);A.toggleClass("sp-input-disabled",
!B.showInput);A.toggleClass("sp-alpha-enabled",B.showAlpha);A.toggleClass("sp-buttons-disabled",!B.showButtons||H);A.toggleClass("sp-palette-disabled",!B.showPalette);A.toggleClass("sp-palette-only",B.showPaletteOnly);A.toggleClass("sp-initial-disabled",!B.showInitial);A.addClass(B.className);G()},O=function(d){if(K&&(d=tinycolor(d).toRgbString(),-1===b.inArray(d,U)&&U.push(d),I&&a.localStorage))try{a.localStorage[I]=U.join(";")}catch(e){}},Ja=function(){var a=[],b=U,d={},e;if(B.showPalette){for(var f=
0;f<da.length;f++)for(var g=0;g<da[f].length;g++)e=tinycolor(da[f][g]).toRgbString(),d[e]=!0;for(f=0;f<b.length;f++)e=tinycolor(b[f]).toRgbString(),d.hasOwnProperty(e)||(a.push(b[f]),d[e]=!0)}return a.reverse().slice(0,B.maxSelectionSize)},q=function(){var a=y(),d=b.map(da,function(b,d){return f(b,a,"sp-palette-row sp-palette-row-"+d)});U&&d.push(f(Ja(),a,"sp-palette-row sp-palette-row-selection"));xa.html(d.join(""))},t=function(){if(B.showInitial){var a=R,b=y();ya.html(f([a,b],b,"sp-palette-row-initial"))}},
u=function(){(0===S||0===W||0===ea)&&G();A.addClass(za)},va=function(){A.removeClass(za)},w=function(){var a=tinycolor(P.val());a.ok?z(a):P.addClass("sp-validation-error")},wa=function(){X?v():x()},x=function(){if(X)G();else if(!1!==Y.beforeShow(y())){for(var d=0;d<m.length;d++)m[d]&&m[d].hide();X=!0;b(fa).bind("click.spectrum",v);b(a).bind("resize.spectrum",N);V.addClass("sp-active");A.show();B.showPalette&&q();G();D();R=y();t();Y.show(R)}},v=function(d){if((!d||!("click"==d.type&&2==d.button))&&
X&&!H)X=!1,b(fa).unbind("click.spectrum",v),b(a).unbind("resize.spectrum",N),V.removeClass("sp-active"),A.hide(),tinycolor.equals(y(),R)||(ma&&"cancel"!==d?E(!0):z(R,!0)),Y.hide(y())},z=function(a,b){if(!tinycolor.equals(a,y())){var d=tinycolor(a),e=d.toHsv();Z=e.h;ga=e.s;ha=e.v;Q=e.a;D();b||(ia=na||d.format)}},y=function(){return tinycolor.fromRatio({h:Z,s:ga,v:ha,a:Math.round(100*Q)/100})},C=function(){D();Y.move(y())},D=function(){P.removeClass("sp-validation-error");F();var a=tinycolor({h:Z,s:"1.0",
v:"1.0"});ja.css("background-color",a.toHexString());a=ia;if(1>Q&&("hex"===a||"name"===a))a="rgb";var b=y(),d=b.toHexString(),e=b.toRgbString();o||1===b.alpha?oa.css("background-color",e):(oa.css("background-color","transparent"),oa.css("filter",b.toFilter()));if(B.showAlpha){e=b.toRgb();e.a=0;var e=tinycolor(e).toRgbString(),f="linear-gradient(left, "+e+", "+d+")";s?aa.css("filter",tinycolor(e).toFilter({gradientType:1},d)):(aa.css("background","-webkit-"+f),aa.css("background","-moz-"+f),aa.css("background",
"-ms-"+f),aa.css("background",f))}if(B.showInput){if(1>Q&&("hex"===a||"name"===a))a="rgb";P.val(b.toString(a))}B.showPalette&&q();t()},F=function(){var a=ga*W,b=S-ha*S,a=Math.max(-T,Math.min(W-T,a-T)),b=Math.max(-T,Math.min(S-T,b-T));Aa.css({top:b,left:a});Ba.css({left:Q*pa-Ca/2});Da.css({top:Z*ea-Ea})},E=function(a){var b=y();qa&&M.val(b.toString(ia)).change();var d=!tinycolor.equals(b,R);R=b;O(b);a&&d&&Y.change(b)},G=function(){W=ja.width();S=ja.height();T=Aa.height();ra.width();ea=ra.height();
Ea=Da.height();pa=Fa.width();Ca=Ba.width();H||A.offset(e(A,ba));F()};h=function(){v();sa=!0;M.attr("disabled",!0);ba.addClass("sp-disabled")};var B,J=b.extend({},p,g);J.callbacks={move:k(J.move,this),change:k(J.change,this),show:k(J.show,this),hide:k(J.hide,this),beforeShow:k(J.beforeShow,this)};B=J;var H=B.flat,K=B.showSelectionPalette,I=B.localStorageKey,L=B.theme,Y=B.callbacks,N,ca=G,ta;N=function(){var a=this,b=arguments;ta||(ta=setTimeout(function(){ta=null;ca.apply(a,b)},10))};var X=!1,W=0,
S=0,T=0,ea=0,pa=0,Ca=0,Ea=0,Z=0,ga=0,ha=0,Q=1,J=B.palette.slice(0),da=b.isArray(J[0])?J:[J],U=B.selectionPalette.slice(0),za="sp-dragging",fa=this.ownerDocument,J=fa.body,M=b(this),sa=!1,A=b(r,fa).addClass(L),ja=A.find(".sp-color"),Aa=A.find(".sp-dragger"),ra=A.find(".sp-hue"),Da=A.find(".sp-slider"),aa=A.find(".sp-alpha-inner"),Fa=A.find(".sp-alpha"),Ba=A.find(".sp-alpha-handle"),P=A.find(".sp-input"),xa=A.find(".sp-palette"),ya=A.find(".sp-initial"),Ga=A.find(".sp-cancel"),Ha=A.find(".sp-choose"),
qa=M.is("input"),ua=qa&&!H,V=ua?b("<div class='sp-replacer'><div class='sp-preview'><div class='sp-preview-inner'></div></div><div class='sp-dd'>&#9660;</div></div>").addClass(L):b([]),ba=ua?V:M,oa=V.find(".sp-preview-inner"),ka=B.color||qa&&M.val(),R=!1,na=B.preferredFormat,ia=na,ma=!B.showButtons||B.clickoutFiresChange,L=function(a){a.data&&a.data.ignore?(z(b(this).data("color")),C()):(z(b(this).data("color")),E(!0),C(),v());return!1};s&&A.find("*:not(input)").attr("unselectable","on");n();ua&&
M.hide().after(V);H?M.after(A).hide():b(J).append(A.hide());if(I&&a.localStorage){try{var Ia=a.localStorage[I].split(",#");1<Ia.length&&(delete a.localStorage[I],b.each(Ia,function(a,b){O(b)}))}catch(Ka){}try{U=a.localStorage[I].split(";")}catch(La){}}ba.bind("click.spectrum touchstart.spectrum",function(a){sa||wa();a.stopPropagation();b(a.target).is("input")||a.preventDefault()});(M.is(":disabled")||!0===B.disabled)&&h();A.click(j);P.change(w);P.bind("paste",function(){setTimeout(w,1)});P.keydown(function(a){13==
a.keyCode&&w()});Ga.text(B.cancelText);Ga.bind("click.spectrum",function(a){a.stopPropagation();a.preventDefault();v("cancel")});Ha.text(B.chooseText);Ha.bind("click.spectrum",function(a){a.stopPropagation();a.preventDefault();P.hasClass("sp-validation-error")||(E(!0),v())});l(Fa,function(a,b,d){Q=a/pa;d.shiftKey&&(Q=Math.round(10*Q)/10);C()});l(ra,function(a,b){Z=parseFloat(b/ea);C()},u,va);l(ja,function(a,b){ga=parseFloat(a/W);ha=parseFloat((S-b)/S);C()},u,va);ka?(z(ka),D(),ia=na||tinycolor(ka).format,
O(ka)):D();H&&x();u=s?"mousedown.spectrum":"click.spectrum touchstart.spectrum";xa.delegate(".sp-thumb-el",u,L);ya.delegate(".sp-thumb-el:nth-child(1)",u,{ignore:!0},L);var la={show:x,hide:v,toggle:wa,reflow:G,option:function(a,e){if(a===d)return b.extend({},B);if(e===d)return B[a];B[a]=e;n()},enable:function(){sa=false;M.attr("disabled",false);ba.removeClass("sp-disabled")},disable:h,set:function(a){z(a);E()},get:y,destroy:function(){M.show();ba.unbind("click.spectrum touchstart.spectrum");A.remove();
V.remove();m[la.id]=null},container:A};la.id=m.push(la)-1;h=la;b(this).data("spectrum.id",h.id)})};b.fn.spectrum.load=!0;b.fn.spectrum.loadOpts={};b.fn.spectrum.draggable=l;b.fn.spectrum.defaults=p;b.spectrum={};b.spectrum.localization={};b.spectrum.palettes={};b.fn.spectrum.processNativeColorInputs=function(){var a=b("<input type='color' value='!' />")[0];"color"===a.type&&"!"!=a.value||b("input[type=color]").spectrum({preferredFormat:"hex6"})};var q=function(a){var b,d,e,f,g;if("object"==typeof a&&
a.hasOwnProperty("_tc_id"))return a;d=a;var j=0,k=0,l=0,a=1,m=!1,n=!1;if("string"==typeof d)a:{d=d.replace(C,"").replace(K,"").toLowerCase();var p=!1;if(D[d])d=D[d],p=!0;else if("transparent"==d){d={r:0,g:0,b:0,a:0};break a}d=(b=I.rgb.exec(d))?{r:b[1],g:b[2],b:b[3]}:(b=I.rgba.exec(d))?{r:b[1],g:b[2],b:b[3],a:b[4]}:(b=I.hsl.exec(d))?{h:b[1],s:b[2],l:b[3]}:(b=I.hsla.exec(d))?{h:b[1],s:b[2],l:b[3],a:b[4]}:(b=I.hsv.exec(d))?{h:b[1],s:b[2],v:b[3]}:(b=I.hex6.exec(d))?{r:parseInt(b[1],16),g:parseInt(b[2],
16),b:parseInt(b[3],16),format:p?"name":"hex"}:(b=I.hex3.exec(d))?{r:parseInt(b[1]+""+b[1],16),g:parseInt(b[2]+""+b[2],16),b:parseInt(b[3]+""+b[3],16),format:p?"name":"hex"}:!1}if("object"==typeof d&&(d.hasOwnProperty("r")&&d.hasOwnProperty("g")&&d.hasOwnProperty("b")?(j=255*u(d.r,255),k=255*u(d.g,255),l=255*u(d.b,255),m=!0,n="rgb"):d.hasOwnProperty("h")&&d.hasOwnProperty("s")&&d.hasOwnProperty("v")?(n=d.h,k=d.s,l=d.v,n=6*u(n,360),k=u(k,100),l=u(l,100),j=z.floor(n),m=n-j,n=l*(1-k),b=l*(1-m*k),m=l*
(1-(1-m)*k),p=j%6,j=255*[l,b,n,n,m,l][p],k=255*[m,l,l,b,n,n][p],l=255*[n,n,m,l,l,b][p],m=!0,n="hsv"):d.hasOwnProperty("h")&&(d.hasOwnProperty("s")&&d.hasOwnProperty("l"))&&(j=d.h,n=d.s,l=d.l,k=function(a,b,d){0>d&&(d+=1);1<d&&(d-=1);return d<1/6?a+6*(b-a)*d:0.5>d?b:d<2/3?a+6*(b-a)*(2/3-d):a},j=u(j,360),n=u(n,100),l=u(l,100),0===n?n=l=b=l:(b=0.5>l?l*(1+n):l+n-l*n,m=2*l-b,n=k(m,b,j+1/3),l=k(m,b,j),b=k(m,b,j-1/3)),j=255*n,k=255*l,l=255*b,m=!0,n="hsl"),d.hasOwnProperty("a")))a=d.a;j=E(255,F(j,0));k=E(255,
F(k,0));l=E(255,F(l,0));1>j&&(j=w(j));1>k&&(k=w(k));1>l&&(l=w(l));b=m;d=d&&d.format||n;e=j;f=k;g=l;var o=G(a);return{ok:b,format:d,_tc_id:h++,alpha:o,toHsv:function(){var a=x(e,f,g);return{h:a.h,s:a.s,v:a.v,a:o}},toHsvString:function(){var a=x(e,f,g),b=w(360*a.h),d=w(100*a.s),a=w(100*a.v);return 1==o?"hsv("+b+", "+d+"%, "+a+"%)":"hsva("+b+", "+d+"%, "+a+"%, "+o+")"},toHsl:function(){var a=y(e,f,g);return{h:a.h,s:a.s,l:a.l,a:o}},toHslString:function(){var a=y(e,f,g),b=w(360*a.h),d=w(100*a.s),a=w(100*
a.l);return 1==o?"hsl("+b+", "+d+"%, "+a+"%)":"hsla("+b+", "+d+"%, "+a+"%, "+o+")"},toHex:function(){return v(e,f,g)},toHexString:function(a){return"#"+v(e,f,g,a)},toRgb:function(){return{r:w(e),g:w(f),b:w(g),a:o}},toRgbString:function(){return 1==o?"rgb("+w(e)+", "+w(f)+", "+w(g)+")":"rgba("+w(e)+", "+w(f)+", "+w(g)+", "+o+")"},toName:function(){return ma[v(e,f,g)]||!1},toFilter:function(a,b){var d=v(e,f,g,!0),h=d,j=Math.round(255*G(o)).toString(16),k=j,l=a&&a.gradientType?"GradientType = 1, ":"";
b&&(k=q(b),h=k.toHex(),k=Math.round(255*G(k.alpha)).toString(16));return"progid:DXImageTransform.Microsoft.gradient("+l+"startColorstr=#"+H(j)+d+",endColorstr=#"+H(k)+h+")"},toString:function(a){var a=a||this.format,b=!1;"rgb"===a&&(b=this.toRgbString());"hex"===a&&(b=this.toHexString());"hex6"===a&&(b=this.toHexString(!0));"name"===a&&(b=this.toName());"hsl"===a&&(b=this.toHslString());"hsv"===a&&(b=this.toHsvString());return b||this.toHexString(!0)}}},y=function(a,b,d){var a=u(a,255),b=u(b,255),
d=u(d,255),e=F(a,b,d),f=E(a,b,d),g,h=(e+f)/2;if(e==f)g=f=0;else{var j=e-f,f=0.5<h?j/(2-e-f):j/(e+f);switch(e){case a:g=(b-d)/j+(b<d?6:0);break;case b:g=(d-a)/j+2;break;case d:g=(a-b)/j+4}g/=6}return{h:g,s:f,l:h}},x=function(a,b,d){var a=u(a,255),b=u(b,255),d=u(d,255),e=F(a,b,d),f=E(a,b,d),g,h=e-f;if(e==f)g=0;else{switch(e){case a:g=(b-d)/h+(b<d?6:0);break;case b:g=(d-a)/h+2;break;case d:g=(a-b)/h+4}g/=6}return{h:g,s:0===e?0:h/e,v:e}},v=function(a,b,d,e){a=[H(w(a).toString(16)),H(w(b).toString(16)),
H(w(d).toString(16))];return!e&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0):a.join("")},u=function(a,b){"string"==typeof a&&(-1!=a.indexOf(".")&&1===G(a))&&(a="100%");var d="string"===typeof a&&-1!=a.indexOf("%"),a=E(b,F(0,G(a)));d&&(a*=b/100);return 1E-6>z.abs(a-b)?1:1<=a?a%b/G(b):a},H=function(a){return 1==a.length?"0"+a:""+a},C=/^[\s,#]+/,K=/\s+$/,h=0,z=Math,w=z.round,E=z.min,F=z.max,L=z.random,G=this.parseFloat;
q.fromRatio=function(a){if("object"==typeof a)for(var b in a)1===a[b]&&(a[b]="1.0");return q(a)};q.equals=function(a,b){return!a||!b?!1:q(a).toRgbString()==q(b).toRgbString()};q.random=function(){return q.fromRatio({r:L(),g:L(),b:L()})};q.desaturate=function(a,b){var d=q(a).toHsl();d.s-=(b||10)/100;d.s=E(1,F(0,d.s));return q(d)};q.saturate=function(a,b){var d=q(a).toHsl();d.s+=(b||10)/100;d.s=E(1,F(0,d.s));return q(d)};q.greyscale=function(a){return q.desaturate(a,100)};q.lighten=function(a,b){var d=
q(a).toHsl();d.l+=(b||10)/100;d.l=E(1,F(0,d.l));return q(d)};q.darken=function(a,b){var d=q(a).toHsl();d.l-=(b||10)/100;d.l=E(1,F(0,d.l));return q(d)};q.complement=function(a){a=q(a).toHsl();a.h=(a.h+0.5)%1;return q(a)};q.triad=function(a){var b=q(a).toHsl(),d=360*b.h;return[q(a),q({h:(d+120)%360,s:b.s,l:b.l}),q({h:(d+240)%360,s:b.s,l:b.l})]};q.tetrad=function(a){var b=q(a).toHsl(),d=360*b.h;return[q(a),q({h:(d+90)%360,s:b.s,l:b.l}),q({h:(d+180)%360,s:b.s,l:b.l}),q({h:(d+270)%360,s:b.s,l:b.l})]};
q.splitcomplement=function(a){var b=q(a).toHsl(),d=360*b.h;return[q(a),q({h:(d+72)%360,s:b.s,l:b.l}),q({h:(d+216)%360,s:b.s,l:b.l})]};q.analogous=function(a,b,d){var b=b||6,d=d||30,e=q(a).toHsl(),d=360/d,a=[q(a)];e.h*=360;for(e.h=(e.h-(d*b>>1)+720)%360;--b;)e.h=(e.h+d)%360,a.push(q(e));return a};q.monochromatic=function(a,b){for(var b=b||6,d=q(a).toHsv(),e=d.h,f=d.s,d=d.v,g=[],h=1/b;b--;)g.push(q({h:e,s:f,v:d})),d=(d+h)%1;return g};q.readable=function(a,b){var d=q(a).toRgb(),e=q(b).toRgb();return 10404<
(e.r-d.r)*(e.r-d.r)+(e.g-d.g)*(e.g-d.g)+(e.b-d.b)*(e.b-d.b)};var D=q.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",
darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",
ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",
lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",
oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",
slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},n=q,t=D,ca={},N;for(N in t)t.hasOwnProperty(N)&&(ca[t[N]]=N);var ma=n.hexNames=ca,I;I={rgb:RegExp("rgb[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),
rgba:RegExp("rgba[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hsl:RegExp("hsl[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hsla:RegExp("hsla[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),
hsv:RegExp("hsv[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};this.tinycolor=q;b(function(){b.fn.spectrum.load&&b.fn.spectrum.processNativeColorInputs()})})(window,jQuery);
define("storymaps/ui/loadingIndicator/LoadingIndicator",[],function(){return function(t,n){var r=null,i=0,s=dojo.byId(t),o=dojo.byId(n);this.init=function(){if(this.spinner!=null)return;var e={lines:16,length:7,width:7,radius:30,rotate:0,color:"#000",speed:1.1,trail:25,shadow:!0,hwaccel:!0,className:"spinner",top:4,left:6};r=(new Spinner(e)).spin(s)},this.start=function(){!r&&this.init(),this.itemCount||(r.spin(s),s.style.visibility="visible"),i=1},this.stop=function(){i--,i<=0&&(r.stop(),s.style.visibility="hidden",i=0),o&&(o.style.visibility="hidden")},this.setMessage=function(e,t){o&&(t&&(o.style.marginTop="-50px"),o.innerHTML=e,o.style.visibility="visible")},this.forceHide=function(){s.style.display="none",o&&(o.style.display="none")}}}),define("storymaps/utils/Helper",["dojo/cookie","dojo/has"],function(e,t){return{isMobile:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)||navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/IEMobile/i)},isArcGISHosted:function(e){return document.location.hostname.match(/.arcgis.com$/)||!e&&document.location.hostname.match(/.esri.com$/)},getWebmapID:function(e){var t=esri.urlToObject(document.location.search).query||{};if(configOptions&&configOptions.webmap)return configOptions.webmap;if(this.isArcGISHosted(e))return t.webmap;if(configOptions.authorizedOwners&&configOptions.authorizedOwners.length>0&&configOptions.authorizedOwners[0])return t.webmap},getAppID:function(e){var t=esri.urlToObject(document.location.search).query||{};return this.isArcGISHosted(e)?t.appid:null},getGraphicsLayerByName:function(e,t){var n;for(var r=0;r<e.graphicsLayerIds.length;r++){n=e.getLayer(e.graphicsLayerIds[r]);if(n.name==t)return n}return null},getWebMapExtentFromItem:function(e){if(!e.extent||e.extent.length!=2)return null;var t=esri.geometry.geographicToWebMercator(new esri.geometry.Point(e.extent[0][0],e.extent[0][1])),n=esri.geometry.geographicToWebMercator(new esri.geometry.Point(e.extent[1][0],e.extent[1][1]));return new esri.geometry.Extent({xmax:n.x,xmin:t.x,ymax:n.y,ymin:t.y,spatialReference:{wkid:102100}})},serializeExtentToItem:function(e){if(!e||!e.spatialReference)return null;var t=e.spatialReference.wkid==4326?e:esri.geometry.webMercatorToGeographic(e);return[[Math.round(t.xmin*1e4)/1e4,Math.round(t.ymin*1e4)/1e4],[Math.round(t.xmax*1e4)/1e4,Math.round(t.ymax*1e4)/1e4]]},serializedExtentEquals:function(e,t){return e&&t&&e.length==t.length&&e.length==2&&e[0][0]==t[0][0]&&e[0][1]==t[0][1]&&e[1][0]==t[1][0]&&e[1][1]==t[1][1]},cloneLayer:function(e){return e.url&&e.url.match(/virtualearth\./)?new esri.layers.ArcGISTiledMapServiceLayer("http://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer"):e instanceof esri.layers.ArcGISTiledMapServiceLayer?new esri.layers.ArcGISTiledMapServiceLayer(e.url):e instanceof esri.layers.ArcGISDynamicMapServiceLayer?new esri.layers.ArcGISDynamicMapServiceLayer(e.url):e.id=="OpenStreetMap"?esri.layers.OpenStreetMapLayer():new esri.layers.ArcGISTiledMapServiceLayer("http://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer")},extentToPolygon:function(e){var t=new esri.geometry.Polygon(e.spatialReference);return t.addRing([[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]),t},getFirstLevelWhereExtentFit:function(e,t){var n=t.width,r=t.height,i=t._params.lods;for(var s=i.length-1;s>=0;s--)if(n*t._params.lods[s].resolution>e.getWidth()&&r*t._params.lods[s].resolution>e.getHeight())return s;return-1},getPortalUser:function(){var t=e("esri_auth");return t?JSON.parse(t.replace('"ssl":undefined','"ssl":""')).email:null},getPortalRole:function(){var t=e("esri_auth");return t?JSON.parse(t.replace('"ssl":undefined','"ssl":""')).role:null},prepareWebmapItemForCloning:function(e){dojo.forEach(e.baseMap.baseMapLayers,function(e){delete e.errors,delete e.layerObject,delete e.resourceInfo}),dojo.forEach(e.operationalLayers,function(e){delete e.errors,delete e.layerObject,delete e.resourceInfo,e.featureCollection&&e.featureCollection.layers&&dojo.forEach(e.featureCollection.layers,function(e){delete e.layerObject})})},getWebmapViewerLinkFromSharingURL:function(e){var t=configOptions.sharingurl.split("/").slice(0,3).join("/");return t+"/home/webmap/viewer.html"},browserSupportAttachementUsingFileReader:function(){return!!window.FileReader&&!!window.FormData&&!!this.browserSupportCanvas()&&!!window.Blob},browserSupportCanvas:function(){var e=document.createElement("canvas");return!!e.getContext&&!!e.getContext("2d")},browserSupportFileReaderBinaryString:function(){if(!window.FileReader)return!1;var e=new window.FileReader;return"readAsArrayBuffer"in e},getBinaryStringFromArrayBuffer:function(e){var t=new Uint8Array(e),n="";for(var r=0;r<t.length;r++)n+=String.fromCharCode(t[r]);return n},addCSSRule:function(e){if(t("ie")<=8)return;$("<style>").prop("type","text/css").html(e).appendTo("head")},hex2rgba:function(e,t){var n=e.replace("#","").match(/../g),r=[],i;for(i in n)r.push(parseInt(n[i],16));return r.push(t),"rgba("+r.join()+")"}}}),define("storymaps/utils/MovableGraphic",["dojo/has","dojo/touch","dojo/on"],function(e,t,n){return function(i,s,o,u,a){function c(){var r=dojo.connect(s,"onMouseOver",function(e){e.graphic==o&&i.setMapCursor("move")}),a=dojo.connect(s,"onMouseOut",function(e){e.graphic==o&&i.setMapCursor("default")}),c=n(s._div.rawNode,t.press,function(t){if(t.graphic==o||e("touch")||e("ie")==10)i.disablePan(),f=!0,o.hasBeenMoved=!1}),p=t.release(s._div.rawNode,function(e){i.enablePan(),f=!1,u&&o.hasBeenMoved&&u(o)}),d=e("touch")||e("ie")==10?t.move(i.__container,h):dojo.connect(i,"onMouseDrag",h);l=[r,a,c,p,d]}function h(e){f&&e.mapPoint&&(o.setGeometry(e.mapPoint),a&&!o.hasBeenMoved&&a(o),o.hasBeenMoved=!0)}var f=!1,l=[];c(),this.clean=function(){dojo.forEach(l,function(e){dojo.disconnect(e)})}}}),define("storymaps/maptour/core/FieldConfig",[],function(){return function(t){var n=this,r=t?t.fieldID:null,i=t?t.fieldName:null,s=t?t.fieldDescription:null,o=t?t.fieldURL:null,u=t?t.fieldThumb:null,a=t?t.fieldIconColor:null;this.setIDField=function(e){r=e},this.getIDField=function(){return r},this.setNameField=function(e){return i=e},this.getNameField=function(){return i},this.setDescriptionField=function(e){return s=e},this.getDescriptionField=function(){return s},this.setURLField=function(e){return o=e},this.getURLField=function(){return o},this.setThumbField=function(e){return u=e},this.getThumbField=function(){return u},this.setIconColorField=function(e){return a=e},this.getIconColorField=function(){return a},this.allFieldsFound=function(){return n.getIDField()!=""&&n.getNameField()!=""&&n.getDescriptionField()!=""&&n.getURLField()!=""&&n.getThumbField()!=""&&n.getIconColorField()!=""},this.allCriticalFieldsFound=function(){return n.getNameField()!=""&&n.getDescriptionField()!=""&&n.getIconColorField()!=""},this.allWebmapLayerMandatoryFieldsFound=function(){return n.getIDField()!=""&&n.getNameField()!=""&&n.getDescriptionField()!=""&&n.getURLField()!=""&&n.getThumbField()!=""},this.serialize=function(){return{fieldID:n.getIDField(),fieldName:n.getNameField(),fieldDescription:n.getDescriptionField(),fieldURL:n.getURLField(),fieldThumb:n.getThumbField(),fieldIconColor:n.getIconColorField()}}}}),define("storymaps/maptour/core/WebApplicationData",["storymaps/maptour/core/FieldConfig","dojo/_base/lang"],function(e,t){var n={},r={values:{}};return{set:function(i){n=t.clone(i);if(!i||!i.values)return;i.values.fieldsOverride&&(i.values.fieldsOverride=new e(i.values.fieldsOverride)),r=i},get:function(){var e=t.clone(r);return e.values.fieldsOverride&&(e.values.fieldsOverride=e.values.fieldsOverride.serialize()),e.values.template="Map Tour",e.values.templateVersion=version,e},restoreOriginalData:function(){this.set(n)},getWebmap:function(){return r.values.webmap},getTitle:function(){return r.values.title},setTitle:function(e){r.values.title=e},getSubtitle:function(){return r.values.subtitle},setSubtitle:function(e){r.values.subtitle=e},setFieldsOverride:function(t){r.values.fieldsOverride=new e(t)},getFieldsOverride:function(){return r.values.fieldsOverride},getTourPointOrder:function(){return r.values.order},setTourPointOrder:function(e){r.values.order=[];for(var t=0;t<e.length;t++)r.values.order.push({id:e[t].id,visible:e[t].visible})},setColors:function(e,t,n){r.values.colors=e+";"+t+";"+n},getColors:function(){return r.values.colors?r.values.colors.split(";"):APPCFG.COLORS},setLogoURL:function(e){r.values.logoURL=e},getLogoURL:function(){return r.values.logoURL},setLogoTarget:function(e){r.values.logoTarget=e},getLogoTarget:function(){return r.values.logoTarget},setZoomLevel:function(e){r.values.zoomLevel=e},getZoomLevel:function(){return r.values.zoomLevel},getLayout:function(){return r.values.layout},setLayout:function(e){r.values.layout=e},getHeaderLinkText:function(){return r.values.headerLinkText},getHeaderLinkURL:function(){return r.values.headerLinkURL},setHeaderLink:function(e,t){r.values.headerLinkText=e,r.values.headerLinkURL=t}}}),define("storymaps/maptour/core/MapTourHelper",[],function(){return{isSupportedMedia:function(e){return e.endsWith(".jpg")},getNotFoundMedia:function(){return document.location.protocol+"//"+document.location.host+document.location.pathname.split("/").slice(0,-1).join("/")+"/resources/icons/picture-not-available.png"},getSymbolUrl:function(e,t){e=e?(""+e).toLowerCase():"";var n=APPCFG.PIN_CFG[e]||APPCFG.PIN_CFG[APPCFG.PIN_DEFAULT_CFG];return n.iconPath+t+".png"},getSymbolCss:function(e){e=e?(""+e).toLowerCase():"";var t=APPCFG.PIN_CFG[e]||APPCFG.PIN_CFG[APPCFG.PIN_DEFAULT_CFG];return t.cssClass},getSymbolColors:function(){var e=[];for(var t in APPCFG.PIN_CFG)e.push(t);return e},colorExists:function(e){return e=e?(""+e).toLowerCase():"",APPCFG.PIN_CFG[e]?!0:!1},getDefaultColor:function(){return APPCFG.PIN_DEFAULT_CFG},getSymbolConfig:function(e){return APPCFG.ICON_CFG[e||"normal"]},getSymbol:function(e,t,n){var r=APPCFG.ICON_CFG[n||"normal"],i=new esri.symbol.PictureMarkerSymbol(this.getSymbolUrl(e,t),r.width,r.height);return i.setOffset(r.offsetX,r.offsetY),i},getSymbolMobileClip:function(){return APPCFG.ICON_CFG.normal.clipRules},isModernLayout:function(){return $("body").hasClass("modern-layout")}}}),define("storymaps/maptour/core/TourPointAttributes",["storymaps/maptour/core/WebApplicationData","dojo/_base/lang","storymaps/maptour/core/MapTourHelper"],function(e,t,n){var r=null;return function(s,o,u,a){function d(e){var t=app.data.getSourceLayer();return t.credential&&t.credential.token?e+"?token="+t.credential.token:e}var f=t.clone(s.attributes),l=s,c=o,h=u,p=!0;if(!r||a&&!r.allFieldsFound())r=app.data.electFields(f,c!=null);f&&r&&(this[r.getIDField()]=f[r.getIDField()]),this.getID=function(){return f&&r?f[r.getIDField()]:null},this.getName=function(){if(!f||!r)return null;var t=e.getFieldsOverride(),n=t?t.getNameField():r.getNameField();return f[n]||""},this.getDescription=function(){if(!f||!r)return null;var t=e.getFieldsOverride(),n=t?t.getDescriptionField():r.getDescriptionField();return f[n]||""},this.getColor=function(){if(!f||!r)return null;var t=e.getFieldsOverride(),n=t?t.getIconColorField():r.getIconColorField();return f[n]||""},this.getURL=function(){if(!f||!r)return;if(c)return c;var t=e.getFieldsOverride(),i=t?t.getURLField()?t.getURLField():r.getURLField():r.getURLField();return d(f[i])||n.getNotFoundMedia()},this.setURL=function(t){if(c)c=t;else{var n=e.getFieldsOverride(),i=n?n.getURLField()?n.getURLField():r.getURLField():r.getURLField();f[i]=t}},this.getThumbURL=function(){if(!f||!r)return;if(h)return h;var t=e.getFieldsOverride(),i=t?t.getThumbField()?t.getThumbField():r.getThumbField():r.getThumbField();return d(f[i])||n.getNotFoundMedia()},this.setThumbURL=function(t){if(h)h=t;else{var n=e.getFieldsOverride(),i=n?n.getThumbField()?n.getThumbField():r.getThumbField():r.getThumbField();f[i]=t}},this.getOriginalGraphic=function(){return l},this.getIDField=function(){return r.getIDField()},this.updateNameAndDescription=function(t,n){var i=e.getFieldsOverride(),s=i?i.getNameField():r.getNameField(),o=i?i.getDescriptionField():r.getDescriptionField();f[s]=t,f[o]=n},this.setColor=function(t){var n=e.getFieldsOverride(),i=n?n.getIconColorField():r.getIconColorField();f[i]=t},this.hasBeenUpdated=function(){var t=e.getFieldsOverride(),n=t?t.getNameField():r.getNameField(),i=t?t.getDescriptionField():r.getDescriptionField(),s=t?t.getIconColorField():r.getIconColorField();return f[n]!=l.attributes[n]||f[i]!=l.attributes[i]||f[s]!=l.attributes[s]},this.commitUpdate=function(){var t=e.getFieldsOverride(),n=t?t.getNameField():r.getNameField(),i=t?t.getDescriptionField():r.getDescriptionField(),s=t?t.getIconColorField():r.getIconColorField();l.attributes[n]=f[n],l.attributes[i]=f[i],l.attributes[s]=f[s]},this.restoreOriginal=function(){f=t.clone(l.attributes)},this.getFieldsConfig=function(){return r},this.getTourVisibility=function(){return p},this.setTourVisibility=function(e){p=e}}}),define("storymaps/maptour/core/TourData",["storymaps/maptour/core/WebApplicationData","storymaps/maptour/core/TourPointAttributes","storymaps/maptour/core/FieldConfig","storymaps/utils/Helper"],function(e,t,n,r){return function(){function b(e,t,n,r){var i=app.data.getSourceLayer().url+"/"+e+"/attachments/"+t,o=app.data.getSourceLayer().url+"/"+e+"/attachments/"+n;s.getCurrentAttributes().setURL(i),s.getCurrentAttributes().setThumbURL(o);if(s.isFSWithURLFields()){var u=s.getFieldsConfig(),a=s.getFieldsConfig(!0),f=s.getCurrentGraphic().getUpdatedFeature();f.attributes[u.getURLField()||a.getURLField()]=i,f.attributes[u.getThumbField()||a.getThumbField()]=o,app.builder.updateFSTourPoint(f,function(e){r(!0),dojo.publish("CORE_UPDATE_UI")},function(){r(!1)})}else r(!0),dojo.publish("CORE_UPDATE_UI")}function w(e,t,n){var r=app.data.getSourceLayer().url+"/"+e+"/attachments/"+t;s.getCurrentAttributes().setThumbURL(r);if(s.isFSWithURLFields()){var i=s.getFieldsConfig(),o=s.getFieldsConfig(!0),u=s.getCurrentGraphic().getUpdatedFeature();u.attributes[i.getThumbField()||o.getThumbField()]=r,app.builder.updateFSTourPoint(u,function(e){n(!0),dojo.publish("CORE_UPDATE_UI")},function(){n(!1)})}else n(!0),dojo.publish("CORE_UPDATE_UI")}function E(e,n,r,i,o,u){var a=s.getFieldsConfig(),f=s.getFieldsConfig(!0),l=app.data.getSourceLayer().url+"/"+e+"/attachments/"+r,c=app.data.getSourceLayer().url+"/"+e+"/attachments/"+i;n.attributes[a.getIDField()]=e,s.isFSWithURLFields()?(n.attributes[a.getURLField()||f.getURLField()]=l,n.attributes[a.getThumbField()||f.getThumbField()]=c,app.builder.updateFSTourPoint(new esri.Graphic(n.geometry,null,n.attributes),function(r){n.attributes=new t(n),S(e,n,o)},u)):(n.attributes=new t(n,l,c),S(e,n,o))}function S(t,n,r){l.push(n);var i={id:t,visible:!0};app.data.getTourLayer().add(n),p.push(n.attributes.getID()),e.setTourPointOrder(c.concat(i)),C(T()),app.data.setCurrentPointByGraphic(n),app.builder.incrementSaveCounter(),dojo.publish("CORE_UPDATE_UI"),r()}function x(){var e=[];return $.each(l,function(t,n){e.push({id:n.attributes.getID(),index:t,order:t,visible:!0})}),e=e.sort(function(e,t){return e.id-t.id}),e}function T(){var t=e.getTourPointOrder();return N(t)}function N(e){var t=[],n=[];return $.each(l,function(n,r){var i=r.attributes.getID(),s=-1;$.each(e,function(e,t){if(t.id==i)return s=e,!0}),s>-1&&t.push({id:i,index:n,order:s,visible:e[s].visible})}),t=t.sort(function(e,t){return e.order-t.order}),t}function C(t){c=t,h=[],$.each(c,function(e,t){l[t.index].attributes.setTourVisibility(t.visible),h.push(l[t.index])}),e.setTourPointOrder(c)}function k(e,t){for(var n=0;n<t.length;n++)for(var r in e)if(r.toLowerCase()==t[n].toLowerCase())return r;return""}function L(e,t){for(var n=0;n<t.length;n++)for(var r=0;r<e.length;r++)if(e[r].name.toLowerCase()==t[n].toLowerCase())return e[r].name;return""}var s=this,o=null,u=null,a=null,f=null,l=null,c=null,h=null,p=[],d=[],v=null,m=-1,g=null,y=!1;this.initialExtentHasBeenEdited=!1,this.getWebMapItem=function(){return o},this.setWebMapItem=function(e){o=e},this.getAppItem=function(){return u||{}},this.setAppItem=function(e){u=e},this.getSourceLayer=function(){return a},this.setSourceLayer=function(e){a=e},this.getTourLayer=function(){return f},this.setTourLayer=function(e){f=e},this.getTourPoints=function(e){return e?h:$.grep(h,function(e){return e.attributes.getTourVisibility()})},this.getAllFeatures=function(){var e=$.grep(l,function(e){var t=$.grep(d,function(t){return t.attributes.getID()==e.attributes.getID()});return h.indexOf(e)==-1&&!t.length});return $.each(e,function(e,t){t.attributes.setTourVisibility(!1)}),h.concat(e)},this.setTourPoints=function(t){l=t,e.getTourPointOrder()?C(T()):C(x())},this.getCurrentGraphic=function(){return v},this.getCurrentIndex=function(){return m},this.getCurrentAttributes=function(){return v?v.attributes:null},this.getCurrentId=function(){return v?v.attributes.getID():null},this.setCurrentPointByGraphic=function(e){v=e,m=$.inArray(e,h)},this.setCurrentPointByIndex=function(e){v=this.getTourPoints(!1)[e],m=e},this.setIntroData=function(e){g=e},this.getIntroData=function(){return g},this.setMaxAllowedFeatureReached=function(e){y=e},this.getMaxAllowedFeatureReached=function(){return y},this.getFeatureIDField=function(){return l&&l[0]?l[0].attributes.getIDField():this.sourceIsFS()?app.data.getSourceLayer().objectIdField:this.sourceIsWebmap()?app.data.getSourceLayer().objectIdField||"__OBJECTID":null},this.getNbPoints=function(){return h?h.length:0},this.sourceIsFS=function(){return a instanceof esri.layers.FeatureLayer&&a.url!=null},this.sourceIsWebmap=function(){return a instanceof esri.layers.FeatureLayer&&a.url==null},this.hasBeenAdded=function(e){var t=$.grep(l,function(e,t){return p.indexOf(e.attributes.getID())!=-1});return t.length!=0},this.getDroppedPoints=function(){return d},this.userIsAppOwnerOrAdmin=function(){return r.getPortalRole()=="account_admin"||r.getPortalUser()!=null&&r.getPortalUser()==this.getAppItem().owner},this.userIsOrgaPublisher=function(){var e=app.portal?app.portal.getPortalUser():null;return e&&e.orgId&&(e.role=="org_admin"||e.role=="org_publisher")},this.addTourPointUsingData=function(e,t,n,r,i,s,o,u){if(e==null||!t||!r||!i||!s)return!1;var a=this.getFieldsConfig(),f={};f[a.getNameField()]=t,f[a.getDescriptionField()]=n,f[a.getIconColorField()]=r;var l=new esri.Graphic(e,null,f);app.builder.addFSNewTourPointUsingData(l,i,s,function(e,t,n,r){e?E(t,l,n,r,o,u):u()})},this.addTemporaryTourPointUsingForm=function(e,t,n){var r=this.getFieldsConfig(),i={};i[r.getNameField()]="",i[r.getDescriptionField()]="",i[r.getIconColorField()]="",app.builder.addTemporaryTourPointUsingForm(new esri.Graphic(new esri.geometry.Point(0,0),null,i),e,function(e,r,i){e?t(r,i,app.data.getSourceLayer().url+"/"+r+"/attachments/"+i):n()})},this.saveTemporaryTourPointUsingForm=function(e,t,n,r,i,s,o,u,a){if(e==null||t==null||!n||!i||!o)return!1;var f=this.getFieldsConfig(),l={};l[f.getIDField()]=e,l[f.getNameField()]=n,l[f.getDescriptionField()]=r,l[f.getIconColorField()]=i;var c=new esri.Graphic(t,null,l);app.builder.saveTemporaryTourPointUsingForm(e,c,o,function(e,t,n){e?E(t,c,s,n,u,a):a()})},this.changeCurrentPointPicAndThumbUsingData=function(e,t,n){app.builder.changePicAndThumbUsingData(this.getCurrentAttributes().getID(),e,t,function(e,t,r,i){e?b(t,r,i,n):n(!1)})},this.changeCurrentPointThumbnailUsingData=function(e,t){app.builder.changeThumbnailUsingData(this.getCurrentAttributes().getID(),e,function(e,n,r){e?w(n,r,t):t(!1)})},this.changeCurrentPointPicAndThumbUsingForm=function(e,t,n){app.builder.changePicAndThumbUsingForm(this.getCurrentAttributes().getID(),e,t,function(e,t,r,i){e?b(t,r,i,n):n(!1)})},this.updateTourPointsOrder=function(e){var t=[],n=$.grep(e,function(e){var n=$.grep(c,function(t){return t.id==e.id});return(n.length||!n.length&&e.visible)&&t.push(e),e.visible&&!n.length});$.each(n,function(e,t){var n=$.grep(l,function(e){return e.attributes.getID()==t.id});n&&app.data.getTourLayer().add(n[0])}),C(N(t)),this.getTourPoints().length==0&&app.data.setCurrentPointByIndex(-1),dojo.publish("CORE_UPDATE_UI")},this.dropTourPoints=function(e){h=$.grep(h,function(t,n){return e.indexOf(t.attributes.getID())>-1?(e.splice(e.indexOf(t.attributes.getID()),1),d.push(t),!1):!0}),$.each(e,function(e,t){$.each(l,function(e,n){t==n.attributes.getID()&&d.push(n)})})},this.discardChanges=function(){h=$.grep(h,function(e,t){return p.indexOf(e.attributes.getID())==-1}),C(T())},this.updateAfterSave=function(){l=$.grep(l,function(e,t){return d.indexOf(e.attributes.getID())==-1}),d=[],p=[],C(T()),app.data.initialExtentHasBeenEdited=!1},this.updateCurrentTourPoint=function(e,t){v.attributes.updateNameAndDescription(e,t),dojo.publish("CORE_SELECTED_TOURPOINT_UPDATE",{index:m,name:e,description:t,color:v.attributes.getColor()})},this.updateCurrentTourPointColor=function(e){v.attributes.setColor(e),dojo.publish("CORE_SELECTED_TOURPOINT_UPDATE",{index:m,color:v.attributes.getColor()})},this.electFields=function(e){return console.log("TourData - electFields"),new n({fieldID:k(e,APPCFG.FIELDS_CANDIDATE.objectid)||app.data.getSourceLayer().objectIdField,fieldName:k(e,APPCFG.FIELDS_CANDIDATE.name),fieldDescription:k(e,APPCFG.FIELDS_CANDIDATE.description),fieldURL:k(e,APPCFG.FIELDS_CANDIDATE.pic_url),fieldThumb:k(e,APPCFG.FIELDS_CANDIDATE.thumb_url),fieldIconColor:k(e,APPCFG.FIELDS_CANDIDATE.color)})},this.getFieldsConfig=function(t){if(!t&&e.getFieldsOverride())return e.getFieldsOverride();var n=this.getTourPoints()[0];return n&&n.attributes?n.attributes.getFieldsConfig():this.electFields(app.data.getSourceLayer().templates[0].prototype.attributes)},this.isFSWithURLFields=function(){var e=app.data.getSourceLayer().fields;return L(e,APPCFG.FIELDS_CANDIDATE["pic_url"])!=""&&L(e,APPCFG.FIELDS_CANDIDATE["thumb_url"])!=""},this.getWebAppData=function(){return e.get()}}}),define("storymaps/maptour/core/FeatureServiceManager",["esri/layers/FeatureLayer","storymaps/maptour/core/TourPointAttributes","storymaps/maptour/core/MapTourHelper"],function(e,t,n){return function(){function o(e,t,n){n.geometry!=null&&(i++,e.queryAttachmentInfos(n.attributes[t],function(e){u(n,e)},function(e){a(n,e)}))}function u(e,o){s++;if(o&&o.length>=2){var u=o[0].id<o[1].id?o[0]:o[1],a=o[0].id>o[1].id?o[0]:o[1];if(n.isSupportedMedia(u.name)&&n.isSupportedMedia(a.name)){var l=new esri.Graphic(new esri.geometry.Point(e.geometry.x,e.geometry.y,e.geometry.spatialReference),null,new t(e,u.url,a.url));r.push(l)}}s==i&&f()}function a(e,t){console.error(i18n.viewer.errors.featureServiceLoad,index,e,s,i),s++,s==i&&f()}function f(){setTimeout(function(){dojo.publish("FS_MANAGER_LAYER_LOADED",{graphics:r})},0)}var r=[],i=0,s=0;this.process=function(e,n){if(n||!e.hasAttachments){for(var i=0;i<e.graphics.length;i++){var s=e.graphics[i],u=new esri.Graphic(new esri.geometry.Point(s.geometry.x,s.geometry.y,s.geometry.spatialReference),null,new t(s));r.push(u)}f()}else{for(var i=0;i<e.graphics.length;i++)o(e,app.data.getSourceLayer().objectIdField,e.graphics[i]);e.graphics.length==0&&f()}}}}),define("storymaps/ui/inlineFieldEdit/InlineFieldEdit",["dojo/has"],function(e){return function(n,r,i){function o(e,t,n){if(!e||!t||!n)return;typeof r=="function"&&r(),s=n,t.parent().parent().addClass("isEditing"),t.hide(),e.hide(),n.val(t.html()),n.show(),n.select()}function u(t){if(!t||!t.get(0))return;s=null;var n=t.get(0).value,r=t.parent().find(".text_edit_label"),o=t.parent().find(".text_edit_icon"),u=r.parent().first();r.parent().parent().removeClass("isEditing"),r.html(n),r.show(),t.hide(),o.css("display","inline-block"),e("ios")&&document.activeElement.blur(),typeof i=="function"&&i(u,n)}var s=null;$(n+" .text_edit_icon").click(function(){o($(this),$(this).parent().find(".text_edit_label"),$(this).parent().find(".text_edit_input"))}),$(n+" .text_edit_label").click(function(){o($(this).parent().find(".text_edit_icon"),$(this),$(this).parent().find(".text_edit_input"))}),$(n+" .text_edit_input").blur(function(){u($(this))}),e("ios")&&$("body").bind("touchstart",function(e){s&&e.target!=s.get(0)&&u(s)}),$(n+" .text_edit_input").keypress(function(e){var t=e.keyCode?e.keyCode:e.which;t=="13"&&u($(this))})}}),define("storymaps/maptour/ui/Header",["storymaps/ui/inlineFieldEdit/InlineFieldEdit","dojo/has"],function(e,t){return function(r,i){function o(e){$("#headerMobile .banner").slideDown(e===!0?0:250)}function u(){s||$("#builderPanel",r).fadeOut("fast"),s=!1}function a(e,n){s=!0,setTimeout(function(){s&&$("#builderPanel",r).fadeIn("fast"),s=!1},t("ios")||t("ie")==10?500:100),setTimeout(function(){dojo.publish("HEADER_EDITED",{src:$(e).attr("class"),value:n})},t("ios")||t("ie")==10?700:0)}var s=!1;this.init=function(t,n,s,f,l,c,h,p){this.setColor(s),this.setLogoInfo(f,l),$(r+" #headerMobile .title").html(t),$(r+" #headerMobile .subtitle").html(n),i&&($(r).addClass("isBuilder"),t="<p class='text_edit_label'>"+(t||i18n.viewer.headerJS.editMe)+"</p>",t+="<div class='text_edit_icon' title='"+i18n.viewer.headerJS.templateTitle+"'></div>",t+="<textarea rows='1' class='text_edit_input' type='text'></textarea>",n="<span class='text_edit_label'>"+(n||i18n.viewer.headerJS.editMe)+"</span>",n+="<div class='text_edit_icon' title='"+i18n.viewer.headerJS.templateSubtitle+"'></div>",n+="<textarea rows='2' class='text_edit_input' type='text'></textarea>"),$(r+" #headerDesktop .title").html(t),$(r+" #headerDesktop .subtitle").html(n),i&&new e(r,u,a),!i&&!n&&$(r+" #headerDesktop .title").css("margin-top","22px"),$(window).scroll(this.hideMobileBanner),$("#headerMobile .banner").fastClick(this.hideMobileBanner),$("#openHeaderMobile").fastClick(o),$(".navBar span").fastClick(function(){$(this).hasClass("current")||(location.hash=$(this).data("viewid"))}),c&&($(r+" .switchBuilder").fastClick(this.switchToBuilder),$(r+" .switchBuilder").show()),o(!0),this.setTopRightLink(h,p),$(r).css("display","block")},this.hideMobileBanner=function(e){$("#headerMobile .banner").slideUp(e===!0?0:250),$("#openHeaderMobile").css("top","41px"),$("#headerMobile").removeClass("firstDisplay")},this.mobileHeaderIsInFirstState=function(){return $("#headerMobile").hasClass("firstDisplay")},this.setColor=function(e){$(r).css("background-color",e),$(r+" #builderPanel").css("background-color",e),$(r+" #headerMobile").css("background-color",e),$("#openHeaderMobile").css("background-color",e)},this.setLogoInfo=function(e,t){!e||e=="NO_LOGO"?$(r+" .logo img").hide():($(r+" .logo img").attr("src",e),t?($(r+" .logo img").closest("a").css("cursor","pointer"),$(r+" .logo img").closest("a").attr("href",t)):$(r+" .logo img").closest("a").css("cursor","default"),$(r+" .logo img").show())},this.setTopRightLink=function(e,t){t?$(r+" .social .msLink").html(e?'<a href="'+t+'" target="_blank">'+e+"</a>":""):e?$(r+" .social .msLink").html("<span>"+e+"</a>"):$(r+" .social .msLink").html("")},this.switchToBuilder=function(){document.location.search.match(/appid/)?document.location=document.location.protocol+"//"+document.location.host+document.location.pathname+document.location.search+"&edit"+document.location.hash:document.location.search.slice(-1)=="?"?document.location=document.location.protocol+"//"+document.location.host+document.location.pathname+"edit"+document.location.hash:document.location=document.location.protocol+"//"+document.location.host+document.location.pathname+"?edit"+document.location.hash},this.initLocalization=function(){dojo.byId("closeHeaderMobile").innerHTML=i18n.viewer.mobileHTML.hideIntro,dojo.byId("openHeaderMobile").innerHTML=i18n.viewer.mobileHTML.showIntro,dojo.byId("listViewLink").innerHTML=i18n.viewer.mobileHTML.navList,dojo.byId("mapViewLink").innerHTML=i18n.viewer.mobileHTML.navMap,dojo.byId("infoViewLink").innerHTML=i18n.viewer.mobileHTML.navInfo,dojo.query(".msLink")[0].innerHTML=i18n.viewer.desktopHTML.storymapsText,dojo.query(".switchBuilder")[0].innerHTML='<div><img src="resources/icons/builder-edit-fields.png" /></div>'+i18n.viewer.desktopHTML.builderButton}}}),define("storymaps/maptour/ui/MapCommand",["dojo/has"],function(e){return function(n,r,i){function o(){navigator.geolocation.getCurrentPosition(function(e){i(!0,new esri.geometry.Point(e.coords.longitude,e.coords.latitude),e)},u)}function u(e){i(!1,e)}var s=$('<div class="esriSimpleSliderIncrementButton"><img style="vertical-align: -2px;" src="resources/icons/mapcommand-home.png"></div>');s.fastClick(function(){r&&typeof r=="function"?r(n._params.extent):n.setExtent(n._params.extent)}),$(n.container).find(".esriSimpleSlider div:nth-child(1)").after(s),navigator&&navigator.geolocation&&i&&typeof i=="function"&&($(".esriSimpleSlider",n.container).after('<div id="mainMap_zoom_location" class="esriSimpleSlider esriSimpleSliderVertical mapCommandLocation"><div><img src="resources/icons/mapcommand-location.png"></div></div>'),$("#mainMap_zoom_location div",n.container).fastClick(o)),e("touch")&&$(".esriSimpleSlider",n.container).addClass("touch"),this.setMobile=function(e){$(".esriSimpleSlider",n.container).toggleClass("touch",e)}}}),define("storymaps/ui/multiTips/MultiTips",["dojo/dom-style","dojo/dom-construct"],function(e,t){return function(r){function u(e){i=dojo.mixin({pointArray:[],map:null,attributeLabelField:"",content:"",zoomToPoints:!1,backgroundColor:"#000000",pointerColor:"#000000",textColor:"#ffffff",minWidth:"",labelDirection:"auto",offsetTop:8,offsetSide:3,offsetBottom:8,mapAuthorizedWidth:-1,mapAuthorizedHeight:-1,visible:!0},e),e.mapAuthorizedWidth==-1&&(i.mapAuthorizedWidth=i.map.width),e.mapAuthorizedHeight==-1&&(i.mapAuthorizedHeight=i.map.height),a(e.map.container)}function a(n,r){f();var u=dojo.connect(i.map,"onZoomStart",function(){h()}),a=dojo.connect(i.map,"onZoomEnd",function(e){l(e,!0)}),p=dojo.connect(i.map,"onPan",function(e,t){if(!t.x&&!t.y)return;s||c(e,t)}),d=dojo.connect(i.map,"onExtentChange",function(e,t){if(t&&t.x==0&&t.y==0)return;s||l(e,!0)});r&&(i.visible=!0),dojo.forEach(i.pointArray,function(r,s){t.place("<div id='arrow"+s+"' class='mtArrow'></div><div id='multiTip"+s+"' class='multiTip'></div>",n,"last"),dojo.query("#multiTip"+s)[0].innerHTML=i.content,e.set("multiTip"+s,{backgroundColor:i.backgroundColor,color:i.textColor,padding:"5px",position:"absolute"}),i.minWidth&&e.set("multiTip"+s,"minWidth",i.minWidth+"px"),e.set("arrow"+s,{position:"absolute",width:"0px",height:"0px"});if(i.map.extent.contains(r.geometry)){var o=i.map.toScreen(r.geometry);v(o,s,i)}}),o=[u,a,p,d]}function f(){s=!1,dojo.forEach(o,function(e){dojo.disconnect(e)}),dojo.query(".multiTip").forEach(dojo.destroy),dojo.query(".mtArrow").forEach(dojo.destroy)}function l(e,t){dojo.forEach(i.pointArray,function(n,r){e.contains(n.geometry)&&(d(r)||t)?v(i.map.toScreen(n.geometry),r,i):p(r)})}function c(e,t){dojo.forEach(i.pointArray,function(n,r){if(e.contains(n.geometry)){var s=i.map.toScreen(n.geometry);s.x+=t.x,s.y+=t.y,v(s,r,i)}else p(r)})}function h(){dojo.query(".multiTip, .mtArrow").forEach(function(e){e.style.display="none"})}function p(e){if(dojo.style(dojo.byId("multiTip"+e),"display")=="none")return;dojo.style(dojo.byId("multiTip"+e),"display","none"),dojo.style(dojo.byId("arrow"+e),"display","none")}function d(e){return dojo.style(dojo.byId("multiTip"+e),"display")=="block"}function v(t,n,r){if(t.x>r.mapAuthorizedWidth||t.y>r.mapAuthorizedHeight){p(n);return}var i=e.get("multiTip"+n,"width"),s=e.get("multiTip"+n,"height");if(!i||!s)dojo.style(dojo.byId("multiTip"+n),"display",r.visible?"block":"none"),dojo.style(dojo.byId("arrow"+n),"display",r.visible?"block":"none"),i=e.get("multiTip"+n,"width"),s=e.get("multiTip"+n,"height");r.minWidth&&i<r.minWidth&&(i=r.minWidth);if(r.labelDirection!="auto")r.labelDirection=="left"?b(t,n,r,i,s):r.labelDirection=="right"?y(t,n,r,i,s):r.labelDirection=="down"?m(t,n,r,i,s):g(t,n,r,i,s);else if(t.x<i/2+25+r.offsetSide+r.topLeftNotAuthorizedArea[0]&&t.y<r.topLeftNotAuthorizedArea[1]+s){if(t.y<s-15||t.x<35+r.topLeftNotAuthorizedArea[0]&&t.y<r.topLeftNotAuthorizedArea[1]){p(n);return}y(t,n,r,i,s)}else if(t.x<i/2+25+r.offsetSide){if(t.y<s-15||t.y>r.mapAuthorizedHeight-s/2-10){p(n);return}y(t,n,r,i,s)}else if(t.x>r.mapAuthorizedWidth-i/2-10){if(t.y<s-15||t.y>r.mapAuthorizedHeight-s/2-10){p(n);return}b(t,n,r,i,s)}else t.y>s+25+r.offsetTop?g(t,n,r,i,s):m(t,n,r,i,s);dojo.style(dojo.byId("multiTip"+n),"display",r.visible?"block":"none"),dojo.style(dojo.byId("arrow"+n),"display",r.visible?"block":"none")}function m(t,n,r,i,s){e.set("multiTip"+n,{top:t.y+10+r.offsetBottom+"px",left:t.x-i/2-5+"px"}),e.set("arrow"+n,{left:t.x-10+"px",top:t.y+r.offsetBottom+"px",borderLeft:"10px solid transparent",borderRight:"10px solid transparent",borderBottom:"10px solid",borderBottomColor:r.pointerColor,borderTop:"none"})}function g(t,n,r,i,s){e.set("multiTip"+n,{top:t.y-s-24-r.offsetTop+"px",left:t.x-i/2-5+"px"}),e.set("arrow"+n,{left:t.x-10+"px",top:t.y-10-r.offsetTop+"px",borderLeft:"10px solid transparent",borderRight:"10px solid transparent",borderTop:"10px solid",borderTopColor:r.pointerColor,borderBottom:"none"})}function y(t,n,r,i,s){e.set("multiTip"+n,{top:t.y-12-(s-10)/2+"px",left:t.x+10+r.offsetSide+"px"}),e.set("arrow"+n,{left:t.x+r.offsetSide+"px",top:t.y-10+"px",borderTop:"10px solid transparent",borderBottom:"10px solid transparent",borderRight:"10px solid",borderRightColor:r.pointerColor,borderLeft:"none"})}function b(t,n,r,i,s){e.set("multiTip"+n,{top:t.y-12-(s-10)/2+"px",left:t.x-24-i-r.offsetSide+"px"}),e.set("arrow"+n,{left:t.x-10-r.offsetSide+"px",top:t.y-10+"px",borderTop:"10px solid transparent",borderBottom:"10px solid transparent",borderLeft:"10px solid",borderLeftColor:r.pointerColor,borderRight:"none"})}var i=null,s=!1,o=[];u(r),this.current=function(){return i.pointArray},this.clean=function(){i=null,f()},this.hide=function(){s=!0,h()},this.show=function(){if(!i)return;s=!1,i.visible=!0,l(i.map.extent,!0)}}}),define("storymaps/maptour/ui/desktop/Carousel",["dojo/has","storymaps/utils/Helper","storymaps/maptour/core/MapTourHelper"],function(e,t,n){return function(i){function f(t,r){s=n.isModernLayout()?156:161;var f="";$(t).each(function(e,t){var r=n.getSymbolCss(t.attributes.getColor());f+="<li>",f+=' <div class="carousel-item-div">',f+='  <span class="'+r+'"><img src="'+t.attributes.getThumbURL()+'" onerror="mediaNotFoundHandler(this)"/></span>',f+="  <div>"+t.attributes.getName()+"</div>",f+=" </div>",f+="</li>"}),$(i+" .carouselScroller").css("width",t.length*s+"px"),$(i+" .carouselScroller ul").html(f),$(i+" .carouselWrapper").mousemove(function(e){a.onMove[0]=e.screenX,a.onMove[1]=e.screenY}),o=new iScroll($(i+" .carouselWrapper")[0],{hideScrollbar:!0,onBeforeScrollMove:function(e){if(Math.abs(a.onScroll[0]-e.screenX)>5||Math.abs(a.onScroll[1]-e.screenY)>5)u=!0;p()},onScrollStart:function(e){a.onScroll=[a.onMove[0],a.onMove[1]]},onBeforeScrollEnd:function(){e("touch")&&(u=!1)},onScrollEnd:p})}function l(e){$(i).click(c),dojo.subscribe("CORE_SELECTED_TOURPOINT_UPDATE",d)}function c(e){if(!e||!e.target)return;e.target.className=="arrowLeft"?v(-1):e.target.className=="arrowRight"?v(1):setTimeout(function(){h(e)},50)}function h(e){var t=$(e.target).closest("li").index();!u&&t!=-1&&dojo.publish("CAROUSEL_CLICK",t),u=!1}function p(e){if(!o)return;if(o.x==o.maxScrollX||o.x==0)u=!1;o.x>-25?$(i+" .arrowLeft").addClass("disabled"):$(i+" .arrowLeft").removeClass("disabled").attr("src","resources/icons/carousel-left.png"),o.scrollerW+o.x-o.wrapperW<25?$(i+" .arrowRight").addClass("disabled"):$(i+" .arrowRight").removeClass("disabled").attr("src","resources/icons/carousel-right.png")}function d(e){var t=$(i+" .carouselScroller li:nth-child("+(e.index+1)+")");t.find(".carousel-item-div > div").html(e.name),t.find(".carousel-item-div > span").attr("class",n.getSymbolCss(e.color))}function v(e){var t=Math.floor(o.wrapperW/s)+1;g(o.x-e*t*s,t)}function m(e){if(!o)return;var t=Math.ceil(Math.abs(o.x/s))+1,n=Math.floor(Math.abs((o.x-o.wrapperW-15)/s));if(e+1>=t&&e+1<=n)return;t==1&&n==0?($(i+" .carousel-item-div").css("visibility","hidden"),setTimeout(function(){g(Math.max(-e*s),Math.abs(t-e),!0),$(i+" .carousel-item-div").css("visibility","visible")},0)):g(Math.max(-e*s),Math.abs(t-e))}function g(e,t,n){var r=Math.max(Math.min(0,e),o.maxScrollX);o.scrollerW+e-s>0&&(r=Math.ceil(r/s)*s),o.scrollTo(r,0,n?0:Math.min(2e3,Math.max(500,t*150)))}function y(e,r){$("#footer, #builderPanel2").css("background-color",t.hex2rgba(e,n.isModernLayout()?.85:1)),r!="rgb(125, 125, 125)"&&t.addCSSRule(".carouselScroller.no-touch .carousel-item-div:not(.selected):hover { background-color: "+r+" !important; }")}var s=161,o=null,u=!1,a={onMove:[-1,-1],onScroll:[-1,-1]};this.init=function(t,n,r){y(n,r),f(t),l(t),e("touch")||$(i+" .carouselScroller").addClass("no-touch")},this.update=function(e,t,n){y(t,n),o.destroy(),f(e),p()},this.resize=function(){p()},this.setSelectedIndex=function(e){if(e==null)return;$(i+" .carousel-item-div").removeClass("selected"),$(i+" .carousel-item-div:nth("+e+")").addClass("selected"),m(e),p()},this.checkItemIsVisible=function(e){if(!o)return;m(e)}}}),define("storymaps/ui/crossfader/CrossFader",["storymaps/ui/inlineFieldEdit/InlineFieldEdit","storymaps/ui/loadingIndicator/LoadingIndicator","storymaps/maptour/core/MapTourHelper"],function(e,t,n){return function(i,s){function b(e){m=a.naturalWidth,g=a.naturalHeight;if(m==null){var t=new Image;t.src=$(a).attr("src"),m=t.width,g=t.height}w(),S(),dojo.publish("CROSSFADER_CHANGE",[m,g])}function w(){var e=$(u).width()-6,t=$(u).height(),n=m/g,r=e/t;n>r?($(a).width(e),$(a).height(e/n)):($(a).height(t),$(a).width(t*n)),$(a).css("left",(e-$(a).width())/2),$(a).css("top",(t-$(a).height())/2),E()}function E(){$(d).css("bottom",($(u).outerHeight()-o.currentHeight())/2),n.isModernLayout()?($(d).css("left",($(u).width()-o.currentWidth())/2-1),$(d).css("width",o.currentWidth()-2)):($(d).css("left",($(u).width()-o.currentWidth())/2+3),$(d).css("width",o.currentWidth()-6))}function S(e){$(a).addClass("current"),$(f).removeClass("current"),$(a).fadeTo("slow",1),$(f).fadeTo("slow",0),setTimeout(function(){h.stop()},100)}function x(t,n){if(s){var r=descrLength=-1;$.each(app.data.getSourceLayer().fields,function(e,t){t.alias==app.data.getFieldsConfig().getNameField()&&(r=t.length),t.alias==app.data.getFieldsConfig().getDescriptionField()&&(descrLength=t.length)}),t="<p class='text_edit_label'>"+(t||i18n.viewer.headerJS.editMe)+"</p>",t+="<div class='text_edit_icon' title='"+i18n.viewer.crossFaderJS.setPicture+"'></div>",t+="<textarea rows='3' class='text_edit_input' type='text' "+(r?"maxlength='"+r+"'":"")+"></textarea>",n="<p class='text_edit_label'>"+(n||i18n.viewer.headerJS.editMe)+"</p>",n+="<div class='text_edit_icon' title='"+i18n.viewer.crossFaderJS.setCaption+"'></div>",n+="<textarea rows='6' class='text_edit_input' type='text' "+(descrLength?"maxlength='"+descrLength+"'":"")+"></textarea>"}$(p).empty(),$(p).append("<div class='name'>"+t+"<div/>"),$(p).append("<div class='description'>"+n+"<div/>"),s&&new e(i,null,T)}function T(e,t){dojo.publish("CROSSFADER_DATA_UPDATE")}var o=this,u=$(i),a,f,l,c,h=new t("pictureLoadingIndicator"),p,d,v,m=1,g=1,y=navigator.appVersion.indexOf("MSIE 7.0")>-1||navigator.appVersion.indexOf("MSIE 8.0")>-1;l=document.createElement("img"),$(l).addClass("member-image"),$(l).error(function(){mediaNotFoundHandler(this)}),c=document.createElement("img"),$(c).addClass("member-image"),$(c).error(function(){mediaNotFoundHandler(this)}),_placardContainer2=$("<div id='placard-bg'></div>"),p=$("<div id='placard'></div>"),_placardContainer2.append(p),v=$("<div id='toggle'>&#x25BC;</div>"),d=$("<div id='placardContainer'></div>"),d.append(v),d.append(_placardContainer2),$(u).append(c),$(u).append(l),$(u).append(d),$(l).load(b),$(c).load(b),$(v).click(function(e){$(_placardContainer2).css("display")=="none"?$(v).html("&#x25BC;"):$(v).html("&#x25B2;"),$(_placardContainer2).slideToggle()}),a=l,this.clean=function(){$(p).empty(),$(a).fadeTo("slow",0),$(f).fadeTo("slow",0),a=null,f=null,$("#placardContainer").fadeOut()},this.setSource=function(e,t,n){x(t,n);var r=e;a=a==l?c:l,f=a==l?c:l,a.src==e?(S(),b()):(a.src=e,h.start()),$("#placardContainer").fadeIn()},this.invalidate=function(){$("#pictureLoadingIndicator").css("padding-top",$(u).height()/2-(n.isModernLayout()?0:26)),$("#pictureLoadingIndicator").css("padding-left",$(u).width()/2-(n.isModernLayout()?54:6)),w()},this.currentWidth=function(){return $(a).outerWidth()},this.currentHeight=function(){return $(a).outerHeight()},this.invalidate()}}),define("storymaps/utils/ResamplePicture",["dojo/has"],function(e){return{resample:function(t,n,r,i,s,o,u){if(!t||!n||!r||!i||!s||!o)return!1;var a=t.getContext("2d");s=Math.min(r,s),o=Math.min(i,o);var f=r/i,l=f>=1?s:r/(i/o),c=f<1?o:i/(r/s);return c>o?(l/=c/o,c=o):l>s&&(c/=l/s,l=s),l=parseInt(l),c=parseInt(c),e("ios")&&u==0?(t.width=c,t.height=l,a.translate(c,0),a.rotate(90*Math.PI/180)):e("ios")&&u==180?(t.width=c,t.height=l,a.translate(0,l),a.rotate(2*Math.PI/180)):e("ios")&&u==-90?(t.width=l,t.height=c,a.translate(l,c),a.rotate(180*Math.PI/180)):(t.width=l,t.height=c),a.drawImage(n.get(0),0,0,l,c),[l,c]}}}),define("storymaps/maptour/ui/desktop/PicturePanel",["storymaps/ui/crossfader/CrossFader","storymaps/utils/Helper","storymaps/utils/ResamplePicture","storymaps/maptour/core/MapTourHelper"],function(e,t,n,r){return function(s,o){function S(t){T(),$(s+" #cfader").empty(),this.update(t),c=new e(s+" #cfader",o),dojo.subscribe("CROSSFADER_CHANGE",function(e,t){h=[e,t],p=!0,dojo.publish("CORE_RESIZE")}),$("#arrowPrev").fastClick(function(){dojo.publish("PIC_PANEL_PREV",null)}),$("#arrowNext").fastClick(function(){dojo.publish("PIC_PANEL_NEXT",null)}),o&&O(),dojo.subscribe("CROSSFADER_DATA_UPDATE",function(){dojo.publish("CORE_RESIZE"),_()})}function x(e){r.isModernLayout()?u.css("background-color","inherit"):u.css("background-color",e),r.isModernLayout()?($("#cfader").css("margin-left",0),$("#cfader").css("margin-top",2.7*f)):($("#cfader").css("margin-left",a),$("#cfader").css("margin-top",f))}function T(){c&&c.clean(),$("#arrowPrev").addClass("disabled"),$("#arrowNext").addClass("disabled")}function N(e,t,n,i){c&&c.setSource(e,t,n),i.left&&r.isModernLayout()?$("#arrowPrev").removeClass("disabled").attr("src","resources/icons/picturepanel-modern-left.png"):i.left?$("#arrowPrev").removeClass("disabled").attr("src","resources/icons/picturepanel-left.png"):$("#arrowPrev").addClass("disabled"),i.right&&r.isModernLayout()?$("#arrowNext").removeClass("disabled").attr("src","resources/icons/picturepanel-modern-right.png"):i.right?$("#arrowNext").removeClass("disabled").attr("src","resources/icons/picturepanel-right.png"):$("#arrowNext").addClass("disabled")}function C(e,t){r.isModernLayout()?k(e,t):L(e,t),A()}function k(e,t){var n,r,i=e-2*a;i*=.95;var s=t-4*f,o=i/s;r=s,n=Math.min(parseInt(s*4/3),i);var l=r<s?s:r;$("#cfader").width(n),$("#cfader").height(l);var c=n,h=r+2*f;ppHeight=h<t?t:h,u.width(c),u.height(ppHeight),setTimeout(function(){$("#arrowPrev").css("top",u.height()/2-$(".member-image.current").height()/2+14),$("#arrowNext").css("top",u.height()/2-$(".member-image.current").height()/2+14),$("#arrowPrev").css("left",(u.width()-$(".member-image.current").width())/2-3),$("#arrowNext").css("right",(u.width()-$(".member-image.current").width())/2)},50),n<300||r<300?$("#picturePanel").css("display","none"):$("#picturePanel").css("display","block")}function L(e,t){var n,r,i=e-2*a,s=t-2*f,o=i/s;r=s,n=Math.min(parseInt(s*4/3),i);var l=r<s?s:r;$("#cfader").width(n),$("#cfader").height(l);var c=n+2*a,h=r+2*f;ppHeight=h<t?t:h,u.width(c),u.height(ppHeight),$("#arrowPrev").css("top",u.height()/2-40),$("#arrowNext").css("top",u.height()/2-40),$("#arrowPrev").css("left",0),$("#arrowNext").css("right",0)}function A(){c&&c.invalidate();var e=$("#cfader .current").height();$("#placardContainer").outerHeight()>e/1.5?($("#placard").addClass("one-line-layout"),!o&&e&&$("#placardContainer .description").css("max-height",e/3)):($("#placard").removeClass("one-line-layout"),!o&&e&&$("#placardContainer .description").css("max-height","inherit")),$("#placard-bg").css("max-height",e-10-(r.isModernLayout()?3:0));if(o&&app.data.getCurrentIndex()!=-1){var t=Math.max($(".editPictureButtons .modernBrowserWay a").eq(0).width(),$(".editPictureButtons .modernBrowserWay a").eq(1).width());t&&$(".editPictureButtons .modernBrowserWay a").width(t),$(".editPictureButtons").css("width",$("#cfader .current").width()),r.isModernLayout()?$(".editPictureButtons").css("margin-left",dojo.query("#cfader .current").length?dojo.query("#cfader .current").position()[0].x-dojo.query("#cfader").position()[0].x:0):$(".editPictureButtons").css("margin-left",dojo.query("#cfader .current").length?dojo.query("#cfader .current").position()[0].x:0),$(".editPictureButtons").css("display","block"),$("#picturePanel").width()<$(".editPictureButtons > div").width()?$(".editPictureButtons > div").css("display","none"):$(".editPictureButtons > div").css("display","inline-block"),$(".editPictureButtons").css("top",parseFloat($("#cfader > img.current").first().css("top"))+24+(r.isModernLayout()?31:0))}else $(".editPictureButtons").css("display","none");p&&(p=!1,dojo.publish("CORE_PICTURE_CHANGED"))}function O(){z(),t.browserSupportAttachementUsingFileReader()?D():F()}function M(){var e=$(s+" .name .text_edit_input").css("display")=="inline-block"?$(s+" .name .text_edit_input").val():$(s+" .name .text_edit_label").html(),t=$(s+" .description .text_edit_input").css("display")=="inline-block"?$(s+" .description .text_edit_input").val():$(s+" .description .text_edit_label").html();e=="Edit me !"&&(e=""),t=="Edit me !"&&(t=""),dojo.publish("PIC_PANEL_EDIT",{title:e,description:t})}function _(){console.log("maptour.ui.PicturePanel - saveEdits");var e=$(s+" .name .text_edit_label").html(),t=$(s+" .description .text_edit_label").html();e=="Edit me !"&&(e=""),t=="Edit me !"&&(t=""),dojo.publish("PIC_PANEL_EDIT",{title:e,description:t})}function D(){$(".editPictureButtons .modernBrowserWay",u).show(),m.popover({placement:"bottom",trigger:"manual",html:!0,content:'<script> $(".editPictureButtons").find(".btn-picture").next(".popover").addClass("picturePanelPicturePopoverFR"); function closeMe(){$(".editPictureButtons").find(".btn-picture").popover("hide");}</script><div class="confirmationStep"> '+i18n.viewer.picturePanelJS.popoverDeleteWarningPicAndThumb+' <button type="button" class="btn btn-danger btn-small" onclick="app.desktopPicturePanel.pictureConfirmation(true)">'+i18n.viewer.builderJS.ok+"</button>"+' <button type="button" class="btn btn-small" onClick="app.desktopPicturePanel.pictureConfirmation(false)">'+i18n.viewer.builderHTML.modalCancel+"</button>"+"</div>"+'<div class="waitStep" style="display: none">'+" "+i18n.viewer.picturePanelJS.popoverUploadingPhoto+' ... <img src="resources/icons/loader-upload.gif" class="addSpinner" alt="Uploading">'+"</div>"+'<div class="loadedStep" style="display: none">'+" "+i18n.viewer.picturePanelJS.popoverUploadSuccessful+"</div>"+'<div class="errorStep" style="display: none; color: red">'+" "+i18n.viewer.picturePanelJS.popoverUploadError+' <button type="button" class="btn btn-danger btn-small" onclick="closeMe()" style="vertical-align: 1px;">'+i18n.viewer.builderJS.gotIt+"</button>"+"</div>"}),g.change(function(){m.popover("show")}),y.popover({placement:"bottom",trigger:"manual",html:!0,content:'<script>$(".editPictureButtons").find(".btn-thumbnail").next(".popover").addClass("picturePanelThumbnailPopover");function closeMe(){$(".editPictureButtons").find(".btn-thumbnail").popover("hide");}</script><div class="confirmationStep"> '+i18n.viewer.picturePanelJS.popoverDeleteWarningThumb+" "+' <button type="button" class="btn btn-danger btn-small" onclick="app.desktopPicturePanel.thumbnailConfirmation(true)">'+i18n.viewer.builderJS.ok+"</button>"+' <button type="button" class="btn btn-small" onClick="app.desktopPicturePanel.thumbnailConfirmation(false)">'+i18n.viewer.builderHTML.modalCancel+"</button>"+"</div>"+'<div class="waitStep" style="display: none">'+" "+i18n.viewer.picturePanelJS.popoverUploadingThumbnail+' ... <img src="resources/icons/loader-upload.gif" class="addSpinner" alt="Uploading">'+"</div>"+'<div class="loadedStep" style="display: none">'+" "+i18n.viewer.picturePanelJS.popoverUploadSuccessful+"</div>"+'<div class="errorStep" style="display: none; color: red">'+" "+i18n.viewer.picturePanelJS.popoverUploadError+' <button type="button" class="btn btn-danger btn-small" onclick="closeMe()" style="vertical-align: 1px;">'+i18n.viewer.builderJS.gotIt+"</button> "+"</div>"}),y.change(function(){y.popover("show")})}function P(e){var t=g.get(0).files[0];if(!e||!t){H(),m.popover("hide");return}var r=m.next(".popover");r.find(".confirmationStep").css("display","none"),r.find(".waitStep").css("display","block");if(t.type==="image/jpeg"){var i=new FileReader;i.onloadend=function(){var e=this.result;d.attr("src",e),d.load(function(t){n.resample(v.get(0),d,t.currentTarget.naturalWidth,t.currentTarget.naturalHeight,app.config.thumbnailMaxWidth,app.config.thumbnailMaxHeight,window.orientation),app.data.changeCurrentPointPicAndThumbUsingData(e,v.get(0).toDataURL("image/jpeg"),function(e){e?(r.find(".waitStep").css("display","none"),r.find(".loadedStep").css("display","block"),setTimeout(function(){m.popover("hide")},l)):(r.find(".waitStep").css("display","none"),r.find(".errorStep").css("display","block"))}),H()})},i.readAsDataURL(t)}else alert(i18n.viewer.addPopupJS.notJpg)}function H(){g.closest("form").get(0).reset()}function B(e){var t=b.get(0).files[0];if(!e||!t){j(),y.popover("hide");return}var n=y.next(".popover");n.find(".confirmationStep").css("display","none"),n.find(".waitStep").css("display","block");if(t.type==="image/jpeg"){var r=new FileReader;r.onloadend=function(){app.data.changeCurrentPointThumbnailUsingData(this.result,function(e){e?(n.find(".waitStep").css("display","none"),n.find(".loadedStep").css("display","block"),setTimeout(function(){y.popover("hide")},l)):(n.find(".waitStep").css("display","none"),n.find(".errorStep").css("display","block"))}),j()},r.readAsDataURL(t)}else alert(i18n.viewer.addPopupJS.notJpg)}function j(){b.closest("form").get(0).reset()}function F(){$(".editPictureButtons .oldBrowserWay",u).show(),w.change(I),E.change(I),_uploadPicAndThumb.popover({placement:"bottom",html:!0,content:'<script>$(".editPictureButtons .oldBrowserWay").find(".btn-upload").next(".popover").addClass("picturePanelPicturePopoverOLD");function closeMe(){$(".editPictureButtons .oldBrowserWay").find(".btn-upload").popover("hide");}</script><div class="confirmationStep"> '+i18n.viewer.picturePanelJS.popoverDeleteWarningPicAndThumb+' <button type="button" class="btn btn-danger btn-small" onclick="app.desktopPicturePanel.formConfirmation(true)">'+i18n.viewer.builderJS.ok+"</button>"+' <button type="button" class="btn btn-small" onClick="app.desktopPicturePanel.formConfirmation(false)">'+i18n.viewer.builderHTML.modalCancel+"</button>"+"</div>"+'<div class="waitStep" style="display: none">'+" "+i18n.viewer.picturePanelJS.popoverUploadingPhoto+' ... <img src="resources/icons/loader-upload.gif" class="addSpinner" alt="Uploading">'+"</div>"+'<div class="loadedStep" style="display: none">'+" "+i18n.viewer.picturePanelJS.popoverUploadSuccessful+"</div>"+'<div class="errorStep" style="display: none; color: red">'+" "+i18n.viewer.picturePanelJS.popoverUploadError+' <button type="button" class="btn btn-danger btn-small" onclick="closeMe()" style="vertical-align: 1px;">'+i18n.viewer.builderJS.gotIt+"</button> "+"</div>"})}function I(){$(w[0]).val()&&$(E[0]).val()?_uploadPicAndThumb.removeAttr("disabled"):_uploadPicAndThumb.attr("disabled","true")}function q(e){if(!e||!$(w[0]).val()||!$(E[0]).val()){_uploadPicAndThumb.popover("hide");return}var t=_uploadPicAndThumb.next(".popover");t.find(".confirmationStep").css("display","none"),t.find(".waitStep").css("display","block"),app.data.changeCurrentPointPicAndThumbUsingForm("ppOldBrowserWayPicForm","ppOldBrowserWayThumbForm",function(e){e?(R(),t.find(".waitStep").css("display","none"),t.find(".loadedStep").css("display","block"),setTimeout(function(){_uploadPicAndThumb.popover("hide")},l)):(t.find(".waitStep").css("display","none"),t.find(".errorStep").css("display","block"))})}function R(){w.closest("form").get(0).reset(),E.closest("form").get(0).reset(),_uploadPicAndThumb.attr("disabled","true")}function U(){}function z(){var e=$(".editPictureButtons .modernBrowserWay");e.find("a.btn-picture").html(e.find("a.btn-picture").html().replace("Browse",i18n.viewer.picturePanelJS.changePicAndThumb)),e.find("a.btn-thumbnail").html(e.find("a.btn-thumbnail").html().replace("Browse",i18n.viewer.picturePanelJS.changeThumb)),m=e.find("a.btn-picture"),g=e.find(".btn-picture input"),y=e.find("a.btn-thumbnail"),b=e.find(".btn-thumbnail input");var t=$(".editPictureButtons .oldBrowserWay");t.find("a.btn-picture").html(t.find("a.btn-picture").html().replace("Browse",i18n.viewer.picturePanelJS.selectPic)),t.find("a.btn-thumbnail").html(t.find("a.btn-thumbnail").html().replace("Browse",i18n.viewer.picturePanelJS.selectThumb)),t.find(".btn-upload").html(i18n.viewer.picturePanelJS.uploadPicAndThumb),w=t.find(".btn-picture input"),E=t.find(".btn-thumbnail input"),_uploadPicAndThumb=t.find(".btn-upload")}var u=$(s),a=45,f=20,l=2e3,c=null,h=[],p=!1,d=$('<img src=""/>'),v=$('<canvas width="140px" height="93px">'),m=null,g=null,y=null,b=null,w=null,E=null;return{init:S,initLocalization:U,updatePicture:N,clean:T,resize:C,saveEdits:_,forceSaveEdits:M,update:x,pictureConfirmation:P,thumbnailConfirmation:B,formConfirmation:q}}}),define("storymaps/maptour/ui/mobile/IntroView",[],function(){return function(t){this.init=function(e,t){$(".navBar span").removeClass("current"),app.header.hideMobileBanner(!0),location.hash="",$("#introPanel").html('<div class="slide"> <h2 class="tourPointName">'+e.attributes.getName()+"</h2>"+' <p class="tourPointDescription">'+e.attributes.getDescription()+"</p>"+' <img class="tourPointImg" src="'+e.attributes.getURL()+'">'+"</div>"),$("#introPanel").css("background-color",t),$("#introPanel").show()},this.hide=function(){$("#introPanel").hide();if(location.hash==""||location.hash=="#")location.hash="map"}}}),define("storymaps/maptour/ui/mobile/ListView",["storymaps/maptour/core/MapTourHelper"],function(e){return function(n){function i(t){var i=document.createDocumentFragment();$.each(t,function(t,n){var s=n.attributes,o=document.createElement("div");o.className="listItem",o.style.backgroundColor=r;var u=document.createElement("div");u.className="tpImgPane",o.appendChild(u);var a=document.createElement("img");a.src=s.getThumbURL(),u.appendChild(a);var f=document.createElement("img");f.className="tpIcon",f.src=e.getSymbolUrl(s.getColor(),t+1),o.appendChild(f);var l=document.createElement("div");l.className="tpTextPane",o.appendChild(l);var c=document.createElement("h4");c.className="tpName",c.innerHTML=s.getName(),l.appendChild(c);var h=document.createElement("p");h.className="tpDescription",h.innerHTML=s.getDescription(),l.appendChild(h),i.appendChild(o)}),$(n).empty(),document.getElementById("listPanel").appendChild(i)}function s(){$(n).fastClick(function(e){dojo.publish("OPEN_MOBILE_INFO",$(e.target).closest(".listItem").index())}),dojo.subscribe("CORE_SELECTED_TOURPOINT_UPDATE",o)}function o(t){var r=$(n+" .listItem:nth-child("+(t.index+1)+")");r.find(".tpName").html(t.name),r.find(".tpDescription").html(t.description),r.find(".tpIcon").attr("src",e.getSymbolUrl(t.color,t.index+1))}function u(e){$(n).css("background-color",e),$(n+" .listItem").css("background-color",e),r=e}var r="";this.init=function(e,t){u(t),i(e),s()},this.update=function(e,t){u(t),i(e)},this.show=function(){$(n).show(),setTimeout(function(){if(app.data.getCurrentIndex()==0)$("body").animate({scrollTop:"0px"},0);else{var e=$("#listPanel .listItem").length*$("#listPanel .listItem").outerHeight(),t=$(" .listItem:nth-child("+(app.data.getCurrentIndex()+1)+")").offset().top-$(".listItem:nth-child(1)").offset().top;t>e&&(t=e)}$("body").animate({scrollTop:t},0)},0)}}}),define("storymaps/maptour/ui/mobile/InfoView",["storymaps/maptour/core/MapTourHelper"],function(e){return function(n){function i(t){r=new SwipeView(n,{numberOfPages:t.length});var i=Math.min(3,Math.max(3,t.length));for(var s=0;s<i;s++){var o=t.length==1?0:s==0?t.length-1:s-1,u=t[o];if(!u)continue;var a=t[o].attributes,f=document.createElement("div");f.className="tourPoint",f.id="tourPoint"+o;var l=document.createElement("div");l.className="iconHolder",f.appendChild(l);var c=document.createElement("img");c.className="tourPointIcon",c.src=e.getSymbolUrl(a.getColor(),o+1),l.appendChild(c);var h=document.createElement("h2");h.className="tourPointName",h.innerHTML=a.getName(),f.appendChild(h);var p=document.createElement("p");p.className="tourPointDescription",p.innerHTML=a.getDescription(),f.appendChild(p);var d=document.createElement("img");d.className="tourPointImg",d.src=a.getURL(),f.appendChild(d),r.masterPages[s].appendChild(f)}}function s(t){r.onTouchStart(function(e){app.header.hideMobileBanner()}),r.onFlip(function(){var n=Math.min(3,t.length);for(var i=0;i<n;i++){var s=r.masterPages[i],u=s.dataset.upcomingPageIndex;if(!t[u])continue;var a=t[u].attributes;if(u!=s.dataset.pageIndex){var f=s.querySelector(".tourPointIcon");f.src=e.getSymbolUrl(a.getColor(),parseInt(u)+1);var l=s.querySelector(".tourPointImg");l.src=a.getURL();var c=s.querySelector(".tourPointName");c.innerHTML=a.getName();var h=s.querySelector(".tourPointDescription");h.innerHTML=a.getDescription()}}$("body").scrollTop(0),o(),dojo.publish("MOBILE_INFO_SWIPE",r.pageIndex)}),r.onMoveOut(function(){clearTimeout(r.delayedFlipEvent),app.header.hideMobileBanner()}),o()}function o(){var e=r.masterPages[r.currentMasterPage].querySelector(".tourPointImg");if(e){var t=new Image;t.onload=function(){$("#infoCarousel").height(r.masterPages[r.currentMasterPage].childNodes[0].clientHeight+15)},t.src=e.src}}function u(t){var r=$(n+" .swipeview-active");r.find(".tourPointName").html(t.name),r.find(".tourPointDescription").html(t.description),r.find(".tourPointIcon").attr("src",e.getSymbolUrl(t.color,t.index+1))}function a(e){$("#infoPanel").css("background-color",e)}var r=null;this.init=function(e,t){a(t),i(e),s(e),dojo.subscribe("CORE_SELECTED_TOURPOINT_UPDATE",u)},this.update=function(e,t){a(t),r.destroy(),$(n).empty(),i(e),s(e)},this.show=function(){$("#infoPanel").show(),r.refreshSize(),r.goToPage(app.data.getCurrentIndex())},this.getCurrentPoint=function(){return r.pageIndex}}}),define("storymaps/maptour/ui/mobile/Carousel",["storymaps/maptour/core/MapTourHelper"],function(e){return function(n,r){function u(t){i=new SwipeView(n+" .carousel",{numberOfPages:t.length});var r=Math.min(3,Math.max(3,t.length));for(var s=0;s<r;s++){var o=t.length==1?0:s==0?t.length-1:s-1,u=t[o];if(!u)continue;var a=u.attributes,f=document.createElement("div");f.className="tpPreview";var l=document.createElement("div");l.className="tpImgPane",f.appendChild(l);var c=document.createElement("img");c.src=a.getThumbURL(),l.appendChild(c);var h=document.createElement("img");h.className="tpIcon",h.src=e.getSymbolUrl(a.getColor(),o+1),f.appendChild(h);var p=document.createElement("div");p.className="tpTextPane",f.appendChild(p);var d=document.createElement("h4");d.className="tpName",d.innerHTML=a.getName(),p.appendChild(d);var v=document.createElement("p");v.className="tpDescription previewDescription",v.innerHTML=a.getDescription(),p.appendChild(v),i.masterPages[s].appendChild(f)}}function a(t){$(".tpPreview").click(function(e){Math.abs(e.clientX-o[0])<10&&Math.abs(e.clientY-o[1])<10&&dojo.publish("OPEN_MOBILE_INFO",null)}),$(n+" .carousel").mousedown(function(e){o=[e.clientX,e.clientY]}),i.onFlip(function(){var n=Math.min(3,t.length);for(var r=0;r<n;r++){var o=i.masterPages[r],u=o.dataset.upcomingPageIndex;if(!t[u])return;var a=t[u].attributes;if(u!=o.dataset.pageIndex){var f=o.querySelector(".tpImgPane img");f.src=a.getThumbURL();var l=o.querySelector(".tpIcon");l.src=e.getSymbolUrl(a.getColor(),parseInt(u)+1);var c=o.querySelector(".tpName");c.innerHTML=a.getName();var h=o.querySelector(".tpDescription");h.innerHTML=a.getDescription()}}app.data.getCurrentIndex()!=-1&&app.data.getCurrentIndex()!=i.pageIndex&&(s=!0,dojo.publish("CAROUSEL_SWIPE",i.pageIndex))})}function f(t){var r=$(n+" .carousel .swipeview-active");r.find(".tpName").html(t.name),r.find(".tpDescription").html(t.description),r.find(".tpIcon").attr("src",e.getSymbolUrl(t.color,t.index+1))}function l(e){$(n+" .carousel").css("background-color",e),$(n+" .builderMobile").css("background-color",e)}var i=null,s=!1,o=[0,0];this.init=function(e,t){r&&$(n+" .builderMobileContainer").css("display","block"),l(t),u(e),a(e),dojo.subscribe("CORE_SELECTED_TOURPOINT_UPDATE",f)},this.update=function(e,t){l(t),i.destroy(),$(n+" .carousel").empty(),u(e),a(e)},this.setSelectedPoint=function(e){if(!i)return;s?s=!1:(i.refreshSize(),i.goToPage(e))}}}),define("storymaps/maptour/core/Core",["esri/map","esri/arcgis/Portal","esri/arcgis/utils","storymaps/utils/Helper","storymaps/utils/MovableGraphic","storymaps/maptour/core/TourData","storymaps/maptour/core/WebApplicationData","storymaps/maptour/core/FeatureServiceManager","storymaps/maptour/core/TourPointAttributes","storymaps/maptour/core/MapTourHelper","storymaps/maptour/ui/Header","storymaps/maptour/ui/MapCommand","storymaps/ui/multiTips/MultiTips","storymaps/maptour/ui/desktop/Carousel","storymaps/maptour/ui/desktop/PicturePanel","storymaps/maptour/ui/mobile/IntroView","storymaps/maptour/ui/mobile/ListView","storymaps/maptour/ui/mobile/InfoView","storymaps/maptour/ui/mobile/Carousel","dojo/has"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b){function E(e){console.log("maptour.core.Core - init"),Et();var t=e!=null&&r.getAppID(St());if(!Nt()){D("invalidConfig");return}app={map:null,portal:null,data:new s,isFirstUserAction:!1,mapTips:null,builder:e,isInBuilderMode:t,builderMovableGraphic:null,isCreatingFS:!1,mapCommand:null,header:new l("#header",t),desktopCarousel:new p("#footerDesktop .carousel",t),desktopPicturePanel:new d("#picturePanel",t),mobileIntroView:new v("#introPanel"),mobileListView:new m("#listPanel"),mobileInfoView:new g("#infoCarousel"),mobileCarousel:new y("#footerMobile",t),config:{thumbnailMaxWidth:140,thumbnailMaxHeight:93,picRecommendedWidth:1090,picRecommendedHeight:725},loadingTimeout:null,filterMouseHoverEvent:!1},yt(),configOptions.sharingurl?configOptions.sharingurl=location.protocol+configOptions.sharingurl:r.isArcGISHosted(St())?configOptions.sharingurl=location.protocol+"//"+location.host+"/sharing/content/items":configOptions.sharingurl=location.protocol+APPCFG.DEFAULT_SHARING_URL,configOptions.geometryserviceurl&&(esri.config.defaults.geometryService=new esri.tasks.GeometryService(location.protocol+configOptions.geometryserviceurl)),configOptions.proxyurl=configOptions.proxyurl?location.protocol+configOptions.proxyurl:location.protocol+"//"+location.host+"/sharing/proxy",esri.arcgis.utils.arcgisUrl=configOptions.sharingurl,esri.config.defaults.io.proxyUrl=configOptions.proxyurl,esri.id&&esri.id.setProtocolErrorHandler(function(){return!0}),t&&APPCFG.CORS_SERVER&&$.each(APPCFG.CORS_SERVER,function(e,t){esriConfig.defaults.io.corsEnabledServers.push(t)});if(app.isInBuilderMode&&b("ie")==10&&navigator.userAgent.match("Windows NT 6.1")){D("ie10Win7Explain");return}if(app.isInBuilderMode&&b("ie")&&b("ie")<9){D("noBuilderIE8");return}var n=esri.urlToObject(document.location.search).query||{};configOptions.sourceLayerTitle=(n.sourceLayerTitle?unescape(n.sourceLayerTitle):null)||configOptions.sourceLayerTitle,configOptions.firstRecordAsIntro=n.firstRecordAsIntro?n.firstRecordAsIntro=="true"?!0:!1:configOptions.firstRecordAsIntro,configOptions.zoomLevel=n.zoomLevel||configOptions.zoomLevel,t?esri.config.defaults.io.timeout=APPCFG.TIMEOUT_BUILDER_REQUEST:esri.config.defaults.io.timeout=APPCFG.TIMEOUT_VIEWER_REQUEST,H(),window.mediaNotFoundHandler=function(e){e.src=f.getNotFoundMedia(),e.onerror=""},$(document).ready(dojo.hitch(this,S))}function S(){console.log("maptour.core.Core - initStep2"),app.header.initLocalization(),app.desktopPicturePanel.initLocalization(),$(window).resize(at),$("form").bind("keydown",function(e){if(e.keyCode==13)return!1});var e=r.getAppID(St()),t=r.getWebmapID(St());dojo.connect(esri.id,"onDialogCreate",lt),loadingIndicator.setMessage(i18n.viewer.loading.step2),r.addCSSRule(".tpIcon {"+f.getSymbolMobileClip()+"}"),e?x(e):t&&(r.isArcGISHosted(St())||xt())?ht():t?C(t):r.isArcGISHosted(St())?ht():D("invalidConfigNoWebmap")}function x(e){console.log("maptour.core.Core - loadWebMappingApp - appId:",e);var t=esri.urlToObject(document.location.search).query||{},n=t.forceLogin!=undefined;n||St()&&r.getPortalUser()||St()&&app.isInBuilderMode&&!r.getPortalUser()?N().then(function(){app.isInBuilderMode&&!app.data.userIsOrgaPublisher()?D("notAuthorized"):T(e)},function(){D("notAuthorized")}):T(e)}function T(e){var t=esri.request({url:configOptions.sharingurl+"/"+e+"",content:{f:"json"},callbackParamName:"callback",load:function(e){app.data.setAppItem(e)},error:function(){}}),n=esri.request({url:configOptions.sharingurl+"/"+e+"/data",content:{f:"json"},callbackParamName:"callback",load:function(e){o.set(e)},error:function(){}}),i=new dojo.DeferredList([t,n]);i.then(function(){if(!n.results||!n.results[0]||!t.results||!t.results[0]){D("invalidApp");return}var e=o.getWebmap()||r.getWebmapID(St());e?C(e):D("invalidApp")})}function N(){var e=new dojo.Deferred,t=configOptions.sharingurl.split("/").slice(0,3).join("/")+"/";return app.portal=new esri.arcgis.Portal(t),dojo.connect(esri.id,"onDialogCreate",ct),app.portal.signIn().then(function(){e.resolve()},function(t){e.reject()}),e}function C(e){console.log("maptour.core.Core - loadWebMap - webmapId:",e);var t=esri.arcgis.utils.createMap(e,"mainMap",{mapOptions:{slider:!0,autoResize:!1,extent:new esri.geometry.Extent({xmax:180,xmin:-180,ymax:90,ymin:-90,spatialReference:{wkid:4326}})},ignorePopups:!0,bingMapsKey:configOptions.bingmapskey});t.addCallback(function(e){setTimeout(function(){k(e)},0)}),t.addErrback(function(){D("createMap")})}function k(e){console.log("maptour.core.Core - webMapInitCallback");if(configOptions.authorizedOwners&&configOptions.authorizedOwners.length>0&&configOptions.authorizedOwners[0]){var t=!1;e.itemInfo.item.owner&&(t=$.inArray(e.itemInfo.item.owner,configOptions.authorizedOwners)!=-1);if(!t){D("invalidConfigOwner");return}}app.map=e.map,app.data.setWebMapItem(e.itemInfo);var n=configOptions.title||o.getTitle()||e.itemInfo.item.title,i=configOptions.subtitle||o.getSubtitle()||e.itemInfo.item.snippet;Z(o.getLayout()||configOptions.layout);var s=o.getColors(),f=o.getLogoURL()||APPCFG.HEADER_LOGO_URL,l=f==APPCFG.HEADER_LOGO_URL?APPCFG.HEADER_LOGO_TARGET:o.getLogoTarget();app.header.init(n,i,s[0],f,l,!app.isInBuilderMode&&(!St()&&r.getAppID(St())||St()&&app.data.userIsAppOwnerOrAdmin()&&app.data.userIsOrgaPublisher()),o.getHeaderLinkText()==undefined?APPCFG.HEADER_LINK_TEXT:o.getHeaderLinkText(),o.getHeaderLinkURL()==undefined?APPCFG.HEADER_LINK_URL:o.getHeaderLinkURL()),document.title=n,app.desktopPicturePanel.init(s[1]),dojo.subscribe("PIC_PANEL_PREV",V),dojo.subscribe("PIC_PANEL_NEXT",J);if(configOptions.sourceLayerTitle){var c=app.data.getWebMapItem()&&app.data.getWebMapItem().itemData?app.data.getWebMapItem().itemData.operationalLayers:[];for(var h=app.map.graphicsLayerIds.length-1;h>=0;h--){var p=app.map.graphicsLayerIds[h],d=app.map._layers[p];p.split("_").length==3&&(p=p.split("_").slice(0,2).join("_"));if(p.match(/^mapNotes_/)||d.geometryType!="esriGeometryPoint")continue;for(var v=0;v<c.length;v++)if(c[v].id==p&&c[v].title.toUpperCase()==configOptions.sourceLayerTitle.toUpperCase()){app.data.setSourceLayer(d);break}if(app.data.getSourceLayer())break}}else for(var h=app.map.graphicsLayerIds.length-1;h>=0;h--){var m=app.map.graphicsLayerIds[h],d=app.map._layers[m];if((d.visible==1||d.visible==undefined)&&d.type=="Feature Layer"&&d.geometryType=="esriGeometryPoint"&&!m.match(/^mapNotes_/)){if(!(!d.url&&d.graphics&&d.graphics.length>0)){app.data.setSourceLayer(d);break}var g=app.data.electFields(d.graphics[0].attributes);if(g&&g.allWebmapLayerMandatoryFieldsFound()){app.data.setSourceLayer(d);break}}}if(app.isInBuilderMode){app.data.sourceIsFS()&&!app.data.getSourceLayer().hasAttachments&&app.data.setSourceLayer(null);if(app.data.sourceIsWebmap()){D("noBuilderWebmapData");return}}if(app.data.sourceIsFS()){app.isInBuilderMode&&(app.data.getSourceLayer().setUserIsAdmin(!0),app.data.getSourceLayer().credential||app.data.getSourceLayer()._forceIdentity(function(){}));var y=function(){loadingIndicator.setMessage(i18n.viewer.loading.step3);var e=new u;dojo.subscribe("FS_MANAGER_LAYER_LOADED",function(e){if(app.isInBuilderMode||!r.getAppID(St())){var t=new esri.tasks.Query;t.where="1=1",app.data.getSourceLayer().queryCount(t,function(t){if(app.data.getSourceLayer().graphics.length!=t){var n=r.getWebmapViewerLinkFromSharingURL()+"?webmap="+app.data.getWebMapItem().item.id,i=app.data.getSourceLayer().graphics.length!=0?i18n.viewer.builderJS.dataWarningExtent:i18n.viewer.builderJS.dataWarningVisibi.replace("%MAPSIZE%",APPCFG.MINIMUM_MAP_WIDTH+"px");app.isInBuilderMode&&app.builder.setDataWarning(i,n)}A(e)},function(){A(e)})}else A(e)}),e.process(app.data.getSourceLayer(),app.data.isFSWithURLFields())};if(b("ie")>0&&b("ie")<9)setTimeout(y,1e3);else var w=dojo.connect(app.map,"onUpdateEnd",function(){dojo.disconnect(w),y()})}else if(app.data.sourceIsWebmap()){loadingIndicator.setMessage(i18n.viewer.loading.step3);var E=[];$(app.data.getSourceLayer().graphics).each(function(e,t){E.push(new esri.Graphic(new esri.geometry.Point(t.geometry.x,t.geometry.y,t.geometry.spatialReference),null,new a(t,null,null,!0)))}),A({graphics:E})}else app.isInBuilderMode?St()?L():N().then(L,function(){D("noLayerNoHostedFS")}):r.getAppID(St())?D("noLayerView"):D("noLayer")}function L(){if(!app.data.userIsOrgaPublisher()){app.data.sourceIsFS()?D("noLayerNoHostedFS"):D("noBuilderWebmapData");return}bt(),app.isCreatingFS=!0,D("noLayerMobile",null,!0),at();var e=app.builder.presentDataPopup(app.portal,app.data.getWebMapItem());e.then(function(){app.isCreatingFS=!1,ft(),C(app.data.getWebMapItem().item.id)},function(){P("noLayerView"),$("#loadingOverlay").css("top","0px"),$("#header").css("display","inherit"),$("#fatalError").css("display","block"),app.isCreatingFS=!1,at()})}function A(e){console.log("maptour.core.Core - tourPointLayerLoaded"),at(),Y(r.getWebMapExtentFromItem(app.data.getWebMapItem().item)).then(function(){configOptions.firstRecordAsIntro&&e.graphics.length>1?(app.data.setIntroData(e.graphics[0]),app.data.setTourPoints(e.graphics.slice(1,APPCFG.MAX_ALLOWED_POINTS+1)),app.data.setCurrentPointByIndex(null)):(app.data.setTourPoints(e.graphics.slice(0,APPCFG.MAX_ALLOWED_POINTS)),app.data.setCurrentPointByIndex(e.graphics.length?0:-1)),e.graphics.length>=APPCFG.MAX_ALLOWED_POINTS&&app.data.setMaxAllowedFeatureReached(!0);var t=app.data.getTourPoints(),n=new esri.layers.GraphicsLayer({id:"mapTourGraphics"}),r=app.data.getTourPoints(!0);$(r).each(function(e,t){n.add(t)});var i=new esri.renderer.UniqueValueRenderer(null,app.data.getFeatureIDField());$(t).each(function(e,t){i.addValue({value:t.attributes.getID(),symbol:f.getSymbol(t.attributes.getColor(),e+1)})}),n.setRenderer(i),app.map.addLayer(n),app.data.setTourLayer(n);var s=o.getColors();app.desktopCarousel.init(t,s[2],s[1]),dojo.subscribe("CAROUSEL_CLICK",K);if(dojo.isIE==undefined||dojo.isIE>8)app.mobileCarousel.init(t,s[2]),dojo.subscribe("CAROUSEL_SWIPE",K),app.mobileListView.init(t,s[2]),app.mobileInfoView.init(app.data.getTourPoints(),s[2]),dojo.subscribe("OPEN_MOBILE_INFO",gt),dojo.subscribe("MOBILE_INFO_SWIPE",K);app.data.getSourceLayer()&&app.data.getSourceLayer().setVisibility(!1),dojo.connect(n,"onMouseOver",j),dojo.connect(n,"onMouseOut",F),dojo.connect(n,"onClick",B),dojo.connect(app.map,"onClick",ut),dojo.subscribe("CORE_UPDATE_UI",et),dojo.subscribe("CORE_UPDATE_EXTENT",Y),dojo.subscribe("CORE_SELECTED_TOURPOINT_UPDATE",tt),dojo.subscribe("CORE_PICTURE_CHANGED",W),dojo.subscribe("CORE_RESIZE",at),app.map.loaded?M():dojo.connect(app.map,"onLoad",M)})}function O(e,t){if(e){if(app.map.spatialReference.wkid==102100)t=esri.geometry.geographicToWebMercator(t);else if(app.map.spatialReference.wkid!=4326)return;G(t)}}function M(){console.log("maptour.core.Core - initMap"),app.mapCommand=new c(app.map,function(){Y(r.getWebMapExtentFromItem(app.data.getWebMapItem().item))},app.isInBuilderMode?O:null),$.each(app.map.graphicsLayerIds,function(e,t){t!=app.data.getSourceLayer().id&&$("#"+t+"_layer").css("visibility","visible")}),app.data.getTourPoints().length&&z(app.data.getIntroData()),at(),location.hash&&(location.hash="map"),window.onhashchange=function(e){if(!(location.hash!=""&&location.hash!="#"||!app.data.getIntroData()))return;vt(),location.hash=="#list"?($("#listViewLink").addClass("current"),app.mobileListView.show()):location.hash=="#info"?($("#infoViewLink").addClass("current"),app.mobileInfoView.show()):($("#mapViewLink").addClass("current"),mt())};var e=!0,t=dojo.connect(app.map,"onExtentChange",function(n,r){!e&&r&&(r.x||r.y)?(app.header.hideMobileBanner(),dojo.disconnect(t)):e=!1}),n=dojo.connect(app.map,"onExtentChange",function(e,t){dojo.disconnect(n),app.isFirstUserAction=!0});dojo.connect(app.map,"onExtentChange",function(e,t){var n=app.data.getCurrentGraphic();if(n&&e.contains(n.geometry))try{n.getDojoShape().moveToFront()}catch(r){}}),app.isInBuilderMode&&!app.data.getFieldsConfig().allCriticalFieldsFound()&&app.builder.openFieldsSettingOnStartup(),app.isInBuilderMode&&Tt()&&app.builder.showBrowserWarning(),app.data.getTourPoints().length||W()}function _(){app.data.getIntroData()&&(!b("ie")||b("ie")>8)&&app.mobileIntroView.init(app.data.getIntroData(),o.getColors()[2]),app.loadingTimeout!=null&&($("#loadingOverlay").fadeOut(),loadingIndicator.stop()),bt()}function D(e,t,n){pt(),bt(),loadingIndicator.stop();if(e=="noLayerView"){var r=app.data.userIsAppOwnerOrAdmin()?'<br /><button type="button" style="margin-top: 6px" class="btn btn-small btn-info" style="vertical-align: 2px" onclick="app.header.switchToBuilder()">'+i18n.viewer.desktopHTML.builderButton+"</button>":"";loadingIndicator.setMessage(i18n.viewer.errors[e]+r,!0);return}loadingIndicator.forceHide(),$("#fatalError .error-msg").html(i18n.viewer.errors[e]),n||$("#fatalError").show()}function P(e){$("#fatalError .error-msg").html(i18n.viewer.errors[e])}function H(){esri.Graphic.prototype.hasBeenUpdated=function(){var e=this.attributes.getOriginalGraphic().geometry;return this.attributes.hasBeenUpdated()||this.geometry.x!=e.x||this.geometry.y!=e.y},esri.Graphic.prototype.getUpdatedFeature=function(){this.attributes.commitUpdate();var e=this.attributes.getOriginalGraphic().geometry;return e.x=this.geometry.x,e.y=this.geometry.y,this.attributes.getOriginalGraphic()},esri.Graphic.prototype.restoreOriginal=function(){this.attributes.restoreOriginal();var e=this.attributes.getOriginalGraphic().geometry;this.geometry.x=e.x,this.geometry.y=e.y}}function B(e){e.graphic!=app.data.getCurrentGraphic()?(app.filterMouseHoverEvent=!0,U(),app.data.setCurrentPointByGraphic(e.graphic),z(),setTimeout(function(){app.filterMouseHoverEvent=!1},500)):R()}function j(e){if(r.isMobile()||app.filterMouseHoverEvent)return;app.map.setMapCursor("pointer");var t=e.graphic,n=t==app.data.getCurrentGraphic();n||st(t,"hover"),(!n||!app.isInBuilderMode&&!dt()&&!$(".multiTip").is(":visible"))&&I(t)}function F(e){app.map.setMapCursor("default"),q();var t=e.graphic;t!=app.data.getCurrentGraphic()&&st(t,"normal")}function I(e){var t=app.map.toScreen(e.geometry),n=t.x,r=t.y;$("#hoverInfo").html(e.attributes.getName()),n<=$("#mainMap").width()-230?$("#hoverInfo").css("left",n+15):$("#hoverInfo").css("left",n-25-$("#hoverInfo").width()),r>=$("#hoverInfo").height()+50?$("#hoverInfo").css("top",r-35-$("#hoverInfo").height()):$("#hoverInfo").css("top",r-15+$("#hoverInfo").height()),$("#hoverInfo").show()}function q(){$("#hoverInfo").hide()}function R(){!app.isInBuilderMode&&!dt()&&!$(".multiTip").is(":visible")&&(q(),app.mapTips&&app.mapTips.show())}function U(){st(app.data.getCurrentGraphic(),"normal"),app.header.mobileHeaderIsInFirstState()&&app.header.hideMobileBanner(),configOptions.firstRecordAsIntro&&app.mobileIntroView.hide(),app.isInBuilderMode&&(app.desktopPicturePanel.forceSaveEdits(),app.builderMoveEvents&&app.builderMoveEvents.clean())}function z(e){console.log("maptour.core.Core - selectedPointChange_after");var t=e?e.attributes:app.data.getCurrentAttributes();if(!t){console.error("selectedPointChange_after - invalid point"),at(),W(),app.desktopPicturePanel.clean();return}app.desktopPicturePanel.updatePicture(t.getURL(),t.getName(),t.getDescription(),X())}function W(){var e=app.data.getCurrentIndex(),t=app.data.getCurrentGraphic();q(),app.mapTips&&app.mapTips.clean();if(app.isFirstUserAction){app.isFirstUserAction=!1;var n=parseInt(o.getZoomLevel()!=""&&o.getZoomLevel()!=undefined?o.getZoomLevel():configOptions.zoomLevel);if(n!==""&&n!=-1&&""+n!="NaN"&&n!=app.map.getZoom()){G(t.geometry,n);var r=dojo.connect(app.map,"onExtentChange",function(){dojo.disconnect(r),rt(t)})}else rt(t)}else rt(t);app.desktopCarousel.setSelectedIndex(e),app.mobileCarousel.setSelectedPoint(e),app.loadingTimeout&&_()}function X(){var e=app.data.getCurrentIndex();return{left:!!e,right:e!=app.data.getNbPoints()-1}}function V(){var e=app.data.getCurrentIndex();if(!e)return;U(),app.data.setCurrentPointByIndex(e-1),z()}function J(){var e=app.data.getCurrentIndex();e==null&&(e=-1);if(e==app.data.getNbPoints()-1)return;U(),app.data.setCurrentPointByIndex(e+1),z()}function K(e){if(e!=app.data.getCurrentIndex())U(),app.data.setCurrentPointByIndex(e),z();else{var t=app.data.getCurrentGraphic();Q(t.geometry)||G(t.geometry),R()}}function Q(e){var t=f.isModernLayout()&&!dt();if(!t)return app.map.extent.contains(e);var n=new esri.geometry.Extent(app.map.extent.xmin,app.map.extent.ymin+(10+dojo.position(dojo.byId("footer")).h)*app.map.__LOD.resolution,app.map.extent.xmin+dojo.position(dojo.byId("picturePanel")).x*app.map.__LOD.resolution,app.map.extent.ymax,app.map.extent.spatialReference);return n.contains(e)}function G(e,t){var n=f.isModernLayout()&&!dt();!n&&!t&&app.map.centerAt(e);if(!n&&t)app.map.centerAndZoom(e,t);else{var r=20+dojo.position(dojo.byId("picturePanel")).x/2,i=10+dojo.position(dojo.byId("footer")).h/2;t?app.map.centerAndZoom(e.offset(r*app.map._params.lods[t].resolution,-i*app.map._params.lods[t].resolution),t):app.map.centerAt(e.offset(r*app.map.__LOD.resolution,-i*app.map.__LOD.resolution))}}function Y(e){var t=f.isModernLayout()&&!dt();if(!t)return app.map.setExtent(e,!0);var n=10+dojo.position(dojo.byId("picturePanel")).w,i=10+dojo.position(dojo.byId("footer")).h,s=e.getWidth()/app.map.width,o=e.getHeight()/app.map.height,u=new esri.geometry.Extent({xmin:e.xmin,ymin:e.ymin-o*i,xmax:e.xmax+s*n,ymax:e.ymax,spatialReference:e.spatialReference}),a=app.map._params.lods,l=r.getFirstLevelWhereExtentFit(u,app.map);if(l!=-1){var c=new esri.geometry.Point(e.getCenter().x+(app.map.width/2-dojo.position(dojo.byId("picturePanel")).x/2)*a[l].resolution,e.getCenter().y-(10+dojo.position(dojo.byId("footer")).h/2)*a[l].resolution,e.spatialReference);return app.map.centerAndZoom(c,l)}return app.map.setExtent(u)}function Z(e){$("body").toggleClass("modern-layout",e=="integrated")}function et(){console.log("maptour.core.Core - updateUI");var e=app.data.getTourPoints();Z(o.getLayout()),nt();var t=o.getColors();app.desktopCarousel.update(e,t[2],t[1]),app.mobileCarousel.update(e,t[2]),app.mobileListView.update(e,t[2]),app.mobileInfoView.update(e,t[2]),app.header.setColor(t[0]);var n=o.getLogoURL()||APPCFG.HEADER_LOGO_URL;app.header.setLogoInfo(n,n==APPCFG.HEADER_LOGO_URL?APPCFG.HEADER_LOGO_TARGET:o.getLogoTarget()),app.header.setTopRightLink(o.getHeaderLinkText()==undefined?APPCFG.HEADER_LINK_TEXT:o.getHeaderLinkText(),o.getHeaderLinkURL()==undefined?APPCFG.HEADER_LINK_URL:o.getHeaderLinkURL()),app.desktopPicturePanel.update(t[1]),z(),at()}function tt(e){var t=app.data.getCurrentGraphic();if(e.name!=undefined||!e.color)return;nt(),st(t,"selected"),ot(t)}function nt(){var e=app.data.getTourPoints(),t=app.data.getCurrentId(),n=-1,r=new esri.renderer.UniqueValueRenderer(null,app.data.getFeatureIDField());$(e).each(function(e,i){r.addValue({value:i.attributes.getID(),symbol:f.getSymbol(i.attributes.getColor(),e+1)}),i.attributes.getID()==t&&(n=e)}),app.data.getTourLayer().setRenderer(r),app.map.setExtent(app.map.extent),n==-1&&e.length>0&&(n=0),app.data.setCurrentPointByIndex(n)}function rt(e){if(!app.map||!e)return;st(e,"selected"),app.isInBuilderMode&&it(e)}function it(e){app.builderMoveEvents&&app.builderMoveEvents.clean(),dt()||(app.builderMoveEvents=new i(app.map,app.data.getTourLayer(),e,app.builder.movedPin,app.builder.hidePinPopup))}function st(e,t){if(!e)return;var n=e.getLayer().renderer._symbols[e.attributes.getID()],r=APPCFG.ICON_CFG[t];if(!r)return;t=="selected"?setTimeout(function(){ot(e)},0):app.map.setExtent(app.map.extent),n.setWidth(r.width).setHeight(r.height).setOffset(r.offsetX,r.offsetY)}function ot(e){Q(e.geometry)?app.loadingTimeout||app.map.setExtent(app.map.extent):G(e.geometry);var t=dojo.connect(app.map,"onExtentChange",function(){dojo.disconnect(t);try{e.getDojoShape().moveToFront()}catch(n){}app.isInBuilderMode?app.builder.createPinPopup(e,app.data.getCurrentIndex(),!dt()):app.mapTips=new h({map:app.map,content:e.attributes.getName(),pointArray:[e],labelDirection:"auto",backgroundColor:"#444444",pointerColor:"#444444",textColor:"#ffffff",offsetTop:32,topLeftNotAuthorizedArea:b("touch")?[40,180]:[30,150],mapAuthorizedWidth:f.isModernLayout()?dojo.query("#picturePanel").position()[0].x:-1,mapAuthorizedHeight:f.isModernLayout()?dojo.query("#footerDesktop").position()[0].y-dojo.query("#header").position()[0].h:-1,visible:!dt()})})}function ut(e){!e.graphic&&!app.isInBuilderMode&&app.mapTips.hide()}function at(){var e=app.data.getCurrentIndex(),t=app.data.getCurrentGraphic(),n=dt(),r=$("#mapViewLink").hasClass("current");app.isCreatingFS&&($("#loadingOverlay").css("top",n?"0px":$("#header").height()),$("#header").css("display",n?"none":"block"),$("#fatalError").css("display",n?"block":"none")),n?$("body").addClass("mobile-view"):$("body").removeClass("mobile-view"),n&&r?$("#footerMobile").show():$("#footerMobile").hide();var i=$("body").width(),s=$("body").height(),o=$("#header").height(),u=$("#footer").height(),a=s-(o+u);$("#headerDesktop .textArea").width(i-$("#headerDesktop .rightArea").outerWidth()-35),$("#contentPanel").height(a+(n?0:f.isModernLayout()?u:0)),$("#contentPanel").width(i),app.desktopPicturePanel.resize(i-APPCFG.MINIMUM_MAP_WIDTH,a),app.desktopCarousel.resize(),$("#mapPanel").width(i-$("#picturePanel").width());if(app.isInBuilderMode){var l=Math.max($("#builderPanel > div > button").eq(0).width(),$("#builderPanel > div > button").eq(1).width());$("#builderPanel > div > button").eq(0).width(l),$("#builderPanel > div > button").eq(1).width(l),$("#builderPanel").css("margin-left",$("body").width()/2-$("#builderPanel").width()/2-18),$("#organizeSlidesButton").width()>0&&($("#builderPanel2 button").width($("#organizeSlidesButton").width()>$("#addPopupButton").width()?$("#organizeSlidesButton").width():$("#addPopupButton").width()),$("#builderPanel2").css("margin-left",$("body").width()/2-$("#builderPanel2").outerWidth()/2))}app.isInBuilderMode&&t&&(it(t),n?app.mapTips&&app.builder.hidePinPopup():app.mapTips&&app.mapTips.show()),n?app.mapTips&&app.mapTips.hide():app.mapTips&&app.mapTips.show(),n||app.desktopCarousel.checkItemIsVisible(e),app.map&&(!n||n&&r)&&app.map.resize(!0),n?$("#mainMap .esriControlsBR > div").first().removeClass("logo-med").addClass("logo-sm"):$("#mainMap .esriControlsBR > div").first().removeClass("logo-sm").addClass("logo-med")}function ft(){$("#mainMap_root").remove(),$("#header").css("display","inherit"),$(".mobileView").css("display","inherit"),$("#footer").css("display","inherit"),$("#fatalError").css("display","none"),$("#loadingOverlay").css("top","0px"),loadingIndicator.start(),loadingIndicator.setMessage(i18n.viewer.loading.step2),yt(),at()}function lt(){$(".esriSignInDialog td label").siblings("br").css("display","none"),$(".esriSignInDialog .dijitDialogPaneContentArea div:nth(1)").css("display","none"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("padding","0px"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("margin-bottom","0px"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("border","none"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("border-radius","0px"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("-webkit-border-radius","0px"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("-moz-border-radius","0px"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("box-shadow","none"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("-webkit-box-shadow","none"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("-moz-box-shadow","none"),$(".esriSignInDialog .dijitReset.dijitValidationContainer").css("display","none"),$(".esriSignInDialog .esriErrorMsg").css("margin-top","10px"),$(".esriSignInDialog").find(".dijitDialogTitleBar").find(".dijitDialogTitle").first().html("Authentication is required"),$(".esriSignInDialog").find(".dijitDialogPaneContentArea:first-child").find(":first-child").first().css("display","none"),$(".esriSignInDialog").find(".dijitDialogPaneContentArea:first-child").find(":first-child").first().after("<div id='dijitDialogPaneContentAreaLoginText'>Please sign in with an account on <a href='http://"+esri.id._arcgisUrl+"' title='"+esri.id._arcgisUrl+"' target='_blank'>"+esri.id._arcgisUrl+"</a> to access the application.</div>")}function ct(){$(".esriSignInDialog").find("#dijitDialogPaneContentAreaLoginText").css("display","none"),$(".esriSignInDialog").find(".dijitDialogPaneContentArea:first-child").find(":first-child").first().after("<div id='dijitDialogPaneContentAreaAtlasLoginText'>Please sign in with an account on <a href='http://"+esri.id._arcgisUrl+"' title='"+esri.id._arcgisUrl+"' target='_blank'>"+esri.id._arcgisUrl+"</a> to configure this application.</div>")}function ht(){window.location.replace("preview.html")}function pt(){$("#header").hide(),$(".mobileView").hide(),$("#footer").hide(),$(".modal").hide()}function dt(){return $("#headerMobile").css("display")=="block"}function vt(){$(".mobileView").hide(),$("#footerMobile").hide(),$(".navBar span").removeClass("current"),app.header.hideMobileBanner(),app.data.getCurrentIndex()==null&&K(0)}function mt(){$("#contentPanel").show(),$("#footerMobile").show(),$("#mapPanel").show(),app.mobileCarousel.setSelectedPoint(app.data.getCurrentIndex()),at()}function gt(e){e!=null&&K(e),location.hash="#info"}function yt(){app.loadingTimeout=setTimeout(wt,APPCFG.TIMEOUT_VIEWER_LOAD)}function bt(){typeof app!="undefined"&&app.loadingTimeout&&(clearTimeout(app.loadingTimeout),app.loadingTimeout=null)}function wt(){if(esri.id&&esri.id.dialog&&esri.id.dialog._alreadyInitialized&&!esri.id.mapTourTimeoutAlreadyFired){clearTimeout(app.loadingTimeout),yt(),esri.id._busy||(esri.id.mapTourTimeoutAlreadyFired=!0);return}loadingIndicator.stop(),loadingIndicator.setMessage(i18n.viewer.loading.fail+'<br /><button type="button" class="btn btn-medium btn-info" style="margin-top: 5px;" onclick="document.location.reload()">'+i18n.viewer.loading.failButton+"</button>",!0),app.map&&app.map.destroy()}function Et(){dojo.query("#fatalError .error-title")[0].innerHTML=i18n.viewer.errors.boxTitle}function St(){return w.environment!=["TPL","ENV","DEV"].join("_")}function xt(){return w.forcePreviewScreen==["TPL","PREVIEW","TRUE"].join("_")}function Tt(){return!r.browserSupportAttachementUsingFileReader()}function Nt(){return APPCFG&&APPCFG.COLORS&&APPCFG.COLORS.length==3&&APPCFG.COLOR_SCHEMES&&APPCFG.DEFAULT_SHARING_URL&&APPCFG.MINIMUM_MAP_WIDTH&&APPCFG.TIMEOUT_VIEWER_LOAD&&APPCFG.TIMEOUT_VIEWER_REQUEST&&APPCFG.TIMEOUT_BUILDER_REQUEST&&APPCFG.MAX_ALLOWED_POINTS&&APPCFG.PIN_CFG&&APPCFG.PIN_DEFAULT_CFG&&APPCFG.PIN_CFG[APPCFG.PIN_DEFAULT_CFG]&&APPCFG.ICON_CFG&&APPCFG.HEADER_LOGO_URL!=undefined&&APPCFG.HEADER_LOGO_TARGET!=undefined&&APPCFG.HEADER_LINK_TEXT!=undefined&&APPCFG.HEADER_LINK_URL!=undefined&&APPCFG.FIELDS_CANDIDATE&&APPCFG.CORS_SERVER}var w={forcePreviewScreen:"TPL_PREVIEW_FALSE",environment:"TPL_ENV_PRODUCTION"};return{init:E,isProd:St}}),define("storymaps/maptour/builder/DataPopup",["storymaps/utils/Helper","dojo/_base/lang"],function(e,t){var n={service:{currentVersion:10.1,serviceDescription:"",hasVersionedData:!1,supportsDisconnectedEditing:!0,supportedQueryFormats:"JSON, AMF",maxRecordCount:1e3,capabilities:"Query",description:"",copyrightText:"",spatialReference:{wkid:102100},initialExtent:{xmin:-20085668.703089,ymin:-20085668.703089,xmax:20085668.703089,ymax:20085668.703089,spatialReference:{wkid:102100}},fullExtent:{xmin:-20085668.703089,ymin:-20085668.703089,xmax:20085668.703089,ymax:20085668.703089,spatialReference:{wkid:102100}},allowGeometryUpdates:!0,units:"esriMeters",documentInfo:{Title:"",Author:"",Comments:"",Subject:"",Category:"",Keywords:""},tables:[],enableZDefaults:!1},layers:[{currentVersion:10.1,id:0,name:"arcgis.arcgis.MAP_TOUR",type:"Feature Layer",description:"",copyrightText:"",defaultVisibility:!0,editFieldsInfo:null,ownershipBasedAccessControlForFeatures:null,syncCanReturnChanges:!1,relationships:[],isDataVersioned:!1,supportsRollbackOnFailureParameter:!1,supportsStatistics:!0,supportsAdvancedQueries:!0,geometryType:"esriGeometryPoint",minScale:0,maxScale:0,extent:{xmin:-20085668.703089,ymin:-20085668.703089,xmax:20085668.703089,ymax:20085668.703089,spatialReference:{wkid:102100}},drawingInfo:{renderer:{type:"simple",symbol:{type:"esriSMS",style:"esriSMSCircle",color:[133,0,11,255],size:4,angle:0,xoffset:0,yoffset:0,outline:{color:[0,0,0,255],width:1}},label:"",description:""},transparency:0,labelingInfo:null},hasM:!1,hasZ:!1,allowGeometryUpdates:!0,hasAttachments:!0,htmlPopupType:"esriServerHTMLPopupTypeAsHTMLText",objectIdField:"objectid",globalIdField:"",displayField:"name",typeIdField:"",fields:[{name:"objectid",type:"esriFieldTypeOID",alias:"ObjectID",domain:null,editable:!1,nullable:!1},{name:"name",type:"esriFieldTypeString",alias:"Name",domain:null,editable:!0,nullable:!0,length:254},{name:"description",type:"esriFieldTypeString",alias:"Description",domain:null,editable:!0,nullable:!0,length:500},{name:"icon_color",type:"esriFieldTypeString",alias:"Icon color",domain:null,editable:!0,nullable:!0,length:254},{name:"pic_url",type:"esriFieldTypeString",alias:"Picture URL",domain:null,editable:!0,nullable:!0,length:254},{name:"thumb_url",type:"esriFieldTypeString",alias:"Thumbnail URL",domain:null,editable:!0,nullable:!0,length:254}],types:[],templates:[{name:"arcgis.arcgis.MAP_TOUR",description:"",prototype:{attributes:{name:null,description:null,icon_color:null,pic_url:null,thumb_url:null}},drawingTool:"esriFeatureEditToolPoint"}],maxRecordCount:1e3,supportedQueryFormats:"JSON, AMF",capabilities:"Create,Delete,Query,Update,Uploads,Editing",adminLayerInfo:{geometryField:{name:"Shape",srid:102100}}}]},r={visibility:!0,opacity:1,mode:0,popupInfo:{title:"arcgis.arcgis.MAP_TOUR: {name}",fieldInfos:[{fieldName:"objectid",label:"ObjectID",isEditable:!1,tooltip:"",visible:!1,format:null,stringFieldOption:"textbox"},{fieldName:"name",label:"Name",isEditable:!0,tooltip:"",visible:!0,format:null,stringFieldOption:"textbox"},{fieldName:"description",label:"Description",isEditable:!0,tooltip:"",visible:!0,format:null,stringFieldOption:"textbox"},{fieldName:"icon_color",label:"Icon color",isEditable:!0,tooltip:"",visible:!0,format:null,stringFieldOption:"textbox"},{fieldName:"pic_url",label:"Picture URL",isEditable:!0,tooltip:"",visible:!0,format:null,stringFieldOption:"textbox"},{fieldName:"thumb_url",label:"Thumbnail URL",isEditable:!0,tooltip:"",visible:!0,format:null,stringFieldOption:"textbox"}],description:null,showAttachments:!0,mediaInfos:[]}};return function(s){function y(){B();var e=_();if(e.length)return P(e),!1;D("progress");var t=c.val().replace(/ /g,"_"),r=M();return C(t).then(function(){S(n,t,r,a.getPortalUser()).then(x,w).then(N,w).then(b,w)},w),!1}function b(){if(g.html()==i18n.viewer.builderHTML.dataFooterError)return;D("succeed"),setTimeout(function(){f.resolve(),$(u).modal("hide")},800)}function w(e){e=="NAME_NOT_AVAILABLE"?(D("original"),P([i18n.viewer.builderHTML.dataSrvAlreadyExistsError])):D("error")}function E(){return v.attr("disabled")?!1:(f.reject(),!0)}function S(e,n,r,i){var s=t.clone(e),o=new dojo.Deferred;dojo.mixin(s.service,{name:n});var u=L()+"content/users/"+i.credential.userId+"/"+(r?r+"/":"")+"createService",a={createParameters:dojo.toJson(s.service),targetType:"featureService"};return k(u,a,!0).then(function(e){var t=T(e.serviceurl)+"/AddToDefinition",n={addToDefinition:dojo.toJson({layers:s.layers})},r=i.credential.token;k(t,n,!0,r).then(function(t){o.resolve(e)},function(){o.reject()})},function(){o.reject()}),o}function x(e){var n=new dojo.Deferred,r=a.getPortalUser(),i=L()+"content/users/"+r.credential.userId+"/shareItems",s=t.mixin(e,{f:"json",everyone:!1,items:e.itemId});return k(i,s,!0).then(function(){n.resolve(e)},function(){n.reject()}),n}function T(e){return e.replace("rest/services","admin/services").replace("/FeatureServer",".FeatureServer")}function N(n){var i=new dojo.Deferred,s=a.getPortalUser();e.prepareWebmapItemForCloning(l.itemData);var o=t.clone(l.item),u=t.clone(l.itemData),f=t.mixin({id:"maptour-layer1",title:"Map Tour layer",url:n.serviceurl+"/0",itemId:n.itemId},t.clone(r));u.operationalLayers.push(f);var c=L()+"content/users/"+s.credential.userId+(o.ownerFolder?"/"+o.ownerFolder:"")+"/addItem",h={item:o.item,title:o.title,tags:o.tags,extent:JSON.stringify(o.extent),text:JSON.stringify(u),type:o.type,typeKeywords:o.typeKeywords,overwrite:!0,thumbnailURL:o.thumbnailURL};return k(c,h,!0).then(function(){i.resolve()},function(){i.reject()}),i}function C(e){var t=new dojo.Deferred,n=L()+"portals/"+a.id+"/isServiceNameAvailable",r={f:"json",type:"Feature Service",name:e};return k(n,r,!0).then(function(e){e&&e.available?t.resolve():t.reject("NAME_NOT_AVAILABLE")},function(){t.reject()}),t}function k(e,t,n,r){var i=n||!1,t=t||{},r=r||"",s=esri.request({url:e,content:dojo.mixin(t,{f:"json",token:r}),callbackParamName:"callback",handleAs:"json"},{usePost:i});return s}function L(){var e=a.portalUrl;return a.portalUrl.match("/sharing/rest/$")?e=a.portalUrl.split("/").slice(0,-2).join("/")+"/":a.portalUrl.match("/sharing/rest$")?e=a.portalUrl.split("/").slice(0,-1).join("/")+"/":a.portalUrl.match("/sharing$")&&(e=a.portalUrl+"/"),e}function A(){h.append('<option data-id="-1">'+i18n.viewer.builderHTML.dataFolderListFetching+"</option>")}function O(e){h.empty(),h.append('<option data-id="">'+i18n.viewer.builderHTML.dataRootFolder+"</option>"),$.each(e,function(e,t){h.append('<option data-id="'+t.id+'">'+t.title+"</option>")})}function M(){return h.find("option:selected").data("id")}function _(){var e=[];c.val()?c.val().match(/[-<>#%:"?&+\/\\]/)&&e.push(i18n.viewer.builderHTML.dataSrcContainsInvalidChar):e.push(i18n.viewer.builderHTML.dataNameError);var t=M();return(t=="-1"||t.length!=32&&t.length!=0)&&e.push(i18n.viewer.builderHTML.dataFolderError),e}function D(e){e=="progress"?(m.attr("disabled","true"),v.attr("disabled","true"),g.html(i18n.viewer.builderHTML.dataFooterProgress+' <img src="resources/icons/loader-upload.gif" />'),g.show()):e=="succeed"?(m.attr("disabled","true"),v.attr("disabled","true"),g.html(i18n.viewer.builderHTML.dataFooterSucceed),g.show()):e=="original"?(m.removeAttr("disabled"),v.removeAttr("disabled"),g.html(""),g.hide()):e=="error"&&(m.removeAttr("disabled"),v.removeAttr("disabled"),g.html(i18n.viewer.builderHTML.dataFooterError),g.addClass("error"))}function P(e){B(),$.each(e,function(e,t){p.append("<li>"+t+"</li>")})}function H(){c.val(""),B(),D("orginal")}function B(){p.empty(),g.removeClass("error")}var o=this,u=s,a=null,f=null,l=null,c=$("#dataNameInput",u),h=$("#dataFolderListInput",u),p=$(".dataError",u),d=$(".modal-header .close",u),v=$(".btnClose",u),m=$(".btnSave",u),g=$(".dataFooterText",u);this.present=function(e,t){return a=e,l=t,f=new dojo.Deferred,A(),H(),a.getPortalUser().getFolders().then(O),d.click(E),v.click(E),m.click(y),$(u).modal(),f},this.initLocalization=function(){$(".modal-header h3",s).html(i18n.viewer.builderHTML.dataHeader),$(".modal-body .dataExplain",s).html(i18n.viewer.builderHTML.dataExplain),$(".modal-body .dataNameLbl",s).html(i18n.viewer.builderHTML.dataNameLbl+":"),$(".modal-body .dataFolderListLbl",s).html(i18n.viewer.builderHTML.dataFolderListLbl+":"),$(".modal-footer .btnClose",s).html(i18n.viewer.builderHTML.dataBtnClose),$(".modal-footer .btnSave",s).html(i18n.viewer.builderHTML.dataBtnSave)}}}),define("storymaps/maptour/builder/AddPopup",["esri/dijit/Geocoder","storymaps/utils/MovableGraphic","storymaps/utils/ResamplePicture","storymaps/maptour/core/MapTourHelper","storymaps/utils/Helper","storymaps/maptour/ui/MapCommand","dojo/has"],function(e,t,n,r,i,s,o){return function(u){function U(e){var t=!0;I.hide().html(""),i.browserSupportAttachementUsingFileReader()&&!f.pictureData?(v.eq(0).children(".tab-icon").removeClass("icon-ok").addClass("icon-exclamation-sign"),t=!1,I.eq(0).append("<li>"+i18n.viewer.addPopupJS.errorNoPhoto+"</li>").show()):!i.browserSupportAttachementUsingFileReader()&&M.html()==i18n.viewer.builderHTML.addNoThumbSelected?(v.eq(0).children(".tab-icon").removeClass("icon-ok").addClass("icon-exclamation-sign"),t=!1,I.eq(1).append("<li>"+i18n.viewer.addPopupJS.errorNoThumbnail+"</li>").show()):v.eq(0).children(".tab-icon").removeClass("icon-exclamation-sign").addClass("icon-ok");if(f.name===""){if(!v.eq(1).hasClass("disabled")||e)v.eq(1).children(".tab-icon").removeClass("icon-ok").addClass("icon-exclamation-sign"),I.eq(2).show();f.name===""&&I.eq(2).append("<li>"+i18n.viewer.addPopupJS.errorNoName+"</li>"),t=!1}else(!v.eq(1).hasClass("disabled")||e)&&v.eq(1).children(".tab-icon").removeClass("icon-exclamation-sign").addClass("icon-ok");if(!f.point){if(!v.eq(2).hasClass("disabled")||e)v.eq(2).children(".tab-icon").removeClass("icon-ok").addClass("icon-exclamation-sign"),I.eq(3).append("<li>"+i18n.viewer.addPopupJS.errorNoLocation+"</li>"),I.eq(3).show();t=!1}else(!v.eq(2).hasClass("disabled")||e)&&v.eq(2).children(".tab-icon").removeClass("icon-exclamation-sign").addClass("icon-ok");if(e)return t}function z(){v.children(".tab-icon").removeClass("icon-ok").removeClass("icon-exclamation-sign")}function W(e){e=="enabled"?(q.removeAttr("disabled"),R.removeAttr("disabled")):(q.attr("disabled","true"),R.attr("disabled","true"))}function X(e){i.browserSupportAttachementUsingFileReader()&&e&&e[0]?K(e[0]):Q()}function V(){z(),S.hide(),g.show(),J()}function J(){y.closest("form").get(0).reset(),_.closest("form").get(0).reset(),M.html(i18n.viewer.builderHTML.addNoThumbSelected),$(".addImage .pictureSize").html("").hide()}function K(e){if(e.type==="image/jpeg"){var t=new FileReader;t.onloadend=function(){var t=this.result;b.attr("src",t),f.pictureData=t,b.load(function(t){var r=t.currentTarget.naturalWidth,i=t.currentTarget.naturalHeight;n.resample(A,$("#addImagePreview"),r,i,app.config.thumbnailMaxWidth,app.config.thumbnailMaxHeight,window.orientation),L.show(),J();if(r>app.config.picRecommendedWidth||i>app.config.picRecommendedHeight||e.size>1e6){var s=n.resample(k,b,r,i,app.config.picRecommendedWidth,app.config.picRecommendedHeight,window.orientation),o=i18n.viewer.builderHTML.addPictureResolutionIntro;o+='<div style="font-weight: normal; padding-top: 2px">',o+=' <div><input type="radio" class="radio" name="picSize" value="resample" checked="checked" />'+i18n.viewer.builderHTML.addPictureResolutionResize.replace("%RESOLUTION%",s[0]+"x"+s[1]+"px")+"</div>",o+=' <div><input type="radio" class="radio" name="picSize" value="keep" />'+i18n.viewer.builderHTML.addPictureResolutionKeep.replace("%RESOLUTION%",r+"x"+i+"px")+"</div>",o+="</div>",$(".addImage .pictureSize").html(o).show()}}).fadeIn()},t.readAsDataURL(e);var r=new FileReader;r.onloadend=function(){var t=i.getBinaryStringFromArrayBuffer(this.result);x.hide(),S.show(),E.html(e.name.split(".")[0]).show();var n=EXIF.readFromBinaryFile(new BinaryFile(t));Y(n)},i.browserSupportFileReaderBinaryString()?r.readAsArrayBuffer(e):S.show(),$(".imageUploadWrapper").css("display","none")}else alert(i18n.viewer.addPopupJS.notJpg)}function Q(){$(".modal-footer .error",h).hide(),$(".modal-footer .success",h).html(i18n.viewer.addPopupJS.uploadingPicture).show(),$(".modal-footer .addSpinner",h).show(),app.data.addTemporaryTourPointUsingForm("addImageUploadFormPicture",G,function(e){$(".modal-footer .success",h).html(i18n.viewer.addPopupJS.uploadSuccess).hide(),$(".modal-footer .addSpinner",h).hide(),$(".modal-footer .error",h).html(i18n.viewer.addPopupJS.uploadError).show(),J()})}function G(e,t,n){$(".modal-footer .success",h).html("").hide(),$(".modal-footer .addSpinner",h).hide(),J(),f.objectId=e,f.pictureId=t,b.attr("src",n),b.load(function(){b.exifLoad(function(e){Y(e)}),b[0]&&(b[0].naturalWidth>app.config.picRecommendedWidth||b[0].naturalHeight>app.config.picRecommendedHeight)&&$(".addImage .pictureSize").html(i18n.viewer.builderHTML.addPictureResolutionOldBrowser.replace("%RECOMMENDED_RES%",app.config.picRecommendedWidth+"x"+app.config.picRecommendedHeight+"px")).show()}),b.fadeIn(),O.show(),S.show(),$(".imageUploadWrapper").css("display","none")}function Y(e){C.html(""),N.html(""),T.hide();if(!e)return;var t={camera:{setting:"CAMERA",string:"<i class='icon-camera' style='vertical-align:text-top'></i> "+e.Make+" "+e.Model,value:[e.Make,e.Model],smallSetting:!1},dateTaken:{setting:"DATE",string:"<i class='icon-calendar' style='vertical-align:text-top'></i> "+Z(e.DateTimeOriginal),value:[e.DateTimeOriginal],smallSetting:!1},location:{setting:"LATITUDE",string:"<i class='icon-globe' style='vertical-align:text-top'></i> "+Math.round(Math.abs(tt(e.GPSLatitude,e.GPSLatitudeRef))*1e3)/1e3+e.GPSLatitudeRef+" "+Math.round(Math.abs(tt(e.GPSLongitude,e.GPSLongitudeRef))*1e3)/1e3+e.GPSLongitudeRef,value:[e.GPSLatitude,e.GPSLatitudeRef,e.GPSLongitude,e.GPSLongitudeRef],smallSetting:!1},shutterSpeed:{setting:"SHUTTER SPEED",string:et(e.ExposureTime)+" s",value:[e.ExposureTime],smallSetting:!0},aperture:{setting:"APERTURE",string:"f/"+parseFloat(e.ApertureValue).toFixed(1),value:[e.ApertureValue],smallSetting:!0},sensitivity:{setting:"SENSITIVITY",string:"ISO "+e.ISOSpeedRatings,value:[e.ISOSpeedRatings],smallSetting:!0}};for(var n in t){var r=!0;$.each(t[n].value,function(e,t){t||(r=!1)}),r&&(t[n].smallSetting?(C.append("<p class='cameraSmallSettings'>"+t[n].string+"</p>"),C.show(),T.show()):(N.append("<p class='cameraSettings'>"+t[n].string+"</p>"),N.show()),x.show()),$(".cameraSmallSettings").each(function(){$(this).position().left+$(this).width()>$(this).offsetParent().width()&&$(this).before("<br>")})}if(e.GPSLongitude&&e.GPSLatitude){var i=tt(e.GPSLatitude,e.GPSLatitudeRef),s=tt(e.GPSLongitude,e.GPSLongitudeRef);it(new esri.geometry.Point(s,i))}}function Z(e){if(e){var t=e.split(":"),n=t[0],r=t[1],i=t[2].split(" "),s=i[0],o=new Date(n,r,s);return o.getMonth()+1+"/"+o.getDate()+"/"+o.getFullYear()}}function et(e){if(e){var t;if(e<1){var n=parseFloat(e);t="1/"+Math.round(1/n)}else t=e;return t}}function tt(e,t){if(e&&t)return t==="S"||t==="W"?-(e[0]+(e[1]+e[2]/60)/60):e[0]+(e[1]+e[2]/60)/60}function nt(){f.point||(f.point=app.map.extent.getCenter(),it(f.point)),l=new esri.Map("locateMap",{slider:!0,center:f.point,zoom:app.map.getLevel(),extent:app.map.extent,autoResize:!1});var e=app.map.getLayer(app.map.layerIds[0]);l.addLayer(i.cloneLayer(e));var n=new esri.layers.GraphicsLayer;l.addLayer(n),l.pointLayer=n;var u=new esri.geometry.Point(f.point),a=r.getSymbol(f.color,app.data.getTourPoints().length+1,"selected");n.add(new esri.Graphic(u,a));var h=dojo.connect(l,"onUpdateEnd",function(){dojo.disconnect(h),l.disableKeyboardNavigation(),new t(l,n,n.graphics[0],st),new s(l,function(e){l.setExtent(l._params.extent);if(!e.contains(l.pointLayer.graphics[0].geometry)){l.pointLayer.setVisibility(!1);var t=dojo.connect(l,"onExtentChange",function(){dojo.disconnect(t),l.pointLayer.graphics[0].setGeometry(e.getCenter()),l.pointLayer.setVisibility(!0)})}},o("touch")?ut:null)});$("#locateMap").append("<div id='geocoder'></div>"),c=new esri.dijit.Geocoder({map:l},"geocoder"),c.startup(),$("#geocoder_input").attr("placeholder",i18n.viewer.builderHTML.addLocatePlaceholder+"..."),dojo.connect(c,"onFindResults",function(e){l.geocodedResult=!0}),dojo.connect(c,"onSelect",function(){o("ios")&&document.activeElement.blur()}),dojo.connect(l,"onExtentChange",function(){l.geocodedResult&&(l.geocodedResult=!1,n.graphics[0].setGeometry(l.extent.getCenter()),it(l.extent.getCenter()))})}function rt(e){$("body").bind("touchstart",function(t){t.target!=e&&$("body").scrollTop(0)})}function it(e){e&&e instanceof esri.geometry.Point?(f.point=e,e.spatialReference.wkid===4326||e.spatialReference.wkid===102100?($(".locationForm").show(),B.val(Math.round(e.getLongitude()*1e3)/1e3),H.val(Math.round(e.getLatitude()*1e3)/1e3)):$(".locationForm").hide()):f.point=new esri.geometry.Point(B.val(),H.val()),l&&(l.pointLayer.graphics[0].setGeometry(f.point),l.extent.contains(l.pointLayer.graphics[0].geometry)||l.centerAt(f.point))}function st(e){it(e.geometry)}function ot(){j.find(".pinSelector").removeClass("selected"),$(this).addClass("selected"),l.pointLayer.graphics[0].setSymbol(l.pointLayer.graphics[0].symbol.setUrl($(this).attr("src")));var e=$(this).index(),t=$.grep(r.getSymbolColors(),function(t,n){return n==e});f.color=t[0]}function ut(e,t){if(e){if(l.spatialReference.wkid==102100)t=esri.geometry.geographicToWebMercator(t);else if(l.spatialReference.wkid!=4326)return;it(t)}}function at(){y=$("input.uploadButton",h),y.change(function(){X(this.files)}),_=O.find("input"),_.change(function(){if(!_[0].value)return;I.eq(1).html(""),M.html(i18n.viewer.builderHTML.addThumbSelected+" "+_[0].value.split("\\").splice(-1)[0])}),i.browserSupportAttachementUsingFileReader()&&g.on("dragover",function(e){e.preventDefault(),e.stopPropagation(),$(this).css("border-color","#52a552")}).on("drop",function(e){e.originalEvent.dataTransfer&&e.originalEvent.dataTransfer.files.length&&(e.preventDefault(),e.stopPropagation(),X(e.originalEvent.dataTransfer.files)),$(this).css("border-color","#848484")}).on("dragleave",function(e){e.preventDefault(),e.stopPropagation(),$(this).css("border-color","#848484")})}var a=this,f,l,c,h=u,p=$(h).find(".clearVal"),d=$(h).find(".clearHTML"),v=$(h).find(".tab"),m=$(h).find(".tab-content"),g=$(h).find(".imageUploadWrapper"),y=$("input.uploadButton",h),b=$(h).find(".imagePreview"),w=$(h).find(".changePhoto button"),E=$(h).find(".imagePreviewName"),S=$(h).find(".previewPanel"),x=$(h).find(".exifData"),T=$(h).find(".exifMinorHeader"),N=$(h).find(".exifMajor"),C=$(h).find(".exifMinor"),k=$("<canvas>").get(0),L=$(h).find(".thumbnailFile"),A=document.getElementById("thumbnailFileCanvas"),O=$(h).find(".thumbnailForm"),M=O.find(".fileName"),_=O.find("input"),D=$(h).find(".tourPointNameField"),P=$(h).find(".tourPointDescr"),H=$(h).find(".latitude"),B=$(h).find(".longitude"),j=$(h).find(".pinContainer"),F=$("#locateMap"),I=$(h).find(".errorList"),q=$(h).find(".modal-footer .btnSave"),R=$(h).find(".modal-footer .btnClose");this.present=function(){if(app.data.getMaxAllowedFeatureReached()||app.data.getTourPoints().length>=APPCFG.MAX_ALLOWED_POINTS){app.data.setMaxAllowedFeatureReached(!0),$("#addPopup .maxPictureReached").show(),$("#addPopup .tab-content").hide(),v.unbind("click"),v.css("cursor","default"),v.removeClass("active"),v.eq(0).addClass("active"),z(),q.hide(),R.html(i18n.viewer.builderHTML.addClose).removeAttr("disabled"),$(h).modal();return}f={objectId:null,pictureId:null,pictureData:null,name:"",description:"",color:APPCFG.PIN_DEFAULT_CFG,point:null},v.removeClass("active"),v.eq(0).addClass("active"),v.eq(1).addClass("disabled"),v.eq(2).addClass("disabled"),z(),m.hide(),m.eq(0).show(),B.val(""),H.val(""),W("enabled"),I.hide(),p.val(""),d.html("").hide(),J(),T.hide(),L.hide(),$(".imageUploadWrapper").css("display","block"),S.hide(),b.attr("src","").hide(),O.hide(),A.getContext("2d").clearRect(0,0,A.width,A.height),l&&(l.destroy(),l=null,c.destroy(),c=null),j.empty(),f.color=APPCFG.PIN_DEFAULT_CFG,$.each(r.getSymbolColors(),function(e,t){var n=t==APPCFG.PIN_DEFAULT_CFG?"selected":"";j.append('<img class="pinSelector '+n+'" src="'+r.getSymbolUrl(t,app.data.getTourPoints().length+1)+'" alt="" />')}),$(h).find(".pinSelector").fastClick(ot),$(".modal-footer .error",h).hide(),$(h).modal()},v.fastClick(function(){U(),v.removeClass("active"),$(this).addClass("active"),m.hide(),m.eq($(this).index()).show();if($(this).index()==2){o("ios")&&$("body").scrollTop(0);if(!l)nt();else{var e=new esri.geometry.Point(f.point||app.map.extent.getCenter());(H.val()==""||B.val()=="")&&it(e)}}$(this).removeClass("disabled")}),q.click(function(){if(U(!0)){$(".modal-footer .error",h).hide(),$(".modal-footer .success",h).html(i18n.viewer.builderHTML.addUploading),$(".modal-footer .success",h).show(),$(".modal-footer .addSpinner",h).show(),W("disabled");var e=function(){$(".modal-footer .success",h).html(i18n.viewer.addPopupJS.uploadSuccess),$(".modal-footer .addSpinner",h).hide(),setTimeout(function(){$(".modal-footer .success",h).html(i18n.viewer.builderHTML.addUploading).hide(),$(h).modal("hide")},1e3)},t=function(){$(".modal-footer .success",h).html(i18n.viewer.addPopupJS.uploadSuccess).hide(),$(".modal-footer .addSpinner",h).hide(),$(".modal-footer .error",h).html(i18n.viewer.addPopupJS.uploadError).show(),W("enabled")};if(f.objectId&&f.pictureId)app.data.saveTemporaryTourPointUsingForm(f.objectId,f.point,f.name,f.description,f.color,f.pictureId,"addImageUploadFormThumbnail",e,t);else{var n=$("input[name=picSize]:checked").val();n=="resample"&&(f.pictureData=k.toDataURL("image/jpeg")),app.data.addTourPointUsingData(f.point,f.name,f.description,f.color,f.pictureData,A.toDataURL("image/jpeg"),e,t)}}else $(".modal-footer .error",h).html(i18n.viewer.builderHTML.tabError).show()}),w.fastClick(V),D.change(function(){f.name=D.val()}),P.change(function(){f.description=P.val()}),H.change(it),B.change(it),H.click(function(){rt(H.get(0))}),B.click(function(){rt(B.get(0))}),this.initLocalization=function(){dojo.query("#addPopup .maxPictureReached")[0].innerHTML=i18n.viewer.builderHTML.addMaxPointReached,dojo.query("#addPopup h3")[0].innerHTML=i18n.viewer.builderHTML.addHeader,dojo.query("#addPopup .tab")[0].innerHTML+=i18n.viewer.builderHTML.addTabPicture,dojo.query("#addPopup .tab")[1].innerHTML+=i18n.viewer.builderHTML.addTabInformation,dojo.query("#addPopup .tab")[2].innerHTML+=i18n.viewer.builderHTML.addTabLocation;var e=i.browserSupportAttachementUsingFileReader()?i18n.viewer.builderHTML.addSelectCaption:i18n.viewer.builderHTML.addSelectCaptionNoFileReader;$(y).attr("title",e),$(y).closest("a").html($(y).closest("a").html().replace("Browse",e)),$("#addPopup #addImageUploadFormThumbnail a").html($("#addPopup #addImageUploadFormThumbnail a").html().replace("Browse",i18n.viewer.builderHTML.addSelectThumbnail)),at(),M.html(i18n.viewer.builderHTML.addNoThumbSelected),dojo.query("#addPopup .changePhoto button")[0].innerHTML=i18n.viewer.builderHTML.addChangePhoto,dojo.query("#addPopup .settingHeading")[0].innerHTML=i18n.viewer.builderHTML.addCameraSettingsHeader,dojo.query("#addPopup .settingHeading")[1].innerHTML=i18n.viewer.builderHTML.addThumbnailHeader,dojo.query("#addPopup .addText label")[0].innerHTML=i18n.viewer.builderHTML.addLabelName,dojo.query("#addPopup .addText label")[1].innerHTML=i18n.viewer.builderHTML.addLabelDescription,dojo.attr(dojo.query("#addPopup .addText input")[0],"placeholder",i18n.viewer.builderHTML.addTextPlaceholder+"..."),dojo.attr(dojo.query("#addPopup .addText textarea")[0],"placeholder",i18n.viewer.builderHTML.addTextPlaceholder+"..."),dojo.query("#addPopup .addLocation label")[0].innerHTML=i18n.viewer.builderHTML.addPinColor,dojo.query("#addPopup .addLocation label")[1].innerHTML=i18n.viewer.builderHTML.addLatitude,dojo.query("#addPopup .addLocation label")[2].innerHTML=i18n.viewer.builderHTML.addLongitude,dojo.attr(dojo.query("#addPopup .addLocation input")[0],"placeholder",i18n.viewer.builderHTML.addLatitudePlaceholder),dojo.attr(dojo.query("#addPopup .addLocation input")[1],"placeholder",i18n.viewer.builderHTML.addLongitudePlaceholder),dojo.query("#addPopup .error")[0].innerHTML=i18n.viewer.builderHTML.tabError,dojo.query("#addPopup .success")[0].innerHTML=i18n.viewer.builderHTML.addUploading,dojo.query("#addPopup .btnClose")[0].innerHTML=i18n.viewer.builderHTML.modalCancel,dojo.query("#addPopup .btnSave")[0].innerHTML=i18n.viewer.builderHTML.addSave}}}),define("storymaps/maptour/builder/SettingsPopup",["dijit/ColorPalette","dijit/Dialog","storymaps/maptour/core/FieldConfig","storymaps/maptour/core/MapTourHelper","storymaps/utils/Helper","esri/toolbars/Draw","esri/toolbars/Edit"],function(e,t,n,r,i){return function(t,n,s){function P(e){T&&T.destroy(),T=null,l.removeClass("alreadyOpened"),e||(e=new esri.geometry.Extent({xmax:-57.98033474158346,xmin:-126.91406249996473,ymax:50.25667033538553,ymin:21.9430455334323,spatialReference:{wkid:4326}})),T=new esri.Map("extentMap",{slider:!0,center:e.getCenter(),extent:e.expand(2),autoResize:!1});var t=app.map.getLayer(app.map.layerIds[0]);T.addLayer(i.cloneLayer(t));var n=new esri.layers.GraphicsLayer;$.each(app.data.getTourPoints(),function(e,t){n.add(new esri.Graphic(t.geometry,r.getSymbol(t.attributes.getColor(),e+1)))}),T.addLayer(n);var s=new esri.layers.GraphicsLayer({id:"extentlayer"});s.add(H(e)),T.addLayer(s),dojo.connect(T,"onLoad",function(){A=new esri.toolbars.Draw(T),O=new esri.toolbars.Edit(T),dojo.connect(A,"onActivate",function(){s.clear(),O.deactivate(),L=!0}),dojo.connect(A,"onDrawEnd",function(e){s.add(H(e)),A.deactivate(),L=!1}),dojo.connect(s,"onClick",function(e){L==0&&(dojo.stopEvent(e),O.activate(esri.toolbars.Edit.MOVE|esri.toolbars.Edit.SCALE,e.graphic))}),dojo.connect(s,"onMouseOver",function(){T.setMapCursor("pointer")}),dojo.connect(s,"onMouseOut",function(){T.setMapCursor("default")}),dojo.connect(T,"onClick",function(e){O.deactivate()})})}function H(e){return new esri.Graphic(i.extentToPolygon(e),new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_DASHDOT,new dojo.Color([255,0,0]),2),new dojo.Color([255,255,0,.25])))}function B(){return T.getLayer("extentlayer")&&T.getLayer("extentlayer").graphics&&T.getLayer("extentlayer").graphics.length>0?T.getLayer("extentlayer").graphics[0]:null}function j(){return $("#settingsPopup #layout .layout-box.selected").index()==2?"integrated":"three-panel"}function F(e){I($(e.target).parent().index()==2?1:0)}function I(e){$("#settingsPopup #layout .layout-box").removeClass("selected"),$("#settingsPopup #layout .layout-box").eq(e?1:0).addClass("selected")}function q(e){Z();if(et()==n.length)$("#headerSimulator",f).css("background-color",$(p).val());else{var t=$.grep(n,function(e,t){return e.name==Q()})[0];$("#headerSimulator",f).css("background-color",t.headerColor)}}function R(e){Y()}function U(e){}function z(e){b=!0,$("#imgLogo",f).hide()}function W(e){if($(this).hasClass("disabled"))return;l.removeClass("active"),$(this).addClass("active"),c.hide(),c.eq($(this).index()).show();if($(e.target).index()==4&&!$(e.target).hasClass("alreadyOpened")){T.resize();var t=dojo.connect(T,"onUpdateEnd",function(e,n){dojo.disconnect(t),T.centerAt(T.getLayer("extentlayer").graphics[0].geometry.getExtent().getCenter())});$(e.target).addClass("alreadyOpened")}}function X(e){if(e.keyCode==13)return b=!1,V(),!1;e.keyCode==8&&($("#logoTargetInput").focus(),$("#logoInput").focus())}function V(){var e=$.trim($("#logoInput",f).val());e&&($("#imgLogo",f).attr("src",e),$("#imgLogo",f).show())}function J(e){e.keyCode==8&&($("#logoInput").focus(),$("#logoTargetInput").focus())}function K(){var e=$(E).find(":selected").val(),t=$(S).find(":selected").val(),r=$(x).find(":selected").val();if(!e||e=="-1"||!t||t=="-1"||!r||r=="-1")return $("#fields .error-msg2",f).show(),l.removeClass("active disabled"),l.eq(3).addClass("active"),c.hide(),c.eq(3).show(),!1;var i={fieldID:w.getIDField(),fieldName:e,fieldDescription:t,fieldURL:w.getURLField(),fieldThumb:w.getThumbField(),fieldIconColor:r},s=Q(),o;if(s=="schemeCustom")o=[$(p).val(),$(d).val(),$(v).val()];else{var u=$.grep(n,function(e,t){return e.name==s})[0];o=[u.headerColor,u.middleColor,u.footerColor]}var a=$("input[name=optionsLogo]:checked",$(f)).val(),h,m;a=="none"?(h=null,m=""):a=="esri"?(h=y,m=""):(h=b?y:$("#imgLogo",f).attr("src"),m=g.val()),dojo.publish("SETTINGS_POPUP_SAVE",{layout:j(),colors:o,fieldConfig:i,logoURL:h,logoTarget:m,headerLinkText:$("#selectSocialText",f).val(),headerLinkURL:$("#selectSocialLink",f).val(),extent:B().geometry.getExtent(),zoomLevel:$("#listZoomLevels").find(":selected").attr("value")})}function Q(){return $("input[name=groupColorSchemes]:checked",$(f)).val()}function G(e){if(!e||!e[0]||!e[1]||!e[2])tt(1);else{var t=!1;$.each(n,function(n,r){var i=e[0]==r.headerColor&&e[1]==r.middleColor&&e[2]==r.footerColor;i&&(t=!0,tt(n+1))}),t||tt(n.length+1)}Z()}function Y(){var e=$("input[name=optionsLogo]:checked",$(f)).val();$("#imgLogo",f).hide(),e=="custom"?V():e=="esri"&&($("#imgLogo",f).attr("src",y),$("#imgLogo",f).show())}function Z(){et()==n.length?($(p).spectrum("enable"),$(d).spectrum("enable"),$(v).spectrum("enable")):($(p).spectrum("disable"),$(d).spectrum("disable"),$(v).spectrum("disable"))}function et(){var e=-1;return $("#settingsPopup #appearance .controls tr td:nth-child(1) input").each(function(t,n){$(n).is(":checked")&&(e=t)}),e}function tt(e){$("#settingsPopup #appearance .controls tr:nth-child("+e+") td:nth-child(1) input").attr("checked","true")}function nt(e){$(e).spectrum({showButtons:!1,color:o,showPalette:!1,showSelectionPalette:!1,showPaletteOnly:!1,showInput:!0})}function rt(){if(!n)return;var e=$("<table></table>"),t;return $.each(n,function(n,r){if(!r.name||!r.headerColor||!r.middleColor||!r.footerColor)return;t=$("<tr></tr>");var i=$("<input type='radio' class='radio' name='groupColorSchemes'/>");$(i).attr("value",r.name);var s=$("<td></td>");$(s).append(i),$(t).append(s),$(t).append("<td><div class='swatch' style='background-color:"+r.headerColor+"'></div></td>"),$(t).append("<td><div class='swatch' style='background-color:"+r.middleColor+"'></div></td>"),$(t).append("<td><div class='swatch' style='background-color:"+r.footerColor+"'></div></td>"),$(e).append(t)}),t=$("<tr></tr>"),$(t).append("<td><input type='radio' class='radio' name='groupColorSchemes' value='schemeCustom'/></td>"),$(t).append("<td><input id='inputCustomHeaderColor' class='colorInput' type='custom'/></td>"),$(t).append("<td><input id='inputCustomMiddleColor' class='colorInput' type='custom'/></td>"),$(t).append("<td><input id='inputCustomFooterColor' class='colorInput' type='custom'/></td>"),$(e).append(t),e}var o="#C0C0C0",u=[{lbl:"-",scale:0,lvl:-1},{lbl:"1:591M (level 0)",scale:591657527.591555,lvl:0},{lbl:"1:295M (level 1)",scale:295828763.795777,lvl:1},{lbl:"1:147M (level 2)",scale:147914381.897889,lvl:2},{lbl:"1:74M (level 3)",scale:73957190.948944,lvl:3},{lbl:"1:37M (level 4)",scale:36978595.474472,lvl:4},{lbl:"1:18M (level 5)",scale:18489297.737236,lvl:5},{lbl:"1:9.2M (level 6)",scale:9244648.868618,lvl:6},{lbl:"1:4.6M (level 7)",scale:4622324.434309,lvl:7},{lbl:"1:2.3M (level 8)",scale:2311162.217155,lvl:8},{lbl:"1:1.1M (level 9)",scale:1155581.108577,lvl:9},{lbl:"1:580K (level 10)",scale:577790.554289,lvl:10},{lbl:"1:290K (level 11)",scale:288895.277144,lvl:11},{lbl:"1:145K (level 12)",scale:144447.638572,lvl:12},{lbl:"1:72K (level 13)",scale:72223.819286,lvl:13},{lbl:"1:36K (level 14)",scale:36111.909643,lvl:14},{lbl:"1:18K (level 15)",scale:18055.954822,lvl:15},{lbl:"1:9K (level 16)",scale:9027.977411,lvl:16},{lbl:"1:4.5K (level 17)",scale:4513.988705,lvl:17},{lbl:"1:2K (level 18)",scale:2256.994353,lvl:18},{lbl:"1:1K (level 19)",scale:1128.497176,lvl:19}];n.splice(0,0,{name:"Gray",headerColor:APPCFG.COLORS[0],middleColor:APPCFG.COLORS[1],footerColor:APPCFG.COLORS[2]});var a=this,f=t,l=$(f).find(".tab"),c=$(f).find(".tab-content"),h,p,d,v,m=$(f).find("#logoInput"),g=$(f).find("#logoTargetInput"),y=s,b=!1,w,E=$(f).find("#selectName"),S=$(f).find("#selectDescription"),x=$(f).find("#selectColor"),T=null,N=$(f).find("#extentDraw"),C=$(f).find("#extentModify"),k=$(f).find("#extentApply"),L=!1,A=null,O=null,M=$("#listZoomLevels",f),_=$(f).find(".btnSave"),D=$(f).find(".btnClose");$("#settingsPopup #layout .layout-box button").fastClick(F),h=rt(),$("#appearance #colorScheme .controls",f).append(h),p=$("#inputCustomHeaderColor",h),d=$("#inputCustomMiddleColor",h),v=$("#inputCustomFooterColor",h),nt(p),nt(d),nt(v),$(p).spectrum("set",o),$(d).spectrum("set",o),$(v).spectrum("set",o),_.click(K),l.click(W),$(m).keydown(X),$(m).blur(V),$(g).keydown(J),$("input[name=groupColorSchemes]",$(h)).click(q),$(p).bind("change",function(e){$("#headerSimulator",f).css("background-color",$(this).val())}),$("input[type=radio]","#logo").click(R),$("#imgLogo",f).error(z),$("#imgLogo",f).load(U),N.click(function(){A.activate(esri.toolbars.Draw.EXTENT)}),C.click(function(){O.activate(esri.toolbars.Edit.MOVE|esri.toolbars.Edit.SCALE,B())}),k.click(function(){var e=B();e&&dojo.publish("CORE_UPDATE_EXTENT",e.geometry.getExtent())}),this.present=function(e){l.removeClass("active disabled"),l.eq(0).addClass("active"),c.hide(),c.eq(0).show(),D.removeAttr("disabled"),$(".error-msg",f).hide(),$(".modal-header .close",f).attr("data-dismiss","modal"),$(".modal-footer .error",f).hide(),$("#fields .error-msg2",f).hide(),I(e.layout=="integrated"?1:0),G(e.currentColors);var t=$("input[name=groupColorSchemes]",f).length;$("input[name=groupColorSchemes]",f).eq(t-1).attr("checked")=="checked"&&($(p).spectrum("set",e.currentColors[0]),$(d).spectrum("set",e.currentColors[1]),$(v).spectrum("set",e.currentColors[2])),$(E).empty(),$(S).empty(),$(x).empty(),w=e.fieldConfig;var n=foundDescription=foundColor=!1;$.each(e.allFields,function(e,t){var r=selectedDesc=selectedColor="";t.name==w.getNameField()&&(r='selected="selected"',n=!0),t.name==w.getDescriptionField()&&(selectedDesc='selected="selected"',foundDescription=!0),t.name==w.getIconColorField()&&(selectedColor='selected="selected"',foundColor=!0),$(E).append('<option value="'+t.name+'" '+r+">"+t.alias+"</option>"),$(S).append('<option value="'+t.name+'" '+selectedDesc+">"+t.alias+"</option>"),$(x).append('<option value="'+t.name+'" '+selectedColor+">"+t.alias+"</option>")}),n||$(E).prepend('<option value="-1" selected="selected">---</option>'),foundDescription||$(selectedDesc).prepend('<option value="-1" selected="selected">---</option>'),foundColor||$(x).prepend('<option value="-1" selected="selected">---</option>');var r=e.logoURL;m.attr("disabled","true"),g.attr("disabled","true"),$("input[name='optionsLogo']",$(f)).change(function(){var e=$("input[name='optionsLogo']:checked",$(f)).val();e=="none"||e=="esri"?(m.attr("disabled","true"),g.attr("disabled","true")):(m.removeAttr("disabled"),g.removeAttr("disabled"))}),$("#headerSimulator",f).css("background-color",e.currentColors[0]),r==null?($("input[name=optionsLogo]:eq(1)",f).attr("checked","checked"),m.val(""),g.val("")):r==y?($("input[name=optionsLogo]:eq(0)",f).attr("checked","checked"),$("#imgLogo",f).show(),m.val(""),g.val("")):($("input[name=optionsLogo]:eq(2)",f).attr("checked","checked"),$("#imgLogo",f).attr("src",r),$("#imgLogo",f).show(),$("#logoInput",f).val(r),g.val(e.logoTarget),m.removeAttr("disabled"),g.removeAttr("disabled")),$("#selectSocialText",f).val(e.headerLinkText),$("#selectSocialLink",f).val(e.headerLinkURL),Y(),P(e.extent),$("#listZoomLevels").children().length==0&&$(u).each(function(e,t){M.append('<option value="'+t.lvl+'">'+t.lbl+"</option>")});var i=$.grep($("option",M),function(t,n){return t.value==e.zoomLevel});i[0]&&$(i[0]).attr("selected","selected"),e.fieldsError&&(l.removeClass("active"),l.addClass("disabled"),l.eq(3).removeClass("disabled"),c.hide(),$(".error-msg",f).show(),l.eq(3).addClass("active"),c.eq(3).show(),D.attr("disabled","disabled"),$(".modal-header .close",f).attr("data-dismiss","none")),$(f).modal({keyboard:!e.fieldsError})},this.initLocalization=function(){dojo.query("#settingsPopup h3")[0].innerHTML=i18n.viewer.builderHTML.settingsHeader,dojo.query("#settingsPopup .tab")[0].innerHTML=i18n.viewer.builderHTML.settingsTabLayout,dojo.query("#settingsPopup .tab")[1].innerHTML=i18n.viewer.builderHTML.settingsTabColor,dojo.query("#settingsPopup .tab")[2].innerHTML=i18n.viewer.builderHTML.settingsTabLogo,dojo.query("#settingsPopup .tab")[3].innerHTML=i18n.viewer.builderHTML.settingsTabFields,dojo.query("#settingsPopup .tab")[4].innerHTML=i18n.viewer.builderHTML.settingsTabExtent,dojo.query("#settingsPopup .tab")[5].innerHTML=i18n.viewer.builderHTML.settingsTabZoom,dojo.query("#settingsPopup #layout p")[0].innerHTML=i18n.viewer.builderHTML.settingsLayoutExplain,dojo.query("#settingsPopup #layout .layout-box:nth-child(2) div")[0].innerHTML=i18n.viewer.builderHTML.settingsLayoutProfessional,dojo.query("#settingsPopup #layout .layout-box:nth-child(2) img")[0].src="resources/icons/builder-professional-layout.png",dojo.query("#settingsPopup #layout .layout-box:nth-child(3) div")[0].innerHTML=i18n.viewer.builderHTML.settingsLayoutModern,dojo.query("#settingsPopup #layout .layout-box:nth-child(3) img")[0].src="resources/icons/builder-modern-layout.png",$("#settingsPopup #layout .layout-box .selectedLayout").html(i18n.viewer.builderHTML.settingsLayoutSelected),$("#settingsPopup #layout .layout-box button").html(i18n.viewer.builderHTML.settingsLayoutSelect),dojo.query("#settingsPopup #appearance p")[0].innerHTML=i18n.viewer.builderHTML.settingsColorExplain,dojo.query("#settingsPopup .control-label")[0].innerHTML=i18n.viewer.builderHTML.settingsLabelColor+":",dojo.query("#settingsPopup #logo p")[0].innerHTML=i18n.viewer.builderHTML.settingsLogoExplain,dojo.query("#settingsPopup .logoText")[0].innerHTML=i18n.viewer.builderHTML.settingsLogoEsri,dojo.query("#settingsPopup .logoText")[1].innerHTML=i18n.viewer.builderHTML.settingsLogoNone,dojo.query("#settingsPopup .logoText")[2].innerHTML=i18n.viewer.builderHTML.settingsLogoCustom,dojo.attr(dojo.byId("logoInput"),"placeholder",i18n.viewer.builderHTML.settingsLogoCustomPlaceholder),dojo.attr(dojo.byId("logoTargetInput"),"placeholder",i18n.viewer.builderHTML.settingsLogoCustomTargetPlaceholder),dojo.query("#settingsPopup #logo p")[1].innerHTML=i18n.viewer.builderHTML.settingsLogoSocialExplain,dojo.query("#settingsPopup .control-label[for=selectSocialText]")[0].innerHTML=i18n.viewer.builderHTML.settingsLogoSocialText+":",dojo.query("#settingsPopup .control-label[for=selectSocialLink]")[0].innerHTML=i18n.viewer.builderHTML.settingsLogoSocialLink+":",dojo.query("#settingsPopup #fields .error-msg")[0].innerHTML=i18n.viewer.builderHTML.settingsDataFieldsError,dojo.query("#settingsPopup #fields .error-msg2")[0].innerHTML=i18n.viewer.builderHTML.settingsFieldError,dojo.query("#settingsPopup #fields p")[0].innerHTML=i18n.viewer.builderHTML.settingsDataFieldsExplain,dojo.query("#settingsPopup #fields .control-label")[0].innerHTML=i18n.viewer.builderHTML.settingsFieldsLabelName+":",dojo.query("#settingsPopup #fields .control-label")[1].innerHTML=i18n.viewer.builderHTML.settingsFieldsLabelDescription+":",dojo.query("#settingsPopup #fields .control-label")[2].innerHTML=i18n.viewer.builderHTML.settingsFieldsLabelColor+":",dojo.query("#settingsPopup #extent p")[0].innerHTML=i18n.viewer.builderHTML.settingsExtentExplain,dojo.query("#settingsPopup #extent .explain2")[0].innerHTML=i18n.viewer.builderHTML.settingsExtentExplainBottom,N.html(i18n.viewer.builderHTML.settingsExtentDrawBtn),C.html(i18n.viewer.builderHTML.settingsExtentModifyBtn),k.html(i18n.viewer.builderHTML.settingsExtentApplyBtn),dojo.query("#settingsPopup #zoom .form-horizontal p")[0].innerHTML=i18n.viewer.builderHTML.settingsZoomExplain,dojo.query("#settingsPopup #zoom .control-label")[0].innerHTML=i18n.viewer.builderHTML.settingsLabelZoom+":",u[0].lbl=i18n.viewer.builderHTML.settingsZoomFirstValue,dojo.query("#settingsPopup .btnClose")[0].innerHTML=i18n.viewer.builderHTML.modalCancel,dojo.query("#settingsPopup .btnSave")[0].innerHTML=i18n.viewer.builderHTML.modalApply,dojo.query("#settingsPopup .error")[0].innerHTML=i18n.viewer.builderHTML.tabError}}}),define("storymaps/maptour/builder/OrganizePopup",["storymaps/maptour/core/MapTourHelper"],function(e){return function(n){function h(e){l&&$(".halo",l).hide(),l=e,$(".halo",l).show(),y(!0)}function p(){if(c.length!=0)return d(),!1;v()}function d(){o.popover({html:!0,trigger:"manual",content:'<script>$("#organizePopup .btnSave").next(".popover").addClass("savePopover");</script>'+b(c.length)+' <button type="button" class="btn btn-danger btn-small" onclick="app.builder.organizePopupSaveConfirmationCallback(true);">'+i18n.viewer.builderJS.yes+"</button> "+'<button type="button" class="btn btn-small" onClick="app.builder.organizePopupSaveConfirmationCallback(false);">'+i18n.viewer.builderJS.no+"</button>"}),o.popover("show")}function v(){var e=$(s).find("li").map(function(e,t){return{id:parseInt($(this).data("featureid")),visible:$(this).find(".veil").css("display")=="none"}});dojo.publish("ORGANIZE_POPUP_SAVE",{order:e.toArray(),dropped:c}),m()}function m(){o.popover("destroy"),$(i).modal("hide")}function g(){var e=1;$.each($("li",s),function(t,n){$(".veil",n).css("display")=="none"&&($(".numberLabel",n).html(e),e++)})}function y(e){e?(f.removeAttr("disabled"),a.removeAttr("disabled")):(f.attr("disabled",!0),a.attr("disabled",!0));if(l){var t=$(".veil",l)[0];$(t).css("display")=="none"?$(f).html(i18n.viewer.organizePopupJS.labelButtonHide):$(f).html(i18n.viewer.organizePopupJS.labelButtonShow)}else $(f).html(i18n.viewer.organizePopupJS.labelButtonHide)}function b(e){var t;return t=i18n.viewer.organizePopupJS.messageStart+" ",t+=e==1?i18n.viewer.organizePopupJS.messageSinglePoint+".":e+" "+i18n.viewer.organizePopupJS.messageMultiPoint+".",t=t+"  "+i18n.viewer.organizePopupJS.messagePermantRemove,t+=e==1?" "+i18n.viewer.organizePopupJS.messageRecord+" ":" "+i18n.viewer.organizePopupJS.messageRecordPlural+" ",t+=i18n.viewer.organizePopupJS.messageConfirm,t}var r=this,i=n,s=$(i).find(".picturesGrid"),o=$(i).find(".btnSave"),u=$(i).find(".btnClose"),a=$(i).find("#btnDelete"),f=$(i).find("#btnHide"),l,c;$(o).click(p),$(u).click(m),$(a).fastClick(function(){l&&(c.push(parseInt($(l).data("featureid"))),$(l).remove(),y(!1),g())}),$(f).fastClick(function(){l&&($(f).html()==i18n.viewer.organizePopupJS.labelButtonShow?($(l).find(".veil").hide(),$(l).find(".numberLabel").show()):($(l).find(".veil").show(),$(l).find(".numberLabel").hide()),g(),y(!0))}),this.present=function(t){c=[],$(s).empty(),$.each(t,function(t,n){var r=e.getSymbolCss(n.attributes.getColor()),i=$('<li data-featureid="'+n.attributes.getID()+'"></li>'),o=$('<img src="'+n.attributes.getThumbURL()+'"/>'),u=$('<div class="numberLabel '+r+'">'+(t+1)+"</div>"),a=$('<div class="veil"></div>'),f=$('<div class="halo"></div>');$(i).append(o),$(i).append(u),$(i).append(a),$(i).append(f),$(s).append(i),n.attributes.getTourVisibility()||($(a).show(),$(u).hide())}),$(s).sortable({start:function(e,t){},update:function(e,t){g()}}),$(i).modal(),$($("li",s)).bind("mousedown",function(e){h(e.currentTarget)}),y(!1),setTimeout(function(){$.each($("li",s),function(e,t){var n=$(".halo",t);$(n).width($(t).width()-parseInt($(n).css("border-left-width"))*2),$(n).height($(t).height()-parseInt($(n).css("border-left-width"))*2)})},300),g()},this.saveConfirmationCallback=function(e){e?v():m()},this.initLocalization=function(){dojo.query("#organizePopup h3")[0].innerHTML=i18n.viewer.builderHTML.organizeHeader,dojo.byId("generalCaption").innerHTML=i18n.viewer.builderHTML.organizeGeneralCaption,dojo.byId("btnDelete").innerHTML=i18n.viewer.builderHTML.organizeDelete,dojo.byId("btnHide").innerHTML=i18n.viewer.builderHTML.organizeHide,dojo.query("#organizePopup .btnClose")[0].innerHTML=i18n.viewer.builderHTML.modalCancel,dojo.query("#organizePopup .btnSave")[0].innerHTML=i18n.viewer.builderHTML.modalApply}}}),define("storymaps/maptour/builder/Builder",["storymaps/maptour/core/WebApplicationData","storymaps/utils/ResamplePicture","storymaps/maptour/builder/DataPopup","storymaps/maptour/builder/AddPopup","storymaps/maptour/builder/SettingsPopup","storymaps/maptour/builder/OrganizePopup","storymaps/ui/multiTips/MultiTips","storymaps/maptour/core/MapTourHelper","storymaps/utils/Helper","dojo/_base/lang","dojo/has","esri/IdentityManager"],function(e,t,n,r,i,s,o,u,a,f,l){function x(e){$("#builderPanel > div > button").attr("disabled",!e)}function T(){return $("#save-counter").html()&&$("#save-counter").html()!=i18n.viewer.builderJS.noPendingChange}function N(){$("#save-counter").html(i18n.viewer.builderJS.noPendingChange),$("#save-counter").css("color","#999"),A()}function C(){$("#builderPanel .discard-popover").length>0&&$("#builderPanel .builder-discard").popover("hide"),$("#builderPanel .view-popover").length>0&&$("#builderPanel .builder-view").popover("hide")}function k(){$("#builderPanel .builder-discard").popover({trigger:"manual",placement:"bottom",html:!0,content:'<script> $("#builderPanel .builder-discard").next(".popover").addClass("discard-popover"); $("#builderPanel .builder-view").popover("hide"); $("#builderPanel .builder-save").popover("hide");</script>'+i18n.viewer.builderJS.popoverDiscard+" "+'<button type="button" class="btn btn-danger btn-small" onclick="app.builder.discard(true)">'+i18n.viewer.builderJS.yes+"</button> "+'<button type="button" class="btn btn-small" onClick="app.builder.discard(false)">'+i18n.viewer.builderJS.no+"</button>"}),$("#builderPanel .builder-view").popover({trigger:"manual",html:!0,content:'<script> $("#builderPanel .builder-view").next(".popover").addClass("view-popover"); $("#builderPanel .builder-discard").popover("hide"); $("#builderPanel .builder-save").popover("hide");</script>'+i18n.viewer.builderJS.popoverLoseSave+" "+'<button type="button" class="btn btn-danger btn-small" onclick="app.builder.switchToView(true)">'+i18n.viewer.builderJS.ok+"</button> "+'<button type="button" class="btn btn-small" onClick="app.builder.switchToView(false)">'+i18n.viewer.builderHTML.modalCancel+"</button>"}),$("#builderPanel .builder-save").popover({trigger:"manual",html:!0,content:'<script>setTimeout(function(){$("#builderPanel .builder-save").next(".popover").css("margin-left", $("#builderPanel > div").width() + 30).addClass("builderPanelPopover");}, 0);</script>'+i18n.viewer.builderJS.popoverSaveWhenDone+' <button type="button" class="btn btn-success btn-small" onclick="app.builder.closeBuilderSaveIntro()">'+i18n.viewer.builderJS.gotIt+"</button> "}),dojo.query("#builderPanel .builder-settings").attr("title",i18n.viewer.builderHTML.buttonSettings),dojo.query("#builderPanel .builder-view").attr("title",i18n.viewer.builderHTML.buttonView)}function L(){$("#builderPanel .builder-settings").popover({html:!0,trigger:"manual",placement:"bottom",content:'<script>$("#builderPanel .builder-settings").next(".popover").addClass("settings-popover");$("#builderPanel .builder-settings").next(".popover").css("margin-left", - $("#builderPanel button").eq(0).width() - $("#builderPanel button").eq(0).width() / 2 + 5 + "px");$("#builderPanel .builder-settings").next(".popover").find(".stepSave").css("display", "block");$("#builderPanel .builder-settings").next(".popover").find(".stepSaved").css("display", "none");$("#builderPanel .builder-settings").next(".popover").find(".stepFailed").css("display", "none");</script><div class="stepSave" style="margin-top: 3px">'+i18n.viewer.builderJS.savingApplication+'... <img src="resources/icons/loader-upload.gif" class="addSpinner" alt="Uploading">'+"</div>"+'<div class="stepSaved">'+i18n.viewer.builderJS.saveSuccess+" "+'<button type="button" class="btn btn-success btn-small" onclick="app.builder.hideSaveConfirmation()" style="vertical-align: 1px;">'+i18n.viewer.builderJS.gotIt+"</button> "+"</div>"+'<div class="stepFailed" style="color: red;">'+i18n.viewer.builderJS.saveError+" "+'<button type="button" class="btn btn-danger btn-small" onclick="app.builder.hideSaveConfirmation()" style="vertical-align: 1px;">'+i18n.viewer.builderJS.gotIt+"</button> "+"</div>"}),dojo.query("#builderPanel .builder-settings").attr("title",i18n.viewer.builderHTML.buttonSettings)}function A(){$("#builderPanel .builder-view").click(M),$("#builderPanel .builder-discard").click(O)}function O(){T()&&$("#builderPanel .builder-discard").popover("show")}function M(){T()?$("#builderPanel .builder-view").popover("show"):h.switchToView(!0)}function _(){$(".builderMobile a").html($(".builderMobile a").html().replace("Browse","+")),$(".builderMobile input").change(function(){b=$("<canvas>"),w=$("<canvas>"),E=$("<img/>"),S=$("<img/>");var e=this.files[0];setTimeout(function(){D(e)},0)})}function D(e){if(!e||e.type!="image/jpeg")return;if(app.data.getMaxAllowedFeatureReached()||app.data.getTourPoints().length>=APPCFG.MAX_ALLOWED_POINTS){alert(i18n.viewer.builderHTML.addMaxPointReachedMobile);return}var n=prompt(i18n.viewer.builderHTML.addMobileName+":");if(n){loadingIndicator.start(),loadingIndicator.setMessage(i18n.viewer.builderHTML.addMobileUploading);var r=new MegaPixImage(e);r.render(E.get(0),{maxWidth:app.config.picRecommendedWidth,maxHeight:app.config.picRecommendedHeight}),E.load(function(e){t.resample(b.get(0),E,e.currentTarget.naturalWidth,e.currentTarget.naturalHeight,app.config.picRecommendedWidth,app.config.picRecommendedHeight,window.orientation),t.resample(w.get(0),E,e.currentTarget.naturalWidth,e.currentTarget.naturalHeight,app.config.thumbnailMaxWidth,app.config.thumbnailMaxHeight,window.orientation),app.data.addTourPointUsingData(app.map.extent.getCenter(),n,"",APPCFG.PIN_DEFAULT_CFG,b.get(0).toDataURL("image/jpeg"),w.get(0).toDataURL("image/jpeg"),function(){save(),$(".builderMobile form").get(0).reset(),loadingIndicator.stop()},function(){$(".builderMobile form").get(0).reset(),loadingIndicator.stop(),loadingIndicator.setMessage(i18n.viewer.builderHTML.addMobileError),setTimeout(function(){loadingIndicator.stop()},2500)})})}else alert(i18n.viewer.builderHTML.addMobileNameMandatory)}function P(e){app.data.dropTourPoints(e.dropped),app.data.updateTourPointsOrder(e.order),h.incrementSaveCounter()}function H(t){g.present({layout:e.getLayout(),fieldsError:t,allFields:app.data.getSourceLayer().fields,logoURL:B(),logoTarget:e.getLogoTarget(),headerLinkText:e.getHeaderLinkText()==undefined?APPCFG.HEADER_LINK_TEXT:e.getHeaderLinkText(),headerLinkURL:e.getHeaderLinkURL()==undefined?APPCFG.HEADER_LINK_URL:e.getHeaderLinkURL(),fieldConfig:app.data.getFieldsConfig(),currentColors:e.getColors(),zoomLevel:e.getZoomLevel(),extent:a.getWebMapExtentFromItem(app.data.getWebMapItem().item)})}function B(){var t=e.getLogoURL();return t?t==c&&(t=null):t=APPCFG.HEADER_LOGO_URL,t}function j(t){t.layout&&e.setLayout(t.layout),t.colors&&e.setColors(t.colors[0],t.colors[1],t.colors[2]),e.setFieldsOverride(t.fieldConfig);var n=t.logoURL;n?n==APPCFG.HEADER_LOGO_URL?e.setLogoURL(null):e.setLogoURL(n):e.setLogoURL(c),e.setLogoTarget(t.logoTarget),e.setHeaderLink(t.headerLinkText,t.headerLinkURL),t.zoomLevel!="-1"?e.setZoomLevel(t.zoomLevel):e.setZoomLevel("");var r=a.serializeExtentToItem(t.extent);a.serializedExtentEquals(r,app.data.getWebMapItem().item.extent)||(app.data.getWebMapItem().item.extent=r,app.data.initialExtentHasBeenEdited=!0),h.incrementSaveCounter(),dojo.publish("CORE_UPDATE_UI")}function F(t){t.src=="title"?t.value!=app.data.getWebMapItem().item.title?t.value!=e.getTitle()&&(e.setTitle(t.value),h.incrementSaveCounter()):e.setTitle(""):t.src=="subtitle"&&(t.value!=app.data.getWebMapItem().item.snippet&&t.value!=i18n.viewer.headerJS.editMe?t.value!=e.getSubtitle()&&(e.setSubtitle(t.value),h.incrementSaveCounter()):e.setSubtitle("")),$("#headerMobile .banner ."+t.src).html(t.value)}function I(e){var t=0;if(!app.data.getCurrentGraphic())return;app.data.getCurrentGraphic().attributes.getName()!=e.title&&t++,app.data.getCurrentGraphic().attributes.getDescription()!=e.description&&t++,t&&(h.incrementSaveCounter(t),app.data.updateCurrentTourPoint(e.title,e.description))}function q(){if(app.data.initialExtentHasBeenEdited){var e=at(),t=app.data.getWebMapItem().item,n=app.data.getWebMapItem().itemData,r=esri.id.findCredential(e).userId,i=esri.id.findCredential(e).token;a.prepareWebmapItemForCloning(n);var s={f:"json",item:t.item,title:t.title,tags:t.tags,extent:JSON.stringify(t.extent),text:JSON.stringify(n),type:t.type,typeKeywords:t.typeKeywords,overwrite:!0,thumbnailURL:t.thumbnailURL,token:i},o=esri.request({url:e+"/sharing/content/users/"+r+(t.ownerFolder?"/"+t.ownerFolder:"")+"/addItem",handleAs:"json",content:s},{usePost:!0});o.then(U,ut)}else U()}function R(){$.each(app.data.getTourPoints(!0),function(e,t){t.hasBeenUpdated()&&!app.data.hasBeenAdded(t)&&t.restoreOriginal()})}function U(){var e=[],t=app.data.getDroppedPoints();$.each(app.data.getTourPoints(!0),function(t,n){n.hasBeenUpdated()&&e.push(n.getUpdatedFeature())}),e.length>0||t.length>0?W(app.data.getSourceLayer(),[],e,t,ot,function(e){ut("FS",e)}):ot({success:!0})}function z(e,t){var n=e.match(/.*\/arcgis\/rest\//)[0],r=e.match(/.*\/arcgis\/rest\/services\/(.*)\/FeatureServer\//);if(!n||!r||!r[1])return;var i=esri.request({url:n.substr(0,n.length-5)+"admin/services/"+r[1]+".FeatureServer/updateDefinition",handleAs:"json",content:{updateDefinition:JSON.stringify(t?{hasStaticData:!1,capabilities:"Query,Editing,Create,Update,Delete",allowGeometryUpdates:!0,editorTrackingInfo:{enableEditorTracking:!1,enableOwnershipAccessControl:!1,allowOthersToUpdate:!0,allowOthersToDelete:!0}}:{capabilities:"Query"}),f:"json",token:esri.id.findCredential(at()).token}},{usePost:!0});return i}function W(e,t,n,r,i,s){if(K(e))z(e.url,!0).then(function(){var o=e.applyEdits(t,n,r);o.then(function(t){z(e.url,!1).then(function(){i(t)},s)},s)},s);else{var o=e.applyEdits(t,n,r);o.then(i,s)}}function X(e,t,n,r,i){K(e)?z(e.url,!0).then(function(){e.addAttachment(t,document.getElementById(n),function(t){z(e.url,!1).then(function(){r(t)},i)},i)},i):e.addAttachment(t,document.getElementById(n),r,i)}function V(e,t){var n=new dojo.Deferred;return K(e)?z(e.url,t).then(function(){n.resolve()}):n.resolve(),n}function J(e,t){if(K(e)){var n=new dojo.Deferred;return z(e.url,!0).then(function(){t().then(function(t){z(e.url,!1).then(function(){n.resolve(t)})})}),n}return t()}function K(e){return!1}function Q(){var e=$(".colorSelectorPin.selectedColor").index()-1,t=$(this).index()-1;if(e!=t){$(".colorSelectorPin").removeClass("selectedColor"),$(this).addClass("selectedColor");var n=$.grep(u.getSymbolColors(),function(e,n){return n==t});h.incrementSaveCounter(),app.data.updateCurrentTourPointColor(n[0])}}function G(e,t){app.data.getSourceLayer().queryAttachmentInfos(e,function(n){V(app.data.getSourceLayer(),!0).then(function(){var r=!1;$.each(n,function(n,i){if(r)return;app.data.getSourceLayer().deleteAttachments(e,[i.id],function(){},function(){r=!0,t(!1)})}),V(app.data.getSourceLayer(),!1).then(function(){r?t(!1):t(!0)},function(){t(!1)})},function(e){V(app.data.getSourceLayer(),!1).then(function(){t(!1)})})},function(e){t(!1)})}function Y(e,t){app.data.getSourceLayer().queryAttachmentInfos(e,function(n){V(app.data.getSourceLayer(),!0).then(function(){var r=[];$.each(n,function(e,t){r.push(t.id)}),r=r.sort().slice(1);var i=!1;$.each(r,function(t,n){if(i)return;app.data.getSourceLayer().deleteAttachments(e,[n],function(){},function(){i=!0})}),V(app.data.getSourceLayer(),!1).then(function(){i?t(!1):t(!0)},function(){t(!1)})},function(e){V(app.data.getSourceLayer(),!1).then(function(){t(!1)})})},function(e){t(!1)})}function Z(e,t,n,r){var i=nt(app.data.getSourceLayer().url,e,t,"picture.jpg"),s=function(){r(!1)};i.then(function(t){var i=t.addAttachmentResult.objectId,o=nt(app.data.getSourceLayer().url,e,n,"thumbnail.jpg");o.then(function(t){var n=t.addAttachmentResult.objectId;r(!0,e,i,n)},s)},s)}function et(e,t,n){var r=nt(app.data.getSourceLayer().url,e,t,"thumbnail.jpg"),i=function(){n(!1)};r.then(function(t){var r=t.addAttachmentResult.objectId;n(!0,e,r)},i)}function tt(e,t,n,r){it(e,t,function(t,i,s){t?it(e,n,function(e,t,n){e?r(!0,i,s,n):r(!1)}):r(!1)})}function nt(e,t,n,r){var i=new FormData;return i.append("attachment",rt(n),r),i.append("f","json"),J(app.data.getSourceLayer(),function(){return esri.request({url:e+"/"+t+"/addAttachment",form:i},{usePost:!0})})}function rt(e){var t=atob(e.split(",")[1]),n=new ArrayBuffer(t.length),r=new Uint8Array(n);for(var i=0;i<t.length;i++)r[i]=t.charCodeAt(i);try{return new Blob([n],{type:"image/jpeg"})}catch(s){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;var o=new BlobBuilder;return o.append(n),o.getBlob({type:"image/jpeg"})}}function it(e,t,n){X(app.data.getSourceLayer(),e,t,function(t){!t.success||t.attachmentId==null?n(!1):n(!0,e,t.attachmentId)},function(){n(!1)})}function st(){var t=at(),n=new esri.arcgis.Portal(t);dojo.connect(esri.id,"onDialogCreate",ft),n.signIn().then(function(){var n=a.getAppID(p.isProd()),r=esri.id.findCredential(t).userId,i=esri.id.findCredential(t).token,s=f.clone(app.data.getAppItem());delete s.avgRating,delete s.modified,delete s.numComments,delete s.numRatings,delete s.numViews,delete s.size,s=f.mixin(s,{f:"json",token:i,overwrite:!0,text:JSON.stringify(e.get())});var o=esri.request({url:t+"/sharing/content/users/"+r+(s.ownerFolder?"/"+s.ownerFolder:"")+"/addItem",handleAs:"json",content:s},{usePost:!0});o.then(q,ut)},function(e){ut("APP",e)})}function ot(e){e.length==0||e&&e.success?($("#builderPanel .builder-settings").next(".popover").find(".stepSave").css("display","none"),$("#builderPanel .builder-settings").next(".popover").find(".stepSaved").css("display","block"),setTimeout(function(){$("#builderPanel .builder-settings").popover("hide")},3500),C(),N(),app.data.updateAfterSave(),x(!0)):ut()}function ut(e,t){$("#builderPanel .builder-settings").next(".popover").find(".stepSave").css("display","none"),$("#builderPanel .builder-settings").next(".popover").find(".stepFailed").css("display","block"),x(!0)}function at(){return configOptions.sharingurl.split("/").slice(0,3).join("/")}function ft(){$(".esriSignInDialog").find("#dijitDialogPaneContentAreaLoginText").css("display","none"),$(".esriSignInDialog").find(".dijitDialogPaneContentArea:first-child").find(":first-child").first().after("<div id='dijitDialogPaneContentAreaAtlasLoginText'>"+i18n.viewer.builderJS.signIn+" <a href='http://"+esri.id._arcgisUrl+"' title='"+esri.id._arcgisUrl+"' target='_blank'>"+esri.id._arcgisUrl+"</a> "+i18n.viewer.builderJS.signInTwo+"</div>"),dojo.connect(esri.id,"onDialogCancel",function(e){$("#builderPanel .builder-settings").popover("hide")})}var c="NO_LOGO",h=this,p=null,d=new n($("#dataPopup")),v=new r($("#addPopup")),m=new s($("#organizePopup")),g=new i($("#settingsPopup"),APPCFG.COLOR_SCHEMES,APPCFG.HEADER_LOGO_URL),y=!0,b=null,w=null,E=null,S=null;return this.init=function(e){p=e,$(document).ready(dojo.hitch(this,function(){console.log("maptour.builder.Builder - init");if(!a.getAppID(p.isProd())){console.error("maptour.builder.Builder - abort builder initialization, no appid supplied");return}$("body").addClass("builder-mode"),this.initLocalization(),$("#builderPanel").css("display","block"),$("#builderPanel2").css("display","block"),A(),k(),a.browserSupportAttachementUsingFileReader()?_():$(".builderMobile").css("display","none"),L(),dojo.subscribe("SETTINGS_POPUP_SAVE",j),dojo.subscribe("ORGANIZE_POPUP_SAVE",P),dojo.subscribe("HEADER_EDITED",F),dojo.subscribe("PIC_PANEL_EDIT",I),window.onbeforeunload=function(e){e=e||window.event;if(!T())return;return e&&(e.returnValue=i18n.viewer.builderJS.closeWithPendingChange),i18n.viewer.builderJS.closeWithPendingChange}}))},this.save=function(){console.log("maptour.builder.Builder - save"),x(!1),closeBuilderSaveIntro(),destroyDataWarning(),$("#builderPanel .builder-settings").popover("show"),st()},this.discard=function(t){t&&(x(!1),e.restoreOriginalData(),R(),app.data.discardChanges(),N(),dojo.publish("CORE_UPDATE_UI"),x(!0)),$("#builderPanel .builder-discard").popover("hide")},this.switchToView=function(e){e?document.location="?"+document.location.search.split("edit")[0].slice(1,-1):$("#builderPanel .builder-view").popover("hide")},this.incrementSaveCounter=function(e){var t=$("#save-counter").html();T()||(t=0,y&&setTimeout(function(){$("#builderPanel .builder-save").popover("show")},250)),t=t?parseInt(t)+(e?e:1)+" "+i18n.viewer.builderJS.unSavedChangePlural:i18n.viewer.builderJS.unSavedChangeSingular,$("#save-counter").html(t),$("#save-counter").css("color","#FFF")},this.closeBuilderSaveIntro=function(){$("#builderPanel .builder-save").popover("destroy"),y=!1},this.hideSaveConfirmation=function(){$("#builderPanel .builder-settings").popover("hide")},this.setDataWarning=function(e,t){var n=e;n+=' <button type="button" class="btn btn-small" onclick="window.open(\''+t+"', '_blank');\">"+i18n.viewer.builderJS.dataWarningEdit+"</button>",n+=' <button type="button" class="btn btn-small" onclick="app.builder.destroyDataWarning()">'+i18n.viewer.builderJS.dataWarningClose+"</button>",$("#builderPanel .builder-settings").popover("destroy"),$("#builderPanel .builder-settings").popover({html:!0,trigger:"manual",content:'<script>$("#builderPanel .builder-settings").next(".popover").addClass("datawarning-popover").css("margin-left", $("#builderPanel > div").eq(0).width() + 30 + "px");</script>'+n}),$("#builderPanel .builder-settings").popover("show")},this.destroyDataWarning=function(){$("#builderPanel .builder-settings").popover("destroy"),L()},this.presentDataPopup=function(e,t){return d.present(e,t)},this.organizePopupShow=function(){m.present(app.data.getAllFeatures())},this.organizePopupSaveConfirmationCallback=function(e){m.saveConfirmationCallback(e)},this.addPopupShow=function(){v.present()},this.openFieldsSettingOnStartup=function(){H(!0)},this.settingsPopupShow=function(){C(),H(!1)},this.updateFSTourPoint=function(e,t,n){W(app.data.getSourceLayer(),[],[e],[],t,n)},this.addFSNewTourPointUsingData=function(e,t,n,r){W(app.data.getSourceLayer(),[e],null,null,function(e){!e||!e[0]||!e[0].success?r(!1):Z(e[0].objectId,t,n,r)},function(e){r(!1)})},this.addTemporaryTourPointUsingForm=function(e,t,n){W(app.data.getSourceLayer(),[e],null,null,function(e){!e||!e[0]||!e[0].success?n(!1):it(e[0].objectId,t,n)},function(e){n(!1)})},this.saveTemporaryTourPointUsingForm=function(e,t,n,r){W(app.data.getSourceLayer(),null,[t],null,function(t){it(e,n,r)},function(e){r(!1)})},this.changePicAndThumbUsingData=function(e,t,n,r){G(e,function(i){i?Z(e,t,n,r):r(!1)})},this.changeThumbnailUsingData=function(e,t,n){Y(e,function(r){r?et(e,t,n):n(!1)})},this.changePicAndThumbUsingForm=function(e,t,n,r){G(e,function(i){i?tt(e,t,n,r):r(!1)})},this.createPinPopup=function(e,t,n){var r="<p style='text-align:center'>"+i18n.viewer.builderJS.dragColorPicker+"</p>",i=e.attributes.getColor();u.colorExists(i)||(i=u.getDefaultColor());var s=u.getSymbolConfig("normal").width,a=u.getSymbolConfig("normal").height;$.each(u.getSymbolColors(),function(e,n){var o=(""+i).toLowerCase()==n.toLowerCase()?"selectedColor":"";r+='<img class="colorSelectorPin '+o+'" src="'+u.getSymbolUrl(n,t+1)+'" alt="" style="width:'+s+"px; height: "+a+'px;"/>'}),app.mapTips=new o({map:app.map,content:r,pointArray:[e],labelDirection:"auto",backgroundColor:"#444444",pointerColor:"#444444",textColor:"#ffffff",minWidth:(s+15)*u.getSymbolColors().length,offsetTop:32,topLeftNotAuthorizedArea:l("touch")?[40,173]:[30,143],mapAuthorizedWidth:u.isModernLayout()?dojo.query("#picturePanel").position()[0].x:-1,mapAuthorizedHeight:u.isModernLayout()?dojo.query("#footerDesktop").position()[0].y-dojo.query("#header").position()[0].h:-1,visible:n}),$(".colorSelectorPin").click(Q)},this.movedPin=function(){h.incrementSaveCounter(),app.mapTips.show()},this.hidePinPopup=function(e){app.mapTips.hide()},this.showBrowserWarning=function(){$("#browserPopup .modal-header h3").html(i18n.viewer.errors.oldBrowserTitle),$("#browserPopup .browserExplain").html(i18n.viewer.errors.oldBrowserExplain),$("#browserPopup .browserExplain2").html(i18n.viewer.errors.oldBrowserExplain2),$("#browserPopup .modal-footer .btnClose").html(i18n.viewer.errors.oldBrowserClose),$("#browserPopup").modal()},this.initLocalization=function(){dojo.query("#builderPanel h4")[0].innerHTML=i18n.viewer.builderHTML.panelHeader,dojo.query("#builderPanel button")[0].innerHTML=i18n.viewer.builderHTML.buttonSave,dojo.query("#builderPanel button")[1].innerHTML=i18n.viewer.builderHTML.buttonDiscard,dojo.query("#builderPanel button")[2].innerHTML='<img src="resources/icons/builder-settings.png" style="vertical-align: -6px;" alt="'+i18n.viewer.builderHTML.buttonSettings+'" />',dojo.query("#builderPanel button")[3].innerHTML='<img src="resources/icons/builder-view.png" style="vertical-align: -6px;" alt="'+i18n.viewer.builderHTML.buttonView+'" />',dojo.query("#save-counter")[0].innerHTML=i18n.viewer.builderJS.noPendingChange,dojo.byId("organizeSlidesButton").innerHTML=i18n.viewer.builderHTML.buttonOrganize,dojo.byId("addPopupButton").innerHTML=i18n.viewer.builderHTML.buttonAdd,d.initLocalization(),m.initLocalization(),g.initLocalization(),v.initLocalization()},resetWebAppData=function(){var t=at(),n=new esri.arcgis.Portal(t);n.signIn().then(function(){var n=a.getAppID(p.isProd()),r=esri.id.findCredential(t).userId,i=esri.id.findCredential(t).token,s=f.clone(app.data.getAppItem());delete s.avgRating,delete s.modified,delete s.numComments,delete s.numRatings,delete s.numViews,delete s.size,delete s.uploaded;var o=e.get(),u=o.values.webmap;o.values={webmap:u},s=f.mixin(s,{f:"json",token:i,overwrite:!0,text:JSON.stringify(o)});var l=esri.request({url:t+"/sharing/content/users/"+r+"/addItem",handleAs:"json",content:s},{usePost:!0})},function(e){console.error(i18n.viewer.errors.mapSave)})},this}),require(["storymaps/ui/loadingIndicator/LoadingIndicator","storymaps/maptour/core/Core","storymaps/maptour/builder/Builder"],function(e){}),define("storymaps/maptour/BuildConfig",function(){});